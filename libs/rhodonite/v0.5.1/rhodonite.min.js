/*! For license information please see rhodonite.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Rn=t():e.Rn=t()}(self,(function(){return(()=>{var e={2992:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec2 a_texcoord_1;\nin vec4 a_joint;\nin vec4 a_weight;\nin vec4 a_baryCentricCoord;\nout vec3 v_color;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\nout vec2 v_texcoord_0;\nout vec2 v_texcoord_1;\nout vec3 v_baryCentricCoord;\n#ifdef RN_USE_TANGENT_ATTRIBUTE\n  in vec4 a_tangent;\n  out vec3 v_tangent_inWorld;\n  out vec3 v_binormal_inWorld;\n#endif\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main()\n{\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  v_color = a_color;\n\n  bool isSkinning = false;\n\n  isSkinning = processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n  v_texcoord_0 = a_texcoord_0;\n  v_texcoord_1 = a_texcoord_1;\n\n\n  #ifdef RN_USE_TANGENT_ATTRIBUTE\n    v_tangent_inWorld = normalMatrix * a_tangent.xyz;\n    v_binormal_inWorld = cross(v_tangent_inWorld, v_normal_inWorld) * a_tangent.w;\n  #endif\n  v_baryCentricCoord = a_baryCentricCoord.xyz;\n\n// #ifdef RN_IS_POINTSPRITE\n\nvec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\nvec3 viewPosition = get_viewPosition(cameraSID, 0);\nfloat distanceFromCamera = length(position_inWorld.xyz - viewPosition);\nvec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\nfloat distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\nfloat maxPointSize = get_pointSize(materialSID, 0);\ngl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);\n\n// #endif\n\n\n}\n",shaderStage:"vertex",isFragmentShader:!1}},3034:e=>{e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./../../dist/",n(n.s="./src/index.ts")}({"./src/index.ts":function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n("./src/main/Shaderity.ts"));t.default=a.default},"./src/main/Reflection.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(e,t){this.__attributeSemanticsMap=new Map,this.__uniformSemanticsMap=new Map,this.__attributes=[],this.__varyings=[],this.__uniforms=[],this.__splittedShaderCode=e,this.__shaderStage=t,this.__setDefaultAttributeAndUniformSemanticsMap()}get attributes(){return this.__attributes}get varyings(){return this.__varyings}get uniforms(){return this.__uniforms}get attributesNames(){return this.__attributes.map((e=>e.name))}get attributesSemantics(){return this.__attributes.map((e=>e.semantic))}get attributesTypes(){return this.__attributes.map((e=>e.type))}addAttributeSemanticsMap(e){this.__attributeSemanticsMap=new Map([...this.__attributeSemanticsMap,...e])}addUniformSemanticsMap(e){this.__uniformSemanticsMap=new Map([...this.__uniformSemanticsMap,...e])}addAttributeSemantics(e,t){this.__attributeSemanticsMap.set(e,t)}addUniformSemantics(e,t){this.__uniformSemanticsMap.set(e,t)}resetAttributeSemantics(){this.__attributeSemanticsMap=new Map}resetUniformSemantics(){this.__uniformSemanticsMap=new Map}reflect(){const e=this.__splittedShaderCode,t=this.__shaderStage;for(const n of e)this.__matchAttribute(n,t)?this.__addAttribute(n):this.__matchVarying(n,t)?this.__addVarying(n,t):n.match(/^(?![\/])[\t ]*uniform[\t ]+/)&&this.__addUniform(n)}__setDefaultAttributeAndUniformSemanticsMap(){this.__attributeSemanticsMap.set("position","POSITION"),this.__attributeSemanticsMap.set("color$","COLOR_0"),this.__attributeSemanticsMap.set("color_?0","COLOR_0"),this.__attributeSemanticsMap.set("texcoord$","TEXCOORD_0"),this.__attributeSemanticsMap.set("texcoord_?0","TEXCOORD_0"),this.__attributeSemanticsMap.set("texcoord_?1","TEXCOORD_1"),this.__attributeSemanticsMap.set("normal","NORMAL"),this.__attributeSemanticsMap.set("tangent","TANGENT"),this.__attributeSemanticsMap.set("joint$","JOINTS_0"),this.__attributeSemanticsMap.set("bone$","JOINTS_0"),this.__attributeSemanticsMap.set("joint_?0","JOINTS_0"),this.__attributeSemanticsMap.set("bone_?0","JOINTS_0"),this.__attributeSemanticsMap.set("weight$","WEIGHTS_0"),this.__attributeSemanticsMap.set("weight_?0","WEIGHTS_0"),this.__uniformSemanticsMap.set("worldmatrix","WorldMatrix"),this.__uniformSemanticsMap.set("normalmatrix","NormalMatrix"),this.__uniformSemanticsMap.set("viewmatrix","ViewMatrix"),this.__uniformSemanticsMap.set("projectionmatrix","ProjectionMatrix"),this.__uniformSemanticsMap.set("modelviewmatrix","ModelViewMatrix")}__matchAttribute(e,t){return"vertex"===t&&e.match(/^(?![\/])[\t ]*(attribute|in)[\t ]+.+;/)}__addAttribute(e){const t={name:"",type:"float",semantic:"UNKNOWN"},n=e.match(i.attributeAndVaryingTypeRegExp);if(n){const a=n[1];t.type=a;const r=n[2];t.name=r;const o=e.match(i.semanticRegExp);if(o)t.semantic=o[1];else for(let[e,n]of this.__attributeSemanticsMap)r.match(new RegExp(e,"i"))&&(t.semantic=n)}this.__attributes.push(t)}__matchVarying(e,t){return"vertex"===t?e.match(/^(?![\/])[\t ]*(varying|out)[\t ]+.+;/):e.match(/^(?![\/])[\t ]*(varying|in)[\t ]+.+;/)}__addVarying(e,t){const n={name:"",type:"float",inout:"in"},a=e.match(i.attributeAndVaryingTypeRegExp);if(a){const e=a[1];n.type=e;const i=a[2];n.name=i,n.inout="vertex"===t?"out":"in"}this.__varyings.push(n)}__addUniform(e){const t={name:"",type:"float",semantic:"UNKNOWN"},n=e.match(i.uniformTypeRegExp);if(n){const a=n[1];t.type=a;const r=n[2];t.name=r;const o=e.match(i.semanticRegExp);if(o)t.semantic=o[1];else for(let[e,n]of this.__uniformSemanticsMap)r.match(new RegExp(e,"i"))&&(t.semantic=n)}this.__uniforms.push(t)}}t.default=i,i.attributeAndVaryingTypeRegExp=/[\t ]+(float|int|vec2|vec3|vec4|mat2|mat3|mat4|ivec2|ivec3|ivec4)[\t ]+(\w+);/,i.uniformTypeRegExp=/[\t ]+(float|int|vec2|vec3|vec4|mat2|mat3|mat4|ivec2|ivec3|ivec4|sampler2D|samplerCube|sampler3D)[\t ]+(\w+);/,i.semanticRegExp=/<.*semantic[\t ]*=[\t ]*(\w+).*>/},"./src/main/ShaderEditor.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static _insertDefinition(e,t){const n=t.replace(/#define[\t ]+/,"");e.unshift(`#define ${n}`)}static _fillTemplate(e,t){const n=e.replace(/\/\*[\t ]*shaderity:[\t ]*(@{[\t ]*)(\S+)([\t ]*})[\t ]*\*\//g,"${this.$2}");return new Function("return `"+n+"`;").call(t)}}},"./src/main/ShaderTransformer.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static _transformToGLSLES1(e,t,n){return this.__convertOrInsertVersionGLSLES1(e),this.__removeES3Qualifier(e,n),this.__convertIn(e,t),this.__convertOut(e,t,n),this.__removePrecisionForES3(e),this.__convertTextureFunctionToES1(e,t,n),e}static _transformToGLSLES3(e,t){return this.__convertOrInsertVersionGLSLES3(e),this.__convertAttribute(e,t),this.__convertVarying(e,t),this.__convertTextureCube(e),this.__convertTexture2D(e),this.__convertTexture2DProd(e),this.__convertTexture3D(e),this.__convertTexture3DProd(e),e}static _transformTo(e,t,n,i){return e.match(/webgl2|es3/i)?this._transformToGLSLES3(t,n):e.match(/webgl1|es1/i)?this._transformToGLSLES1(t,n,i):(console.error("Invalid Version"),t)}static __convertOrInsertVersionGLSLES1(e){this.__removeFirstMatchingLine(e,/^(?![\/])[\t ]*#[\t ]*version[\t ]+.*/),e.unshift("#version 100")}static __convertOrInsertVersionGLSLES3(e){this.__removeFirstMatchingLine(e,/^(?![\/])[\t ]*#[\t ]*version[\t ]+.*/),e.unshift("#define GLSL_ES3"),e.unshift("#version 300 es")}static __convertIn(e,t){let n;n=t?function(e,t){return"varying "+t}:function(e,t){return"attribute "+t},this.__replaceLine(e,/^(?![\/])[\t ]*in[\t ]+((highp|mediump|lowp|)[\t ]*\w+[\t ]*\w+[\t ]*;)/,n)}static __convertOut(e,t,n){if(t){const t=this.__removeOutQualifier(e,n);if(null==t)return;this.__addGLFragColor(t,e,n)}else{const t=/^(?![\/])[\t ]*out[\t ]+((highp|mediump|lowp|)[\t ]*\w+[\t ]*\w+[\t ]*;)/,n=function(e,t){return"varying "+t};this.__replaceLine(e,t,n)}}static __removeOutQualifier(e,t){const n=/^(?![\/])[\t ]*out[\t ]+((highp|mediump|lowp|)[\t ]*\w+[\t ]*(\w+)[\t ]*;)/;let i;for(let t=0;t<e.length;t++){const a=e[t].match(n);if(a){e[t]=a[1],i=a[3];break}}return i}static __addGLFragColor(e,t,n){const i=/(.*)\}[\n\t ]*$/,a=/[\n\t ]*return[\n\t ]*;/,r=/(^|^(?![\/])[\t\n ]+)void[\t\n ]+main([\t\n ]|\(|$)/,o=`  gl_FragColor = ${e};`;let s=!1;for(let e=t.length-1;e>=0;e--){const n=t[e];if(!s&&n.match(i)&&(t[e]=n.replace(i,`$1\n${o}\n}\n`),s=!0),n.match(a)&&t.splice(e,0,o),n.match(r))break}if(!s){const e="__removeOutQualifier: Not found the closing brackets for the main function";this.__outError(t,t.length,e,n)}}static __removeES3Qualifier(e,t){this.__removeVaryingQualifier(e,t),this.__removeLayout(e)}static __removeVaryingQualifier(e,t){const n=/^(?![\/])[\t ]*(flat|smooth)[\t ]*((in|out)[\t ]+.*)/;for(let i=0;i<e.length;i++)e[i]=e[i].replace(n,((n,a,r)=>"flat"===a?(this.__outError(e,i+1,"__removeVaryingQualifier: glsl es1 does not support flat qualifier",t),n):r))}static __removeLayout(e){this.__replaceLine(e,/^(?![\/])[\t ]*layout[\t ]*\([\t ]*location[\t ]*\=[\t ]*\d[\t ]*\)[\t ]+/g,"")}static __removePrecisionForES3(e){const t=/^(?![\/])[\t ]*precision[\t ]+(highp|mediump|lowp)[\t ]+(\w+)[\t ]*;/;for(let n=0;n<e.length;n++){const i=e[n].match(t);if(null!=i){if("int"===i[2]||"float"===i[2]||"sampler2D"===i[2]||"samplerCube"===i[2])continue;e.splice(n--,1)}}}static __convertTextureFunctionToES1(e,t,n){var i,a;const r=this.__regSymbols(),o=new RegExp(`(${r}+)textureProj(Lod|)(${r}+)`,"g"),s=new RegExp(`(${r}+)texture(Lod|)(${r}+)`,"g");let l;const c=this.__createUniformSamplerMap(e,n);for(let r=0;r<e.length;r++){const _=e[r],h=_.match(/textureProj(Lod|)[\t ]*\([\t ]*(\w+),/);if(h){l=null!=l?l:this.__createArgumentSamplerMap(e,r,n);const a="Lod"===h[1],s=t&&a?"EXT":"",_=h[2],d=null!==(i=null==l?void 0:l.get(_))&&void 0!==i?i:c.get(_);if(null!=d)if("sampler2D"===d)e[r]=e[r].replace(o,`$1texture2DProj$2${s}$3`);else{const t="__convertTextureFunctionToES1: do not support "+d+" type";this.__outError(e,r,t,n)}continue}const d=_.match(/texture(Lod|)[\t ]*\([\t ]*(\w+),/);if(d){l=null!=l?l:this.__createArgumentSamplerMap(e,r,n);const i="Lod"===d[1],o=t&&i?"EXT":"",_=d[2],h=null!==(a=null==l?void 0:l.get(_))&&void 0!==a?a:c.get(_);if(null!=h){let t;if("sampler2D"===h)t="texture2D";else if("samplerCube"===h)t="textureCube";else{t="";const i="__convertTextureFunctionToES1: do not support "+h+" type";this.__outError(e,r,i,n)}""!==t&&(e[r]=e[r].replace(s,`$1${t}$2${o}$3`))}}else _.match(/\}/)&&(l=void 0)}}static __createUniformSamplerMap(e,t){const n=new Map;for(let i=0;i<e.length;i++){const a=e[i].match(/^(?![\/])[\t ]*uniform*[\t ]*(highp|mediump|lowp|)[\t ]*(sampler\w+)[\t ]+(\w+)/);if(a){const r=a[2],o=a[3];if(n.get(o)){const n="__createUniformSamplerMap: duplicate variable name";this.__outError(e,i,n,t)}n.set(o,r)}}return n}static __createArgumentSamplerMap(e,t,n){var i,a;const r=new Map;for(let o=t;o>=0;o--){if(!e[o].match(/\{/))continue;const t=null===(i=this.__getBracketSection(e,o).match(/.*\((.*)\)/))||void 0===i?void 0:i[1];if(null==t)return;const s=t.split(","),l=/[\n\t ]*(highp|mediump|lowp|)[\n\t ]*(sampler\w+)[\n\t ]*(\w+)[\n\t ]*/;if(null!==(a=s[0].match(l))&&void 0!==a?a:s[0].match(/^[\n\t ]*$/)){for(const t of s){const i=t.match(l);if(null==i)continue;const a=i[2],s=i[3];if(r.get(s)){const t="__createArgumentSamplerMap: duplicate variable name";this.__outError(e,o,t,n)}r.set(s,a)}break}}return r}static __getBracketSection(e,t){let n=0;for(let i=t;i>=0;i--)if(e[i].match(/\(/)){n=i;break}let i="";for(let a=n;a<=t;a++)i+=e[a];return i}static __convertAttribute(e,t){t||this.__replaceLine(e,/^(?![\/])[\t ]*attribute[\t ]+/g,"in ")}static __convertVarying(e,t){const n=t?"in ":"out ";this.__replaceLine(e,/^(?![\/])[\t ]*varying[\t ]+/g,n)}static __convertTextureCube(e){const t=this.__regSymbols(),n=new RegExp(`(${t}+)(textureCube)(${t}+)`,"g");this.__replaceLine(e,n,"$1texture$3")}static __convertTexture2D(e){const t=this.__regSymbols(),n=new RegExp(`(${t}+)(texture2D)(${t}+)`,"g");this.__replaceLine(e,n,"$1texture$3")}static __convertTexture2DProd(e){const t=this.__regSymbols(),n=new RegExp(`(${t}+)(texture2DProj)(${t}+)`,"g");this.__replaceLine(e,n,"$1textureProj$3")}static __convertTexture3D(e){const t=this.__regSymbols(),n=new RegExp(`(${t}+)(texture3D)(${t}+)`,"g");this.__replaceLine(e,n,"$1texture$3")}static __convertTexture3DProd(e){const t=this.__regSymbols(),n=new RegExp(`(${t}+)(texture3DProj)(${t}+)`,"g");this.__replaceLine(e,n,"$1textureProj$3")}static __regSymbols(){return"[!\"#$%&'()*+-.,/:;<=>?@[\\]^`{|}~\t\n ]"}static __replaceLine(e,t,n){for(let i=0;i<e.length;i++)e[i]=e[i].replace(t,n)}static __removeFirstMatchingLine(e,t){for(let n=0;n<e.length;n++)if(e[n].match(t)){e.splice(n,1);break}}static __outError(e,t,n,i){if(!i)throw new Error(n);{const i=`// line ${t}: ${n}\n`,a=/(.*)\}[\n\t ]*$/;for(let t=e.length-1;t>=0&&!e[t].match(a);t--)if(e[t]===i)return;console.error(n),e.push(i)}}}},"./src/main/Shaderity.ts":function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n("./src/main/Reflection.ts")),r=i(n("./src/main/ShaderTransformer.ts")),o=i(n("./src/main/ShaderEditor.ts")),s=i(n("./src/main/Utility.ts")),l=i(n("./src/main/ShaderityObjectCreator.ts"));t.default=class{static transformToGLSLES1(e,t=!1){const n=s.default._splitByLineFeedCode(e.code),i=r.default._transformToGLSLES1(n,e.isFragmentShader,t);return{code:s.default._joinSplittedLine(i),shaderStage:e.shaderStage,isFragmentShader:e.isFragmentShader}}static transformToGLSLES3(e){const t=s.default._splitByLineFeedCode(e.code),n=r.default._transformToGLSLES3(t,e.isFragmentShader);return{code:s.default._joinSplittedLine(n),shaderStage:e.shaderStage,isFragmentShader:e.isFragmentShader}}static transformTo(e,t,n=!1){const i=s.default._splitByLineFeedCode(t.code),a=r.default._transformTo(e,i,t.isFragmentShader,n);return{code:s.default._joinSplittedLine(a),shaderStage:t.shaderStage,isFragmentShader:t.isFragmentShader}}static createShaderityObjectCreator(e){return new l.default(e)}static fillTemplate(e,t){const n=this.__copyShaderityObject(e);return n.code=o.default._fillTemplate(n.code,t),n}static insertDefinition(e,t){const n=this.__copyShaderityObject(e),i=s.default._splitByLineFeedCode(e.code);return o.default._insertDefinition(i,t),n.code=s.default._joinSplittedLine(i),n}static createReflectionObject(e){const t=s.default._splitByLineFeedCode(e.code);return new a.default(t,e.shaderStage)}static __copyShaderityObject(e){return{code:e.code,shaderStage:e.shaderStage,isFragmentShader:e.isFragmentShader}}}},"./src/main/ShaderityObjectCreator.ts":function(e,t,n){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(n("./src/main/Utility.ts"));class r{constructor(e){this.__functionIdCount=0,this.__defineDirectiveNames=[],this.__extensions=[],this.__globalPrecision={int:"highp",float:"highp",sampler2D:"highp",samplerCube:"highp",sampler3D:"highp",sampler2DArray:"highp",isampler2D:"highp",isamplerCube:"highp",isampler3D:"highp",isampler2DArray:"highp",usampler2D:"highp",usamplerCube:"highp",usampler3D:"highp",usampler2DArray:"highp",sampler2DShadow:"highp",samplerCubeShadow:"highp",sampler2DArrayShadow:"highp"},this.__structDefinitions=[],this.__globalConstantValues=[],this.__globalConstantStructValues=[],this.__attributes=[],this.__varyings=[],this.__uniforms=[],this.__uniformStructs=[],this.__uniformBufferObjects=[],this.__functions=[],this.__mainFunctionCode="void main() {}",this.__outputColorVariableName="renderTarget0",this.__shaderStage=e}addDefineDirective(e){this.__defineDirectiveNames.some((t=>t===e))?console.warn("addDefineDirective: this define directive is already set"):this.__defineDirectiveNames.push(e)}addExtension(e,t="enable"){this.__extensions.some((t=>t.extensionName===e))?console.warn("addExtension: this extension is already set"):this.__extensions.push({extensionName:e,behavior:t})}addStructDefinition(e,t){this.__structDefinitions.some((t=>t.structName===e))?console.error(`addStructDefinition: duplicate struct type name ${e}`):this.__structDefinitions.push({structName:e,memberObjects:t})}addGlobalConstantValue(e,t,n){this.__globalConstantValues.some((t=>t.variableName===e))?console.error(`addGlobalConstantValue: duplicate variable name ${e}`):a.default._isValidComponentCount(t,n)?(a.default._isIntType(t)&&r.__existNonIntegerValue(n)&&console.warn(`addGlobalConstantValue: non-integer value is set to ${e}`),this.__globalConstantValues.push({variableName:e,type:t,values:n})):console.error(`addGlobalConstantValue: the component count of ${e} is invalid`)}addGlobalConstantStructValue(e,t,n){this.__globalConstantStructValues.some((e=>e.variableName===t))?console.error(`addGlobalConstantStructValue: duplicate variable name ${t}`):this.__globalConstantStructValues.push({variableName:t,structName:e,values:n})}addAttributeDeclaration(e,t,n){"vertex"===this.__shaderStage?this.__attributes.some((t=>t.variableName===e))?console.error(`addAttribute: duplicate variable name ${e}`):this.__attributes.push({variableName:e,type:t,precision:null==n?void 0:n.precision,location:null==n?void 0:n.location}):console.error("addAttribute: this method is for vertex shader only")}addVaryingDeclaration(e,t,n){if(this.__varyings.some((t=>t.variableName===e)))return void console.error(`addVarying: duplicate variable name ${e}`);const i=a.default._isIntType(t);let r=null==n?void 0:n.interpolationType;if(i&&"flat"!==r){if(null!=r)return void console.error("addVarying: the interpolationType must be flat for integer types");console.warn("addVarying: set the interpolationType of integer types to flat to avoid compilation error"),r="flat"}this.__varyings.push({variableName:e,type:t,precision:null==n?void 0:n.precision,interpolationType:r})}addUniformDeclaration(e,t,n){this.__uniforms.some((t=>t.variableName===e))?console.error(`addUniform: duplicate variable name ${e}`):("bool"===t&&null!=(null==n?void 0:n.precision)&&(console.warn("addUniform: remove the specification of precision for bool type to avoid compilation error"),n.precision=void 0),this.__uniforms.push({variableName:e,type:t,precision:null==n?void 0:n.precision}))}addUniformStructDeclaration(e,t){this.__uniformStructs.some((e=>e.variableName===t))?console.error(`addUniformStructDeclaration: duplicate variable name ${t}`):this.__uniformStructs.push({variableName:t,structName:e})}addUniformBufferObjectDeclaration(e,t,n){if(this.__uniformBufferObjects.some((t=>t.blockName===e)))console.error(`addUniformBufferObjectDeclaration: duplicate block name ${e}`);else{for(const e of this.__uniformBufferObjects)for(const n of e.variableObjects)for(const e of t)if(n.variableName===e.variableName)return void console.error(`addUniformBufferObjectDeclaration: duplicate variable name ${e.variableName}`);this.__uniformBufferObjects.push({blockName:e,variableObjects:t,instanceName:null==n?void 0:n.instanceName})}}addFunctionDefinition(e,t){var n,i;const a=this.__functionIdCount++,r=null!==(n=null==t?void 0:t.dependencyLevel)&&void 0!==n?n:0;return this.__functions[r]=null!==(i=this.__functions[r])&&void 0!==i?i:[],this.__functions[r].push({functionCode:e,functionId:a}),a}updateGlobalPrecision(e){Object.assign(this.__globalPrecision,e)}updateStructDefinition(e,t){const n=this.__structDefinitions.findIndex((t=>t.structName===e));-1!==n?this.__structDefinitions[n].memberObjects=t:console.error(`updateStructDefinition: the struct type name ${e} is not exist`)}updateGlobalConstantValue(e,t){const n=this.__globalConstantValues.findIndex((t=>t.variableName===e));if(-1===n)return void console.warn(`updateGlobalConstantValue: the variable name ${e} is not exist`);const i=this.__globalConstantValues[n].type;a.default._isValidComponentCount(i,t)?(a.default._isIntType(i)&&r.__existNonIntegerValue(t)&&console.warn(`updateGlobalConstantValue: the ${e} has a non-integer value.`),this.__globalConstantValues[n].values=t):console.error("updateGlobalConstantValue: the component count is invalid")}updateGlobalConstantStructValue(e,t){const n=this.__globalConstantStructValues.findIndex((t=>t.variableName===e));-1!==n?this.__globalConstantStructValues[n].values=t:console.error(`updateGlobalConstantStructValue:  the variable name ${e} is not exist`)}updateMainFunction(e){this.__mainFunctionCode=e}updateOutputColorVariableName(e){"fragment"===this.__shaderStage?0!==e.length?this.__outputColorVariableName=e:console.error("updateOutputColorVariableName: invalid outColorVariableName"):console.error("updateOutputColorVariableName: this method is for fragment shader only")}removeDefineDirective(e){const t=this.__defineDirectiveNames.indexOf(e);-1!==t?this.__defineDirectiveNames.splice(t,1):console.warn("removedDefineDirective: this define directive is not exist")}removeExtension(e){const t=this.__extensions.findIndex((t=>t.extensionName===e));-1!==t?this.__extensions.splice(t,1):console.warn("removeExtension: this extension is not exist")}removeStructDefinition(e){const t=this.__structDefinitions.findIndex((t=>t.structName===e));-1!==t?this.__structDefinitions.splice(t,1):console.error(`removeStructDefinition: the struct type name ${e} is not exist`)}removeGlobalConstantValue(e){const t=this.__globalConstantValues.findIndex((t=>t.variableName===e));-1!==t?this.__globalConstantValues.splice(t,1):console.warn(`removeGlobalConstantValue: the variable name ${e} is not exist`)}removeGlobalConstantStructValue(e){const t=this.__globalConstantStructValues.findIndex((t=>t.variableName===e));-1!==t?this.__globalConstantStructValues.splice(t,1):console.error(`updateGlobalConstantStructValue:  the variable name ${e} is not exist`)}removeAttributeDeclaration(e){const t=this.__attributes.findIndex((t=>t.variableName===e));-1!==t?this.__attributes.splice(t,1):console.warn(`removeAttribute: the variable name ${e} is not exist`)}removeVaryingDeclaration(e){const t=this.__varyings.findIndex((t=>t.variableName===e));-1!==t?this.__varyings.splice(t,1):console.warn(`removeVarying: the variable name ${e} is not exist`)}removeUniformDeclaration(e){const t=this.__uniforms.findIndex((t=>t.variableName===e));-1!==t?this.__uniforms.splice(t,1):console.warn(`removeUniform: the variable name ${e} is not exist`)}removeUniformStructDeclaration(e){const t=this.__uniformStructs.findIndex((t=>t.variableName===e));-1!==t?this.__uniformStructs.splice(t,1):console.warn(`removeUniformStructDeclaration: the variable name ${e} is not exist`)}removeUniformBufferObjectDeclaration(e){const t=this.__uniformBufferObjects.findIndex((t=>t.blockName===e));-1!==t?this.__uniformBufferObjects.splice(t,1):console.warn(`removeUniformStructDeclaration: the variable name ${e} is not exist`)}removeFunctionDefinition(e){this.__fillEmptyFunctions(),(e<0||e>=this.__functionIdCount)&&console.warn("removeFunctionDefinition: invalid function id");for(const t of this.__functions){const n=t.findIndex((t=>t.functionId===e));if(-1!==n)return void t.splice(n,1)}console.warn(`removeFunctionDefinition: not found the function of functionId ${e}`)}createShaderityObject(){return{code:this.__createShaderCode(),shaderStage:this.__shaderStage,isFragmentShader:"fragment"===this.__shaderStage}}static __existNonIntegerValue(e){for(const t of e)if(!Number.isInteger(t))return!0;return!1}__createShaderCode(){return this.__fillEmptyFunctions(),"#version 300 es\n\n"+this.__createDefineDirectiveShaderCode()+this.__createExtensionShaderCode()+this.__createGlobalPrecisionShaderCode()+this.__createStructDefinitionShaderCode()+this.__createGlobalConstantValueShaderCode()+this.__createGlobalConstantStructValueShaderCode()+this.__createAttributeDeclarationShaderCode()+this.__createVaryingDeclarationShaderCode()+this.__createOutputColorDeclarationShaderCode()+this.__createUniformDeclarationShaderCode()+this.__createUniformStructDeclarationShaderCode()+this.__createUniformBufferObjectShaderCode()+this.__createFunctionDefinitionShaderCode()+this.__createMainFunctionDefinitionShaderCode()}__fillEmptyFunctions(){var e;for(let t=0;t<this.__functions.length;t++)this.__functions[t]=null!==(e=this.__functions[t])&&void 0!==e?e:[]}__createDefineDirectiveShaderCode(){let e="";for(const t of this.__defineDirectiveNames)e+=`#define ${t}\n`;return a.default._addLineFeedCodeIfNotNullString(e)}__createExtensionShaderCode(){let e="";for(const t of this.__extensions)e+=`#extension ${t.extensionName}: ${t.behavior}\n`;return a.default._addLineFeedCodeIfNotNullString(e)}__createGlobalPrecisionShaderCode(){let e="";for(const t in this.__globalPrecision){const n=t;e+=`precision ${this.__globalPrecision[n]} ${n};\n`}return a.default._addLineFeedCodeIfNotNullString(e)}__createStructDefinitionShaderCode(){let e="";for(const t of this.__structDefinitions){e+=`struct ${t.structName} {\n`;for(let n=0;n<t.memberObjects.length;n++){const i=t.memberObjects[n];e+="  ",null!=i.precision&&(e+=`${i.precision} `),e+=`${i.type} ${i.memberName};\n`}e+="};\n"}return a.default._addLineFeedCodeIfNotNullString(e)}__createGlobalConstantValueShaderCode(){let e="";for(const t of this.__globalConstantValues){const n=t.type,i=t.variableName,a=t.values;e+=`const ${n} ${i} = ${n}(`;for(let t=0;t<a.length;t++)e+=a[t]+", ";e=e.replace(/,\s$/,");\n")}return a.default._addLineFeedCodeIfNotNullString(e)}__createGlobalConstantStructValueShaderCode(){let e="";for(const t of this.__globalConstantStructValues){const n=this.__structDefinitions.findIndex((e=>e.structName===t.structName));if(-1===n){console.error(`__createGlobalConstantStructValueShaderCode: the struct type ${t.structName} is not defined`);continue}e+=`const ${t.structName} ${t.variableName} = ${t.structName} (\n`;const i=this.__structDefinitions[n];if(i.memberObjects.length===Object.keys(t.values).length)if(i.memberObjects.some((e=>a.default._isSamplerType(e.type))))console.error(`__createGlobalConstantStructValueShaderCode: ConstantStructValue (${t.variableName}) cannot have sampler type parameter`);else{for(let n=0;n<i.memberObjects.length;n++){const r=i.memberObjects[n].memberName,o=t.values[r];if(null==o){console.error(`__createGlobalConstantStructValueShaderCode: ${t.variableName} does not have the value of ${r}`);continue}const s=i.memberObjects[n].type;if(a.default._isValidComponentCount(s,o)){e+=`  ${s}(`;for(let t=0;t<o.length;t++)e+=o[t]+", ";e=e.replace(/,\s$/,"),\n")}else console.error(`__createGlobalConstantStructValueShaderCode: the component count of ${r} in ${t.variableName} is invalid`)}e=e.replace(/,\n$/,"\n);\n")}else console.error(`__createGlobalConstantStructValueShaderCode: Invalid number of variables that ${t.variableName} has`)}return a.default._addLineFeedCodeIfNotNullString(e)}__createAttributeDeclarationShaderCode(){let e="";for(const t of this.__attributes)null!=t.location&&(e+=`layout (location = ${t.location}) `),e+="in ",null!=t.precision&&(e+=`${t.precision} `),e+=`${t.type} ${t.variableName};\n`;return a.default._addLineFeedCodeIfNotNullString(e)}__createVaryingDeclarationShaderCode(){let e="";for(const t of this.__varyings)null!=t.interpolationType&&(e+=`${t.interpolationType} `),e+="vertex"==this.__shaderStage?"out ":"in ",null!=t.precision&&(e+=`${t.precision} `),e+=`${t.type} ${t.variableName};\n`;return a.default._addLineFeedCodeIfNotNullString(e)}__createOutputColorDeclarationShaderCode(){return"fragment"!==this.__shaderStage?"":`layout(location = 0) out vec4 ${this.__outputColorVariableName};\n\n`}__createUniformDeclarationShaderCode(){let e="";for(const t of this.__uniforms)e+="uniform ",null!=t.precision&&(e+=`${t.precision} `),e+=`${t.type} ${t.variableName};\n`;return a.default._addLineFeedCodeIfNotNullString(e)}__createUniformStructDeclarationShaderCode(){let e="";for(const t of this.__uniformStructs){const n=t.structName;this.__structDefinitions.some((e=>e.structName===n))?e+=`uniform ${n} ${t.variableName};\n`:console.error(`__createUniformStructDeclarationShaderCode: the struct type ${n} is not defined`)}return a.default._addLineFeedCodeIfNotNullString(e)}__createUniformBufferObjectShaderCode(){let e="";for(const t of this.__uniformBufferObjects){e+=`layout (std140) uniform ${t.blockName} {\n`;for(let n=0;n<t.variableObjects.length;n++){const i=t.variableObjects[n];e+=`  ${i.type} ${i.variableName};\n`}null!=t.instanceName?e+=`} ${t.instanceName};\n`:e+="};\n"}return a.default._addLineFeedCodeIfNotNullString(e)}__createFunctionDefinitionShaderCode(){let e="";for(let t=0;t<this.__functions.length;t++){const n=this.__functions[t];for(let t=0;t<n.length;t++)e+=n[t].functionCode+"\n"}return a.default._addLineFeedCodeIfNotNullString(e)}__createMainFunctionDefinitionShaderCode(){return this.__mainFunctionCode+"\n"}}t.default=r},"./src/main/Utility.ts":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{static _splitByLineFeedCode(e){return e.split(/\r\n|\n/)}static _joinSplittedLine(e){return e.join("\n")}static _addLineFeedCodeIfNotNullString(e){return""===e?e:e+"\n"}static _componentNumber(e){let t;return"float"===e||"int"===e||"bool"===e||"uint"===e||"sampler2D"===e||"samplerCube"===e||"sampler3D"===e||"sampler2DArray"===e||"isampler2D"===e||"isamplerCube"===e||"isampler3D"===e||"isampler2DArray"===e||"usampler2D"===e||"usamplerCube"===e||"usampler3D"===e||"usampler2DArray"===e||"sampler2DShadow"===e||"samplerCubeShadow"===e||"sampler2DArrayShadow"===e?t=1:"vec2"===e||"ivec2"===e||"bvec2"===e||"uvec2"===e?t=2:"vec3"===e||"ivec3"===e||"bvec3"===e||"uvec3"===e?t=3:"vec4"===e||"ivec4"===e||"bvec4"===e||"uvec4"===e||"mat2"===e||"mat2x2"===e?t=4:"mat2x3"===e||"mat3x2"===e?t=6:"mat2x4"===e||"mat4x2"===e?t=8:"mat3"===e||"mat3x3"===e?t=9:"mat3x4"===e||"mat4x3"===e?t=12:"mat4"===e||"mat4x4"===e?t=16:(t=0,console.error("Utility._componentNumber: detect unknown type")),t}static _isIntType(e){return"int"===e||"ivec2"===e||"ivec3"===e||"ivec4"===e||"uint"===e||"uvec2"===e||"uvec3"===e||"uvec4"===e}static _isValidComponentCount(e,t){return i._componentNumber(e)===t.length}static _isSamplerType(e){return"sampler2D"===e||"samplerCube"===e||"sampler3D"===e||"sampler2DArray"===e||"isampler2D"===e||"isamplerCube"===e||"isampler3D"===e||"isampler2DArray"===e||"usampler2D"===e||"usamplerCube"===e||"usampler3D"===e||"usampler2DArray"===e||"sampler2DShadow"===e||"samplerCubeShadow"===e||"sampler2DArrayShadow"===e}}t.default=i}})},792:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var i=n(9721),a=n(5333),r=n(4507),o=n(657),s=n(1784),l=n(2404),c=n(4710),_=n(7987),h=n(346),d=n(3496),u=n(4690);class m extends i.Z{constructor(e,t,n){super(e,t,n),this.type="efk",this.playJustAfterLoaded=!1,this.isLoop=!1,this.isPause=!1,this.randomSeed=-1,this.isImageLoadWithCredential=!1,this.__speed=1,this.isLoadEffect=!1,h.Z.noWebGLTex2DStateCache=!0}static get componentTID(){return c.z.EffekseerComponentTID}cancelLoop(){clearInterval(this.__timer)}isPlay(){return!!u.Is.exist(this.__handle)&&this.__handle.exists}play(){var e,t;return u.Is.not.exist(this.__context)?(console.warn("No Effekseer context yet"),!1):u.Is.not.exist(this.__effect)?(console.warn("No Effekseer effect yet"),!1):(this.stop(),this.isPause=!1,this.__handle=null===(e=this.__context)||void 0===e?void 0:e.play(this.__effect,0,0,0),this.randomSeed>0&&(null===(t=this.__handle)||void 0===t||t.setRandomSeed(this.randomSeed)),!0)}continue(){this.isPause=!1}pause(){u.Is.exist(this.__handle)&&(this.isPause=!0)}stop(){u.Is.exist(this.__handle)&&this.__handle.stop()}set playSpeed(e){this.__handle&&this.__handle.setSpeed(e),this.__speed=e}get playSpeed(){return this.__speed}setTime(e){if(!this.play())return!1;if(u.Is.not.exist(this.__context))return!1;let t=0;const n=.0166;for(t=n;t<=e;)if(this.__context.update(t/n),t+=n,e<t){const i=n-(e-t);this.__context.update(i/n);break}return this.pause(),!0}set translate(e){this.__handle&&this.__handle.setLocation(e.x,e.y,e.z),this.__transformComponent.translate=e}get translate(){return this.__transformComponent.translate}set rotate(e){this.__handle&&this.__handle.setRotation(e.x,e.y,e.z),this.__transformComponent.rotate=e}get rotate(){return this.__transformComponent.rotate}set scale(e){this.__handle&&this.__handle.setScale(e.x,e.y,e.z),this.__transformComponent.scale=e}get scale(){return this.__transformComponent.scale}$create(){this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,a.Z),this.__transformComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,o.Z),this.moveStageTo(r.I.Load)}__createEffekseerContext(){if(u.Is.not.exist(this.uri)&&u.Is.not.exist(this.arrayBuffer))return console.error("Effekseer data not found."),!1;if(effekseer.setImageCrossOrigin(this.isImageLoadWithCredential?"use-credentials":""),this.__context=effekseer.createContext(),u.Is.not.exist(this.__context))return console.error("Effekseer context creation fails"),!1;const e=_.Z.getWebGLResourceRepository().currentWebGLContextWrapper;m.__isInitialized=!0;const t=e.getRawContext(),n=u.Is.exist(this.uri)?this.uri:this.arrayBuffer;this.__context.init(t);const i=()=>{this.playJustAfterLoaded&&(this.isLoop?this.__timer=setInterval((()=>{this.play()}),500):this.play(),this.moveStageTo(r.I.Logic))},a=()=>{};if("efkpkg"===this.type){if(u.Is.not.exist(m.Unzip))return console.error("Please Set an Unzip object to EffekseerComponent.Unzip"),!1;this.__effect=this.__context.loadEffectPackage(n,m.Unzip,1,i.bind(this),a.bind(this))}else this.__effect=this.__context.loadEffect(n,1,i.bind(this),a.bind(this));return!0}$load(){!m.__isInitialized&&u.Is.not.exist(this.__context)&&u.Is.not.exist(this.__effect)&&(u.Is.exist(m.wasmModuleUri)?effekseer.initRuntime(m.wasmModuleUri,(()=>{this.__createEffekseerContext()&&this.moveStageTo(r.I.Logic)}),(()=>{console.error("Failed to initialize Effekseer")})):this.__createEffekseerContext()&&this.moveStageTo(r.I.Logic))}$logic(){if(this.isPause||u.Is.exist(this.__context)&&this.__context.update(),null!=this.__handle){const e=m.__tmp_identityMatrix_0.copyComponents(this.__sceneGraphComponent.worldMatrixInner);this.__handle.setMatrix(e._v),this.__handle.setSpeed(this.__speed)}this.isPause||this.isLoop&&(this.isPlay()||this.play()),this.moveStageTo(r.I.Render)}$render(){const e=l.Z.getInstance().getComponent(s.Z,s.Z.main),t=m.__tmp_identityMatrix_0,n=m.__tmp_identityMatrix_1;e?(t.copyComponents(e.viewMatrix),n.copyComponents(e.projectionMatrix)):(t.identity(),n.identity()),u.Is.exist(this.__context)&&(this.__context.setProjectionMatrix(n._v),this.__context.setCameraMatrix(t._v),this.__context.draw()),this.moveStageTo(r.I.Logic)}}m.wasmModuleUri=void 0,m.__isInitialized=!1,m.__tmp_identityMatrix_0=d.Z.identity(),m.__tmp_identityMatrix_1=d.Z.identity(),l.Z.registerComponentClass(m);var x=n(1350);const f=Object.freeze({EffekseerComponent:m,createEffekseerEntity:function(){return x.Z.getInstance().createEntity([o.Z,a.Z,m])}})},3658:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(2471);class a{constructor(){this.zNearLimitFactor=10,this.zFarScalingFactor=1e4,this.autoCalculateZNearAndZFar=!0}_calcZNearInner(e,t,n){if(this.autoCalculateZNearAndZFar&&null!=this.__targetEntity){const a=this.__targetEntity.getSceneGraph().worldAABB,r=i.ZP.lengthBtw(t,a.centerPoint),o=Math.min(a.sizeX,a.sizeY,a.sizeZ),s=(o>0?o/2:Math.min(a.sizeX>0?a.sizeX:1/0,a.sizeY>0?a.sizeY:1/0,a.sizeZ>0?a.sizeZ:1/0)/2)/this.zNearLimitFactor;if(r-a.lengthCenterToCorner<s)return void(e.zNearInner=s);const l=a.centerPoint.x-t.x,c=a.centerPoint.y-t.y,_=a.centerPoint.z-t.z,h=(l*n.x+c*n.y+_*n.z)/(Math.hypot(l,c,_)*n.length());e.zNearInner=Math.max(r*h-a.lengthCenterToCorner,s)}else e.zNearInner=e.zNear}_calcZFarInner(e){this.autoCalculateZNearAndZFar?e.zFarInner=e.zNearInner*this.zFarScalingFactor:e.zNearInner=e.zFar}}},6547:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(2471),a=n(9190),r=n(3032),o=n(2566),s=n(916),l=n(3496),c=n(3658),_=n(4690);class h extends c.Z{constructor(){super(),this.dollyScale=2,this.scaleOfLengthCenterToCamera=1,this.moveSpeed=1,this.followTargetAABB=!1,this.__isMouseDown=!1,this.__lastMouseDownTimeStamp=0,this.__lastMouseUpTimeStamp=0,this.__originalY=-1,this.__originalX=-1,this.__buttonNumber=0,this.__mouse_translate_y=0,this.__mouse_translate_x=0,this.__efficiency=1,this.__lengthOfCenterToEye=1,this.__fovyBias=1,this.__scaleOfTranslation=2.8,this.__mouseTranslateVec=a.ZP.zero(),this.__newEyeVec=a.ZP.zero(),this.__newCenterVec=a.ZP.zero(),this.__newUpVec=a.ZP.zero(),this.__newTangentVec=a.ZP.zero(),this.__isSymmetryMode=!0,this.__rot_bgn_x=0,this.__rot_bgn_y=0,this.__rot_x=0,this.__rot_y=0,this.__dolly=.5,this.__eyeVec=a.ZP.zero(),this.__centerVec=a.ZP.zero(),this.__upVec=a.ZP.zero(),this.__scaleOfZNearAndZFar=5e3,this.__doPreventDefault=!0,this.__isPressingShift=!1,this.__isPressingCtrl=!1,this.__pinchInOutControl=!1,this.__pinchInOutOriginalDistance=null,this.__resetDollyTouchTime=0,this.__mouseDownFunc=this.__mouseDown.bind(this),this.__mouseUpFunc=this.__mouseUp.bind(this),this.__mouseMoveFunc=this.__mouseMove.bind(this),this.__touchDownFunc=this.__touchDown.bind(this),this.__touchUpFunc=this.__touchUp.bind(this),this.__touchMoveFunc=this.__touchMove.bind(this),this.__pinchInOutFunc=this.__pinchInOut.bind(this),this.__pinchInOutEndFunc=this.__pinchInOutEnd.bind(this),this.__mouseWheelFunc=this.__mouseWheel.bind(this),this.__mouseDblClickFunc=this.__mouseDblClick.bind(this),this.__contextMenuFunc=this.__contextMenu.bind(this),this.__pressShiftFunc=this.__pressShift.bind(this),this.__releaseShiftFunc=this.__releaseShift.bind(this),this.__pressCtrlFunc=this.__pressCtrl.bind(this),this.__releaseCtrlFunc=this.__releaseCtrl.bind(this),this.__resetDollyAndPositionFunc=this.__resetDollyAndPosition.bind(this),this.registerEventListeners()}setTarget(e){this.__targetEntity=e,this.__originalTargetAABB=void 0}getTarget(){return this.__targetEntity}set doPreventDefault(e){this.__doPreventDefault=e}get doPreventDefault(){return this.__doPreventDefault}__mouseDown(e){this.__tryToPreventDefault(e),this.isMouseDown||this.__isPressingCtrl||(this.__originalX=e.clientX,this.__originalY=e.clientY,this.__rot_bgn_x=this.__rot_x,this.__rot_bgn_y=this.__rot_y,this.__isMouseDown=!0,this.__lastMouseDownTimeStamp=e.timeStamp)}__mouseMove(e){if(this.__tryToPreventDefault(e),_.Is.false(this.isMouseDown))return;if(this.__isPressingCtrl)return;0===this.__buttonNumber&&(this.__buttonNumber=e.buttons);const t=e.clientX,n=e.clientY;switch(this.__buttonNumber){case 1:this.__isPressingShift?this.__parallelTranslateControl(this.__originalX,this.__originalY,t,n):(this.__rotateControl(this.__originalX,this.__originalY,t,n),this.__rot_bgn_x=this.__rot_x,this.__rot_bgn_y=this.__rot_y);break;case 2:this.__zoomControl(this.__originalX,t);break;case 4:this.__parallelTranslateControl(this.__originalX,this.__originalY,t,n);break;default:return}this.__originalX=t,this.__originalY=n}__mouseUp(e){this.__buttonNumber=0,this.__originalX=-1,this.__originalY=-1,this.__isMouseDown=!1,this.__lastMouseUpTimeStamp=e.timeStamp}__touchDown(e){this.__tryToPreventDefault(e),1===e.touches.length?(this.__originalX=e.touches[0].clientX,this.__originalY=e.touches[0].clientY,this.__rot_bgn_x=this.__rot_x,this.__rot_bgn_y=this.__rot_y):(this.__originalX=.5*(e.touches[0].clientX+e.touches[1].clientX),this.__originalY=.5*(e.touches[0].clientY+e.touches[1].clientY)),this.__isMouseDown=!0,this.__lastMouseDownTimeStamp=e.timeStamp}__touchMove(e){if(this.__tryToPreventDefault(e),_.Is.false(this.isMouseDown))return;let t=e.touches[0].clientX,n=e.touches[0].clientY;1===e.touches.length?(t=e.touches[0].clientX,n=e.touches[0].clientY,this.__rotateControl(this.__originalX,this.__originalY,t,n),this.__rot_bgn_x=this.__rot_x,this.__rot_bgn_y=this.__rot_y):(t=.5*(e.touches[0].clientX+e.touches[1].clientX),n=.5*(e.touches[0].clientY+e.touches[1].clientY),this.__parallelTranslateControl(this.__originalX,this.__originalY,t,n)),this.__originalX=t,this.__originalY=n}__touchUp(e){const t=e.touches.length;0===t?(this.__originalX=-1,this.__originalY=-1):1===t?(this.__originalX=e.touches[0].clientX,this.__originalY=e.touches[0].clientY,this.__rot_bgn_x=this.__rot_x,this.__rot_bgn_y=this.__rot_y):(this.__originalX=.5*(e.touches[0].clientX+e.touches[1].clientX),this.__originalY=.5*(e.touches[0].clientY+e.touches[1].clientY)),this.__isMouseDown=!1,this.__lastMouseUpTimeStamp=e.timeStamp}set rotX(e){this.__rot_x=e}get rotX(){return this.__rot_x}set rotY(e){this.__rot_y=e}get rotY(){return this.__rot_y}set maximumY(e){this.__maximum_y=e}set minimumY(e){this.__minimum_y=e}__rotateControl(e,t,n,i){const a=(n-e)*this.__efficiency*.3,r=(i-t)*this.__efficiency*.3;this.__rot_x=this.__rot_bgn_x-a,this.__rot_y=this.__rot_bgn_y-r,null!=this.__maximum_y&&this.__rot_y>this.__maximum_y&&(this.__rot_y=this.__maximum_y),null!=this.__minimum_y&&this.__rot_y<this.__minimum_y&&(this.__rot_y=this.__minimum_y)}__zoomControl(e,t){this.dolly-=(t-e)/1e3*this.__efficiency}__parallelTranslateControl(e,t,n,i){this.__mouse_translate_y=(i-t)/1e3*this.__efficiency,this.__mouse_translate_x=(n-e)/1e3*this.__efficiency;const a=this.__lengthOfCenterToEye*this.__fovyBias*this.__scaleOfTranslation,r=h.__tmpVec3_0;r.copyComponents(this.__newUpVec).normalize().multiply(this.__mouse_translate_y).multiply(a);const o=h.__tmpVec3_1;o.copyComponents(this.__newTangentVec).normalize().multiply(this.__mouse_translate_x).multiply(a),this.__mouseTranslateVec.add(r).add(o)}__getTouchesDistance(e){const t=e.touches,n=t[1].clientX-t[0].clientX,i=t[1].clientY-t[0].clientY;return Math.hypot(n,i)}__pinchInOut(e){if(e.touches.length<2)return;if(null==this.__pinchInOutOriginalDistance)return void(this.__pinchInOutOriginalDistance=this.__getTouchesDistance(e));const t=this.__getTouchesDistance(e),n=this.__pinchInOutOriginalDistance;if(!this.__pinchInOutControl)return void(Math.abs(t-n)>35&&(this.__pinchInOutOriginalDistance=t,this.__pinchInOutControl=!0));const i=n/t;this.dolly*=Math.pow(i*this.__efficiency,2.2/15),this.__pinchInOutOriginalDistance=t}__pinchInOutEnd(e){e.touches.length<2&&(this.__pinchInOutControl=!1,this.__pinchInOutOriginalDistance=null)}__tryToPreventDefault(e){this.__doPreventDefault&&e.preventDefault()}__mouseWheel(e){this.__tryToPreventDefault(e),this.dolly+=Math.sign(e.deltaY)/200}__contextMenu(e){this.__tryToPreventDefault(e)}set dolly(e){e=Math.min(e,1),e=Math.max(e,1e-4);let t=Math.pow(e,5);t=Math.max(t,1e-4),this.__dolly=t}get dolly(){return Math.pow(this.__dolly,.2)}__mouseDblClick(e){e.shiftKey?this.__mouseTranslateVec.zero():e.ctrlKey&&(this.__rot_y=0,this.__rot_x=0,this.__rot_bgn_y=0,this.__rot_bgn_x=0)}__resetDollyAndPosition(e){if(e.touches.length>1)return;const t=(new Date).getTime();t-this.__resetDollyTouchTime<300?(this.dolly=Math.pow(.5,1/2.2),this.__mouseTranslateVec.zero(),this.__rot_x=0,this.__rot_y=0):this.__resetDollyTouchTime=t}__pressShift(e){!0===e.shiftKey&&(this.__isPressingShift=!0)}__releaseShift(e){!1===e.shiftKey&&(this.__isPressingShift=!1)}__pressCtrl(e){!0===e.ctrlKey&&(this.__isPressingCtrl=!0)}__releaseCtrl(e){!1===e.ctrlKey&&(this.__isPressingCtrl=!1)}registerEventListeners(e=document){this._eventTargetDom=e,e&&("ontouchend"in document?(e.addEventListener("touchstart",this.__touchDownFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchmove",this.__touchMoveFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchend",this.__touchUpFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchmove",this.__pinchInOutFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchend",this.__pinchInOutEndFunc,{passive:!this.__doPreventDefault}),e.addEventListener("touchstart",this.__resetDollyAndPositionFunc,{passive:!this.__doPreventDefault})):(e.addEventListener("mousedown",this.__mouseDownFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mouseup",this.__mouseUpFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mouseleave",this.__mouseUpFunc,{passive:!this.__doPreventDefault}),e.addEventListener("mousemove",this.__mouseMoveFunc,{passive:!this.__doPreventDefault}),e.addEventListener("keydown",this.__pressShiftFunc,{passive:!this.__doPreventDefault}),e.addEventListener("keyup",this.__releaseShiftFunc,{passive:!this.__doPreventDefault}),e.addEventListener("keydown",this.__pressCtrlFunc,{passive:!this.__doPreventDefault}),e.addEventListener("keyup",this.__releaseCtrlFunc,{passive:!this.__doPreventDefault}),e.addEventListener("contextmenu",(e=>{e.preventDefault()}))),window.WheelEvent&&e.addEventListener("wheel",this.__mouseWheelFunc,{passive:!this.__doPreventDefault}),e.addEventListener("contextmenu",this.__contextMenuFunc,{passive:!this.__doPreventDefault}),e.addEventListener("dblclick",this.__mouseDblClickFunc,{passive:!this.__doPreventDefault}))}unregisterEventListeners(){const e=this._eventTargetDom;e&&("ontouchend"in document?(e.removeEventListener("touchstart",this.__touchDownFunc),e.removeEventListener("touchmove",this.__touchMoveFunc),e.removeEventListener("touchend",this.__touchUpFunc),e.removeEventListener("touchmove",this.__pinchInOutFunc),e.removeEventListener("touchend",this.__pinchInOutEndFunc),e.removeEventListener("touchstart",this.__resetDollyAndPositionFunc)):(e.removeEventListener("mousedown",this.__mouseDownFunc),e.removeEventListener("mouseup",this.__mouseUpFunc),e.removeEventListener("mouseleave",this.__mouseUpFunc),e.removeEventListener("mousemove",this.__mouseMoveFunc),e.removeEventListener("keydown",this.__pressShiftFunc),e.removeEventListener("keyup",this.__releaseShiftFunc),e.removeEventListener("contextmenu",(e=>{e.preventDefault()}))),window.WheelEvent&&e.removeEventListener("wheel",this.__mouseWheelFunc),e.removeEventListener("contextmenu",this.__contextMenuFunc),e.removeEventListener("dblclick",this.__mouseDblClickFunc))}__getFovyFromCamera(e){return e.fovy?e.fovy:r.k.radianToDegree(2*Math.atan(Math.abs(e.top-e.bottom)/(2*e.zNear)))}logic(e){this.__updateTargeting(e),this.__calculateInfluenceOfController(),this.__updateCameraComponent(e)}__updateTargeting(e){const t=e.eye,n=e._direction,i=e._up,o=this.__eyeVec,l=this.__centerVec,c=this.__upVec.copyComponents(i);if(null==this.__targetEntity)o.copyComponents(t),l.copyComponents(n);else{if(null==this.__originalTargetAABB){const e=this.__targetEntity.getSceneGraph().worldAABB;this.__originalTargetAABB=e.clone()}if(this.followTargetAABB){const e=this.__targetEntity.getSceneGraph().worldAABB;l.copyComponents(e.centerPoint)}else l.copyComponents(this.__originalTargetAABB.centerPoint);const i=a.ZP.subtractTo(t,n,o).normalize(),_=this.__originalTargetAABB.lengthCenterToCorner*(1+1/Math.tan(r.k.degreeToRadian(e.fovy/2)))*this.scaleOfLengthCenterToCamera;i.multiply(_).add(l);const d=e.entity.getSceneGraph();if(null!=d){const e=s.Z.invertTo(d.worldMatrixInner,h.__tmpMat44_0);e.multiplyVector3To(l,l),e.multiplyVector3To(o,o),e.multiplyVector3To(c,c)}}}__calculateInfluenceOfController(){const e=a.ZP.subtractTo(this.__eyeVec,this.__centerVec,h.__tmpVec3_0);e.multiply(this.__dolly*this.dollyScale),this.__lengthOfCenterToEye=e.length();const t=this.__newUpVec,n=this.__newEyeVec,s=this.__newCenterVec,l=this.__newTangentVec;if(this.__isSymmetryMode){const c=h.__tmpVec3_1;c.setComponents(e.x,0,e.z);let _=i.ZP.angleOfVectors(c,h.__tmp_up);_*=Math.sign(c.cross(h.__tmp_up).y);const d=h.__tmp_rotateM_X,u=h.__tmp_rotateM_Y,m=h.__tmp_rotateM_Reset,x=h.__tmp_rotateM_Revert;d.rotateX(r.k.degreeToRadian(this.__rot_y)),u.rotateY(r.k.degreeToRadian(this.__rot_x)),m.rotateY(r.k.degreeToRadian(_)),x.rotateY(r.k.degreeToRadian(-_));const f=h.__tmp_rotateM;o.Z.multiplyTo(d,m,f),f.multiplyByLeft(u),f.multiplyByLeft(x),f.multiplyVectorTo(this.__upVec,t),f.multiplyVectorTo(e,n).add(this.__centerVec),s.copyComponents(this.__centerVec);const A=h.__tmpVec3_2;a.ZP.subtractTo(s,n,A),a.ZP.crossTo(t,A,l),n.add(this.__mouseTranslateVec),s.add(this.__mouseTranslateVec)}else{const i=h.__tmp_rotateM_X,c=h.__tmp_rotateM_Y;i.rotateX(r.k.degreeToRadian(this.__rot_y)),c.rotateY(r.k.degreeToRadian(this.__rot_x));const _=o.Z.multiplyTo(c,i,h.__tmp_rotateM);_.multiplyVectorTo(this.__upVec,t),_.multiplyVectorTo(e,n).add(this.__centerVec),s.copyComponents(this.__centerVec);const d=h.__tmpVec3_1;a.ZP.subtractTo(s,n,d),a.ZP.crossTo(t,d,l),n.add(this.__mouseTranslateVec),s.add(this.__mouseTranslateVec)}}__updateCameraComponent(e){const t=h.__tmpVec3_0.copyComponents(this.__newCenterVec);t.subtract(this.__newEyeVec).normalize(),this._calcZNearInner(e,this.__newEyeVec,t),this._calcZFarInner(e);const n=e.zFar/e.zNear/this.__scaleOfZNearAndZFar,i=e.left+n,a=e.right+n,o=e.top+n,s=e.bottom+n,l=this.__getFovyFromCamera(e);this.__fovyBias=Math.tan(r.k.degreeToRadian(l/2)),e.eyeInner=this.__newEyeVec,e.directionInner=this.__newCenterVec,e.upInner=this.__newUpVec,e.leftInner=i,e.rightInner=a,e.topInner=o,e.bottomInner=s,e.fovyInner=l}set scaleOfZNearAndZFar(e){this.__scaleOfZNearAndZFar=e}get scaleOfZNearAndZFar(){return this.__scaleOfZNearAndZFar}get isMouseDown(){return this.__isMouseDown}get lastMouseDownTimeStamp(){return this.__lastMouseDownTimeStamp}get lastMouseUpTimeStamp(){return this.__lastMouseUpTimeStamp}}h.__tmp_up=i.ZP.fromCopyArray([0,0,1]),h.__tmpVec3_0=a.ZP.zero(),h.__tmpVec3_1=a.ZP.zero(),h.__tmpVec3_2=a.ZP.zero(),h.__tmp_rotateM_X=o.Z.identity(),h.__tmp_rotateM_Y=o.Z.identity(),h.__tmp_rotateM=o.Z.identity(),h.__tmp_rotateM_Reset=o.Z.identity(),h.__tmp_rotateM_Revert=o.Z.identity(),h.__tmpMat44_0=l.Z.identity()},4478:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(916),a=n(8547),r=n(6098),o=n(9190),s=n(2566),l=n(3496),c=n(3658),_=n(3032);class h extends c.Z{constructor(e={eventTargetDom:document,verticalSpeed:1,horizontalSpeed:1,turnSpeed:.25,mouseWheelSpeedScale:1,inverseVerticalRotating:!1,inverseHorizontalRotating:!1}){super(),this._isKeyDown=!1,this._isMouseDrag=!1,this._lastKeyCode=-1,this._currentDir=o.ZP.fromCopyArray([0,0,-1]),this._currentPos=o.ZP.fromCopyArray([0,0,0]),this._currentCenter=o.ZP.fromCopyArray([0,0,-1]),this._currentHorizontalDir=o.ZP.fromCopyArray([0,0,-1]),this._newDir=o.ZP.fromCopyArray([0,0,-1]),this._isMouseDown=!1,this._clickedMouseXOnCanvas=-1,this._clickedMouseYOnCanvas=-1,this._draggedMouseXOnCanvas=-1,this._draggedMouseYOnCanvas=-1,this._deltaMouseXOnCanvas=-1,this._deltaMouseYOnCanvas=-1,this._mouseXAdjustScale=1,this._mouseYAdjustScale=1,this._deltaY=-1,this._deltaX=-1,this._mouseUpBind=this._mouseUp.bind(this),this._mouseDownBind=this._mouseDown.bind(this),this._mouseMoveBind=this._mouseMove.bind(this),this._mouseWheelBind=this._mouseWheel.bind(this),this._needInitialize=!0,this._horizontalSpeed=e.horizontalSpeed,this._verticalSpeed=e.verticalSpeed,this._turnSpeed=e.turnSpeed,this._mouseXAdjustScale=this._turnSpeed,this._mouseYAdjustScale=this._turnSpeed,this._mouseWheelSpeedScale=e.mouseWheelSpeedScale,this._inverseVerticalRotating=e.inverseVerticalRotating,this._inverseHorizontalRotating=e.inverseHorizontalRotating,this.reset(),this._onKeydown=e=>{this._isKeyDown=!0,this._lastKeyCode=e.keyCode},this._onKeyup=e=>{this._isKeyDown=!1,this._lastKeyCode=-1};const t=e.eventTargetDom;this.registerEventListeners(t)}registerEventListeners(e=document){this._eventTargetDom=e,e&&(e.addEventListener("keydown",this._onKeydown),e.addEventListener("keyup",this._onKeyup),"ontouchend"in document&&(document.addEventListener("touchstart",this._mouseDownBind),document.addEventListener("touchend",this._mouseUpBind),document.addEventListener("touchmove",this._mouseMoveBind)),"onmouseup"in document&&(e.addEventListener("mousedown",this._mouseDownBind),e.addEventListener("mouseup",this._mouseUpBind),e.addEventListener("mouseleave",this._mouseUpBind),e.addEventListener("mousemove",this._mouseMoveBind)),"onwheel"in document&&e.addEventListener("wheel",this._mouseWheelBind))}unregisterEventListeners(){const e=this._eventTargetDom;e&&(e.removeEventListener("keydown",this._onKeydown),e.removeEventListener("keyup",this._onKeyup),"ontouchend"in document&&(document.removeEventListener("touchstart",this._mouseDownBind),document.removeEventListener("touchend",this._mouseUpBind),document.removeEventListener("touchmove",this._mouseMoveBind)),"onmouseup"in document&&(e.removeEventListener("mousedown",this._mouseDownBind),e.removeEventListener("mouseup",this._mouseUpBind),e.removeEventListener("mouseleave",this._mouseUpBind),e.removeEventListener("mousemove",this._mouseMoveBind)),"onwheel"in document&&e.removeEventListener("wheel",this._mouseWheelBind))}_mouseWheel(e){if(null===this._currentDir)return;const t=-1*Math.sign(e.deltaY)*this._mouseWheelSpeedScale*this._horizontalSpeed,n=h.__tmp_Vec3_0;n.setComponents(this._currentDir.x,0,this._currentDir.z).normalize();const i=o.ZP.multiplyTo(n,t,h.__tmp_Vec3_1);this._currentPos.add(i),this._currentCenter.add(i)}_mouseDown(e){r.Kf.preventDefaultForDesktopOnly(e),e.stopPropagation(),this._isMouseDown=!0;const t=e.target.getBoundingClientRect();return this._clickedMouseXOnCanvas=e.clientX-t.left,this._clickedMouseYOnCanvas=e.clientY-t.top,!1}_mouseMove(e){if(r.Kf.preventDefaultForDesktopOnly(e),!this._isMouseDown)return;e.stopPropagation();const t=e.target.getBoundingClientRect();this._draggedMouseXOnCanvas=e.clientX-t.left,this._draggedMouseYOnCanvas=e.clientY-t.top,this._deltaMouseXOnCanvas=this._draggedMouseXOnCanvas-this._clickedMouseXOnCanvas,this._deltaMouseYOnCanvas=this._draggedMouseYOnCanvas-this._clickedMouseYOnCanvas,this._isMouseDrag=!0}_mouseUp(e){this._isMouseDown=!1,this._isMouseDrag=!1;const t=e.target;if(null==(null==t?void 0:t.getBoundingClientRect))return;const n=t.getBoundingClientRect();this._clickedMouseXOnCanvas=e.clientX-n.left,this._clickedMouseYOnCanvas=e.clientY-n.top}tryReset(){}reset(){this._isKeyDown=!1,this._lastKeyCode=-1,this._currentPos.zero(),this._currentCenter.setComponents(0,0,-1),this._currentDir.setComponents(0,0,-1),this._currentHorizontalDir.setComponents(0,0,-1),this._isMouseDown=!1,this._isMouseDrag=!1,this._draggedMouseXOnCanvas=-1,this._draggedMouseYOnCanvas=-1,this._deltaMouseXOnCanvas=-1,this._deltaMouseYOnCanvas=-1,this._mouseXAdjustScale=this._turnSpeed,this._mouseYAdjustScale=this._turnSpeed,this._deltaY=0,this._deltaX=0,this._newDir.setComponents(0,0,-1)}logic(e){this.__updateCameraComponent(e)}__updateCameraComponent(e){var t;const n=null===(t=this.__targetEntity)||void 0===t?void 0:t.getSceneGraph().worldAABB;if(this._needInitialize&&null!=n){const t=n.lengthCenterToCorner*(1+1/Math.tan(_.k.degreeToRadian(e.fovy/2)));if(this._currentPos.copyComponents(n.centerPoint),this._currentPos.z+=t,this._currentCenter.copyComponents(n.centerPoint),this._currentDir.setComponents(0,0,-1),e.entity.getSceneGraph()){const t=e.entity.getSceneGraph(),n=i.Z.invertTo(t.worldMatrixInner,h.__tmpInvMat);n.multiplyVector3To(this._currentPos,this._currentPos),n.multiplyVector3To(this._currentCenter,this._currentCenter)}this._needInitialize=!1}const a=this._deltaY/90;this._newDir.x=this._currentDir.x*(1-a),this._newDir.y=a,this._newDir.z=this._currentDir.z*(1-a),this._newDir.normalize(),this._currentHorizontalDir.x=this._currentDir.x,this._currentHorizontalDir.y=0,this._currentHorizontalDir.z=this._currentDir.z,this._currentHorizontalDir.normalize();const r=h.__tmp_Vec3_0.zero();switch(this._lastKeyCode){case 87:case 38:r.x=this._currentHorizontalDir.x*this._horizontalSpeed,r.z=this._currentHorizontalDir.z*this._horizontalSpeed;break;case 65:case 37:r.x=this._currentHorizontalDir.z*this._horizontalSpeed,r.z=-this._currentHorizontalDir.x*this._horizontalSpeed;break;case 83:case 40:r.x=-this._currentHorizontalDir.x*this._horizontalSpeed,r.z=-this._currentHorizontalDir.z*this._horizontalSpeed;break;case 68:case 39:r.x=-this._currentHorizontalDir.z*this._horizontalSpeed,r.z=this._currentHorizontalDir.x*this._horizontalSpeed;break;case 81:r.x=-this._newDir.x*this._horizontalSpeed,r.y=-this._newDir.y*this._horizontalSpeed,r.z=-this._newDir.z*this._horizontalSpeed;break;case 69:r.x=this._newDir.x*this._horizontalSpeed,r.y=this._newDir.y*this._horizontalSpeed,r.z=this._newDir.z*this._horizontalSpeed;break;case 82:r.y=this._verticalSpeed;break;case 70:r.y=-this._verticalSpeed}if(this._currentPos.add(r),this._currentCenter.add(r),this._isMouseDrag){this._inverseHorizontalRotating?this._deltaX=this._deltaMouseXOnCanvas*this._mouseXAdjustScale:this._deltaX=-this._deltaMouseXOnCanvas*this._mouseXAdjustScale,this._inverseVerticalRotating?this._deltaY+=this._deltaMouseYOnCanvas*this._mouseYAdjustScale:this._deltaY+=-this._deltaMouseYOnCanvas*this._mouseYAdjustScale,this._deltaY=Math.max(-120,Math.min(50,this._deltaY));const e=h.__tmpRotateMat.rotateY(_.k.degreeToRadian(this._deltaX));e.multiplyVectorTo(this._currentDir,this._currentDir);const t=o.ZP.subtractTo(this._currentCenter,this._currentPos,h.__tmp_Vec3_1);e.multiplyVectorTo(t,t),t.x=t.x*(1-a),t.y=a,t.z=t.z*(1-a),t.normalize(),this._currentCenter.copyComponents(this._currentPos),this._currentCenter.add(t),this._clickedMouseXOnCanvas=this._draggedMouseXOnCanvas,this._clickedMouseYOnCanvas=this._draggedMouseYOnCanvas,this._deltaMouseXOnCanvas=0,this._deltaMouseYOnCanvas=0}e.eyeInner=this._currentPos,e.directionInner=this._currentCenter,e.upInner=e._up,e.leftInner=e.left,e.rightInner=e.right,e.topInner=e.top,e.bottomInner=e.bottom,e.fovyInner=e.fovy,this._calcZNearInner(e,this._currentPos,this._newDir),this._calcZFarInner(e)}getDirection(){return null!==this._currentCenter?this._newDir.clone():null}set horizontalSpeed(e){this._horizontalSpeed=e}get horizontalSpeed(){return this._horizontalSpeed}set verticalSpeed(e){this._verticalSpeed=e}get verticalSpeed(){return this._verticalSpeed}set mouseWheelSpeed(e){this._mouseWheelSpeedScale=e}get mouseWheelSpeed(){return this._mouseWheelSpeedScale}setTarget(e){const t=e.getSceneGraph().worldAABB.lengthCenterToCorner/10;this.verticalSpeed=t,this.horizontalSpeed=t,this.__targetEntity=e,this._needInitialize=!0}getTarget(){return this.__targetEntity}get allInfo(){const e={};return e.verticalSpeed=this.verticalSpeed,e.horizontalSpeed=this.horizontalSpeed,e._turnSpeed=this._turnSpeed,this._currentPos&&(e._currentPos=this._currentPos.clone()),this._currentCenter&&(e._currentCenter=this._currentCenter.clone()),this._currentDir&&(e._currentDir=this._currentDir.clone()),e._deltaY=this._deltaY,e._newDir=this._newDir.clone(),e}set allInfo(e){let t=e;"string"==typeof e&&(t=JSON.parse(e));for(const e in t)t.hasOwnProperty(e)&&e in this&&(this[e]="quaternion"===e?a.Z.cloneOfMathObjects(a.Z.arrayToQuaternion(t[e])):a.Z.cloneOfMathObjects(a.Z.arrayToVectorOrMatrix(t[e])))}}h.__tmpInvMat=l.Z.identity(),h.__tmpRotateMat=s.Z.identity(),h.__tmp_Vec3_0=o.ZP.zero(),h.__tmp_Vec3_1=o.ZP.zero()},7861:(e,t,n)=>{"use strict";n.d(t,{Z:()=>U});var i=n(9721),a=n(2404),r=n(4710),o=n(7305),s=n(3498),l=n(657),c=n(4507),_=n(6019),h=n(6098),d=n(4690),u=n(4388);const m=Symbol("get1_offsetAsComposition"),x=Symbol("get2_offsetAsComposition"),f=Symbol("get3"),A=Symbol("get3_offset"),p=Symbol("get3_offsetAsComposition"),g=Symbol("get4"),v=Symbol("get4_offset"),y=Symbol("get4_offsetAsComposition"),I=Symbol("getN_offset"),b=Symbol("getN_offsetAsComposition"),T=Symbol("add2"),S=Symbol("add2_offset"),E=Symbol("add3"),C=Symbol("add3_offset"),w=Symbol("add4"),D=Symbol("mulArray3WithScalar_offset"),N=Symbol("mulArray4WithScalar_offset"),B=Symbol("mulArrayNWithScalar_offset"),P=Symbol("add4_offset"),M=Symbol("qlerp_offsetAsComposition"),F=Symbol("scalar_lerp_offsetAsComposition"),R=Symbol("array3_lerp_offsetAsComposition"),L=Symbol("arrayN_lerp_offsetAsComposition"),V=Symbol("normalizeArray4"),W=[Array,Float32Array,Float64Array,Int8Array,Int16Array,Int32Array,Uint8Array,Uint16Array,Uint32Array],z=[m,x,f,A,p,g,v,y,I,b,T,S,E,C,w,P,D,N,B,M,F,R,L,V],H=[function(e){return[this[e]]},function(e){return[this[2*e],this[2*e+1]]},function(){return[this[0],this[1],this[2]]},function(e){return[this[e],this[e+1],this[e+2]]},function(e){return[this[3*e],this[3*e+1],this[3*e+2]]},function(){return[this[0],this[1],this[2],this[3]]},function(e){return[this[e],this[e+1],this[e+2],this[e+3]]},function(e){return[this[4*e],this[4*e+1],this[4*e+2],this[4*e+3]]},function(e,t){const n=new Array(t);for(let i=0;i<t;i++)n[i]=this[e+i];return n},function(e,t){const n=new Array(t);for(let i=0;i<t;i++)n[i]=this[e*t+i];return n},function(e){return this[0]+=e[0],this[1]+=e[1],this},function(e,t,n){return this[t]+=e[n],this[t+1]+=e[n+1],this},function(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this},function(e,t,n){return this[t]+=e[n],this[t+1]+=e[n+1],this[t+2]+=e[n+2],this},function(e){return this[0]+=e[0],this[1]+=e[1],this[2]+=e[2],this[3]+=e[3],this},function(e,t,n){return this[t]+=e[n],this[t+1]+=e[n+1],this[t+2]+=e[n+2],this[t+3]+=e[n+3],this},function(e,t){return this[e]*=t,this[e+1]*=t,this[e+2]*=t,this},function(e,t){return this[e]*=t,this[e+1]*=t,this[e+2]*=t,this[e+3]*=t,this},function(e,t,n){for(let i=0;i<t;i++)this[e+i]*=n;return this},function(e,t,n,i){const a=new Array(4);let r=this[0+4*n]*e[0+4*i]+this[1+4*n]*e[1+4*i]+this[2+4*n]*e[2+4*i]+this[3+4*n]*e[3+4*i];if(0==1-r*r)a[0]=this[0+4*n],a[1]=this[1+4*n],a[2]=this[2+4*n],a[3]=this[3+4*n];else{r>1?r=.999:r<-1&&(r=-.999);let o=Math.acos(r);const s=Math.sin(o);let l;r<0?(r*=-1,o=Math.acos(r),l=-1*Math.sin(o*t)/s):l=Math.sin(o*t)/s;const c=Math.sin(o*(1-t))/s;a[0]=this[0+4*n]*c+e[0+4*i]*l,a[1]=this[1+4*n]*c+e[1+4*i]*l,a[2]=this[2+4*n]*c+e[2+4*i]*l,a[3]=this[3+4*n]*c+e[3+4*i]*l}return a},function(e,t,n,i){return this[n]*(1-t)+e[i]*t},function(e,t,n,i){const a=new Array(3);for(let r=0;r<3;r++)a[r]=this[3*n+r]*(1-t)+e[3*i+r]*t;return a},function(e,t,n,i,a){const r=new Array(t);for(let o=0;o<t;o++)r[o]=this[i*t+o]*(1-n)+e[a*t+o]*n;return r},function(){const e=Math.hypot(this[0],this[1],this[2],this[3]);return this[0]/=e,this[1]/=e,this[2]/=e,this[3]/=e,this}];for(let e=0;e<W.length;e++)for(let t=0;t<z.length;t++)W[e].prototype[z[t]]=H[t];var O=n(2471);const G={name:"",maxStartInputTime:0,maxEndInputTime:0},Q=Symbol("AnimationComponentEventChangeAnimationInfo"),k=Symbol("AnimationComponentEventPlayEnd");class U extends i.Z{constructor(e,t,n){super(e,t,n),this.__backupDefaultValues=new Map,this.__animationData=new Map,this.__isAnimating=!0,this.__currentProcessStage=c.I.Create}static get componentTID(){return r.z.AnimationComponentTID}static setActiveAnimationForAll(e){const t=a.Z.getInstance().getComponentsWithType(U);for(const n of t)n.setActiveAnimation(e)}setActiveAnimation(e){return this.__animationData.has(e)?(this.__currentActiveAnimationName=e,!0):(this.__currentActiveAnimationName=void 0,!1)}setAnimation(e,t,n,i,a,r,o=!0){this.__currentActiveAnimationName=o?e:(0,h.kS)({value:this.__currentActiveAnimationName,defaultValue:e});const s={name:e,input:n,output:i,outputComponentN:a,outputAttributeName:t,interpolationMethod:r};(0,h.wv)({value:this.__animationData.get(e),compensation:()=>{const t=new Map;return this.__animationData.set(e,t),t}}).set(t,s);const c=n[0],d=n[n.length-1],u=(0,h.kS)({value:U.__animationInfo.get(e),defaultValue:G}),m=u.maxStartInputTime,x=u.maxEndInputTime,f=(0,h.Qj)(m,c),A=(0,h.tS)(d,x);if(f.result||A.result){const t={name:e,maxStartInputTime:f.less,maxEndInputTime:A.greater};U.__animationInfo.set(e,t),U.__pubsub.publishAsync(U.Event.ChangeAnimationInfo,{infoMap:new Map(U.__animationInfo)})}this.__transformComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,l.Z),this.__meshComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,_.Z),this.backupDefaultValues()}static subscribe(e,t){U.__pubsub.subscribe(e,t)}static lerp(e,t,n,i,a){const r=e;return n===s.s.Quaternion.index?r[M](r,t,i,i+1):n===s.s.Weights.index?r[L](r,a,t,i,i+1):r[R](r,t,i,i+1)}static cubicSpline(e,t,n,i,a){const r=new Array(e.length);for(let o=0;o<e.length;o++)r[o]=(2*a**3-3*a**2+1)*e[o]+(a**3-2*a**2+a)*n[o]+(-2*a**3+3*a**2)*t[o]+(a**3-a**2)*i[o];return r}static __isClamped(e,t){return e<0||e>=t.length}static binarySearch(e,t){let n=0,i=e.length-1,a=0,r=0;for(;n<=i;)if(a=n+(i-n>>1),e[a]<t)n=a+1,r=a;else{if(!(t<e[a]))return a;i=a-1,r=i}return r}static interpolationSearch(e,t){let n=0,i=0,a=e.length-1,r=0;for(;i<=a&&t>=e[i]&&t<=e[a];)if(n=Math.floor(i+(t-e[i])*(a-i)/(e[a]-e[i])),e[n]<t)i=n+1,r=n;else{if(!(t<e[n]))return n;a=n-1,r=a}return r}static bruteForceSearch(e,t){for(let n=0;n<e.length;n++)if(e[n]<=t&&t<e[n+1])return n;return e.length-1}static __getOutputValue(e,t,n){const i=n;return t.interpolationMethod===o.k.CubicSpline?4===t.outputComponentN?i[v](3*t.outputComponentN*e+t.outputComponentN):3===t.outputComponentN?i[A](3*t.outputComponentN*e+t.outputComponentN):i[I](3*t.outputComponentN*e+t.outputComponentN,t.outputComponentN):4===t.outputComponentN?i[y](e):3===t.outputComponentN?i[p](e):i[b](e,t.outputComponentN)}static interpolate(e,t,n){var i;const a=e.input,r=e.output,l=null!==(i=e.interpolationMethod)&&void 0!==i?i:o.k.Linear;if(t<=a[0])return this.__getOutputValue(0,e,r);if(a[a.length-1]<=t)return this.__getOutputValue(a.length-1,e,r);if(l===o.k.CubicSpline){const i=this.interpolationSearch(a,t),o=a[i+1]-a[i],l=(t-a[i])/o,{p_0:c,p_1:_,m_0:h,m_1:d}=this.__prepareVariablesForCubicSpline(r,i,e.outputComponentN,o),u=this.cubicSpline(c,_,h,d,l);return n===s.s.Quaternion.index&&u[V](),u}if(l===o.k.Linear){const i=this.interpolationSearch(a,t),o=(t-a[i])/(a[i+1]-a[i]);return this.lerp(r,o,n,i,e.outputComponentN)}if(l===o.k.Step){for(let n=0;n<a.length-1;n++)if(a[n]<=t&&t<a[n+1])return this.__getOutputValue(n,e,r);return this.__getOutputValue(a.length-1,e,r)}return[]}static __prepareVariablesForCubicSpline(e,t,n,i){const a=e;return 4===n?{p_0:a[v](3*n*t+n),p_1:a[v](3*n*(t+1)+n),m_0:a[N](3*n*t+2*n,i),m_1:a[N](3*n*(t+1),i)}:3===n?{p_0:a[A](3*n*t+n),p_1:a[A](3*n*(t+1)+n),m_0:a[D](3*n*t+2*n,i),m_1:a[D](3*n*(t+1),i)}:{p_0:a[I](3*n*t+n,n),p_1:a[I](3*n*(t+1)+n,n),m_0:a[B](3*n*t+2*n,n,i),m_1:a[B](3*n*(t+1),n,i)}}getStartInputValueOfAnimation(e){const t=null!=e?e:this.__currentActiveAnimationName;if(void 0===t){const e=Array.from(U.__animationInfo.values());return 0===e.length?0:e[0].maxEndInputTime}return(0,h.kS)({value:U.__animationInfo.get(t),defaultValue:G}).maxStartInputTime}getEndInputValueOfAnimation(e){const t=null!=e?e:this.__currentActiveAnimationName;if(void 0===t){const e=Array.from(U.__animationInfo.values());return 0===e.length?0:e[0].maxEndInputTime}return(0,h.kS)({value:U.__animationInfo.get(t),defaultValue:G}).maxEndInputTime}static getAnimationInfo(){return new Map(this.__animationInfo)}static get startInputValue(){if(0===a.Z.getInstance().getComponentsWithType(U).length)return 0;{const e=Array.from(this.__animationInfo.values());return e[e.length-1].maxStartInputTime}}static get endInputValue(){if(0===a.Z.getInstance().getComponentsWithType(U).length)return 0;{const e=Array.from(this.__animationInfo.values());return e[e.length-1].maxEndInputTime}}static get isAnimating(){const e=a.Z.getInstance().getComponentsWithType(U);for(const t of e)if(t.isAnimating)return!0;return!1}setAnimating(e){this.__isAnimating=e}static setAnimatingForAll(e){const t=this.__componentRepository._getComponents(U);for(const n of t)n.setAnimating(e)}get isAnimating(){return this.__isAnimating}setAnimationToRest(){this.restoreDefaultValues()}restoreDefaultValues(){this.__transformComponent.quaternion=this.__backupDefaultValues.get(s.s.Quaternion.str),this.__transformComponent.translate=this.__backupDefaultValues.get(s.s.Translate.str),this.__transformComponent.scale=this.__backupDefaultValues.get(s.s.Scale.str),null!=this.__meshComponent&&(this.__meshComponent.weights=this.__backupDefaultValues.get(s.s.Weights.str))}backupDefaultValues(){var e;this.__backupDefaultValues.set(s.s.Quaternion.str,this.__transformComponent.quaternion),this.__backupDefaultValues.set(s.s.Translate.str,this.__transformComponent.translate),this.__backupDefaultValues.set(s.s.Scale.str,this.__transformComponent.scale),null!=this.__meshComponent&&this.__backupDefaultValues.set(s.s.Weights.str,null===(e=this.__meshComponent)||void 0===e?void 0:e.weights)}static getAnimationList(){return Array.from(this.__animationInfo.keys())}$create(){this.__transformComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,l.Z),this.__meshComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,_.Z),this.moveStageTo(c.I.Logic)}$logic(){if(this.isAnimating&&void 0!==this.__currentActiveAnimationName){const e=this.__animationData.get(this.__currentActiveAnimationName);if(void 0!==e)for(const[t,n]of e){const e=s.s.fromString(t).index,i=U.interpolate(n,U.globalTime,e);e===s.s.Quaternion.index?this.__transformComponent.quaternion=u.Z.fromCopyArray4(i):e===s.s.Translate.index?this.__transformComponent.translate=O.ZP.fromCopyArray3(i):e===s.s.Scale.index?this.__transformComponent.scale=O.ZP.fromCopyArray3(i):e===s.s.Weights.index&&(this.__meshComponent.weights=i)}}}}U.globalTime=0,U.__componentRepository=a.Z.getInstance(),U.__animationInfo=new Map,U.__pubsub=new class{constructor(){this.__subscriberMap=new Map}subscribe(e,t){let n=this.__subscriberMap.get(e);return d.Is.not.exist(n)&&(this.__subscriberMap.set(e,[]),n=this.__subscriberMap.get(e)),n.push(t)-1}unsubscribe(e,t){const n=this.__subscriberMap.get(e);null!=n&&n.splice(t,1)}unsubscribeAll(e){this.__subscriberMap.delete(e)}publishAsync(e,t){let n=0;const i=(0,h.vV)(this.__subscriberMap.get(e));for(const e of i)setTimeout(e.bind(this,t),0),n++;return n}publishSync(e,t){let n=0;const i=(0,h.vV)(this.__subscriberMap.get(e));for(const e of i)e(t),n++;return n}},U.Event={ChangeAnimationInfo:Q,PlayEnd:k},a.Z.registerComponentClass(U)},85:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(9721),a=n(2404),r=n(4710),o=n(4507);class s extends i.Z{constructor(e,t,n){super(e,t,n),this.__weights=[],this.__targetNames=[],this.moveStageTo(o.I.Logic)}static get componentTID(){return r.z.BlendShapeComponentTID}set weights(e){this.__weights=e}get weights(){return this.__weights}set targetNames(e){this.__targetNames=e}get targetNames(){return this.__targetNames}$logic(){}}a.Z.registerComponentClass(s)},1784:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(2404),a=n(9721),r=n(4710),o=n(2471),s=n(9646),l=n(5333),c=n(752),_=n(3999),h=n(3496),d=n(4507),u=n(4536),m=n(9190),x=n(916),f=n(408);class A{constructor(){this.top=u.ZP.zero(),this.bottom=u.ZP.zero(),this.right=u.ZP.zero(),this.left=u.ZP.zero(),this.zNear=u.ZP.zero(),this.zFar=u.ZP.zero(),this.__updated=!1,this.__vp=h.Z.zero()}update(e,t){x.Z.multiplyTo(t,e,this.__vp),this.zNear.x=this.__vp.m20+this.__vp.m30,this.zNear.y=this.__vp.m21+this.__vp.m31,this.zNear.z=this.__vp.m22+this.__vp.m32,this.zNear.w=this.__vp.m23+this.__vp.m33,this.zNear.normalize3(),this.zFar.x=-this.__vp.m20+this.__vp.m30,this.zFar.y=-this.__vp.m21+this.__vp.m31,this.zFar.z=-this.__vp.m22+this.__vp.m32,this.zFar.w=-this.__vp.m23+this.__vp.m33,this.zFar.normalize3(),this.bottom.x=this.__vp.m10+this.__vp.m30,this.bottom.y=this.__vp.m11+this.__vp.m31,this.bottom.z=this.__vp.m12+this.__vp.m32,this.bottom.w=this.__vp.m13+this.__vp.m33,this.bottom.normalize3(),this.top.x=-this.__vp.m10+this.__vp.m30,this.top.y=-this.__vp.m11+this.__vp.m31,this.top.z=-this.__vp.m12+this.__vp.m32,this.top.w=-this.__vp.m13+this.__vp.m33,this.top.normalize3(),this.left.x=this.__vp.m00+this.__vp.m30,this.left.y=this.__vp.m01+this.__vp.m31,this.left.z=this.__vp.m02+this.__vp.m32,this.left.w=this.__vp.m03+this.__vp.m33,this.left.normalize3(),this.right.x=-this.__vp.m00+this.__vp.m30,this.right.y=-this.__vp.m01+this.__vp.m31,this.right.z=-this.__vp.m02+this.__vp.m32,this.right.w=-this.__vp.m03+this.__vp.m33,this.right.normalize3()}clipping(e,t,n){const i=o.ZP.dot(e,t)+e.w;return i+n<0?f.E.Invisible:i-n>0?f.E.Visible:f.E.Neutral}culling(e){const t=e.worldAABB,n=t.centerPoint,i=t.lengthCenterToCorner,a=this.clipping(this.right,n,i),r=this.clipping(this.left,n,i);if(a===f.E.Invisible&&r===f.E.Visible||a===f.E.Visible&&r===f.E.Invisible)return f.E.Invisible;const o=this.clipping(this.zNear,n,i),s=this.clipping(this.zFar,n,i);if(o===f.E.Invisible&&s===f.E.Visible||o===f.E.Visible&&s===f.E.Invisible)return f.E.Invisible;const l=this.clipping(this.top,n,i),c=this.clipping(this.bottom,n,i);return l===f.E.Invisible&&c===f.E.Visible||l===f.E.Visible&&c===f.E.Invisible?f.E.Invisible:6===l.index+c.index+a.index+r.index+o.index+s.index?f.E.Visible:f.E.Neutral}}var p=n(346),g=n(7348),v=n(4587),y=n(3032),I=n(4529),b=n(2251);class T extends a.Z{constructor(e,t,n){super(e,t,n),this._eyeInner=m.ZP.dummy(),this._direction=m.ZP.dummy(),this._directionInner=m.ZP.dummy(),this._up=m.ZP.dummy(),this._upInner=m.ZP.dummy(),this._filmWidth=36,this._filmHeight=24,this._focalLength=20,this._corner=u.ZP.dummy(),this._cornerInner=u.ZP.dummy(),this._parameters=u.ZP.dummy(),this._parametersInner=u.ZP.dummy(),this.__type=s.i.Perspective,this._projectionMatrix=h.Z.dummy(),this.__isProjectionMatrixUpToDate=!1,this._viewMatrix=h.Z.dummy(),this.__isViewMatrixUpToDate=!1,this.__frustum=new A,this.maxNumberOfComponent=Math.max(10,Math.floor(p.Z.maxEntityNumber/100)),this.registerMember(c.$.CPUGeneric,"eyeInner",m.ZP,_.r.Float,[0,0,0]),this.registerMember(c.$.CPUGeneric,"direction",m.ZP,_.r.Float,[0,0,-1]),this.registerMember(c.$.CPUGeneric,"up",m.ZP,_.r.Float,[0,1,0]),this.registerMember(c.$.CPUGeneric,"directionInner",m.ZP,_.r.Float,[0,0,-1]),this.registerMember(c.$.CPUGeneric,"upInner",m.ZP,_.r.Float,[0,1,0]),this.registerMember(c.$.CPUGeneric,"corner",u.ZP,_.r.Float,[-1,1,1,-1]),this.registerMember(c.$.CPUGeneric,"cornerInner",u.ZP,_.r.Float,[-1,1,1,-1]),this.registerMember(c.$.CPUGeneric,"parameters",u.ZP,_.r.Float,[.1,1e4,90,1]),this.registerMember(c.$.CPUGeneric,"parametersInner",u.ZP,_.r.Float,[.1,1e4,90,1]),this.registerMember(c.$.CPUGeneric,"projectionMatrix",h.Z,_.r.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(c.$.CPUGeneric,"viewMatrix",h.Z,_.r.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.submitToAllocation(p.Z.maxCameraNumber);const i=g.Z.getInstance();i.takeOne(v.f.ViewMatrix),i.takeOne(v.f.ProjectionMatrix),i.takeOne(v.f.ViewPosition),this.setFovyAndChangeFocalLength(90),-1===T.main&&(T.main=t)}static set main(e){this.__main=e}static get main(){return this.__main}set type(e){this.__type=e,e===s.i.Orthographic?(this._parameters.z=1,this._parameters.w=1,this._parametersInner.z=1,this._parametersInner.w=1):(this.setFovyAndChangeFocalLength(90),this._parameters.w=1,this._parametersInner.z=90,this._parametersInner.w=1)}get type(){return this.__type}get eye(){return T._eye}set eye(e){throw Error("In Rhodonite, eye is always (0,0,0). Use TransformComponent for Camera positioning.")}get eyeInner(){return this._eyeInner}set eyeInner(e){this._eyeInner.copyComponents(e)}set upInner(e){this._upInner.copyComponents(e)}set up(e){this._up.copyComponents(e)}get up(){return this._up.clone()}get upInner(){return this._upInner}set direction(e){const t=this._direction,n=e,i=this._up;let a;if(0===m.ZP.crossTo(n,i,T.__tmpVector3_0).length()){const e=m.ZP.crossTo(t,i,T.__tmpVector3_1);a=m.ZP.crossTo(e,n,T.__tmpVector3_2)}else{const e=m.ZP.multiplyTo(n,n.dot(i),T.__tmpVector3_1);a=m.ZP.subtractTo(i,e,T.__tmpVector3_2)}this._up.copyComponents(a).normalize(),this._direction.copyComponents(n)}set directionInner(e){this._directionInner.copyComponents(e)}get direction(){return this._direction.clone()}get directionInner(){return this._directionInner}set corner(e){this._corner.copyComponents(e)}get corner(){return this._corner.clone()}set left(e){this._corner.x=e}set leftInner(e){this._cornerInner.x=e}get left(){return this._corner.x}set right(e){this._corner.y=e}set rightInner(e){this._cornerInner.y=e}get right(){return this._corner.y}set top(e){this._corner.z=e}set topInner(e){this._cornerInner.z=e}get top(){return this._corner.z}set bottom(e){this._corner.w=e}set bottomInner(e){this._cornerInner.w=e}get bottom(){return this._corner.w}set cornerInner(e){this._cornerInner.copyComponents(e)}get cornerInner(){return this._cornerInner}set parametersInner(e){this._parametersInner.copyComponents(e)}get parametersInner(){return this._parametersInner}get parameters(){return this._parameters.clone()}set zNear(e){this._parameters.x=e}set zNearInner(e){this._parametersInner.x=e}get zNearInner(){return this._parametersInner.x}get zNear(){return this._parameters.x}set focalLength(e){this._focalLength=e,this._parameters.z=2*y.k.radianToDegree(Math.atan(this._filmHeight/(2*e)))}get focalLength(){return this._focalLength}set zFar(e){this._parameters.y=e}set zFarInner(e){this._parametersInner.y=e}get zFarInner(){return this._parametersInner.y}get zFar(){return this._parameters.y}setFovyAndChangeFilmSize(e){this._parameters.z=e,this._filmHeight=2*this.focalLength*Math.tan(y.k.degreeToRadian(e)/2),this._filmWidth=this._filmHeight*this.aspect}setFovyAndChangeFocalLength(e){this._parameters.z=e,this._focalLength=this._filmHeight/2/Math.tan(y.k.degreeToRadian(e)/2)}get fovy(){return this._parameters.z}set fovyInner(e){this._parametersInner.z=e}set aspect(e){this._parameters.w=e,this._filmWidth=this._filmHeight*e}get aspect(){return this._parameters.w}set xMag(e){this._parameters.z=e}get xMag(){return this._parameters.z}set yMag(e){this._parameters.w=e}get yMag(){return this._parameters.w}static get componentTID(){return r.z.CameraComponentTID}calcProjectionMatrix(){const e=this._parametersInner.x,t=this._parametersInner.y;if(this.type===s.i.Perspective){const n=this._parametersInner.z,i=this._parametersInner.w,a=1/Math.tan(.5*n*Math.PI/180),r=a/i;this._projectionMatrix.setComponents(r,0,0,0,0,a,0,0,0,0,-(t+e)/(t-e),-2*t*e/(t-e),0,0,-1,0)}else if(this.type===s.i.Orthographic){const n=this._parametersInner.z,i=this._parametersInner.w;this._projectionMatrix.setComponents(1/n,0,0,0,0,1/i,0,0,0,0,-2/(t-e),-(t+e)/(t-e),0,0,0,1)}else{const n=this._cornerInner.x,i=this._cornerInner.y,a=this._cornerInner.z,r=this._cornerInner.w;this._projectionMatrix.setComponents(2*e/(i-n),0,(i+n)/(i-n),0,0,2*e/(a-r),(a+r)/(a-r),0,0,0,-(t+e)/(t-e),-2*t*e/(t-e),0,0,-1,0)}return this._projectionMatrix}get projectionMatrix(){return this._projectionMatrix}calcViewMatrix(){const e=this.eyeInner,t=m.ZP.subtractTo(this._directionInner,e,T.__tmpVector3_0).normalize(),n=m.ZP.crossTo(t,this._upInner,T.__tmpVector3_1).normalize(),i=m.ZP.crossTo(n,t,T.__tmpVector3_2);this._viewMatrix.setComponents(n.x,n.y,n.z,-o.ZP.dot(n,e),i.x,i.y,i.z,-o.ZP.dot(i,e),-t.x,-t.y,-t.z,o.ZP.dot(t,e),0,0,0,1);const a=h.Z.invertTo(this.__sceneGraphComponent.worldMatrixInner,T.__tmpMatrix44_0);return this._viewMatrix.multiply(a),this._viewMatrix}get viewMatrix(){return this._viewMatrix}set viewMatrix(e){this._viewMatrix.copyComponents(e)}set projectionMatrix(e){this._projectionMatrix.copyComponents(e)}get viewProjectionMatrix(){return h.Z.multiplyTo(this._projectionMatrix,this._viewMatrix,T.__tmpMatrix44_0)}setValuesToGlobalDataRepositoryOnlyMatrices(){T.__globalDataRepository.setValue(v.f.ViewMatrix,this.componentSID,this.viewMatrix),T.__globalDataRepository.setValue(v.f.ProjectionMatrix,this.componentSID,this.projectionMatrix)}setValuesToGlobalDataRepository(){T.__globalDataRepository.setValue(v.f.ViewMatrix,this.componentSID,this.viewMatrix),T.__globalDataRepository.setValue(v.f.ProjectionMatrix,this.componentSID,this.projectionMatrix),T.__globalDataRepository.setValue(v.f.ViewPosition,this.componentSID,this.worldPosition)}get worldPosition(){return this.__sceneGraphComponent.worldMatrixInner.multiplyVector3To(this.eyeInner,T.returnVector3),T.returnVector3}updateFrustum(){this.__frustum.update(this.viewMatrix,this.projectionMatrix)}get frustum(){return this.__frustum}$create(){this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,l.Z),this.moveStageTo(d.I.Logic)}$logic({renderPass:e}){null==this.__entityRepository.getComponentOfEntity(this.__entityUid,I.Z)?(this._eyeInner.copyComponents(T._eye),this._directionInner.copyComponents(this._direction),this._upInner.copyComponents(this._up),this._cornerInner.copyComponents(this._corner),this._parametersInner.copyComponents(this._parameters)):this._parametersInner.w=this._parameters.w,this.calcViewMatrix(),this.calcProjectionMatrix();const t=b.Z.getInstance().getModule("xr");(null==t?void 0:t.WebXRSystem.getInstance().isWebXRMode)?t.WebXRSystem.getInstance()._setValuesToGlobalDataRepository():(null==t?void 0:t.WebVRSystem.getInstance().isWebVRMode)?t.WebVRSystem.getInstance().setValuesToGlobalDataRepository():this.setValuesToGlobalDataRepository()}}T._eye=o.ZP.zero(),T.__main=-1,T.returnVector3=m.ZP.zero(),T.__globalDataRepository=g.Z.getInstance(),T.__tmpVector3_0=m.ZP.zero(),T.__tmpVector3_1=m.ZP.zero(),T.__tmpVector3_2=m.ZP.zero(),T.__tmpMatrix44_0=h.Z.zero(),i.Z.registerComponentClass(T)},4529:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(9721),a=n(1784),r=n(4507),o=n(2404),s=n(4710),l=n(6547),c=n(4478),_=n(8914);class h extends i.Z{constructor(e,t,n){super(e,t,n),this.__cameraController=new l.Z}set type(e){this.__cameraController.unregisterEventListeners(),e===_.M.Orbit?this.__cameraController=new l.Z:e===_.M.WalkThrough?this.__cameraController=new c.Z:console.warn("Not support type!")}get type(){return this.__cameraController instanceof l.Z?_.M.Orbit:_.M.WalkThrough}get controller(){return this.__cameraController}static get componentTID(){return s.z.CameraControllerComponentTID}$create(){this.__cameraComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,a.Z),this.moveStageTo(r.I.Logic)}$logic(){this.__cameraController&&this.__cameraController.logic(this.__cameraComponent)}}o.Z.registerComponentClass(h)},4322:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i=n(2404),a=n(9721),r=n(4710),o=n(5634),s=n(2471),l=n(5333),c=n(4507),_=n(346),h=n(7348),d=n(4587),u=n(4536),m=n(4255);class x extends a.Z{constructor(e,t,n){super(e,t,n),this.type=o.v.Point,this.__intensity=s.ZP.fromCopyArray([1,1,1]),this.__initialdirection=s.ZP.fromCopyArray([0,1,0]),this.__direction=s.ZP.fromCopyArray([0,1,0]),this.spotExponent=1,this.spotCutoff=30,this.range=-1,this.maxNumberOfComponent=Math.max(10,Math.floor(_.Z.maxEntityNumber/100))}static get componentTID(){return r.z.LightComponentTID}get direction(){return this.__direction}set intensity(e){this.__intensity=e}get intensity(){return this.__intensity}$create(){this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,l.Z),this.moveStageTo(c.I.Load)}$load(){const e=x.__componentRepository.getComponentsWithType(x);x.__globalDataRepository.getValue(d.f.CurrentComponentSIDs,0)._v[r.z.LightComponentTID]=e.length,x.__lightPositions=x.__globalDataRepository.getValue(d.f.LightPosition,0),x.__lightDirections=x.__globalDataRepository.getValue(d.f.LightDirection,0),x.__lightIntensities=x.__globalDataRepository.getValue(d.f.LightIntensity,0),this.moveStageTo(c.I.Logic)}$logic(){this.__direction=this.__sceneGraphComponent.normalMatrixInner.multiplyVector(this.__initialdirection),x.__lightDirections._v[4*this.componentSID+0]=this.__direction.x,x.__lightDirections._v[4*this.componentSID+1]=this.__direction.y,x.__lightDirections._v[4*this.componentSID+2]=this.__direction.z,x.__lightDirections._v[4*this.componentSID+3]=0;const e=this.__sceneGraphComponent.worldPosition;x.__lightPositions._v[4*this.componentSID+0]=e.x,x.__lightPositions._v[4*this.componentSID+1]=e.y,x.__lightPositions._v[4*this.componentSID+2]=e.z,x.__lightPositions._v[4*this.componentSID+3]=this.type.index,x.__lightIntensities._v[4*this.componentSID+0]=this.__intensity.x,x.__lightIntensities._v[4*this.componentSID+1]=this.__intensity.y,x.__lightIntensities._v[4*this.componentSID+2]=this.__intensity.z,x.__lightIntensities._v[4*this.componentSID+3]=0}}x.__componentRepository=i.Z.getInstance(),x.__globalDataRepository=h.Z.getInstance(),x.__tmp_vec4=u.ZP.zero(),x.__lightPositions=new m.Z(new Float32Array(0)),x.__lightDirections=new m.Z(new Float32Array(0)),x.__lightIntensities=new m.Z(new Float32Array(0)),i.Z.registerComponentClass(x)},6019:(e,t,n)=>{"use strict";n.d(t,{Z:()=>A});var i=n(2404),a=n(9721),r=n(4710),o=n(4507),s=n(2471),l=n(7192),c=n(1328),_=n(85),h=n(5333),d=n(916),u=n(3496),m=n(8547),x=n(9190),f=n(4690);class A extends a.Z{constructor(e,t,n){super(e,t,n),this.__viewDepth=-Number.MAX_VALUE,this.isPickable=!0,this.moveStageTo(o.I.Create)}static get componentTID(){return r.z.MeshComponentTID}setMesh(e){this.__mesh=e,e._attachedEntityUID=this.entityUID}unsetMesh(){return null!=this.__mesh&&(this.__mesh._attachedEntityUID=c.Z.invalidEntityUID,this.__mesh=void 0,!0)}get mesh(){return this.__mesh}set weights(e){null!=this.__mesh&&(this.__mesh.weights=e)}calcViewDepth(e){const t=this.__mesh.AABB.centerPoint,n=this.entity.getSkeletal();(null==n?void 0:n._bindShapeMatrix)&&n._bindShapeMatrix.multiplyVector3To(this.__mesh.AABB.centerPoint,t);const i=this.entity.getSceneGraph().worldMatrixInner.multiplyVector3To(t,A.__tmpVector3_0),a=e.viewMatrix.multiplyVector3To(i,A.__tmpVector3_1);return this.__viewDepth=a.z,this.__viewDepth}get viewDepth(){return this.__viewDepth}static alertNoMeshSet(e){console.debug("No mesh is set on this MeshComponent:"+e.componentSID)}castRay(e,t,n=0){if(this.__mesh){let i=e,a=t;if(this.__sceneGraphComponent){const r=d.Z.invert(this.__sceneGraphComponent.worldMatrixInner);i=s.ZP.fromCopyVector4(r.multiplyVector(l.ZP.fromCopyVector3(e)));const o=s.ZP.add(e,t),c=s.ZP.fromCopyVector4(r.multiplyVector(l.ZP.fromCopyVector3(o)));a=s.ZP.normalize(s.ZP.subtract(c,i));const{t:_,intersectedPosition:h}=this.__mesh.castRay(i,a,n);let u=null;return _>=0&&(u=s.ZP.fromCopyVector4(this.__sceneGraphComponent.worldMatrixInner.multiplyVector(l.ZP.fromCopyVector3(h)))),{t:_,intersectedPositionInWorld:u}}}return{t:-1,intersectedPositionInWorld:void 0}}castRayFromScreen(e,t,n,i,a=0){if(this.__mesh&&this.__sceneGraphComponent){const r=u.Z.multiplyTo(n.projectionMatrix,n.viewMatrix,A.__tmpMatrix44_0).multiply(this.__sceneGraphComponent.worldMatrixInner).invert(),o=m.Z.unProjectTo(e,t,0,r,i,A.__tmpVector3_0),s=m.Z.unProjectTo(e,t,1,r,i,A.__tmpVector3_1),l=x.ZP.subtractTo(s,o,A.__tmpVector3_2).normalize(),{t:c,intersectedPosition:_}=this.__mesh.castRay(o,l,a);let h=null;return null!=_&&c>=0&&(h=this.__sceneGraphComponent.worldMatrixInner.multiplyVector3To(_,A.__returnVector3)),{t:c,intersectedPositionInWorld:h}}return{t:-1,intersectedPositionInWorld:void 0}}$create(){this.__blendShapeComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,_.Z),this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,h.Z),this.moveStageTo(o.I.Load)}static common_$load({processApproach:e}){var t;const n=i.Z.getInstance().getComponentsWithType(A);for(const e of n){const n=e.mesh;if(!f.Is.exist(n))continue;const i=n.getPrimitiveNumber();for(let a=0;a<i;a++)n.getPrimitiveAt(a).isPositionAccessorUpdated&&(null===(t=e.entity.getMeshRenderer())||void 0===t||t.moveStageTo(o.I.Load))}}$load(){null!=this.__mesh&&(this.__mesh._calcTangents(),this.__mesh._calcArenbergInverseMatrices(),this.__mesh._calcFaceNormalsIfNonNormal(),this.__blendShapeComponent&&this.__blendShapeComponent.weights.length>0&&this.__mesh._calcBaryCentricCoord(),this.moveStageTo(o.I.Logic))}$logic(){}}A.__tmpVector3_0=x.ZP.zero(),A.__tmpVector3_1=x.ZP.zero(),A.__tmpVector3_2=x.ZP.zero(),A.__returnVector3=x.ZP.zero(),A.__tmpMatrix44_0=u.Z.zero(),i.Z.registerComponentClass(A)},5850:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var i=n(2404),a=n(9721),r=n(6019),o=n(4507),s=n(5333),l=n(4710),c=n(1784),_=n(916),h=n(7987),d=n(9286),u=n(346),m=n(752),x=n(810),f=n(3999),A=n(2251),p=n(408),g=n(9002),v=n(4141);class y extends a.Z{constructor(e,t,n){super(e,t,n),this.diffuseCubeMapContribution=1,this.specularCubeMapContribution=1,this.rotationOfCubeMap=0,this._readyForRendering=!1,this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,s.Z);const a=i.Z.getInstance().getComponentsWithType(c.Z);a&&(y.__cameraComponent=a[0])}static get componentTID(){return l.z.MeshRendererComponentTID}static get firstTransparentIndex(){return y.__firstTransparentIndex}static get lastTransparentIndex(){return y.__lastTransparentIndex}static __isReady(){return y.__instanceIDBufferUid!==h.Z.InvalidCGAPIResourceUid}static __setupInstanceIDBuffer(){if(null==y.__instanceIdAccessor){const e=d.Z.getInstance().createOrGetBuffer(m.$.CPUGeneric),t=u.Z.maxEntityNumber,n=e.takeBufferView({byteLengthToNeed:4*t,byteStride:0});y.__instanceIdAccessor=n.takeAccessor({compositionType:x.d.Scalar,componentType:f.r.Float,count:t})}const e=y.__componentRepository.getComponentsWithType(r.Z);if(null==e)return h.Z.InvalidCGAPIResourceUid;for(let t=0;t<e.length;t++)y.__instanceIdAccessor.setScalar(t,e[t].entityUID,{});return y.__webglResourceRepository.createVertexBuffer(y.__instanceIdAccessor)}static set manualTransparentSids(e){y.__manualTransparentSids=e}static set manualTransparentEntityNames(e){y.__manualTransparentSids=[];for(const t of e){const e=g.Z.getRnObjectByName(t);if(e){const t=e.getMesh();if(t){const e=t.mesh;e&&(e.isOpaque()||y.__manualTransparentSids.push(t.componentSID))}}}}$create(){this.__meshComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,r.Z),this.moveStageTo(o.I.Load)}static common_$load({processApproach:e}){const t=A.Z.getInstance().getModule("webgl");y.__webglRenderingStrategy=t.getRenderingStrategy(e),y.__webglResourceRepository=t.WebGLResourceRepository.getInstance(),v.Z.initDefaultTextures()}$load(){y.__webglRenderingStrategy.$load(this.__meshComponent),this.diffuseCubeMap&&!this.diffuseCubeMap.startedToLoad&&this.diffuseCubeMap.loadTextureImagesAsync(),this.specularCubeMap&&!this.specularCubeMap.startedToLoad&&this.specularCubeMap.loadTextureImagesAsync(),this.moveStageTo(o.I.PreRender)}static common_$prerender(){if(null==y.__webglResourceRepository.currentWebGLContextWrapper)throw new Error("No WebGLRenderingContext!");return y.__webglRenderingStrategy.common_$prerender(),y.__isReady()?0:(y.__instanceIDBufferUid=y.__setupInstanceIDBuffer(),y.__instanceIDBufferUid)}$prerender(){y.__webglRenderingStrategy.$prerender(this.__meshComponent,this,y.__instanceIDBufferUid),this.moveStageTo(o.I.Render)}static sort_$render(e){return null==y.__manualTransparentSids?y.sort_$render_inner(void 0,e):y.sort_$render_inner(y.__manualTransparentSids,e)}static sort_$render_inner(e=[],t){const n=t.sceneTopLevelGraphComponents;let l=[];const _=i.Z.getInstance();let h=t.cameraComponent;if(null==h&&(h=_.getComponent(c.Z,c.Z.main)),h&&y.isViewFrustumCullingEnabled){h.updateFrustum();const e=t=>{if(null!=t.entity.getSkeletal())return!0;{const n=t.children;for(const t of n)return e(t);return!1}},t=h.frustum,i=(e,t)=>{const n=s.Z.flattenHierarchy(e,!1);for(const e of n){const n=e.entity.getMesh();n&&t.push(n)}},a=(n,r)=>{const o=t.culling(n);if(o===p.E.Visible)i(n,r);else if(o===p.E.Neutral||e(n)){const e=n.children,t=n.entity.getMesh();t&&r.push(t);for(const t of e)a(t,r)}};for(const e of n)a(e,l)}else l=t.meshComponents;l=Array.from(new Set(l));const d=[],u=[],m=[];for(let t=0;t<l.length;t++)if(l[t].entity.getSceneGraph().isVisible&&l[t].entity.getMeshRenderer().currentProcessStage===o.I.Render){const n=l[t];n.mesh?(0===e.length&&n.mesh.isBlendPartially()?(u.push(n),d.push(n.componentSID)):0===e.length&&n.mesh.isAllBlend()&&m.push(n),n.mesh.isOpaque()?d.push(n.componentSID):h&&n.calcViewDepth(h)):r.Z.alertNoMeshSet(n)}const x=u.concat(m);let f;x.sort(((e,t)=>e.viewDepth-t.viewDepth)),f=0===e.length?x.map((e=>e.componentSID)):e,y.__firstTransparentIndex=d.length;const A=d.concat(f);return y.__lastTransparentIndex=A.length-1,A.push(a.Z.invalidComponentSID),A}static common_$render({renderPass:e,processStage:t,renderPassTickCount:n}){y.__cameraComponent=e.cameraComponent,null==y.__cameraComponent&&(y.__cameraComponent=y.__componentRepository.getComponent(c.Z,c.Z.main));let i=y.__tmp_identityMatrix,o=y.__tmp_identityMatrix;y.__cameraComponent&&(i=y.__cameraComponent.viewMatrix,o=y.__cameraComponent.projectionMatrix);const s=a.Z.__componentsOfProcessStages.get(t),l=y.__componentRepository._getComponents(r.Z);y.__webglRenderingStrategy.common_$render(s,l,i,o,e,n)}$render({i:e,renderPass:t,renderPassTickCount:n}){if(null==y.__webglRenderingStrategy.$render)return;const i=this.__entityRepository.getEntity(this.__entityUid);y.__webglRenderingStrategy.$render(e,this.__meshComponent,this.__sceneGraphComponent.worldMatrixInner,this.__sceneGraphComponent.normalMatrixInner,i,t,n,this.diffuseCubeMap,this.specularCubeMap),this.__meshComponent.mesh?this.__meshComponent.mesh.weights.length>0&&this.moveStageTo(o.I.PreRender):r.Z.alertNoMeshSet(this.__meshComponent)}}y.__shaderProgramHandleOfPrimitiveObjectUids=new Map,y.__componentRepository=i.Z.getInstance(),y.__instanceIDBufferUid=h.Z.InvalidCGAPIResourceUid,y.__tmp_identityMatrix=_.Z.identity(),y.__firstTransparentIndex=-1,y.__lastTransparentIndex=-1,y.isViewFrustumCullingEnabled=!0,y.isDepthMaskTrueForTransparencies=!1,i.Z.registerComponentClass(y)},5333:(e,t,n)=>{"use strict";n.d(t,{Z:()=>D});var i=n(2404),a=n(9721),r=n(916),o=n(3999),s=n(4710),l=n(752),c=n(4507),_=n(3496),h=n(2566),d=n(2471),u=n(2477),m=n(9190),x=n(9002),f=n(1350);class A extends x.Z{constructor(e){super(),this.__entityRepository=f.Z.getInstance(),this.__isVisible=!1,this.__target=e,this.setGizmoTag()}set isVisible(e){this.__isVisible=e,this.__topEntity&&this.__topEntity.getSceneGraph().setVisibilityRecursively(e)}get isVisible(){return this.__isVisible}__toSkipSetup(){return!!this.isSetup||!!this.__target.matchTag("Being","gizmo")}setGizmoTag(){if(this.__topEntity){this.__topEntity.tryToSetTag({tag:"Being",value:"gizmo"}),this.__topEntity.tryToSetTag({tag:"Gizmo",value:"top"});const e=D.flattenHierarchy(this.__topEntity.getSceneGraph(),!1);for(const t of e)t.entity.tryToSetTag({tag:"Being",value:"gizmo"})}}}var p=n(657),g=n(6019),v=n(5850),y=n(8696),I=n(128),b=n(810),T=n(1845),S=n(6214);class E extends A{constructor(e){super(e)}get isSetup(){return null!=this.__topEntity}_setup(){if(this.__toSkipSetup())return;this.__topEntity=this.__entityRepository.createEntity([p.Z,D,g.Z,v.Z]),this.__topEntity.tryToSetUniqueName(`AABBGizmo_of_${this.__target.uniqueName}`,!0),this.__topEntity.getSceneGraph().toMakeWorldMatrixTheSameAsLocalMatrix=!0,this.__target.getSceneGraph()._addGizmoChild(this.__topEntity.getSceneGraph());const e=this.__topEntity.getMesh();E.__mesh=new S.Z,E.__mesh.addPrimitive(E.generatePrimitive()),e.setMesh(E.__mesh),this.setGizmoTag()}static generatePrimitive(){const e=new Uint32Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,3,3,7,7,4,4,0,1,2,2,6,6,5,5,1,0,1,1,5,5,4,4,0,3,2,2,6,6,7,7,3]),t=new Float32Array([-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,1,1]);return T.Z.createPrimitive({indices:e,attributeCompositionTypes:[b.d.Vec3],attributeSemantics:[I.T.Position],attributes:[t],primitiveMode:y.T.Lines})}_update(){if(null==this.__topEntity)return;const e=this.__target.getSceneGraph().worldAABB;this.__topEntity.getTransform().translate=e.centerPoint,this.__topEntity.getTransform().scale=d.ZP.fromCopyArray([e.sizeX/2,e.sizeY/2,e.sizeZ/2])}}class C extends A{constructor(e){super(e)}get isSetup(){return null!=this.__topEntity}set length(e){C.__length=e}get length(){return C.__length}_setup(){if(this.__toSkipSetup())return;this.__topEntity=this.__entityRepository.createEntity([p.Z,D,g.Z,v.Z]),this.__topEntity.tryToSetUniqueName(`LocatorGizmo_of_${this.__target.uniqueName}`,!0),this.__topEntity.getSceneGraph().toMakeWorldMatrixTheSameAsLocalMatrix=!0,this.__target.getSceneGraph()._addGizmoChild(this.__topEntity.getSceneGraph());const e=this.__topEntity.getMesh();C.__mesh=new S.Z,C.__mesh.addPrimitive(C.__generatePrimitive()),e.setMesh(C.__mesh),this.setGizmoTag()}_update(){if(null==this.__topEntity)return;const e=this.__target.getSceneGraph().worldAABB;this.__topEntity.getTransform().translate=e.centerPoint,this.__topEntity.getTransform().scale=d.ZP.fromCopyArray([Math.min(1,e.isVanilla()?1:e.sizeX/2),Math.min(1,e.isVanilla()?1:e.sizeY/2),Math.min(1,e.isVanilla()?1:e.sizeZ/2)])}static __generatePrimitive(){const e=new Float32Array([0,0,0,this.__length,0,0,0,0,0,0,this.__length,0,0,0,0,0,0,this.__length]),t=new Float32Array([1,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,1]);return T.Z.createPrimitive({attributeCompositionTypes:[b.d.Vec3,b.d.Vec3],attributeSemantics:[I.T.Position,I.T.Color0],attributes:[e,t],primitiveMode:y.T.Lines})}}C.__length=1;var w=n(4690);class D extends a.Z{constructor(e,t,n){super(e,t,n),this.__children=[],this.__gizmoChildren=[],this._worldMatrix=_.Z.dummy(),this._normalMatrix=h.Z.dummy(),this.__isWorldMatrixUpToDate=!1,this.__isNormalMatrixUpToDate=!1,this.__tmpMatrix=_.Z.identity(),this.__worldAABB=new u.Z,this.__isWorldAABBDirty=!0,this.isVisible=!0,this.toMakeWorldMatrixTheSameAsLocalMatrix=!1,this.isRootJoint=!1,this.jointIndex=-1,D.__sceneGraphs.push(this),this.isAbleToBeParent=!1,this.beAbleToBeParent(!0),this.registerMember(l.$.GPUInstanceData,"worldMatrix",_.Z,o.r.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(l.$.GPUInstanceData,"normalMatrix",h.Z,o.r.Float,[1,0,0,0,1,0,0,0,1]),this.submitToAllocation(this.maxNumberOfComponent)}set isAABBGizmoVisible(e){e?(w.Is.not.defined(this.__aabbGizmo)&&(this.__aabbGizmo=new E(this.entity),this.__aabbGizmo._setup()),this.__aabbGizmo.isVisible=!0):w.Is.defined(this.__aabbGizmo)&&(this.__aabbGizmo.isVisible=!1)}get isAABBGizmoVisible(){return!!w.Is.defined(this.__aabbGizmo)&&this.__aabbGizmo.isVisible}set isLocatorGizmoVisible(e){e?(w.Is.not.defined(this.__locatorGizmo)&&(this.__locatorGizmo=new C(this.entity),this.__locatorGizmo._setup()),this.__locatorGizmo.isVisible=!0):w.Is.defined(this.__locatorGizmo)&&(this.__locatorGizmo.isVisible=!1)}get isLocatorGizmoVisible(){return!!w.Is.defined(this.__locatorGizmo)&&this.__locatorGizmo.isVisible}static getTopLevelComponents(){return D.__sceneGraphs.filter((e=>e.isTopLevel))}isJoint(){return this.jointIndex>=0}static get componentTID(){return s.z.SceneGraphComponentTID}beAbleToBeParent(e){this.isAbleToBeParent=e}setWorldMatrixDirty(){var e;this.setWorldMatrixDirtyRecursively(),null===(e=this.parent)||void 0===e||e.setWorldAABBDirtyParentRecursively()}setWorldMatrixDirtyRecursively(){this.__isWorldMatrixUpToDate=!1,this.__isNormalMatrixUpToDate=!1,this.__isWorldAABBDirty=!0,this.children.forEach((e=>{e.setWorldMatrixDirtyRecursively()}))}setWorldAABBDirtyParentRecursively(){var e;this.__isWorldAABBDirty=!0,null===(e=this.parent)||void 0===e||e.setWorldAABBDirtyParentRecursively()}addChild(e){e.__parent=this,this.__children.push(e)}_addGizmoChild(e){e.__parent=this,this.__gizmoChildren.push(e)}get isTopLevel(){return null==this.__parent}get children(){return this.__children}get parent(){return this.__parent}get worldMatrixInner(){return this.__isWorldMatrixUpToDate||(this._worldMatrix.copyComponents(this.__calcWorldMatrixRecursively()),this.__isWorldMatrixUpToDate=!0),this._worldMatrix}get worldMatrix(){return this.worldMatrixInner.clone()}get normalMatrixInner(){return this.__isNormalMatrixUpToDate||(r.Z.invertTo(this.worldMatrixInner,D.invertedMatrix44),this._normalMatrix.copyComponents(D.invertedMatrix44.transpose()),this.__isNormalMatrixUpToDate=!0),this._normalMatrix}get entityWorldMatrix(){return this.entity.worldMatrix}get entityWorldMatrixInner(){return this.entity.worldMatrixInner}get normalMatrix(){return this.normalMatrixInner.clone()}isWorldMatrixUpToDateRecursively(){return!!this.__isWorldMatrixUpToDate&&(!this.__parent||this.__parent.isWorldMatrixUpToDateRecursively())}__calcWorldMatrixRecursively(){if(this.__isWorldMatrixUpToDate)return this._worldMatrix;const e=this.__entityRepository.getEntity(this.__entityUid).getTransform();if(null==this.__parent||this.toMakeWorldMatrixTheSameAsLocalMatrix)return e.matrixInner;const t=this.__parent.__calcWorldMatrixRecursively();return _.Z.multiplyTo(t,e.matrixInner,this.__tmpMatrix)}static flattenHierarchy(e,t){const n=[];if(t&&!e.isJoint()||n.push(e),e.isAbleToBeParent){const i=e.children;for(let e=0;e<i.length;e++){const a=this.flattenHierarchy(i[e],t);Array.prototype.push.apply(n,a)}}return n}get worldPosition(){const e=D.__originVector3;return this.worldMatrixInner.multiplyVector3To(e,D.returnVector3),D.returnVector3}getWorldPositionOf(e){return this.worldMatrixInner.multiplyVector3(e)}getLocalPositionOf(e){return r.Z.invert(this.worldMatrixInner).multiplyVector3(e)}calcWorldAABB(){return this.__worldAABB.initialize(),function e(t){const n=t.entity.getMesh();null!=(null==n?void 0:n.mesh)&&u.Z.multiplyMatrixTo(t.entityWorldMatrixInner,n.mesh.AABB,t.__worldAABB);const i=t.children;for(let n=0;n<i.length;n++){const a=e(i[n]);t.__worldAABB.mergeAABB(a)}return t.__worldAABB}(this)}get __shouldJointWorldAabbBeCalculated(){return!D.isJointAABBShouldBeCalculated&&this.isJoint()}get worldAABB(){return this.__shouldJointWorldAabbBeCalculated||this.__isWorldAABBDirty&&(this.calcWorldAABB(),this.__isWorldAABBDirty=!1),this.__worldAABB}setVisibilityRecursively(e){this.isVisible=e;for(const t of this.__children)t.setVisibilityRecursively(e)}castRay(e,t,n=0,i=[]){const a=D.flattenHierarchy(this,!1),r=[];for(const e of a){const t=e.entity.getMesh();t&&r.push(t)}let o=Number.MAX_VALUE,s=null,l=null;for(const a of r){if(!a.entity.getSceneGraph().isVisible)continue;if(!a.isPickable)continue;if(-1!==i.indexOf(a))continue;const{t:r,intersectedPositionInWorld:c}=a.castRay(e,t,n);r<o&&(o=r,s=c,l=a)}return o===Number.MAX_VALUE&&(o=-1),{intersectedPosition:s,rayDistance:o,selectedMeshComponent:l}}castRayFromScreen(e,t,n,i,a=0,r=[]){const o=D.flattenHierarchy(this,!1),s=[];for(const e of o){const t=e.entity.getMesh();t&&s.push(t)}let l=Number.MAX_VALUE,c=null,_=null;for(const o of s){if(!o.entity.getSceneGraph().isVisible)continue;if(!o.isPickable)continue;if(-1!==r.indexOf(o))continue;const{t:s,intersectedPositionInWorld:h}=o.castRayFromScreen(e,t,n,i,a);s<l&&(l=s,c=h,_=o)}return l===Number.MAX_VALUE&&(l=-1),{intersectedPosition:c,rayDistance:l,selectedMeshComponent:_}}$create(){this.moveStageTo(c.I.Logic)}$logic(){var e;this._worldMatrix.copyComponents(this.__calcWorldMatrixRecursively()),this.__updateGizmos();const t=null===(e=this.entity.getMesh())||void 0===e?void 0:e.mesh;if(t){const e=t.getPrimitiveNumber();for(let n=0;n<e;n++)if(t.getPrimitiveAt(n).isPositionAccessorUpdated){this.setWorldAABBDirtyParentRecursively();break}}}__updateGizmos(){w.Is.defined(this.__aabbGizmo)&&this.__aabbGizmo.isSetup&&this.__aabbGizmo.isVisible&&this.__aabbGizmo._update(),w.Is.defined(this.__locatorGizmo)&&this.__locatorGizmo.isSetup&&this.__locatorGizmo.isVisible&&this.__locatorGizmo._update()}}D.__sceneGraphs=[],D.__originVector3=d.ZP.zero(),D.returnVector3=m.ZP.zero(),D.isJointAABBShouldBeCalculated=!1,D.invertedMatrix44=new _.Z([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),i.Z.registerComponentClass(D)},871:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(2404),a=n(9721),r=n(4710),o=n(4507),s=n(9190),l=n(963),c=n(3032),_=n(4536),h=n(3496),d=n(4587),u=n(7348),m=n(346),x=n(1226);class f extends a.Z{constructor(e,t,n){super(e,t,n),this._jointIndices=[],this.__joints=[],this._inverseBindMatrices=[],this.isSkinning=!0,this.isOptimizingMode=!0,this.__qArray=new Float32Array(0),this.__tsArray=new Float32Array(0),this.__tqArray=new Float32Array(0),this.__sqArray=new Float32Array(0),this.__qtsArray=new Float32Array(0),this.__qtsInfo=_.ZP.dummy(),this.__matArray=new Float32Array(0),this.__worldMatrix=h.Z.identity(),this.__isWorldMatrixVanilla=!0,f.__tookGlobalDataNum<m.Z.maxSkeletonNumber?(m.Z.boneDataType===x.N.Mat44x1?f.__globalDataRepository.takeOne(d.f.BoneMatrix):m.Z.boneDataType===x.N.Vec4x2?(f.__globalDataRepository.takeOne(d.f.BoneTranslatePackedQuat),f.__globalDataRepository.takeOne(d.f.BoneScalePackedQuat)):m.Z.boneDataType===x.N.Vec4x2Old?(f.__globalDataRepository.takeOne(d.f.BoneQuaternion),f.__globalDataRepository.takeOne(d.f.BoneTranslateScale)):m.Z.boneDataType===x.N.Vec4x1&&(f.__globalDataRepository.takeOne(d.f.BoneTranslateScale),f.__globalDataRepository.takeOne(d.f.BoneCompressedChunk)),f.__tookGlobalDataNum++):console.warn("The actual number of Skeleton generated exceeds Config.maxSkeletonNumber."),this.moveStageTo(o.I.Logic)}static get componentTID(){return r.z.SkeletalComponentTID}set joints(e){this.__joints=e;let t=0;this.componentSID<m.Z.maxSkeletonNumber&&(t=this.componentSID),m.Z.boneDataType===x.N.Mat44x1?this.__matArray=f.__globalDataRepository.getValue(d.f.BoneMatrix,t)._v:m.Z.boneDataType===x.N.Vec4x2?(this.__tqArray=f.__globalDataRepository.getValue(d.f.BoneTranslatePackedQuat,t)._v,this.__sqArray=f.__globalDataRepository.getValue(d.f.BoneScalePackedQuat,t)._v):m.Z.boneDataType===x.N.Vec4x2Old?(this.__qArray=f.__globalDataRepository.getValue(d.f.BoneQuaternion,t)._v,this.__tsArray=f.__globalDataRepository.getValue(d.f.BoneTranslateScale,t)._v):m.Z.boneDataType===x.N.Vec4x1&&(this.__tsArray=f.__globalDataRepository.getValue(d.f.BoneTranslateScale,t)._v,this.__qtsArray=f.__globalDataRepository.getValue(d.f.BoneCompressedChunk,t)._v,this.__qtsInfo=f.__globalDataRepository.getValue(d.f.BoneCompressedInfo,0))}get rootJointWorldMatrixInner(){var e;return null===(e=this.jointsHierarchy)||void 0===e?void 0:e.worldMatrixInner}get jointMatrices(){return this.__jointMatrices}get jointQuaternionArray(){return this.__qArray}get jointTranslateScaleArray(){return this.__tsArray}get jointTranslatePackedQuat(){return this.__tqArray}get jointScalePackedQuat(){return this.__sqArray}get jointMatricesArray(){return this.__matArray}get jointCompressedChunk(){return this.__qtsArray}get jointCompressedInfo(){return this.__qtsInfo}get worldMatrix(){return this.__worldMatrix.clone()}get worldMatrixInner(){return this.__worldMatrix}get isWorldMatrixUpdated(){return!this.__isWorldMatrixVanilla}$logic(){if(this.isSkinning){for(let e=0;e<this.__joints.length;e++){const t=this.__joints[e];let n;if(t.isVisible){const i=t.worldMatrixInner,a=this._inverseBindMatrices[e];h.Z.multiplyTo(i,a,f.__tmp_mat4),this._bindShapeMatrix&&f.__tmp_mat4.multiply(this._bindShapeMatrix),n=f.__tmp_mat4}else n=f.__identityMat;if(0===e&&this.__worldMatrix.copyComponents(n),this.__isWorldMatrixVanilla=!1,m.Z.boneDataType!==x.N.Mat44x1&&m.Z.boneDataType!==x.N.Vec4x1||this.__copyToMatArray(n,e),m.Z.boneDataType!==x.N.Mat44x1){const t=f.__tmpVec3_0.setComponents(Math.hypot(n.m00,n.m01,n.m02),Math.hypot(n.m10,n.m11,n.m12),Math.hypot(n.m20,n.m21,n.m22));n.m00/=t.x,n.m01/=t.x,n.m02/=t.x,n.m10/=t.y,n.m11/=t.y,n.m12/=t.y,n.m20/=t.z,n.m21/=t.z,n.m22/=t.z;const i=f.__tmp_q.fromMatrix(n);if(m.Z.boneDataType===x.N.Vec4x2Old||m.Z.boneDataType===x.N.Vec4x1){let n=1;n=Math.abs(t.x)>Math.abs(t.y)?Math.abs(t.x)>Math.abs(t.z)?t.x:t.z:Math.abs(t.y)>Math.abs(t.z)?t.y:t.z,this.__tsArray[4*e+3]=n}if(m.Z.boneDataType===x.N.Vec4x2){const a=c.k.packNormalizedVec4ToVec2(i.x,i.y,i.z,i.w,Math.pow(2,12));this.__tqArray[4*e+0]=n.m03,this.__tqArray[4*e+1]=n.m13,this.__tqArray[4*e+2]=n.m23,this.__sqArray[4*e+0]=t.x,this.__sqArray[4*e+1]=t.y,this.__sqArray[4*e+2]=t.z,this.__tqArray[4*e+3]=a[0],this.__sqArray[4*e+3]=a[1]}else m.Z.boneDataType===x.N.Vec4x2Old&&(this.__tsArray[4*e+0]=n.m03,this.__tsArray[4*e+1]=n.m13,this.__tsArray[4*e+2]=n.m23,this.__qArray[4*e+0]=i.x,this.__qArray[4*e+1]=i.y,this.__qArray[4*e+2]=i.z,this.__qArray[4*e+3]=i.w);if(m.Z.boneDataType===x.N.Vec4x1){this.__tsArray[4*e+0]=n.m03,this.__tsArray[4*e+1]=n.m13,this.__tsArray[4*e+2]=n.m23;const t=c.k.packNormalizedVec4ToVec2(i.x,i.y,i.z,i.w,Math.pow(2,12));this.__qtsArray[4*e+0]=t[0],this.__qtsArray[4*e+1]=t[1]}}}if(m.Z.boneDataType===x.N.Vec4x1){let e=1,t=1,n=1;for(let i=0;i<this.__joints.length;i++){const a=Math.abs(this.__tsArray[4*i+0]);a>e&&(e=a);const r=Math.abs(this.__tsArray[4*i+1]);r>t&&(t=r);const o=Math.abs(this.__tsArray[4*i+2]);o>n&&(n=o)}this.__qtsInfo.x=e,this.__qtsInfo.y=t,this.__qtsInfo.z=n,this.__qtsInfo.w=1;for(let i=0;i<this.__joints.length;i++){const a=this.__tsArray[4*i+0]/e,r=this.__tsArray[4*i+1]/t,o=this.__tsArray[4*i+2]/n,s=this.__tsArray[4*i+3],l=c.k.packNormalizedVec4ToVec2(a,r,o,s,Math.pow(2,12));this.__qtsArray[4*i+2]=l[0],this.__qtsArray[4*i+3]=l[1]}}}}__copyToMatArray(e,t){this.__matArray[16*t+0]=e._v[0],this.__matArray[16*t+1]=e._v[1],this.__matArray[16*t+2]=e._v[2],this.__matArray[16*t+3]=e._v[3],this.__matArray[16*t+4]=e._v[4],this.__matArray[16*t+5]=e._v[5],this.__matArray[16*t+6]=e._v[6],this.__matArray[16*t+7]=e._v[7],this.__matArray[16*t+8]=e._v[8],this.__matArray[16*t+9]=e._v[9],this.__matArray[16*t+10]=e._v[10],this.__matArray[16*t+11]=e._v[11],this.__matArray[16*t+12]=e._v[12],this.__matArray[16*t+13]=e._v[13],this.__matArray[16*t+14]=e._v[14],this.__matArray[16*t+15]=e._v[15]}}f.__tmpVec3_0=s.ZP.zero(),f.__tmpVec3_1=s.ZP.zero(),f.__tmp_mat4=h.Z.identity(),f.__tmp_q=new l.Z(0,0,0,1),f.__identityMat=h.Z.identity(),f.__globalDataRepository=u.Z.getInstance(),f.__tookGlobalDataNum=0,i.Z.registerComponentClass(f)},657:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(2471),a=n(4388),r=n(916),o=n(9721),s=n(2404),l=n(3999),c=n(4710),_=n(752),h=n(3496),d=n(963),u=n(4507),m=n(2566),x=n(9190);class f extends o.Z{constructor(e,t,n){super(e,t,n),this._translate=x.ZP.dummy(),this._rotate=x.ZP.dummy(),this._scale=x.ZP.dummy(),this._quaternion=d.Z.dummy(),this._matrix=h.Z.dummy(),this._invMatrix=h.Z.dummy(),this._normalMatrix=m.Z.dummy(),this.__toUpdateAllTransform=!0,this._updateCount=0,this.__updateCountAtLastLogic=0,this._dependentAnimationComponentId=0,this.registerMember(_.$.CPUGeneric,"translate",x.ZP,l.r.Float,[0,0,0]),this.registerMember(_.$.CPUGeneric,"rotate",x.ZP,l.r.Float,[0,0,0]),this.registerMember(_.$.CPUGeneric,"scale",x.ZP,l.r.Float,[1,1,1]),this.registerMember(_.$.CPUGeneric,"quaternion",d.Z,l.r.Float,[0,0,0,1]),this.registerMember(_.$.CPUGeneric,"matrix",h.Z,l.r.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(_.$.CPUGeneric,"invMatrix",h.Z,l.r.Float,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.registerMember(_.$.CPUGeneric,"normalMatrix",m.Z,l.r.Float,[1,0,0,0,1,0,0,0,1]),this.submitToAllocation(this.maxNumberOfComponent),this._is_translate_updated=!0,this._is_euler_angles_updated=!0,this._is_scale_updated=!0,this._is_quaternion_updated=!0,this._is_trs_matrix_updated=!0,this._is_inverse_trs_matrix_updated=!0,this._is_normal_trs_matrix_updated=!0,this.moveStageTo(u.I.Logic)}static get renderedPropertyCount(){return null}static get componentTID(){return c.z.TransformComponentTID}set toUpdateAllTransform(e){this.__toUpdateAllTransform=e}get toUpdateAllTransform(){return this.__toUpdateAllTransform}_needUpdate(){this._updateCount++}set translate(e){this._translate.copyComponents(e),this._is_translate_updated=!0,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get translate(){return this.translateInner.clone()}get translateInner(){return this._is_translate_updated||this._is_trs_matrix_updated&&(this._matrix.getTranslateTo(this._translate),this._is_translate_updated=!0),this._translate}set rotate(e){this._rotate.copyComponents(e),this._is_euler_angles_updated=!0,this._is_quaternion_updated=!1,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get rotate(){return this.rotateInner.clone()}get rotateInner(){return this._is_euler_angles_updated||(this._is_trs_matrix_updated?this._matrix.toEulerAnglesTo(this._rotate):this._is_quaternion_updated&&this._quaternion.toEulerAnglesTo(this._rotate),this._is_euler_angles_updated=!0),this._rotate}set scale(e){this._scale.copyComponents(e),this._is_scale_updated=!0,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get scale(){return this.scaleInner.clone()}get scaleInner(){return this._is_scale_updated||this._is_trs_matrix_updated&&(this._matrix.getScaleTo(this._scale),this._is_scale_updated=!0),this._scale}set quaternion(e){this._quaternion.copyComponents(e),this._is_quaternion_updated=!0,this._is_euler_angles_updated=!1,this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get quaternion(){return this.quaternionInner.clone()}get quaternionInner(){if(this._is_quaternion_updated)return this._quaternion;if(!this._is_quaternion_updated){if(this._is_trs_matrix_updated)return this._is_quaternion_updated=!0,this._quaternion.fromMatrix(this._matrix),this._quaternion;if(this._is_euler_angles_updated){const e=f.__tmpMatrix44_0.rotate(this._rotate);return this._quaternion.fromMatrix(e),this._is_quaternion_updated=!0,this._quaternion}}return this._quaternion}set matrix(e){this._matrix.copyComponents(e),this._is_trs_matrix_updated=!0,this._is_translate_updated=!1,this._is_euler_angles_updated=!1,this._is_quaternion_updated=!1,this._is_scale_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,this.__updateTransform()}get matrix(){return this.matrixInner.clone()}get matrixInner(){if(this._is_trs_matrix_updated)return this._matrix;const e=this.scaleInner,t=e._v[0],n=e._v[1],i=e._v[2],a=this.quaternionInner,r=a._v[0]*a._v[0],o=a._v[1]*a._v[1],s=a._v[2]*a._v[2],l=a._v[1]*a._v[2],c=a._v[0]*a._v[2],_=a._v[0]*a._v[1],h=a._v[3]*a._v[0],d=a._v[3]*a._v[1],u=a._v[3]*a._v[2],m=1-2*(o+s),x=2*(_-u),f=2*(c+d),A=2*(_+u),p=1-2*(r+s),g=2*(l-h),v=2*(c-d),y=2*(l+h),I=1-2*(r+o),b=this.translateInner;return this._matrix.m00=m*t,this._matrix.m01=x*n,this._matrix.m02=f*i,this._matrix.m03=b.x,this._matrix.m10=A*t,this._matrix.m11=p*n,this._matrix.m12=g*i,this._matrix.m13=b.y,this._matrix.m20=v*t,this._matrix.m21=y*n,this._matrix.m22=I*i,this._matrix.m23=b.z,this._matrix.m30=0,this._matrix.m31=0,this._matrix.m32=0,this._matrix.m33=1,this._is_trs_matrix_updated=!0,this._matrix}get inverseMatrix(){return this.inverseMatrixInner.clone()}get inverseMatrixInner(){return this._is_inverse_trs_matrix_updated||(h.Z.invertTo(this.matrixInner,this._invMatrix),this._is_inverse_trs_matrix_updated=!0),this._invMatrix}get normalMatrix(){return this.normalMatrixInner.clone()}get normalMatrixInner(){if(!this._is_normal_trs_matrix_updated){const e=h.Z.invertTo(this.matrixInner,f.__tmpMatrix44_0).transpose();this._normalMatrix.copyComponents(e),this._is_normal_trs_matrix_updated=!0}return this._normalMatrix}setTransform(e,t,n,i,a){this._is_trs_matrix_updated=!1,this._is_inverse_trs_matrix_updated=!1,this._is_normal_trs_matrix_updated=!1,null!=a&&(this._matrix.copyComponents(a),this._is_trs_matrix_updated=!0,this._is_translate_updated=!1,this._is_euler_angles_updated=!1,this._is_quaternion_updated=!1,this._is_scale_updated=!1),null!=e&&(this._translate.copyComponents(e),this._is_translate_updated=!0),null!=t&&null!=i?(this._rotate.copyComponents(t),this._quaternion=new d.Z(i),this._is_euler_angles_updated=!0,this._is_quaternion_updated=!0):null!=t?(this._rotate.copyComponents(t),this._is_euler_angles_updated=!0,this._is_quaternion_updated=!1):null!=i&&(this._quaternion.copyComponents(i),this._is_euler_angles_updated=!1,this._is_quaternion_updated=!0),null!=n&&(this._scale.copyComponents(n),this._is_scale_updated=!0),this.__updateTransform()}__updateTransform(){this.__toUpdateAllTransform&&(this.__updateRotation(),this.__updateTranslate(),this.__updateScale()),this._needUpdate()}__updateRotation(){if(this._is_euler_angles_updated&&!this._is_quaternion_updated){const e=f.__tmpMatrix44_0.rotate(this._rotate);this._quaternion.fromMatrix(e),this._is_quaternion_updated=!0}else!this._is_euler_angles_updated&&this._is_quaternion_updated?(this._quaternion.toEulerAnglesTo(this._rotate),this._is_euler_angles_updated=!0):this._is_euler_angles_updated||this._is_quaternion_updated||!this._is_trs_matrix_updated||(this._quaternion.fromMatrix(this._matrix),this._is_quaternion_updated=!0,this._matrix.toEulerAnglesTo(this._rotate),this._is_euler_angles_updated=!0)}__updateTranslate(){!this._is_translate_updated&&this._is_trs_matrix_updated&&(this._matrix.getTranslateTo(this._translate),this._is_translate_updated=!0)}__updateScale(){!this._is_scale_updated&&this._is_trs_matrix_updated&&(this._matrix.getScaleTo(this._scale),this._is_scale_updated=!0)}__updateMatrix(){if(!this._is_trs_matrix_updated&&this._is_translate_updated&&this._is_quaternion_updated&&this._is_scale_updated){const e=this._matrix.fromQuaternion(this._quaternion),t=f.__tmpMatrix44_0.scale(this._scale);e.multiply(t).putTranslate(this._translate),this._is_trs_matrix_updated=!0}}setPropertiesFromJson(e){let t=e;"string"==typeof e&&(t=JSON.parse(e));for(const e in t)t.hasOwnProperty(e)&&e in this&&(this[e]="quaternion"===e?new a.Z(t[e]):"matrix"===e?new r.Z(t[e]):i.ZP.fromCopyArray(t[e]))}setRotationFromNewUpAndFront(e,t){const n=e,i=x.ZP.crossTo(n,t,f.__tmpVector3_0),a=x.ZP.crossTo(i,n,f.__tmpVector3_1),r=f.__tmpMatrix44_0.setComponents(i.x,n.x,a.x,0,i.y,n.y,a.y,0,i.z,n.z,a.z,0,0,0,0,1);this.rotateMatrix44=r}headToDirection(e,t){const n=f.__tmpVector3_0.copyComponents(e).normalize(),a=f.__tmpVector3_1.copyComponents(t).normalize(),r=x.ZP.crossTo(n,a,f.__tmpVector3_2),o=i.ZP.dot(n,a),s=Math.acos(o);this.quaternion=f.__tmpQuaternion_0.axisAngle(r,s)}set rotateMatrix44(e){this.quaternion=f.__tmpQuaternion_0.fromMatrix(e)}get rotateMatrix44(){return new r.Z(this.quaternion)}$logic(){const e=this.entity.getSceneGraph();this.__updateCountAtLastLogic!==this._updateCount?(e.setWorldMatrixDirty(),this.__updateCountAtLastLogic=this._updateCount):null!=this.entity.getSkeletal()&&e.setWorldMatrixDirty()}}f.__tmpMatrix44_0=h.Z.zero(),f.__tmpVector3_0=x.ZP.zero(),f.__tmpVector3_1=x.ZP.zero(),f.__tmpVector3_2=x.ZP.zero(),f.__tmpQuaternion_0=d.Z.identity(),s.Z.registerComponentClass(f)},4710:(e,t,n)=>{"use strict";n.d(t,{z:()=>i});const i=Object.freeze({AnimationComponentTID:1,TransformComponentTID:2,SceneGraphComponentTID:3,MeshComponentTID:4,MeshRendererComponentTID:5,CameraControllerComponentTID:6,CameraComponentTID:7,LightComponentTID:8,SkeletalComponentTID:9,BlendShapeComponentTID:10,PhysicsComponentTID:11,SparkGearComponentTID:12,EffekseerComponentTID:13,maxWellKnownTidNumber:13})},9721:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(9286),a=n(1350),r=(n(810),n(4507)),o=n(2404),s=n(346),l=n(9002);class c extends l.Z{constructor(e,t,n){super(),this.__currentProcessStage=r.I.Create,this.__byteOffsetOfThisComponent=-1,this.__maxComponentNumber=s.Z.maxEntityNumber,this.__entityUid=e,this._component_sid=t,this.__isAlive=!0,c._processStages.forEach((e=>{this.isExistProcessStageMethod(e)&&null==c.__componentsOfProcessStages.get(e)&&(c.__componentsOfProcessStages.set(e,new Int32Array(s.Z.maxEntityNumber)),c.__lengthOfArrayOfProcessStages.set(e,0))})),this.__memoryManager=i.Z.getInstance(),this.__entityRepository=n}set maxNumberOfComponent(e){this.__maxComponentNumber=e}get maxNumberOfComponent(){return this.__maxComponentNumber}moveStageTo(e){this.__currentProcessStage=e}static get componentTID(){return 0}get componentSID(){return this._component_sid}get entityUID(){return this.__entityUid}get currentProcessStage(){return this.__currentProcessStage}static isExistProcessStageMethod(e,t,n){return null!=e.prototype[t.methodName]}isExistProcessStageMethod(e){return null!=this[e.methodName]}static process({componentType:e,processStage:t,processApproach:n,componentRepository:i,strategy:a,renderPass:r,renderPassTickCount:o}){if(!c.isExistProcessStageMethod(e,t,i))return;const s=t.methodName,l=this.__componentsOfProcessStages.get(t),_=i._getComponents(e);for(let e=0;e<l.length;++e){const i=l[e];if(i===c.invalidComponentSID)return;_[i][s]({i:e,processStage:t,processApproach:n,strategy:a,renderPass:r,renderPassTickCount:o})}}static updateComponentsOfEachProcessStage(e,t,n,i){if(!c.isExistProcessStageMethod(e,t,n))return;const a=c.__componentsOfProcessStages.get(t);if(a){const r=e["sort_"+t.methodName];if(null!=r){let e=[];e=r(i);for(let t=0;t<e.length;t++)a[t]=e[t]}else{let i=0;const r=n.getComponentsWithType(e);for(let e=0;e<r.length;++e)t===r[e].__currentProcessStage&&(a[i++]=e);a[i]=c.invalidComponentSID}}}static getByteLengthSumOfMembers(e,t){return this.__byteLengthSumOfMembers.get(t).get(e)}static setupBufferView(){}registerDependency(e,t){}static takeBufferView(e,t,n,a){const r=i.Z.getInstance().createOrGetBuffer(e);this.__bufferViews.has(t)||this.__bufferViews.set(t,new Map);const o=this.__bufferViews.get(t);if(!o.has(e)){const t=r.takeBufferView({byteLengthToNeed:n*a,byteStride:0});return o.set(e,t),t}}takeOne(e,t,n){if(!this["_"+e].isDummy())return;const i=c.__accessors.get(this.constructor).get(e).takeOne();this["_"+e]=new t(i,!1,!0);for(let t=0;t<this["_"+e]._v.length;++t)this["_"+e]._v[t]=n[t];return null}static getAccessor(e,t){return this.__accessors.get(t).get(e)}static takeAccessor(e,t,n,i,a,r){this.__accessors.has(n)||this.__accessors.set(n,new Map);const o=this.__accessors.get(n);if(!o.has(t)){const s=this.__bufferViews.get(n),l=i.getNumberOfComponents()*a.getSizeInBytes();let c=l;l%16!=0&&(c+=l%16==0?0:16-l%16);const _=s.get(e).takeAccessor({compositionType:i,componentType:a,count:r,byteStride:c});return o.set(t,_),_}}static getByteOffsetOfThisComponentTypeInBuffer(e,t){return this.__bufferViews.get(t).get(e).byteOffsetInBuffer}static getByteOffsetOfFirstOfThisMemberInBuffer(e,t){return this.__accessors.get(t).get(e).byteOffsetInBuffer}static getByteOffsetOfFirstOfThisMemberInBufferView(e,t){return this.__accessors.get(t).get(e).byteOffsetInBufferView}static getCompositionTypeOfMember(e,t){const n=this.__memberInfo.get(t).find((t=>t.memberName===e));return null!=n?n.compositionType:null}static getComponentTypeOfMember(e,t){const n=this.__memberInfo.get(t).find((t=>t.memberName===e));return null!=n?n.componentType:null}registerMember(e,t,n,i,a){c.__memberInfo.has(this.constructor)||c.__memberInfo.set(this.constructor,[]),c.__memberInfo.get(this.constructor).push({bufferUse:e,memberName:t,dataClassType:n,compositionType:n.compositionType,componentType:i,initValues:a})}submitToAllocation(e){const t=this.constructor,n=c.__memberInfo.get(t);0===this._component_sid&&function(i){c.__members.has(t)||c.__members.set(t,new Map);const a=c.__members.get(t);n.forEach((e=>{a.set(e.bufferUse,[])})),n.forEach((e=>{a.get(e.bufferUse).push(e)}));for(const n of a.keys()){const r=a.get(n);c.__byteLengthSumOfMembers.has(t)||c.__byteLengthSumOfMembers.set(t,new Map);const o=c.__byteLengthSumOfMembers.get(t);if(o.has(n)||o.set(n,0),r.forEach((e=>{o.set(n,o.get(n)+e.compositionType.getNumberOfComponents()*e.componentType.getSizeInBytes())})),r.length>0){const a=c.takeBufferView(n,t,o.get(n),e);i.__byteOffsetOfThisComponent=a.byteOffsetInBuffer}}for(const n of a.keys())a.get(n).forEach((n=>{const a=c.takeAccessor(n.bufferUse,n.memberName,t,n.compositionType,n.componentType,e);i["_byteOffsetOfAccessorInBuffer_"+n.memberName]=a.byteOffsetInBuffer,i["_byteOffsetOfAccessorInComponent_"+n.memberName]=a.byteOffsetInBufferView}))}(this);const i=c.__members.get(t);for(const e of i.keys())i.get(e).forEach((e=>{this.takeOne(e.memberName,e.dataClassType,e.initValues)}))}get entity(){return this.__entityRepository.getEntity(this.__entityUid)}static getDataByteInfoInner(e,t){const n=e["_"+t]._v,i=n.byteOffset,a=n.byteLength,r=n.length,o=i/4/4;return{byteLength:a,byteOffsetInBuffer:i,byteOffsetInThisComponent:this["_byteOffsetOfAccessorInComponent_"+t]+e.componentSID*r*4,locationOffsetInBuffer:o,locationOffsetInThisComponent:this["_byteOffsetOfAccessorInComponent_"+t]+e.componentSID*r,thisComponentByteOffsetInBuffer:e.__byteOffsetOfThisComponent,thisComponentLocationOffsetInBuffer:e.__byteOffsetOfThisComponent/4/4,componentNumber:r}}getDataByteInfo(e){return c.getDataByteInfoInner(this,e)}static getDataByteInfoByComponentSID(e,t,n){const i=o.Z.getInstance().getComponent(e,t);if(i)return c.getDataByteInfoInner(i,n)}static getDataByteInfoByEntityUID(e,t,n){const i=a.Z.getInstance().getComponentOfEntity(t,e);if(i)return c.getDataByteInfoInner(i,n)}static getLocationOffsetOfMemberOfComponent(e,t){return o.Z.getInstance().getComponent(e,0)["_byteOffsetOfAccessorInBuffer_"+t]/4/4}}c.invalidComponentSID=-1,c.__componentsOfProcessStages=new Map,c.__lengthOfArrayOfProcessStages=new Map,c.__bufferViews=new Map,c.__accessors=new Map,c.__byteLengthSumOfMembers=new Map,c.__memberInfo=new Map,c.__members=new Map,c._processStages=[r.I.Create,r.I.Load,r.I.Logic,r.I.PreRender,r.I.Render]},2404:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(9721),a=n(4690),r=n(346);class o{constructor(){this.__component_sid_count_map=new Map,this.__components=new Map}static registerComponentClass(e){o.__componentClasses.set(e.componentTID,e)}static unregisterComponentClass(e){o.__componentClasses.delete(e)}static getInstance(){return this.__instance||(this.__instance=new o),this.__instance}static getComponentClass(e){return this.__componentClasses.get(e)}createComponent(e,t,n){const r=o.__componentClasses.get(e);if(a.Is.exist(r)){let o=this.__component_sid_count_map.get(e);a.Is.not.exist(o)&&(this.__component_sid_count_map.set(e,0),o=i.Z.invalidComponentSID),this.__component_sid_count_map.set(e,++o);const s=new r(t,o,n);this.__components.has(e)||this.__components.set(e,[]);const l=this.__components.get(e);if(null!=l)return l[s.componentSID]=s,s}else console.error("The Component Class object is invalid.");return null}getComponent(e,t){return this.getComponentFromComponentTID(e.componentTID,t)}getComponentFromComponentTID(e,t){const n=this.__components.get(e);return null!=n&&null!=n[t]?n[t]:null}_getComponents(e){return this.__components.get(e.componentTID)}static getMemoryBeginIndex(e){let t=0;for(let n=0;n<e;n++){const e=o.__componentClasses.get(n);null!=e&&(t+=e.sizeOfThisComponent*r.Z.maxEntityNumber)}return t}getComponentsWithType(e){const t=this.__components.get(e.componentTID);return null==t?[]:t}getComponentTIDs(){const e=[];for(const t of this.__components.keys())e.push(t);return e.sort(((e,t)=>e<t?-1:e>t?1:0)),e}}o.__componentClasses=new Map},346:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(1226),a=n(7683);const r=Math.pow(2,12),o=Math.pow(2,12),s={maxEntityNumber:5e3,maxLightNumberInShader:4,maxVertexMorphNumberInShader:41,maxMaterialInstanceForEachType:500,boneDataType:i.N.Vec4x2,maxSkeletonNumber:33,maxCameraNumber:15,maxSizeLimitOfNonCompressedTexture:512,maxSkeletalBoneNumber:250,maxSkeletalBoneNumberForUniformMode:50,dataTextureWidth:r,dataTextureHeight:o,noWebGLTex2DStateCache:!1,maxMorphTargetNumber:4,totalSizeOfGPUShaderDataStorageExceptMorphData:0,isUboEnabled:!0,getMaxSkeletalBoneNumber:e=>a.V.isUniformApproach(e)?50:250}},1328:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(4710),a=n(9002),r=n(4690);class o extends a.Z{constructor(e,t){super(),this.__components=[],this.__entity_uid=e,this.__isAlive=t}get entityUID(){return this.__entity_uid}_setComponent(e){this.__components[e.constructor.componentTID]=e}getComponent(e){return this.__components[e.componentTID]}getComponentByComponentTID(e){return this.__components[e]}getTransform(){return null==this.__transformComponent&&(this.__transformComponent=this.getComponentByComponentTID(i.z.TransformComponentTID)),this.__transformComponent}getSceneGraph(){return null==this.__sceneGraphComponent&&(this.__sceneGraphComponent=this.getComponentByComponentTID(i.z.SceneGraphComponentTID)),this.__sceneGraphComponent}getSkeletal(){return null==this.__skeletalComponent&&(this.__skeletalComponent=this.getComponentByComponentTID(i.z.SkeletalComponentTID)),this.__skeletalComponent}getMesh(){return null==this.__meshComponent&&(this.__meshComponent=this.getComponentByComponentTID(i.z.MeshComponentTID)),this.__meshComponent}getMeshRenderer(){return null==this.__meshRendererComponent&&(this.__meshRendererComponent=this.getComponentByComponentTID(i.z.MeshRendererComponentTID)),this.__meshRendererComponent}getCamera(){return null==this.__cameraComponent&&(this.__cameraComponent=this.getComponentByComponentTID(i.z.CameraComponentTID)),this.__cameraComponent}getCameraController(){return null==this.__cameraControllerComponent&&(this.__cameraControllerComponent=this.getComponentByComponentTID(i.z.CameraControllerComponentTID)),this.__cameraControllerComponent}getBlendShape(){return null==this.__blendShapeComponent&&(this.__blendShapeComponent=this.getComponentByComponentTID(i.z.BlendShapeComponentTID)),this.__blendShapeComponent}getPhysics(){return null==this.__physicsComponent&&(this.__physicsComponent=this.getComponentByComponentTID(i.z.PhysicsComponentTID)),this.__physicsComponent}getLight(){return null==this.__lightComponent&&(this.__lightComponent=this.getComponentByComponentTID(i.z.LightComponentTID)),this.__lightComponent}get worldMatrixInner(){const e=this.getSkeletal();if(r.Is.exist(e)&&e.isWorldMatrixUpdated)return e.worldMatrixInner;{const e=this.getSceneGraph();if(r.Is.exist(e))return e.worldMatrixInner}}get worldMatrix(){var e;return null===(e=this.worldMatrixInner)||void 0===e?void 0:e.clone()}getChildByName(e){const t=this.getSceneGraph().children;for(const n of t)if(n.entity.uniqueName===e)return n.entity}}o.invalidEntityUID=-1},1350:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(1328),a=n(2404),r=n(4690),o=n(6098);class s{constructor(){this.__entity_uid_count=i.Z.invalidEntityUID,this.__entities=[],this._components=[],this.__componentRepository=a.Z.getInstance()}static getInstance(){return this.__instance||(this.__instance=new s),this.__instance}createEntity(e){const t=new i.Z(++this.__entity_uid_count,!0);return this.__entities[this.__entity_uid_count]=t,this.addComponentsToEntity(e,t.entityUID)}addComponentsToEntity(e,t){const n=this.getEntity(t);for(const i of e){const e=this.__componentRepository.createComponent(i.componentTID,t,this);r.Is.exist(e)&&((0,o.wv)({value:this._components[n.entityUID],compensation:()=>{const e=new Map;return this._components[n.entityUID]=e,e}}).set(i.componentTID,e),n._setComponent(e))}return n}removeComponentsFromEntity(e,t){const n=this.getEntity(t);for(const t of e){let e=this._components[n.entityUID];null==e&&(e=new Map,this._components[n.entityUID]=e),e.delete(t.componentTID)}return n}getEntity(e){return this.__entities[e]}getComponentOfEntity(e,t){const n=this._components[e];let i=null;return null!=n?(i=n.get(t.componentTID),null!=i?i:null):i}searchByTags(e){const t=[];for(const n of this.__entities)n.matchTags(e)&&t.push(n);return t}getEntityByUniqueName(e){for(const t of this.__entities)if(t.uniqueName===e)return t}_getEntities(){return this.__entities.concat()}getEntitiesNumber(){return this.__entities.length}}},7348:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var i=n(4587),a=n(752),r=n(9286),o=n(810),s=n(7571),l=n(3999),c=n(8547),_=n(7987),h=n(5324),d=n(4255),u=n(1813),m=n(346),x=n(3616),f=n(7192),A=n(2471),p=n(3496),g=n(4710),v=n(1226);class y{constructor(){this.__fields=new Map}initialize(e){const t={semantic:i.f.CurrentComponentSIDs,compositionType:o.d.ScalarArray,componentType:l.r.Float,maxIndex:g.z.maxWellKnownTidNumber,stage:h.H.VertexAndPixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,needUniformInFastest:!0,initialValue:new d.Z(new Float32Array(g.z.maxWellKnownTidNumber))};this.registerProperty(t,1),this.takeOne(i.f.CurrentComponentSIDs);const n={semantic:i.f.ViewMatrix,compositionType:o.d.Mat4,componentType:l.r.Float,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,initialValue:p.Z.identity()},a={semantic:i.f.ProjectionMatrix,compositionType:o.d.Mat4,componentType:l.r.Float,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,initialValue:p.Z.identity()},r={semantic:i.f.ViewPosition,compositionType:o.d.Vec3,componentType:l.r.Float,stage:h.H.VertexAndPixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,initialValue:A.ZP.fromCopyArray([0,0,1])};this.registerProperty(n,m.Z.maxCameraNumber),this.registerProperty(a,m.Z.maxCameraNumber),this.registerProperty(r,m.Z.maxCameraNumber);const s=m.Z.getMaxSkeletalBoneNumber(e),c={semantic:i.f.BoneMatrix,compositionType:o.d.Mat4Array,maxIndex:s,componentType:l.r.Float,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,soloDatum:!0,initialValue:new d.Z(new Float32Array(0))},_={semantic:i.f.BoneQuaternion,compositionType:o.d.Vec4Array,maxIndex:s,componentType:l.r.Float,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,soloDatum:!0,initialValue:new d.Z(new Float32Array(0))},y={semantic:i.f.BoneTranslateScale,compositionType:o.d.Vec4Array,maxIndex:s,componentType:l.r.Float,soloDatum:!0,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,initialValue:new d.Z(new Float32Array(0))},I={semantic:i.f.BoneTranslatePackedQuat,compositionType:o.d.Vec4Array,maxIndex:s,componentType:l.r.Float,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,soloDatum:!0,initialValue:new d.Z(new Float32Array(0))},b={semantic:i.f.BoneScalePackedQuat,compositionType:o.d.Vec4Array,maxIndex:s,componentType:l.r.Float,soloDatum:!0,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,initialValue:new d.Z(new Float32Array(0))},T={semantic:i.f.BoneCompressedChunk,compositionType:o.d.Vec4Array,maxIndex:s,componentType:l.r.Float,soloDatum:!0,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,initialValue:new d.Z(new Float32Array(0))},S={semantic:i.f.BoneCompressedInfo,compositionType:o.d.Vec4,componentType:l.r.Float,soloDatum:!0,stage:h.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.FirstTimeOnly,initialValue:f.ZP.zero()},E={semantic:i.f.SkinningMode,compositionType:o.d.Scalar,componentType:l.r.Int,stage:h.H.VertexAndPixelShader,min:0,max:1,isSystem:!0,updateInterval:u.a.EveryTime,initialValue:x.ZP.fromCopyNumber(-1)};m.Z.boneDataType===v.N.Mat44x1?this.registerProperty(c,m.Z.maxSkeletonNumber):m.Z.boneDataType===v.N.Vec4x2?(this.registerProperty(I,m.Z.maxSkeletonNumber),this.registerProperty(b,m.Z.maxSkeletonNumber)):m.Z.boneDataType===v.N.Vec4x2Old?(this.registerProperty(_,m.Z.maxSkeletonNumber),this.registerProperty(y,m.Z.maxSkeletonNumber)):m.Z.boneDataType===v.N.Vec4x1&&(this.registerProperty(y,m.Z.maxSkeletonNumber),this.registerProperty(T,m.Z.maxSkeletonNumber),this.registerProperty(S,1),this.takeOne(i.f.BoneCompressedInfo)),this.registerProperty(E,1),this.takeOne(i.f.SkinningMode);const C={semantic:i.f.LightPosition,compositionType:o.d.Vec4Array,componentType:l.r.Float,stage:h.H.PixelShader,maxIndex:m.Z.maxLightNumberInShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:u.a.EveryTime,initialValue:new d.Z(new Float32Array(m.Z.maxLightNumberInShader))},w={semantic:i.f.LightDirection,compositionType:o.d.Vec4Array,componentType:l.r.Float,stage:h.H.PixelShader,maxIndex:m.Z.maxLightNumberInShader,min:-1,max:1,isSystem:!0,initialValue:new d.Z(new Float32Array(m.Z.maxLightNumberInShader)),updateInterval:u.a.EveryTime},D={semantic:i.f.LightIntensity,compositionType:o.d.Vec4Array,componentType:l.r.Float,stage:h.H.PixelShader,maxIndex:m.Z.maxLightNumberInShader,min:0,max:10,isSystem:!0,initialValue:new d.Z(new Float32Array(m.Z.maxLightNumberInShader)),updateInterval:u.a.EveryTime};this.registerProperty(C,1),this.registerProperty(w,1),this.registerProperty(D,1),this.takeOne(i.f.LightDirection),this.takeOne(i.f.LightIntensity),this.takeOne(i.f.LightPosition);const N={semantic:i.f.LightNumber,compositionType:o.d.Scalar,componentType:l.r.Int,stage:h.H.VertexAndPixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInterval:u.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)};this.registerProperty(N,1),this.takeOne(i.f.LightNumber)}static getInstance(){return this.__instance||(this.__instance=new y),this.__instance}registerProperty(e,t){const n=s.Z._getPropertyIndex(e),i=r.Z.getInstance().createOrGetBuffer(a.$.GPUInstanceData),c=s.Z._calcAlignedByteLength(e),_=i.takeBufferView({byteLengthToNeed:c*t,byteStride:0});let h=e.maxIndex;o.d.isArray(e.compositionType)&&null==h&&(h=100);const d={shaderSemanticsInfo:e,values:[],maxCount:t,accessor:_.takeAccessor({compositionType:e.compositionType,componentType:l.r.Float,count:t,byteStride:c,arrayLength:h})};this.__fields.set(n,d)}takeOne(e,t){const n=s.Z._getPropertyIndex2(e,t),i=this.__fields.get(n);if(i){const e=i.shaderSemanticsInfo,t=i.accessor.takeOne(),n=i.values.length,a=c.Z.initWithFloat32Array(e.initialValue,e.initialValue,t,e.compositionType);return i.values[n]=a,a}}setValue(e,t,n,i){const a=s.Z._getPropertyIndex2(e,i),r=this.__fields.get(a);if(r){const e=r.values[t];c.Z._setForce(e,n)}}getValue(e,t,n){const i=s.Z._getPropertyIndex2(e,n),a=this.__fields.get(i);if(a)return a.values[t]}getGlobalPropertyStruct(e){return this.__fields.get(e)}getGlobalProperties(){return Array.from(this.__fields.values())}setUniformLocationsForUniformModeOnly(e){const t=_.Z.getWebGLResourceRepository(),n=[];this.__fields.forEach(((e,t)=>{const i=e.shaderSemanticsInfo;n.push(i)})),t.setupUniformLocations(e,n,!0)}setUniformValues(e){const t=_.Z.getWebGLResourceRepository();this.__fields.forEach(((n,i)=>{const a=n.shaderSemanticsInfo,r=n.values;for(let n=0;n<r.length;n++)t.setUniformValue(e,a.semantic.str,!0,r[n],a.index)}))}getLocationOffsetOfProperty(e){const t=this.__fields.get(e);return t?t.accessor.byteOffsetInBuffer/4/4:-1}getCurrentDataNumberOfTheProperty(e){const t=this.__fields.get(e);return t?t.values.length:0}addPropertiesStr(e,t,n,i){return this.__fields.forEach(((a,r)=>{const o=a.shaderSemanticsInfo;o.stage!==h.H.VertexShader&&o.stage!==h.H.VertexAndPixelShader||(e+=n("",o,r,!0,i)),o.stage!==h.H.PixelShader&&o.stage!==h.H.VertexAndPixelShader||(t+=n("",o,r,!0,i))})),[e,t]}}},9286:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(3395),a=n(752),r=n(346);class o{constructor(e,t,n){this.__buffers={},this.__buffersOnDemand=new Map,this.__memorySizeRatios={},this.__memorySizeRatios[a.$.CPUGeneric.str]=e,this.__memorySizeRatios[a.$.GPUInstanceData.str]=t,this.__memorySizeRatios[a.$.GPUVertexData.str]=n}static createInstanceIfNotCreated(e,t,n){return this.__instance||(this.__instance=new o(e,t,n)),this.__instance}__makeMultipleOf4byteSize(e){return e+(e%4==0?0:4-e%4)}static getInstance(){return this.__instance}__createBuffer(e){const t=o.bufferWidthLength*o.bufferHeightLength*4*4*this.__memorySizeRatios[e.str],n=new ArrayBuffer(this.__makeMultipleOf4byteSize(t));let r=4;e!=a.$.GPUInstanceData&&e!=a.$.GPUVertexData||(r=16);const s=new i.Z({byteLength:n.byteLength,buffer:n,name:e.str,byteAlign:r});return this.__buffers[s.name]=s,s}getBuffer(e){return this.__buffers[e.toString()]}createOrGetBuffer(e){let t=this.__buffers[e.toString()];return null==t&&(t=this.__createBuffer(e)),t}createBufferOnDemand(e,t,n){const r=new ArrayBuffer(e),o=new i.Z({byteLength:r.byteLength,buffer:r,name:a.$.UBOGeneric.toString(),byteAlign:n});return this.__buffersOnDemand.set(t.objectUID,o),o}getBufferOnDemand(e){return this.__buffersOnDemand.get(e.objectUID)}static get bufferWidthLength(){return r.Z.dataTextureWidth}static get bufferHeightLength(){return r.Z.dataTextureHeight}printMemoryUsage(){const e=this.__buffers[a.$.CPUGeneric.toString()],t=this.__buffers[a.$.GPUInstanceData.toString()],n=this.__buffers[a.$.GPUVertexData.toString()];console.log("Memory Usage in Memory Manager:"),console.log(`CPUGeneric: ${e.takenSizeInByte} byte of ${e.byteLength} bytes. (${e.takenSizeInByte/e.byteLength*100} %) `),console.log(`GPUInstanceData: ${t.takenSizeInByte} byte of ${t.byteLength} bytes. (${t.takenSizeInByte/t.byteLength*100} %) `),null!=n&&console.log(`GPUVertexData: ${n.takenSizeInByte} byte of ${n.byteLength} bytes. (${n.takenSizeInByte/n.byteLength*100} %) `)}}},9002:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{constructor(){this.__objectUid=i.InvalidObjectUID,this.__tags={},this.__combinedTagString="",this.__objectUid=i.currentMaxObjectCount++,i.__objects[this.__objectUid]=this,this.__uniqueName=`${this.constructor.name}__uid_${this.__objectUid}`,i.__uniqueNames[this.__objectUid]=this.__uniqueName,i.__objectsByNameMap.set(this.__uniqueName,this)}static searchByTag(e,t){for(const n of i.__objects)if(n.getTagValue(e)===t)return n}get objectUID(){return this.__objectUid}static getRnObject(e){return i.__objects[e]}static getRnObjectByName(e){return i.__objectsByNameMap.get(e)}tryToSetUniqueName(e,t){if(-1!==i.__uniqueNames.indexOf(e)){if(t){const t=e+"_("+this.__objectUid+")";if(-1===i.__uniqueNames.indexOf(t))return this.__uniqueName=t,i.__uniqueNames[this.__objectUid]=this.__uniqueName,i.__objectsByNameMap.set(this.__uniqueName,this),!0}return!1}return this.__uniqueName=e,i.__uniqueNames[this.__objectUid]=this.__uniqueName,i.__objectsByNameMap.set(this.__uniqueName,this),!0}validateTagString(e){return!new RegExp(/[!"#$%&'()\*\+\-\s\.,\/:;<=>?@\[\\\]^`{|}~]/g).test(e)}tryToSetTag(e){return!!this.validateTagString(e.tag)&&(this.hasTag(e.tag)&&this.removeTag(e.tag),this.__tags[e.tag]=e.value,this.__combinedTagString+=`${e.tag}:${e.value} `,!0)}getTagValue(e){return this.__tags[e]}getTag(e){return{tag:e,value:this.__tags[e]}}hasTag(e){return null!=this.__tags[e]}removeTag(e){this.__tags[e],this.__combinedTagString.replace(this.__combinedTagString,""),delete this.__tags[e]}matchTag(e,t){return this.__tags[e]===t}matchTagsAsFreeStrings(e){let t="^";for(let n=0;n<e.length;n++)t+=`(?=.*${e[n]})`;return!!new RegExp(t).test(this.__combinedTagString)}matchTags(e){let t="^";for(const n in e)t+=`(?=.*${[n]}:${e[n]})`;return!!new RegExp(t).test(this.__combinedTagString)}get uniqueName(){return this.__uniqueName}static _reset(){this.currentMaxObjectCount=0,this.__uniqueNames=[],this.__objectsByNameMap=new Map,this.__objects=[]}}i.InvalidObjectUID=-1,i.currentMaxObjectCount=0,i.__uniqueNames=[],i.__objectsByNameMap=new Map,i.__objects=[]},5704:(e,t,n)=>{"use strict";n.d(t,{F:()=>_});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"OPAQUE"}),o=new a({index:1,str:"MASK"}),s=new a({index:2,str:"TRANSLUCENT"}),l=new a({index:3,str:"ADDITIVE"}),c=[r,o,s,l],_=Object.freeze({Opaque:r,Mask:o,Translucent:s,Additive:l,from:function(e){return(0,i.li)({typeList:c,index:e})},fromString:function(e){return(0,i.cu)({typeList:c,str:e})},fromGlTFString:function(e){return"BLEND"===e?s:(0,i.cu)({typeList:c,str:e})}})},3498:(e,t,n)=>{"use strict";n.d(t,{s:()=>_});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"Quaternion"}),o=new a({index:1,str:"Translate"}),s=new a({index:2,str:"Scale"}),l=new a({index:3,str:"Weights"}),c=[r,o,s,l],_=Object.freeze({Quaternion:r,Translate:o,Scale:s,Weights:l,from:function(e){return(0,i.li)({typeList:c,index:e})},fromString:function(e){return(0,i.cu)({typeList:c,str:e})}})},7305:(e,t,n)=>{"use strict";n.d(t,{k:()=>c});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"Linear"}),o=new a({index:1,str:"Step"}),s=new a({index:2,str:"CubicSpline"}),l=[r,o,s],c=Object.freeze({Linear:r,Step:o,CubicSpline:s,from:function(e){return(0,i.li)({typeList:l,index:e})},fromString:function(e){return(0,i.cu)({typeList:l,str:e})}})},1226:(e,t,n)=>{"use strict";n.d(t,{N:()=>_});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"Mat44x1"}),o=new a({index:1,str:"Vec4x2"}),s=new a({index:2,str:"Vec4x2Old"}),l=new a({index:3,str:"Vec4x1"}),c=[r,o,l],_=Object.freeze({Mat44x1:r,Vec4x2:o,Vec4x2Old:s,Vec4x1:l,from:function(e){return(0,i.li)({typeList:c,index:e})},fromString:function(e){return(0,i.cu)({typeList:c,str:e})}})},752:(e,t,n)=>{"use strict";n.d(t,{$:()=>_});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"GPUInstanceData"}),o=new a({index:1,str:"GPUVertexData"}),s=new a({index:2,str:"UBOGeneric"}),l=new a({index:3,str:"CPUGeneric"}),c=[r,o,s,l],_=Object.freeze({GPUInstanceData:r,GPUVertexData:o,UBOGeneric:s,CPUGeneric:l,from:function(e){return(0,i.li)({typeList:c,index:e})},fromString:function(e){return(0,i.cu)({typeList:c,str:e})}})},8914:(e,t,n)=>{"use strict";n.d(t,{M:()=>l});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"Orbit"}),o=new a({index:1,str:"WalkThrough"}),s=[r,o],l=Object.freeze({Orbit:r,WalkThrough:o,from:function(e){return(0,i.li)({typeList:s,index:e})},fromString:function(e){return(0,i.cu)({typeList:s,str:e})}})},9646:(e,t,n)=>{"use strict";n.d(t,{i:()=>c});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"Perspective"}),o=new a({index:1,str:"Orthographic"}),s=new a({index:2,str:"Frustum"}),l=[r,o,s],c=Object.freeze({Perspective:r,Orthographic:o,Frustum:s,from:function(e){return(0,i.li)({typeList:l,index:e})},fromString:function(e){return(0,i.cu)({typeList:l,str:e})}})},3999:(e,t,n)=>{"use strict";n.d(t,{r:()=>A});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t,sizeInBytes:n}){super({index:e,str:t}),this.__sizeInBytes=n}getSizeInBytes(){return this.__sizeInBytes}isFloatingPoint(){return 5126===this.index||5127===this.index||36193===this.index}isInteger(){return 5120===this.index||5121===this.index||5122===this.index||5123===this.index||5124===this.index||5125===this.index}}const r=new a({index:5119,str:"UNKNOWN",sizeInBytes:0}),o=new a({index:5120,str:"BYTE",sizeInBytes:1}),s=new a({index:5121,str:"UNSIGNED_BYTE",sizeInBytes:1}),l=new a({index:5122,str:"SHORT",sizeInBytes:2}),c=new a({index:5123,str:"UNSIGNED_SHORT",sizeInBytes:2}),_=new a({index:5124,str:"INT",sizeInBytes:4}),h=new a({index:5125,str:"UNSIGNED_INT",sizeInBytes:4}),d=new a({index:5126,str:"FLOAT",sizeInBytes:4}),u=new a({index:5127,str:"DOUBLE",sizeInBytes:8}),m=new a({index:35670,str:"BOOL",sizeInBytes:1}),x=new a({index:36193,str:"HALF_FLOAT_OES",sizeInBytes:2}),f=[r,o,s,l,c,_,h,d,u,x],A=Object.freeze({Unknown:r,Byte:o,UnsignedByte:s,Short:l,UnsignedShort:c,Int:_,UnsignedInt:h,Float:d,Double:u,Bool:m,HalfFloat:x,from:function(e){return(0,i.li)({typeList:f,index:e})},fromTypedArray:function(e){return e instanceof Int8Array?o:e instanceof Uint8Array||e instanceof Uint8ClampedArray?s:e instanceof Int16Array?l:e instanceof Uint16Array?c:e instanceof Int32Array?_:e instanceof Uint32Array?h:e instanceof Float32Array?d:e instanceof Float64Array?u:r},toTypedArray:function(e){return e===o?Int8Array:e===s?Uint8Array:e===l?Int16Array:e===c?Uint16Array:e===_?Int32Array:e===h?Uint32Array:e===d?Float32Array:e===u?Float64Array:void 0},fromString:function(e){return(0,i.cu)({typeList:f,str:e})},fromGlslString:function(e){let t=e;switch(e){case"int":t="INT";break;case"float":case"vec2":case"vec3":case"vec4":case"mat2":case"mat3":case"mat4":t="FLOAT";break;case"ivec2":case"ivec3":case"ivec4":case"sampler2D":case"sampler3D":case"samplerCube":t="INT"}return(0,i.cu)({typeList:f,str:t})}})},810:(e,t,n)=>{"use strict";n.d(t,{d:()=>b});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t,glslStr:n,hlslStr:i,numberOfComponents:a,vec4SizeOfProperty:r,isArray:o=!1}){super({index:e,str:t}),this.__numberOfComponents=a,this.__glslStr=n,this.__hlslStr=i,this.__vec4SizeOfProperty=r,this.__isArray=o}getNumberOfComponents(){return this.__numberOfComponents}getGlslStr(e){return 5126===e.index||5127===e.index||this===b.Texture2D||this===b.TextureCube?this.__glslStr:5120===e.index||5122===e.index||5124===e.index?this===b.Scalar||this===b.ScalarArray?"int":"i"+this.__glslStr:35670===e.index?"bool":"unknown"}getGlslInitialValue(e){if(5126===e.index||5127===e.index){if(this===b.Scalar)return"0.0";if(2===this.__numberOfComponents)return this.__glslStr+"(0.0, 0.0)";if(3===this.__numberOfComponents)return this.__glslStr+"(0.0, 0.0, 0.0)";if(4===this.__numberOfComponents)return this.__glslStr+"(0.0, 0.0, 0.0, 0.0)";if(9===this.__numberOfComponents)return this.__glslStr+"(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)";if(16===this.__numberOfComponents)return this.__glslStr+"(0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0)"}else if(5120===e.index||5122===e.index||5124===e.index){if(this===b.Scalar)return"0";if(2===this.__numberOfComponents)return this.__glslStr+"(0, 0)";if(3===this.__numberOfComponents)return this.__glslStr+"(0, 0, 0)";if(4===this.__numberOfComponents)return this.__glslStr+"(0, 0, 0, 0)";if(9===this.__numberOfComponents)return this.__glslStr+"(0, 0, 0, 0, 0, 0, 0, 0, 0)";if(16===this.__numberOfComponents)return this.__glslStr+"(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)"}else if(35670===e.index){if(this===b.Scalar)return"false";if(2===this.__numberOfComponents)return this.__glslStr+"(false, false)";if(3===this.__numberOfComponents)return this.__glslStr+"(false, false, false)";if(4===this.__numberOfComponents)return this.__glslStr+"(false, false, false, false)"}return"unknown"}getVec4SizeOfProperty(){return this.__vec4SizeOfProperty}}const r=new a({index:-1,str:"UNKNOWN",glslStr:"unknown",hlslStr:"unknown",numberOfComponents:0,vec4SizeOfProperty:0}),o=new a({index:0,str:"SCALAR",glslStr:"float",hlslStr:"float",numberOfComponents:1,vec4SizeOfProperty:1}),s=new a({index:1,str:"VEC2",glslStr:"vec2",hlslStr:"float2",numberOfComponents:2,vec4SizeOfProperty:1}),l=new a({index:2,str:"VEC3",glslStr:"vec3",hlslStr:"float3",numberOfComponents:3,vec4SizeOfProperty:1}),c=new a({index:3,str:"VEC4",glslStr:"vec4",hlslStr:"float4",numberOfComponents:4,vec4SizeOfProperty:1}),_=new a({index:4,str:"MAT2",glslStr:"mat2",hlslStr:"float2x2",numberOfComponents:4,vec4SizeOfProperty:2}),h=new a({index:5,str:"MAT3",glslStr:"mat3",hlslStr:"float3x3",numberOfComponents:9,vec4SizeOfProperty:3}),d=new a({index:6,str:"MAT4",glslStr:"mat4",hlslStr:"float4x4",numberOfComponents:16,vec4SizeOfProperty:4}),u=new a({index:7,str:"TEXTURE_2D",glslStr:"sampler2D",hlslStr:"Texture2D",numberOfComponents:1,vec4SizeOfProperty:1}),m=new a({index:8,str:"TEXTURE_CUBE_MAP",glslStr:"samplerCube",hlslStr:"TextureCube",numberOfComponents:1,vec4SizeOfProperty:1}),x=new a({index:9,str:"SCALAR_ARRAY",glslStr:"float",hlslStr:"float",numberOfComponents:1,vec4SizeOfProperty:1,isArray:!0}),f=new a({index:10,str:"VEC2_ARRAY",glslStr:"vec2",hlslStr:"float2",numberOfComponents:2,vec4SizeOfProperty:1,isArray:!0}),A=new a({index:11,str:"VEC3_ARRAY",glslStr:"vec3",hlslStr:"float3",numberOfComponents:3,vec4SizeOfProperty:1,isArray:!0}),p=new a({index:12,str:"VEC4_ARRAY",glslStr:"vec4",hlslStr:"float4",numberOfComponents:4,vec4SizeOfProperty:1,isArray:!0}),g=new a({index:13,str:"MAT4_ARRAY",glslStr:"mat4",hlslStr:"float4x4",numberOfComponents:16,vec4SizeOfProperty:4,isArray:!0}),v=new a({index:14,str:"MAT3_ARRAY",glslStr:"mat3",hlslStr:"float3x3",numberOfComponents:9,vec4SizeOfProperty:3,isArray:!0}),y=new a({index:15,str:"MAT2_ARRAY",glslStr:"mat2",hlslStr:"float2x2",numberOfComponents:4,vec4SizeOfProperty:2,isArray:!0}),I=[r,o,s,l,c,_,h,d,f,A,p,x,y,v,g,u,m],b=Object.freeze({Unknown:r,Scalar:o,Vec2:s,Vec3:l,Vec4:c,Mat2:_,Mat3:h,Mat4:d,ScalarArray:x,Vec2Array:f,Vec3Array:A,Vec4Array:p,Mat2Array:y,Mat3Array:v,Mat4Array:g,Texture2D:u,TextureCube:m,from:function(e){return(0,i.li)({typeList:I,index:e})},fromString:function(e){return(0,i.cu)({typeList:I,str:e})},fromGlslString:function(e){let t=e;switch(e){case"int":case"float":t="scalar";break;case"ivec2":t="vec2";break;case"ivec3":t="vec3";break;case"ivec4":t="vec4";break;case"sampler2D":t="TEXTURE_2D";break;case"samplerCube":t="TEXTURE_CUBE_MAP"}return(0,i.cu)({typeList:I,str:t})},isArray:function(e){return e===x||e===f||e===A||e===p||e===g||e===v||e===y},isTexture:function(e){return e===u||e===m}})},1715:(e,t,n)=>{"use strict";n.d(t,{b:()=>U});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:37808,str:"COMPRESSED_RGBA_ASTC_4x4_KHR"}),o=new a({index:37809,str:"COMPRESSED_RGBA_ASTC_5x4_KHR"}),s=new a({index:37810,str:"COMPRESSED_RGBA_ASTC_5x5_KHR"}),l=new a({index:37811,str:"COMPRESSED_RGBA_ASTC_6x5_KHR"}),c=new a({index:37812,str:"COMPRESSED_RGBA_ASTC_6x6_KHR"}),_=new a({index:37813,str:"COMPRESSED_RGBA_ASTC_8x5_KHR"}),h=new a({index:37814,str:"COMPRESSED_RGBA_ASTC_8x6_KHR"}),d=new a({index:37815,str:"COMPRESSED_RGBA_ASTC_8x8_KHR"}),u=new a({index:37816,str:"COMPRESSED_RGBA_ASTC_10x5_KHR"}),m=new a({index:37817,str:"COMPRESSED_RGBA_ASTC_10x6_KHR"}),x=new a({index:37818,str:"COMPRESSED_RGBA_ASTC_10x8_KHR"}),f=new a({index:37819,str:"COMPRESSED_RGBA_ASTC_10x10_KHR"}),A=new a({index:37820,str:"COMPRESSED_RGBA_ASTC_12x10_KHR"}),p=new a({index:37821,str:"COMPRESSED_RGBA_ASTC_12x12_KHR"}),g=new a({index:37840,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR"}),v=new a({index:37841,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR"}),y=new a({index:37842,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR"}),I=new a({index:37843,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR"}),b=new a({index:37844,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR"}),T=new a({index:37845,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR"}),S=new a({index:37846,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR"}),E=new a({index:37847,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR"}),C=new a({index:37848,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR"}),w=new a({index:37849,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR"}),D=new a({index:37850,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR"}),N=new a({index:37851,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR"}),B=new a({index:37852,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR"}),P=new a({index:37853,str:"COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}),M=new a({index:33776,str:"COMPRESSED_RGB_S3TC_DXT1_EXT"}),F=new a({index:33777,str:"COMPRESSED_RGBA_S3TC_DXT1_EXT"}),R=new a({index:33778,str:"COMPRESSED_RGBA_S3TC_DXT3_EXT"}),L=new a({index:33779,str:"COMPRESSED_RGBA_S3TC_DXT5_EXT"}),V=new a({index:36492,str:"COMPRESSED_RGBA_BPTC_UNORM_EXT"}),W=new a({index:35842,str:"COMPRESSED_RGBA_PVRTC_4BPPV1_IMG"}),z=new a({index:35840,str:"COMPRESSED_RGB_PVRTC_4BPPV1_IMG"}),H=new a({index:37496,str:"COMPRESSED_RGBA8_ETC2_EAC"}),O=new a({index:37492,str:"COMPRESSED_RGB8_ETC2"}),G=new a({index:36196,str:"COMPRESSED_RGB_ETC1_WEBGL"}),Q=new a({index:32856,str:"RGBA8_EXT"}),k=[r,o,s,l,c,_,h,d,u,m,x,f,A,p,g,v,y,I,b,T,S,E,C,w,D,N,B,P,M,F,R,L,V,W,z,H,O,G,Q],U=Object.freeze({ASTC_RGBA_4x4:r,ASTC_RGBA_5x4:o,ASTC_RGBA_5x5:s,ASTC_RGBA_6x5:l,ASTC_RGBA_6x6:c,ASTC_RGBA_8x5:_,ASTC_RGBA_8x6:h,ASTC_RGBA_8x8:d,ASTC_RGBA_10x5:u,ASTC_RGBA_10x6:m,ASTC_RGBA_10x8:x,ASTC_RGBA_10x10:f,ASTC_RGBA_12x10:A,ASTC_RGBA_12x12:p,ASTC_SRGB_4x4:g,ASTC_SRGB_5x4:v,ASTC_SRGB_5x5:y,ASTC_SRGB_6x5:I,ASTC_SRGB_6x6:b,ASTC_SRGB_8x5:T,ASTC_SRGB_8x6:S,ASTC_SRGB_8x8:E,ASTC_SRGB_10x5:C,ASTC_SRGB_10x6:w,ASTC_SRGB_10x8:D,ASTC_SRGB_10x10:N,ASTC_SRGB_12x10:B,ASTC_SRGB_12x12:P,S3TC_RGB_DXT1:M,S3TC_RGBA_DXT1:F,S3TC_RGBA_DXT3:R,S3TC_RGBA_DXT5:L,BPTC_RGBA:V,PVRTC_RGBA_4BPPV1:W,PVRTC_RGB_4BPPV1:z,ETC2_RGBA8_EAC:H,ETC2_RGB8:O,ETC1_RGB:G,RGBA8_EXT:Q,from:function(e){return(0,i.li)({typeList:k,index:e})},fromString:function(e){return(0,i.cu)({typeList:k,str:e})}})},1986:(e,t,n)=>{"use strict";n.d(t,{c:()=>h});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:".ldr_srgb"}),o=new a({index:1,str:".ldr_linear"}),s=new a({index:2,str:".hdr"}),l=new a({index:3,str:".rgbe.png"}),c=new a({index:4,str:".rgb9_e5.png"}),_=new a({index:5,str:".exr"}),h=Object.freeze({LDR_SRGB:r,LDR_LINEAR:o,HDR_LINEAR:s,RGBE_PNG:l,RGB9_E5_PNG:c,OpenEXR:_})},5634:(e,t,n)=>{"use strict";n.d(t,{v:()=>_});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"Directional"}),o=new a({index:1,str:"Point"}),s=new a({index:2,str:"Spot"}),l=new a({index:3,str:"Ambient"}),c=[o,r,s,l],_=Object.freeze({Point:o,Directional:r,Spot:s,Ambient:l,from:function(e){return(0,i.li)({typeList:c,index:e})},fromString:function(e){return(0,i.cu)({typeList:c,str:e})}})},9216:(e,t,n)=>{"use strict";n.d(t,{V:()=>h});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:6402,str:"DEPTH_COMPONENT"}),o=new a({index:6406,str:"ALPHA"}),s=new a({index:6407,str:"RGB"}),l=new a({index:6408,str:"RGBA"}),c=new a({index:6409,str:"LUMINANCE"}),_=new a({index:6410,str:"LUMINANCE_ALPHA"}),h=Object.freeze({DepthComponent:r,Alpha:o,RGB:s,RGBA:l,Luminance:c,LuminanceAlpha:_})},8696:(e,t,n)=>{"use strict";n.d(t,{T:()=>m});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:-1,str:"UNKNOWN"}),o=new a({index:0,str:"POINTS"}),s=new a({index:1,str:"LINES"}),l=new a({index:2,str:"LINE_LOOP"}),c=new a({index:3,str:"LINE_STRIP"}),_=new a({index:4,str:"TRIANGLES"}),h=new a({index:5,str:"TRIANGLE_STRIP"}),d=new a({index:6,str:"TRIANGLE_FAN"}),u=[r,o,s,l,c,_,h,d],m=Object.freeze({Unknown:r,Points:o,Lines:s,LineLoop:l,LineStrip:c,Triangles:_,TriangleStrip:h,TriangleFan:d,from:function(e){return(0,i.li)({typeList:u,index:e})}})},7683:(e,t,n)=>{"use strict";n.d(t,{V:()=>_});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}get webGLVersion(){switch(this){case s:case c:return 2;case o:case l:return 1;default:return 0}}}const r=new a({index:0,str:"NONE"}),o=new a({index:1,str:"UNIFORM_WEBGL1"}),s=new a({index:2,str:"UNIFORM_WEBGL2"}),l=new a({index:7,str:"FASTEST_WEBGL1"}),c=new a({index:8,str:"FASTEST_WEBGL2"}),_=Object.freeze({isFastestApproach:e=>{switch(e){case l:case c:return!0;default:return!1}},isUniformApproach:e=>{switch(e){case o:case s:return!0;default:return!1}},None:r,UniformWebGL1:o,UniformWebGL2:s,FastestWebGL1:l,FastestWebGL2:c,isWebGL2Approach:e=>{switch(e){case s:case c:return!0;default:return!1}}})},4507:(e,t,n)=>{"use strict";n.d(t,{I:()=>x});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t,methodName:n}){super({index:e,str:t}),this.methodName=n}}const r=new a({index:-1,str:"UNKNOWN",methodName:"$unknown"}),o=new a({index:0,str:"CREATE",methodName:"$create"}),s=new a({index:1,str:"LOAD",methodName:"$load"}),l=new a({index:2,str:"MOUNT",methodName:"$mount"}),c=new a({index:3,str:"LOGIC",methodName:"$logic"}),_=new a({index:4,str:"PRE_RENDER",methodName:"$prerender"}),h=new a({index:5,str:"RENDER",methodName:"$render"}),d=new a({index:6,str:"UNMOUNT",methodName:"$unmount"}),u=new a({index:7,str:"DISCARD",methodName:"$discard"}),m=[r,o,s,l,c,_,h,d,u],x=Object.freeze({Unknown:r,Create:o,Load:s,Mount:l,Logic:c,PreRender:_,Render:h,Unmount:d,Discard:u,from:function(e){return(0,i.li)({typeList:m,index:e})}})},8422:(e,t,n)=>{"use strict";n.d(t,{G:()=>T});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}webGLConstantValue(){return-2===this.index?0:-1===this.index?1029:36064+this.index}}const r=new a({index:-2,str:"NONE"}),o=new a({index:-1,str:"BACK"}),s=new a({index:0,str:"COLOR_ATTACHMENT0"}),l=new a({index:1,str:"COLOR_ATTACHMENT1"}),c=new a({index:2,str:"COLOR_ATTACHMENT2"}),_=new a({index:3,str:"COLOR_ATTACHMENT3"}),h=new a({index:4,str:"COLOR_ATTACHMENT4"}),d=new a({index:5,str:"COLOR_ATTACHMENT5"}),u=new a({index:6,str:"COLOR_ATTACHMENT6"}),m=new a({index:7,str:"COLOR_ATTACHMENT7"}),x=new a({index:8,str:"COLOR_ATTACHMENT8"}),f=new a({index:9,str:"COLOR_ATTACHMENT9"}),A=new a({index:10,str:"COLOR_ATTACHMENT10"}),p=new a({index:11,str:"COLOR_ATTACHMENT11"}),g=new a({index:12,str:"COLOR_ATTACHMENT12"}),v=new a({index:13,str:"COLOR_ATTACHMENT13"}),y=new a({index:14,str:"COLOR_ATTACHMENT14"}),I=new a({index:15,str:"COLOR_ATTACHMENT15"}),b=[r,o,s,l,c,_,h,d,u,m,x,f,A,p,g,v,y,I],T=Object.freeze({None:r,Back:o,ColorAttachment0:s,ColorAttachment1:l,ColorAttachment2:c,ColorAttachment3:_,ColorAttachment4:h,ColorAttachment5:d,ColorAttachment6:u,ColorAttachment7:m,ColorAttachment8:x,ColorAttachment9:f,ColorAttachment10:A,ColorAttachment11:p,ColorAttachment12:g,ColorAttachment13:v,ColorAttachment14:y,ColorAttachment15:I,from:function(e){return(0,i.li)({typeList:b,index:e})}})},4587:(e,t,n)=>{"use strict";n.d(t,{w:()=>r,f:()=>he});var i=n(2343),a=n(810);class r extends i.Jx{constructor({str:e}){super({index:++r.__indexCount*r._scale,str:e,noCheckStrUnique:!0}),r.__classes[this.index]=this}static getShaderSemanticByIndex(e){return this.__classes[Math.abs(e)-Math.abs(e)%this._scale]}static isNonArrayShaderSemanticIndex(e){return e>=this._scale}static isArrayAndZeroIndexShaderSemanticIndex(e){return e<0&&Math.abs(e)%r._scale==0}static isArrayAndNonZeroIndexShaderSemanticIndex(e){return e<0&&Math.abs(e)%r._scale!=0}}r.__indexCount=-1,r._scale=1e4,r.__classes=[];const o=new r({str:"worldMatrix"}),s=new r({str:"viewMatrix"}),l=new r({str:"projectionMatrix"}),c=new r({str:"normalMatrix"}),_=new r({str:"boneMatrix"}),h=new r({str:"baseColorFactor"}),d=new r({str:"baseColorTexture"}),u=new r({str:"normalTexture"}),m=new r({str:"metallicRoughnessTexture"}),x=new r({str:"occlusionTexture"}),f=new r({str:"emissiveTexture"}),A=new r({str:"lightNumber"}),p=new r({str:"lightPosition"}),g=new r({str:"lightDirection"}),v=new r({str:"lightIntensity"}),y=new r({str:"metallicRoughnessFactor"}),I=new r({str:"brdfLutTexture"}),b=new r({str:"diffuseEnvTexture"}),T=new r({str:"specularEnvTexture"}),S=new r({str:"iblParameter"}),E=new r({str:"viewPosition"}),C=new r({str:"wireframe"}),w=new r({str:"diffuseColorFactor"}),D=new r({str:"diffuseColorTexture"}),N=new r({str:"specularColorFactor"}),B=new r({str:"specularColorTexture"}),P=new r({str:"shininess"}),M=new r({str:"shadingModel"}),F=new r({str:"skinningMode"}),R=new r({str:"generalTexture"}),L=new r({str:"vertexAttributesExistenceArray"}),V=new r({str:"boneQuaternion"}),W=new r({str:"boneTranslateScale"}),z=new r({str:"boneTranslatePackedQuat"}),H=new r({str:"boneScalePackedQuat"}),O=new r({str:"boneCompressedChunk"}),G=new r({str:"boneCompressedInfo"}),Q=new r({str:"pointSize"}),k=new r({str:"colorEnvTexture"}),U=new r({str:"pointDistanceAttenuation"}),Z=new r({str:"hdriFormat"}),X=new r({str:"screenInfo"}),q=new r({str:"depthTexture"}),Y=new r({str:"lightViewProjectionMatrix"}),j=new r({str:"anisotropy"}),K=new r({str:"clearcoatParameter"}),J=new r({str:"sheenParameter"}),$=new r({str:"specularGlossinessFactor"}),ee=new r({str:"specularGlossinessTexture"}),te=new r({str:"entityUID"}),ne=new r({str:"morphTargetNumber"}),ie=new r({str:"dataTextureMorphOffsetPosition"}),ae=new r({str:"morphWeights"}),re=new r({str:"currentComponentSIDs"}),oe=new r({str:"alphaCutoff"}),se=new r({str:"alphaTexture"}),le=new r({str:"makeOutputSrgb"}),ce=new r({str:"framebufferWidth"}),_e=[o,s,l,c,_,h,d,u,m,x,f,A,p,g,v,y,I,b,T,S,E,C,w,D,N,B,P,M,F,R,L,V,W,z,H,O,G,Q,k,U,Z,X,q,Y,j,K,J,$,ee,te,ne,ie,ae,re,oe,se,le,ce],he=Object.freeze({from:function(e){return(0,i.li)({typeList:_e,index:e})},fromString:function(e){return(0,i.cu)({typeList:_e,str:e})},fromStringCaseSensitively:function(e){return(0,i.bm)({typeList:_e,str:e})},WorldMatrix:o,ViewMatrix:s,ProjectionMatrix:l,NormalMatrix:c,BoneMatrix:_,BaseColorFactor:h,BaseColorTexture:d,NormalTexture:u,MetallicRoughnessTexture:m,OcclusionTexture:x,EmissiveTexture:f,LightNumber:A,LightPosition:p,LightDirection:g,LightIntensity:v,MetallicRoughnessFactor:y,BrdfLutTexture:I,DiffuseEnvTexture:b,SpecularEnvTexture:T,IBLParameter:S,ViewPosition:E,Wireframe:C,DiffuseColorFactor:w,DiffuseColorTexture:D,SpecularColorFactor:N,SpecularColorTexture:B,Shininess:P,ShadingModel:M,SkinningMode:F,GeneralTexture:R,VertexAttributesExistenceArray:L,BoneQuaternion:V,BoneTranslateScale:W,BoneTranslatePackedQuat:z,BoneScalePackedQuat:H,BoneCompressedChunk:O,BoneCompressedInfo:G,PointSize:Q,ColorEnvTexture:k,PointDistanceAttenuation:U,HDRIFormat:Z,ScreenInfo:X,DepthTexture:q,LightViewProjectionMatrix:Y,Anisotropy:j,ClearCoatParameter:K,SheenParameter:J,SpecularGlossinessFactor:$,SpecularGlossinessTexture:ee,fullSemanticStr:function(e){let t="";return null!=e.prefix&&(t=e.prefix),t+e.semantic.str},getShaderProperty:(e,t,n,i,o)=>{if(t.isComponentData)return"";const s=t.compositionType.getGlslStr(t.componentType);let l=he.fullSemanticStr(t);const c=t.compositionType.getGlslStr(t.componentType);let _="";t.maxIndex&&(_=`[${t.maxIndex}]`);const h=`  uniform ${c} u_${l}${_};\n`;let d="";if(n<0||a.d.isArray(t.compositionType)){if(Math.abs(n)%r._scale!=0&&!a.d.isArray(t.compositionType))return"";l.match(/\[.+?\]/)?l=l.replace(/\[.+?\]/g,"[i]"):l+="[i]",d+=o?`\n        ${s} val;\n          int i = index;\n          return u_${l};\n        `:`\n        ${s} val;\n        for (int i=0; i<${t.maxIndex}; i++) {\n          if (i == index) {\n            val = u_${l};\n            break;\n          }\n        }\n        return val;\n        `}else d+=`return u_${l};`;let u="";return t.compositionType===a.d.Texture2D||t.compositionType===a.d.TextureCube||(u=`\n  ${s} get_${t.semantic.str}(float instanceId, int index) {\n    ${d}\n  }\n`),`${h}${u}`},EntityUID:te,MorphTargetNumber:ne,DataTextureMorphOffsetPosition:ie,MorphWeights:ae,CurrentComponentSIDs:re,AlphaCutoff:oe,AlphaTexture:se,MakeOutputSrgb:le,FramebufferWidth:ce})},5324:(e,t,n)=>{"use strict";n.d(t,{H:()=>_});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:1,str:"VertexShader"}),o=new a({index:2,str:"PixelShader"}),s=new a({index:3,str:"VertexAndPixelShader"}),l=new a({index:4,str:"ComputeShader"}),c=[r,o,s,l],_=Object.freeze({VertexShader:r,PixelShader:o,VertexAndPixelShader:s,ComputeShader:l,from:function(e){return(0,i.li)({typeList:c,index:e})},fromString:function(e){return(0,i.cu)({typeList:c,str:e})}})},1813:(e,t,n)=>{"use strict";n.d(t,{a:()=>c});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"FirstTimeOnly"}),o=new a({index:1,str:"EveryTime"}),s=new a({index:2,str:"RenderPass"}),l=[r,o,s],c=Object.freeze({FirstTimeOnly:r,EveryTime:o,RenderPass:s,from:function(e){return(0,i.li)({typeList:l,index:e})},fromString:function(e){return(0,i.cu)({typeList:l,str:e})}})},9840:(e,t,n)=>{"use strict";n.d(t,{D:()=>h});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:-1,str:"UNKNOWN"}),o=new a({index:0,str:"CONSTANT"}),s=new a({index:1,str:"LAMBERT"}),l=new a({index:2,str:"BLINN"}),c=new a({index:3,str:"PHONG"}),_=[r,o,s,l,c],h=Object.freeze({Unknown:r,Constant:o,Lambert:s,BlinnPhong:l,Phong:c,from:function(e){return(0,i.li)({typeList:_,index:e})}})},5981:(e,t,n)=>{"use strict";n.d(t,{d:()=>L});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:9728,str:"NEAREST"}),o=new a({index:9729,str:"LINEAR"}),s=new a({index:9984,str:"NEAREST_MIPMAP_NEAREST"}),l=new a({index:9985,str:"LINEAR_MIPMAP_NEAREST"}),c=new a({index:9986,str:"NEAREST_MIPMAP_LINEAR"}),_=new a({index:9987,str:"LINEAR_MIPMAP_LINEAR"}),h=new a({index:10240,str:"TEXTURE_MAG_FILTER"}),d=new a({index:10241,str:"TEXTURE_MIN_FILTER"}),u=new a({index:10242,str:"TEXTURE_WRAP_S"}),m=new a({index:10243,str:"TEXTURE_WRAP_T"}),x=new a({index:3553,str:"TEXTURE_2D"}),f=new a({index:5890,str:"TEXTURE"}),A=new a({index:33984,str:"TEXTURE0"}),p=new a({index:33985,str:"TEXTURE1"}),g=new a({index:34016,str:"ACTIVE_TEXTURE"}),v=new a({index:10497,str:"REPEAT"}),y=new a({index:33071,str:"CLAMP_TO_EDGE"}),I=new a({index:33648,str:"MIRRORED_REPEAT"}),b=new a({index:32849,str:"RGB8"}),T=new a({index:32856,str:"RGBA8"}),S=new a({index:32857,str:"RGB10_A2"}),E=new a({index:34843,str:"RGB16F"}),C=new a({index:34837,str:"RGB32F"}),w=new a({index:34842,str:"RGBA16F"}),D=new a({index:34836,str:"RGBA32F"}),N=new a({index:33189,str:"DEPTH_COMPONENT16"}),B=new a({index:33190,str:"DEPTH_COMPONENT24"}),P=new a({index:36012,str:"DEPTH_COMPONENT32F"}),M=new a({index:35056,str:"DEPTH24_STENCIL8"}),F=new a({index:36013,str:"DEPTH32F_STENCIL8"}),R=[r,o,s,l,c,_,h,d,u,m,x,f,A,p,g,v,y,I,b,T,S,E,C,w,D,N,B,P,M,F],L=Object.freeze({Nearest:r,Linear:o,NearestMipmapNearest:s,LinearMipmapNearest:l,NearestMipmapLinear:c,LinearMipmapLinear:_,TextureMagFilter:h,TextureMinFilter:d,TextureWrapS:u,TextureWrapT:m,Texture2D:x,Texture:f,Texture0:A,Texture1:p,ActiveTexture:g,Repeat:v,ClampToEdge:y,MirroredRepeat:I,RGB8:b,RGBA8:T,RGB10_A2:S,RGB16F:E,RGB32F:C,RGBA16F:w,RGBA32F:D,Depth16:N,Depth24:B,Depth32F:P,Depth24Stencil8:M,Depth32FStencil8:F,from:function(e){return(0,i.li)({typeList:R,index:e})}})},128:(e,t,n)=>{"use strict";n.d(t,{x:()=>a,T:()=>p});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t,shaderStr:n,attributeSlot:i}){super({index:e,str:t}),this.__attributeSlot=i,this.__shaderStr=n}getAttributeSlot(){return this.__attributeSlot}get shaderStr(){return this.__shaderStr}}const r=new a({index:-1,str:"UNKNOWN",shaderStr:"a_unknown",attributeSlot:-1}),o=new a({index:0,str:"POSITION",shaderStr:"a_position",attributeSlot:0}),s=new a({index:1,str:"NORMAL",shaderStr:"a_normal",attributeSlot:1}),l=new a({index:2,str:"TANGENT",shaderStr:"a_tangent",attributeSlot:2}),c=new a({index:3,str:"TEXCOORD_0",shaderStr:"a_texcoord_0",attributeSlot:3}),_=new a({index:4,str:"TEXCOORD_1",shaderStr:"a_texcoord_1",attributeSlot:4}),h=new a({index:5,str:"COLOR_0",shaderStr:"a_color_0",attributeSlot:5}),d=new a({index:6,str:"JOINTS_0",shaderStr:"a_joints_0",attributeSlot:6}),u=new a({index:7,str:"WEIGHTS_0",shaderStr:"a_weights_0",attributeSlot:7}),m=new a({index:8,str:"INSTANCE",shaderStr:"a_instance",attributeSlot:8}),x=new a({index:9,str:"FACE_NORMAL",shaderStr:"a_faceNormal",attributeSlot:9}),f=new a({index:10,str:"BARY_CENTRIC_COORD",shaderStr:"a_baryCentricCoord",attributeSlot:10}),A=[r,o,s,l,c,_,h,d,u,m,x,f],p=Object.freeze({Unknown:r,Position:o,Normal:s,Tangent:l,Texcoord0:c,Texcoord1:_,Color0:h,Joints0:d,Weights0:u,Instance:m,FaceNormal:x,BaryCentricCoord:f,AttributeTypeNumber:11,from:function(e){return(0,i.li)({typeList:A,index:e})},fromString:function(e){let t=e;return"COLOR"===e?t="COLOR_0":"TEXCOORD"===e?t="TEXCOORD_0":"JOINTS"===e?t="JOINTS_0":"WEIGHTS"===e&&(t="WEIGHTS_0"),(0,i.cu)({typeList:A,str:t})}})},408:(e,t,n)=>{"use strict";n.d(t,{E:()=>c});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:0,str:"Neutral"}),o=new a({index:1,str:"Visible"}),s=new a({index:-1,str:"Invisible"}),l=[o,s,r],c=Object.freeze({Visible:o,Invisible:s,Neutral:r,from:function(e){return(0,i.li)({typeList:l,index:e})},fromString:function(e){return(0,i.cu)({typeList:l,str:e})}})},6214:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i=n(128),a=n(8696),r=n(9286),o=n(752),s=n(3999),l=n(810),c=n(2471),_=n(2477),h=n(7987),d=n(1328),u=n(9190),m=n(4690);class x{constructor(){this.__instanceIdx=0,this.__primitives=[],this.__opaquePrimitives=[],this.__transparentPrimitives=[],this.__morphPrimitives=[],this.weights=[],this.__localAABB=new _.Z,this.__vaoUids=[],this.__variationVBOUid=h.Z.InvalidCGAPIResourceUid,this.__instances=[],this._attachedEntityUID=d.Z.invalidEntityUID,this.__instancesDirty=!0,this.tangentCalculationMode=1,this.isPreComputeForRayCastPickingEnable=!1,this.__hasFaceNormal=!1,this.__meshUID=++x.__mesh_uid_count}getVaoUids(e){return this.isInstanceMesh()?this.__instanceOf.getVaoUids(e):this.__vaoUids[e]}addPrimitive(e){this.isInstanceMesh()&&(this.__instanceOf.__instances=this.__instanceOf.__instances.filter((e=>e!==this)),this.__instanceOf=void 0,this.__instanceIdx=0,this.__opaquePrimitives=this.__opaquePrimitives.slice(),this.__transparentPrimitives=this.__transparentPrimitives.slice(),this.__morphPrimitives=this.__morphPrimitives.slice()),null!=e.material&&e.material.isBlend()?this.__transparentPrimitives.push(e):this.__opaquePrimitives.push(e),this.__setPrimitives(this.__opaquePrimitives.concat(this.__transparentPrimitives)),x.__originalMeshes.push(this)}__setPrimitives(e){this.__primitives=e;for(const e of this.__instances)e.__primitives=this.__primitives,e.__opaquePrimitives=this.__opaquePrimitives,e.__transparentPrimitives=this.__transparentPrimitives,e.__morphPrimitives=this.__morphPrimitives}setOriginalMesh(e){return e.isInstanceMesh()?(console.error("Don't set InstanceMesh."),!1):(this.__primitives=e.__primitives,this.__opaquePrimitives=e.__opaquePrimitives,this.__transparentPrimitives=e.__transparentPrimitives,this.__morphPrimitives=e.__morphPrimitives,this.__instanceOf=e,e._addMeshToInstanceArray(this),this.__instanceIdx=e.instanceIndex+1,x.__originalMeshes=x.__originalMeshes.filter((e=>e!==this)),!0)}isAllBlend(){return this.__transparentPrimitives.length>0&&0===this.__opaquePrimitives.length}isBlendPartially(){return this.__transparentPrimitives.length>0&&this.__opaquePrimitives.length>0}isOpaque(){return 0===this.__transparentPrimitives.length&&this.__opaquePrimitives.length>0}isFirstOpaquePrimitiveAt(e){return this.isFirstOpaquePrimitiveAt(e)?this.__instanceOf.isFirstOpaquePrimitiveAt(e):this.__opaquePrimitives.length>0&&0===e}isFirstTransparentPrimitiveAt(e){return this.isFirstOpaquePrimitiveAt(e)?this.__instanceOf.isFirstTransparentPrimitiveAt(e):this.__transparentPrimitives.length>0&&this.__opaquePrimitives.length===e}getPrimitiveAt(e){return this.__primitives[e]}getPrimitiveNumber(){return this.__primitives.length}isInstanceMesh(){return null!=this.__instanceOf}isOriginalMesh(){return!this.isInstanceMesh()}updateVariationVBO(){if(this.isInstanceMesh())return this.__instanceOf.updateVariationVBO();{if(!this.__instancesDirty)return!1;const e=h.Z.getWebGLResourceRepository();this.__variationVBOUid!==h.Z.InvalidCGAPIResourceUid&&e.deleteVertexBuffer(this.__variationVBOUid);const t=this.__instances.length,n=new Float32Array(t+1);n[0]=this._attachedEntityUID;for(let e=0;e<t;e++)n[e+1]=this.__instances[e]._attachedEntityUID;return this.__variationVBOUid=e.createVertexBufferFromTypedArray(n),this.__instancesDirty=!1,!0}}deleteVariationVBO(){if(this.isInstanceMesh())return this.__instanceOf.deleteVariationVBO();{const e=h.Z.getWebGLResourceRepository();if(this.__variationVBOUid!==h.Z.InvalidCGAPIResourceUid)return e.deleteVertexBuffer(this.__variationVBOUid),this.__variationVBOUid=h.Z.InvalidCGAPIResourceUid,this.__instancesDirty=!0,!0}return!1}updateVAO(){if(this.isInstanceMesh())return this.__instanceOf.updateVAO();const e=h.Z.getWebGLResourceRepository();for(let t=0;t<this.__primitives.length;t++){const n=this.__primitives[t],i=n.vertexHandles;m.Is.undefined(i)?console.warn("Need to create 3DAPIVertexData before update VAO"):((isNaN(this.__vaoUids[t])||this.__vaoUids[t]===h.Z.InvalidCGAPIResourceUid||i.vaoHandle===h.Z.InvalidCGAPIResourceUid)&&(this.__vaoUids[t]=e.createVertexArray(),i.vaoHandle=this.__vaoUids[t]),e.setVertexDataToPipeline(i,n,this.__variationVBOUid))}for(let t=this.__primitives.length;t<this.__vaoUids.length;t++)this.__vaoUids[t]&&(e.deleteVertexArray(this.__vaoUids[t]),this.__vaoUids[t]=h.Z.InvalidCGAPIResourceUid)}deleteVAO(){if(this.isInstanceMesh())return this.__instanceOf.updateVAO();const e=h.Z.getWebGLResourceRepository();for(let t=0;t<this.__vaoUids.length;t++)e.deleteVertexArray(this.__vaoUids[t]),this.__vaoUids[t]=h.Z.InvalidCGAPIResourceUid}castRay(e,t,n=0){let i,a=Number.MAX_VALUE;for(const r of this.__primitives){const{currentShortestIntersectedPosVec3:o,currentShortestT:s}=r.castRay(e,t,!0,!0,n,this.__hasFaceNormal);null!=s&&s<a&&(a=s,i=o)}return Number.MAX_VALUE,{t:a,intersectedPosition:i}}get primitives(){return Array.from(this.__primitives)}get meshUID(){return this.__meshUID}get instanceCountIncludeOriginal(){return this.__instances.length+1}get _variationVBOUid(){return this.isInstanceMesh()?this.__instanceOf._variationVBOUid:this.__variationVBOUid}get AABB(){if(this.isInstanceMesh())return this.__instanceOf.AABB;for(const e of this.__primitives)if(e.isPositionAccessorUpdated){this.__localAABB.initialize();break}if(this.__localAABB.isVanilla())for(const e of this.__primitives)this.__localAABB.mergeAABB(e.AABB);return this.__localAABB}get instanceIndex(){return this.__instanceIdx}_addMeshToInstanceArray(e){this.__instances.push(e),this.__instancesDirty=!0}_calcArenbergInverseMatrices(){if(!this.isInstanceMesh()&&this.isPreComputeForRayCastPickingEnable)for(const e of this.__primitives)e._calcArenbergInverseMatrices()}__calcMorphPrimitives(){if(0!==this.weights.length&&!this.isInstanceMesh())for(let e=0;e<this.__primitives.length;e++){const t=this.__morphPrimitives[e],n=this.__primitives[e];n.targets[0].forEach(((e,i)=>{const a=t.getAttribute(i),r=a.elementCount;for(let e=0;e<r;e++)a.setElementFromSameCompositionAccessor(e,n.getAttribute(i))}))}}_calcTangents(){if(this.__usePreCalculatedTangent())for(const e of this.__primitives){if(-1!==e.attributeSemantics.indexOf(i.T.Tangent)&&2===this.tangentCalculationMode)continue;const t=e.attributeSemantics.indexOf(i.T.Texcoord0),n=e.attributeSemantics.indexOf(i.T.Normal);if(-1!==t&&-1!==n){const c=e.attributeSemantics.indexOf(i.T.Position),_=e.attributeAccessors[c],h=e.attributeAccessors[t],d=e.attributeAccessors[n],u=e.indicesAccessor;let m=3;e.primitiveMode!==a.T.TriangleStrip&&e.primitiveMode!==a.T.TriangleFan||(m=1);const x=e.getVertexCountAsIndicesBased(),f=r.Z.getInstance().createOrGetBuffer(o.$.CPUGeneric),A=4*_.byteLength/3,p=f.takeBufferView({byteLengthToNeed:A,byteStride:0}).takeAccessor({compositionType:l.d.Vec4,componentType:s.r.Float,count:_.elementCount});for(let e=0;e<x-2;e+=m){const t=_.getVec3(e,{indicesAccessor:u}),n=_.getVec3(e+1,{indicesAccessor:u}),i=_.getVec3(e+2,{indicesAccessor:u}),a=h.getVec2(e,{indicesAccessor:u}),r=h.getVec2(e+1,{indicesAccessor:u}),o=h.getVec2(e+2,{indicesAccessor:u}),s=d.getVec3(e,{indicesAccessor:u});this.__calcTangentFor3Vertices(e,t,n,i,a,r,o,s,p,u)}e.setVertexAttribute(p,i.T.Tangent)}}}__calcTangentFor3Vertices(e,t,n,i,a,r,o,s,l,c){const _=this.__calcTangentPerVertex(t,n,i,a,r,o,s,x.__tmpReturnVec3_0),h=this.__calcTangentPerVertex(n,i,t,r,o,a,s,x.__tmpReturnVec3_1),d=this.__calcTangentPerVertex(i,t,n,o,a,r,s,x.__tmpReturnVec3_2);l.setVec4(e,_.x,_.y,_.z,1,{indicesAccessor:c}),l.setVec4(e+1,h.x,h.y,h.z,1,{indicesAccessor:c}),l.setVec4(e+2,d.x,d.y,d.z,1,{indicesAccessor:c})}__calcTangentPerVertex(e,t,n,i,a,r,o,s){const l=[x.__tmpVec3_0.setComponents(e.x,i.x,i.y),x.__tmpVec3_1.setComponents(e.y,i.x,i.y),x.__tmpVec3_2.setComponents(e.z,i.x,i.y)],_=[x.__tmpVec3_3.setComponents(t.x,a.x,a.y),x.__tmpVec3_4.setComponents(t.y,a.x,a.y),x.__tmpVec3_5.setComponents(t.z,a.x,a.y)],h=[x.__tmpVec3_6.setComponents(n.x,r.x,r.y),x.__tmpVec3_7.setComponents(n.y,r.x,r.y),x.__tmpVec3_8.setComponents(n.z,r.x,r.y)],d=[],m=[];for(let e=0;e<3;e++){const t=u.ZP.subtractTo(_[e],l[e],x.__tmpVec3_9),n=u.ZP.subtractTo(h[e],_[e],x.__tmpVec3_10),i=u.ZP.crossTo(t,n,x.__tmpVec3_11),a=Math.abs(i.x)<Number.EPSILON;if(a)return console.assert(a,"Polygons or polygons on UV are degenerate!"),c.ZP.fromCopyArray([0,0,0]);d[e]=-i.y/i.x,m[e]=-i.z/i.x}return d[0]*d[0]+d[1]*d[1]+d[2]*d[2]<Number.EPSILON?(u.ZP.crossTo(o,t,s),s.normalize()):s.setComponents(d[0],d[1],d[2]).normalize()}__usePreCalculatedTangent(){return 0!==this.tangentCalculationMode&&1!==this.tangentCalculationMode&&3!==this.tangentCalculationMode&&!this.isInstanceMesh()}_calcBaryCentricCoord(){if(!this.isInstanceMesh())for(const e of this.__primitives){if(-1!==e.attributeSemantics.indexOf(i.T.BaryCentricCoord))return;const t=r.Z.getInstance().createOrGetBuffer(o.$.CPUGeneric),n=e.attributeSemantics.indexOf(i.T.Position),a=e.attributeAccessors[n].elementCount,c=4*a*4,_=t.takeBufferView({byteLengthToNeed:c,byteStride:0}).takeAccessor({compositionType:l.d.Vec4,componentType:s.r.Float,count:a});for(let e=0;e<a;e++)_.setVec4(e,e%3==0?1:0,e%3==1?1:0,e%3==2?1:0,e,{});e.setVertexAttribute(_,i.T.BaryCentricCoord)}}_calcFaceNormalsIfNonNormal(){if(!this.isInstanceMesh())for(const e of this.__primitives){if(-1!==e.attributeSemantics.indexOf(i.T.Normal))return;this.__hasFaceNormal=!0;const t=e.attributeSemantics.indexOf(i.T.Position),n=e.attributeAccessors[t],c=e.indicesAccessor;let _=3;e.primitiveMode!==a.T.TriangleStrip&&e.primitiveMode!==a.T.TriangleFan||(_=1);const h=e.getVertexCountAsIndicesBased(),d=r.Z.getInstance().createOrGetBuffer(o.$.CPUGeneric),u=n.byteLength,m=d.takeBufferView({byteLengthToNeed:u,byteStride:0}).takeAccessor({compositionType:l.d.Vec3,componentType:s.r.Float,count:n.elementCount});for(let e=0;e<h-2;e+=_){const t=n.getVec3(e,{indicesAccessor:c}),i=n.getVec3(e+1,{indicesAccessor:c}),a=n.getVec3(e+2,{indicesAccessor:c});this.__calcFaceNormalFor3Vertices(e,t,i,a,m,c)}e.setVertexAttribute(m,i.T.Normal)}}__calcFaceNormalFor3Vertices(e,t,n,i,a,r){const o=n.x-t.x,s=n.y-t.y,l=n.z-t.z,c=i.x-t.x,_=i.y-t.y,h=i.z-t.z;let d=s*h-l*_,u=l*c-o*h,m=o*_-s*c,x=Math.hypot(d,u,m);x<=1e-6&&(x=1e-4),x=1/x,d*=x,u*=x,m*=x,a.setVec3(e,d,u,m,{indicesAccessor:r}),a.setVec3(e+1,d,u,m,{indicesAccessor:r}),a.setVec3(e+2,d,u,m,{indicesAccessor:r})}}x.invalidateMeshUID=-1,x.__mesh_uid_count=x.invalidateMeshUID,x.__originalMeshes=[],x.__tmpVec3_0=u.ZP.zero(),x.__tmpVec3_1=u.ZP.zero(),x.__tmpVec3_2=u.ZP.zero(),x.__tmpVec3_3=u.ZP.zero(),x.__tmpVec3_4=u.ZP.zero(),x.__tmpVec3_5=u.ZP.zero(),x.__tmpVec3_6=u.ZP.zero(),x.__tmpVec3_7=u.ZP.zero(),x.__tmpVec3_8=u.ZP.zero(),x.__tmpVec3_9=u.ZP.zero(),x.__tmpVec3_10=u.ZP.zero(),x.__tmpVec3_11=u.ZP.zero(),x.__tmpReturnVec3_0=u.ZP.zero(),x.__tmpReturnVec3_1=u.ZP.zero(),x.__tmpReturnVec3_2=u.ZP.zero()},1845:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(8696),a=n(128),r=n(9002),o=n(3999),s=n(9286),l=n(810),c=n(2477),_=n(2993),h=n(7987),d=n(2471),u=n(2566),m=n(9190),x=n(4690);class f extends r.Z{constructor(){super(),this.__mode=i.T.Unknown,this.__material=_.Z.createEmptyMaterial(),this._prevMaterial=_.Z.createEmptyMaterial(),this.__attributes=new Map,this.__primitiveUid=-1,this.__aabb=new c.Z,this.__targets=[],this.__inverseArenbergMatrix=[],this.__arenberg3rdPosition=[]}set material(e){this.__material=e,e._addBelongPrimitive(this)}get material(){return this.__material}_backupMaterial(){this._prevMaterial=this.__material}_restoreMaterial(){this.__material=this._prevMaterial}setData(e,t,n,i){this.__indices=i,this.__attributes=e,this.material=null!=n?n:_.Z.createClassicUberMaterial({isSkinning:!0,isLighting:!0}),this.__mode=t,this.__primitiveUid=f.__primitiveCount++}static get maxPrimitiveCount(){return 500}static get headerAccessor(){return this.__headerAccessor}static createPrimitive({indices:e,attributeCompositionTypes:t,attributeSemantics:n,attributes:i,material:a,primitiveMode:r}){let c=0;i.forEach((e=>{c+=e.byteLength}));let _=c;null!=e&&(_+=e.byteLength);const h=new f,d=s.Z.getInstance().createBufferOnDemand(_,h,4);let u,m,x;if(null!=e){u=o.r.fromTypedArray(e),m=d.takeBufferView({byteLengthToNeed:e.byteLength,byteStride:0}),x=m.takeAccessor({compositionType:l.d.Scalar,componentType:u,count:e.byteLength/u.getSizeInBytes()});for(let t=0;t<e.byteLength/x.componentSizeInBytes;t++)x.setScalar(t,e[t],{})}const A=d.takeBufferView({byteLengthToNeed:c,byteStride:0}),p=[],g=[];i.forEach(((e,n)=>{g[n]=o.r.fromTypedArray(i[n]);const a=A.takeAccessor({compositionType:t[n],componentType:o.r.fromTypedArray(i[n]),count:e.byteLength/t[n].getNumberOfComponents()/g[n].getSizeInBytes()});a.copyFromTypedArray(e),p.push(a)}));const v=new Map;for(let e=0;e<n.length;e++)v.set(n[e],p[e]);return h.setData(v,r,a,x),h}get indicesAccessor(){return this.__indices}getVertexCountAsIndicesBased(){return this.indicesAccessor?this.indicesAccessor.elementCount:this.getVertexCountAsVerticesBased()}getVertexCountAsVerticesBased(){return this.__attributes.get(a.T.Position).elementCount}getTriangleCountAsIndicesBased(){if(!this.indicesAccessor)return this.getTriangleCountAsVerticesBased();switch(this.__mode){case i.T.Triangles:return this.indicesAccessor.elementCount/3;case i.T.TriangleStrip:case i.T.TriangleFan:return this.indicesAccessor.elementCount-2;default:return 0}}getTriangleCountAsVerticesBased(){const e=this.__attributes.get(a.T.Position);switch(this.__mode){case i.T.Triangles:return e.elementCount/3;case i.T.TriangleStrip:case i.T.TriangleFan:return e.elementCount-2;default:return 0}}hasIndices(){return null!=this.__indices}get attributeAccessors(){const e=[];return this.__attributes.forEach(((t,n)=>{e.push(t)})),e}getAttribute(e){return this.__attributes.get(e)}get attributeSemantics(){const e=[];return this.__attributes.forEach(((t,n)=>{e.push(n)})),e}get attributeEntries(){return this.__attributes.entries()}get attributeCompositionTypes(){const e=[];return this.__attributes.forEach(((t,n)=>{e.push(t.compositionType)})),e}get attributeComponentTypes(){const e=[];return this.__attributes.forEach(((t,n)=>{e.push(t.componentType)})),e}get primitiveMode(){return this.__mode}get primitiveUid(){return this.__primitiveUid}get isPositionAccessorUpdated(){const e=this.__attributes.get(a.T.Position);return(null==e?void 0:e.isMinMaxDirty)||!1}get AABB(){if(this.__aabb.isVanilla()||this.isPositionAccessorUpdated){const e=this.__attributes.get(a.T.Position);e.isMinMaxDirty&&e.calcMinMax();const t=e.min;this.__aabb.minPoint=f.__tmpVec3_0.setComponents(t[0],t[1],t[2]);const n=e.max;this.__aabb.maxPoint=f.__tmpVec3_0.setComponents(n[0],n[1],n[2])}return this.__aabb}setVertexAttribute(e,t){this.__attributes.set(t,e)}removeIndices(){this.__indices=void 0}setIndices(e){this.__indices=e}setTargets(e){this.__targets=e}get targets(){return this.__targets}isBlend(){return!(null==this.material||!this.material.isBlend())}isOpaque(){return!this.isBlend()}create3DAPIVertexData(){if(null!=this.__vertexHandles)return!1;const e=h.Z.getWebGLResourceRepository();return this.__vertexHandles=e.createVertexBufferAndIndexBuffer(this),!0}update3DAPIVertexData(){const e=this.__vertexHandles;return!!x.Is.exist(this.__vertexHandles)&&(h.Z.getWebGLResourceRepository().updateVertexBufferAndIndexBuffer(this,e),!0)}delete3DAPIVertexData(){return null!=this.__vertexHandles&&(h.Z.getWebGLResourceRepository().deleteVertexDataResources(this.__vertexHandles),this.__vertexHandles=void 0,!0)}get vertexHandles(){return this.__vertexHandles}castRay(e,t,n,r,o,s){let l=Number.MAX_VALUE,c=null;const _=this.__attributes.get(a.T.Position);let h=3;if(this.__mode===i.T.TriangleStrip)h=1;else if(this.__mode===i.T.Points)return{currentShortestIntersectedPosVec3:c,currentShortestT:l};if(this.hasIndices())for(let i=0;i<this.__indices.elementCount-2;i++){const a=i*h;if(a+2>this.__indices.elementCount-1)break;const _=this.__indices.getScalar(a,{}),d=this.__indices.getScalar(a+1,{}),u=this.__indices.getScalar(a+2,{}),m=this.__castRayInner(e,t,i,_,d,u,n,r,o,s);if(null===m)continue;const x=m[0];m[0]<l&&(l=x,c=m[1])}else for(let i=0;i<_.elementCount;i+=h){const a=i,_=i+1,h=i+2,d=this.__castRayInner(e,t,i,a,_,h,n,r,o,s);if(null===d)continue;const u=d[0];d[0]<l&&(l=u,c=d[1])}return{currentShortestIntersectedPosVec3:c,currentShortestT:l}}__castRayInner(e,t,n,i,r,o,s,l,c,_){if(!this.__arenberg3rdPosition[n])return null;if(_){const e=this.__attributes.get(a.T.Normal);if(e){const i=e.getVec3(n,{});if(i.dot(t)<c&&!s)return null;if(i.dot(t)>-c&&!l)return null}}const h=d.ZP.subtract(e,this.__arenberg3rdPosition[n]),u=this.__inverseArenbergMatrix[n].multiplyVector(h),x=this.__inverseArenbergMatrix[n].multiplyVector(t);if(x.z>=-1e-6&&x.z<=1e-6)return null;const f=-u.z/x.z;if(f<=1e-5)return null;const A=u.x+f*x.x,p=u.y+f*x.y;if(A<0||p<0||A+p>1)return null;const g=1-A-p,v=this.__attributes.get(a.T.Position),y=v.getVec3(i,{}),I=v.getVec3(r,{}),b=v.getVec3(o,{}),T=d.ZP.multiply(y,A),S=d.ZP.multiply(I,p),E=d.ZP.multiply(b,g);return[f,m.ZP.zero().add(T).add(S).add(E)]}_calcArenbergInverseMatrices(){if(0!==this.__inverseArenbergMatrix.length)return;const e=this.__attributes.get(a.T.Position);let t=3;if(this.__mode===i.T.TriangleStrip)t=1;else if(this.__mode===i.T.Points)return;if(this.hasIndices())for(let e=0;e<this.__indices.elementCount-2;e++){const n=e*t;if(n+2>this.__indices.elementCount-1)break;const i=this.__indices.getScalar(n,{}),a=this.__indices.getScalar(n+1,{}),r=this.__indices.getScalar(n+2,{});this._calcArenbergMatrixFor3Vertices(e,i,a,r)}else for(let n=0;n<e.elementCount-2;n+=t){const e=n,t=n+1,i=n+2;this._calcArenbergMatrixFor3Vertices(n,e,t,i)}}_calcArenbergMatrixFor3Vertices(e,t,n,i){const r=this.__attributes.get(a.T.Position),o=r.getVec3(t,{}),s=r.getVec3(n,{}),l=r.getVec3(i,{}),c=o.x-l.x,_=o.y-l.y,h=o.z-l.z,d=s.x-l.x,m=s.y-l.y,x=s.z-l.z;let f=_*x-h*m,A=h*d-c*x,p=c*m-_*d,g=Math.sqrt(f*f+A*A+p*p);g<=1e-6&&(g=1e-4),g=1/g,f*=g,A*=g,p*=g;const v=new u.Z(o.x-l.x,s.x-l.x,f-l.x,o.y-l.y,s.y-l.y,A-l.y,o.z-l.z,s.z-l.z,p-l.z).invert();this.__inverseArenbergMatrix[e]=v,this.__arenberg3rdPosition[e]=l}}f.__primitiveCount=0,f.__tmpVec3_0=m.ZP.zero()},2993:(e,t,n)=>{"use strict";n.d(t,{Z:()=>pe});var i=n(346),a=n(7571),r=n(1481),o=n(4141),s=n(1784),l=n(2404),c=n(3999),_=n(810),h=n(3616),d=n(4587),u=n(5324),m=n(1813),x=(n(9840),n(2471)),f=n(7192);const A={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec4 a_joint;\nin vec4 a_weight;\nin vec4 a_baryCentricCoord;\nout vec3 v_color;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\nout vec2 v_texcoord_0;\nout vec3 v_baryCentricCoord;\n\nuniform float u_pointSize; // initialValue=30\nuniform vec3 u_pointDistanceAttenuation; // initialValue=(0,0.1,0.01)\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main()\n{\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  // Skeletal\n  processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n\n  v_color = a_color;\n  v_normal_inWorld = normalMatrix * a_normal;\n  v_texcoord_0 = a_texcoord_0;\n  v_baryCentricCoord = a_baryCentricCoord.xyz;\n\n// #ifdef RN_IS_POINTSPRITE\n\nvec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\nvec3 viewPosition = get_viewPosition(cameraSID, 0);\nfloat distanceFromCamera = length(position_inWorld.xyz - viewPosition);\nvec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\nfloat distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\nfloat maxPointSize = get_pointSize(materialSID, 0);\ngl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);\n\n// #endif\n\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},p={code:"\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec3 v_color;\nin vec3 v_normal_inWorld;\nin vec4 v_position_inWorld;\nin vec2 v_texcoord_0;\nin vec3 v_baryCentricCoord;\n\nuniform int u_shadingModel; // initialValue=0\nuniform float u_alphaCutoff; // initialValue=0.01\nuniform float u_shininess; // initialValue=5\nuniform vec4 u_diffuseColorFactor; // initialValue=(1,1,1,1)\nuniform sampler2D u_diffuseColorTexture; // initialValue=(0,white)\nuniform sampler2D u_normalTexture; // initialValue=(1,blue)\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n// #pragma shaderity: require(../common/deliot2019SeamlessTexture.glsl)\n// uniform sampler2D u_tInvTexture; // initialValue=(1,white)\n// uniform vec3 u_colorSpaceOrigin;\n// uniform vec3 u_colorSpaceVector1;\n// uniform vec3 u_colorSpaceVector2;\n// uniform vec3 u_colorSpaceVector3;\n// uniform vec4 u_scaleTranslate;\n\n/* shaderity: @{getters} */\n\nvoid main ()\n{\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n\n  vec4 diffuseColorFactor = get_diffuseColorFactor(materialSID, 0);\n\n\n  // diffuseColor (Considered to be premultiplied alpha)\n  vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  if (v_color != diffuseColor && diffuseColorFactor.rgb != diffuseColor) {\n    diffuseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == diffuseColor) {\n    diffuseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == diffuseColor) {\n    diffuseColor = v_color;\n  } else {\n    diffuseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n  // diffuseColorTexture (Considered to be premultiplied alpha)\n  vec4 textureColor = texture2D(u_diffuseColorTexture, v_texcoord_0);\n  diffuseColor *= textureColor.rgb;\n  alpha *= textureColor.a;\n\n#ifdef RN_IS_ALPHAMODE_MASK\n  float alphaCutoff = get_alphaCutoff(materialSID, 0);\n  if (alpha < alphaCutoff) {\n    discard;\n  }\n#endif\n\n\n  // Lighting\n  vec3 shadingColor = vec3(0.0, 0.0, 0.0);\n#ifdef RN_IS_LIGHTING\n  int shadingModel = get_shadingModel(materialSID, 0);\n  if (shadingModel > 0) {\n\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 specular = vec3(0.0, 0.0, 0.0);\n    for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */ ; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float lightType = gotLightPosition.w;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(gotLightDirection.xyz, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n\n      vec3 incidentLight = spotEffect * lightIntensity;\n\n\n\n      diffuse += diffuseColor * max(0.0, dot(normal_inWorld, lightDirection)) * incidentLight;\n\n      float shininess = get_shininess(materialSID, 0);\n      int shadingModel = get_shadingModel(materialSID, 0);\n\n      float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n      vec3 viewPosition = get_viewPosition(cameraSID, 0);\n\n      if (shadingModel == 2) {// BLINN\n        // ViewDirection\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 halfVector = normalize(lightDirection + viewDirection);\n        specular += pow(max(0.0, dot(halfVector, normal_inWorld)), shininess);\n      } else if (shadingModel == 3) { // PHONG\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 R = reflect(lightDirection, normal_inWorld);\n        specular += pow(max(0.0, dot(R, viewDirection)), shininess);\n      }\n\n    }\n\n    shadingColor = diffuse + specular;\n  } else {\n    shadingColor = diffuseColor;\n  }\n#else\n  shadingColor = diffuseColor;\n#endif\n\n  rt0 = vec4(shadingColor, alpha);\n  // rt0 = vec4(u_lightNumber, 0.0, 0.0, 1.0);\n  // rt0 = vec4(1.0, 0.0, 0.0, 1.0);\n  // rt0 = vec4(normal_inWorld*0.5+0.5, 1.0);\n\n#ifdef RN_IS_ALPHAMODE_OPAQUE\n  rt0.a = 1.0;\n#elif defined(RN_IS_ALPHAMODE_MASK)\n  rt0.a = 1.0;\n#endif\n\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};var g=n(6529),v=n(2390);const y={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec3 a_position;\nout vec2 v_texcoord_0;\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n\n  v_texcoord_0 = a_texcoord_0;\n}\n",shaderStage:"vertex",isFragmentShader:!1},I={code:"\nprecision highp float;\nprecision highp int;\n\n\n/**\n * This file contains source code provided by NVIDIA Corporation.\n * FXAA antialiasing is developed by NVIDIA.\n * The codes of this file is modified from original code to work on WebGL1.\n * The modification for GLSL 100 is referred from Three.js, https://github.com/mrdoob/three.js/blob/5ba4c25bcb74577e1b1e14906f345135610a94f3/examples/js/shaders/FXAAShader.js\n * The original FXAA code is https://github.com/NVIDIAGameWorks/GraphicsSamples/blob/80e8ba8f5e8935821513207033490735dd3279d8/samples/es3-kepler/FXAA/FXAA3_11.h\n */\n\n//----------------------------------------------------------------------------------\n// File:        es3-kepler\\FXAA/FXAA3_11.h\n// SDK Version: v3.00\n// Email:       gameworks@nvidia.com\n// Site:        http://developer.nvidia.com/\n//\n// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions\n// are met:\n//  * Redistributions of source code must retain the above copyright\n//    notice, this list of conditions and the following disclaimer.\n//  * Redistributions in binary form must reproduce the above copyright\n//    notice, this list of conditions and the following disclaimer in the\n//    documentation and/or other materials provided with the distribution.\n//  * Neither the name of NVIDIA CORPORATION nor the names of its\n//    contributors may be used to endorse or promote products derived\n//    from this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS 'AS IS' AND ANY\n// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\n// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\n// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\n// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\n// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\n// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\n// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n//\n//----------------------------------------------------------------------------------\n/*============================================================================\n                    NVIDIA FXAA 3.11 by TIMOTHY LOTTES\n============================================================================*/\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec2 v_texcoord_0;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\n\n\n  #define FXAA_PC 1\n  #define FXAA_QUALITYPRESET 39\n  #define FXAA_GREEN_AS_LUMA 0\n  #define FXAA_GLSL_100 1\n\n  /*============================================================================\n                                INTEGRATION KNOBS\n  ============================================================================*/\n  //\n  // FXAA_PS3 and FXAA_360 choose the console algorithm (FXAA3 CONSOLE).\n  // FXAA_360_OPT is a prototype for the new optimized 360 version.\n  //\n  // 1 = Use API.\n  // 0 = Don't use API.\n  //\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_PS3\n  #define FXAA_PS3 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_360\n  #define FXAA_360 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_360_OPT\n  #define FXAA_360_OPT 0\n  #endif\n  /*==========================================================================*/\n  #ifndef FXAA_PC\n  //\n  // FXAA Quality\n  // The high quality PC algorithm.\n  //\n  #define FXAA_PC 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_PC_CONSOLE\n  //\n  // The console algorithm for PC is included\n  // for developers targeting really low spec machines.\n  // Likely better to just run FXAA_PC, and use a really low preset.\n  //\n  #define FXAA_PC_CONSOLE 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_GLSL_120\n  #define FXAA_GLSL_120 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_GLSL_130\n  #define FXAA_GLSL_130 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_HLSL_3\n  #define FXAA_HLSL_3 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_HLSL_4\n  #define FXAA_HLSL_4 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_HLSL_5\n  #define FXAA_HLSL_5 0\n  #endif\n  /*==========================================================================*/\n  #ifndef FXAA_GREEN_AS_LUMA\n  //\n  // For those using non-linear color,\n  // and either not able to get luma in alpha, or not wanting to,\n  // this enables FXAA to run using green as a proxy for luma.\n  // So with this enabled, no need to pack luma in alpha.\n  //\n  // This will turn off AA on anything which lacks some amount of green.\n  // Pure red and blue or combination of only R and B, will get no AA.\n  //\n  // Might want to lower the settings for both,\n  //    fxaaConsoleEdgeThresholdMin\n  //    fxaaQualityEdgeThresholdMin\n  // In order to insure AA does not get turned off on colors\n  // which contain a minor amount of green.\n  //\n  // 1 = On.\n  // 0 = Off.\n  //\n  #define FXAA_GREEN_AS_LUMA 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_EARLY_EXIT\n  //\n  // Controls algorithm's early exit path.\n  // On PS3 turning this ON adds 2 cycles to the shader.\n  // On 360 turning this OFF adds 10ths of a millisecond to the shader.\n  // Turning this off on console will result in a more blurry image.\n  // So this defaults to on.\n  //\n  // 1 = On.\n  // 0 = Off.\n  //\n  #define FXAA_EARLY_EXIT 1\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_DISCARD\n  //\n  // Only valid for PC OpenGL currently.\n  // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\n  //\n  // 1 = Use discard on pixels which don't need AA.\n  //     For APIs which enable concurrent TEX+ROP from same surface.\n  // 0 = Return unchanged color on pixels which don't need AA.\n  //\n  #define FXAA_DISCARD 0\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_FAST_PIXEL_OFFSET\n  //\n  // Used for GLSL 120 only.\n  //\n  // 1 = GL API supports fast pixel offsets\n  // 0 = do not use fast pixel offsets\n  //\n  #ifdef GLEXT_gpu_shader4\n  #define FXAA_FAST_PIXEL_OFFSET 1\n  #endif\n  #ifdef GLNV_gpu_shader5\n  #define FXAA_FAST_PIXEL_OFFSET 1\n  #endif\n  #ifdef GLARB_gpu_shader5\n  #define FXAA_FAST_PIXEL_OFFSET 1\n  #endif\n  #ifndef FXAA_FAST_PIXEL_OFFSET\n  #define FXAA_FAST_PIXEL_OFFSET 0\n  #endif\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_GATHER4_ALPHA\n  //\n  // 1 = API supports gather4 on alpha channel.\n  // 0 = API does not support gather4 on alpha channel.\n  //\n  #if (FXAA_HLSL_5 == 1)\n  #define FXAA_GATHER4_ALPHA 1\n  #endif\n  #ifdef GLARB_gpu_shader5\n  #define FXAA_GATHER4_ALPHA 1\n  #endif\n  #ifdef GLNV_gpu_shader5\n  #define FXAA_GATHER4_ALPHA 1\n  #endif\n  #ifndef FXAA_GATHER4_ALPHA\n  #define FXAA_GATHER4_ALPHA 0\n  #endif\n  #endif\n\n  /*============================================================================\n                        FXAA CONSOLE PS3 - TUNING KNOBS\n  ============================================================================*/\n  #ifndef FXAA_CONSOLEPS3_EDGE_SHARPNESS\n  //\n  // Consoles the sharpness of edges on PS3 only.\n  // Non-PS3 tuning is done with shader input.\n  //\n  // Due to the PS3 being ALU bound,\n  // there are only two safe values here: 4 and 8.\n  // These options use the shaders ability to a free *|/ by 2|4|8.\n  //\n  // 8.0 is sharper\n  // 4.0 is softer\n  // 2.0 is really soft (good for vector graphics inputs)\n  //\n  #if 1\n  #define FXAA_CONSOLEPS3_EDGE_SHARPNESS 8.0\n  #endif\n  #if 0\n  #define FXAA_CONSOLEPS3_EDGE_SHARPNESS 4.0\n  #endif\n  #if 0\n  #define FXAA_CONSOLEPS3_EDGE_SHARPNESS 2.0\n  #endif\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #ifndef FXAA_CONSOLEPS3_EDGE_THRESHOLD\n  //\n  // Only effects PS3.\n  // Non-PS3 tuning is done with shader input.\n  //\n  // The minimum amount of local contrast required to apply algorithm.\n  // The console setting has a different mapping than the quality setting.\n  //\n  // This only applies when FXAA_EARLY_EXIT is 1.\n  //\n  // Due to the PS3 being ALU bound,\n  // there are only two safe values here: 0.25 and 0.125.\n  // These options use the shaders ability to a free *|/ by 2|4|8.\n  //\n  // 0.125 leaves less aliasing, but is softer\n  // 0.25 leaves more aliasing, and is sharper\n  //\n  #if 1\n  #define FXAA_CONSOLEPS3_EDGE_THRESHOLD 0.125\n  #else\n  #define FXAA_CONSOLEPS3_EDGE_THRESHOLD 0.25\n  #endif\n  #endif\n\n  /*============================================================================\n                          FXAA QUALITY - TUNING KNOBS\n  ------------------------------------------------------------------------------\n  NOTE the other tuning knobs are now in the shader function inputs!\n  ============================================================================*/\n  #ifndef FXAA_QUALITYPRESET\n  //\n  // Choose the quality preset.\n  // This needs to be compiled into the shader as it effects code.\n  // Best option to include multiple presets is to\n  // in each shader define the preset, then include this file.\n  //\n  // OPTIONS\n  // -----------------------------------------------------------------------\n  // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\n  // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\n  // 39       - no dither, very expensive\n  //\n  // NOTES\n  // -----------------------------------------------------------------------\n  // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\n  // 13 = about same speed as FXAA 3.9 and better than 12\n  // 23 = closest to FXAA 3.9 visually and performance wise\n  //  _ = the lowest digit is directly related to performance\n  // _  = the highest digit is directly related to style\n  //\n  #define FXAA_QUALITYPRESET 12\n  #endif\n\n\n  /*============================================================================\n                             FXAA QUALITY - PRESETS\n  ============================================================================*/\n\n  /*============================================================================\n                       FXAA QUALITY - MEDIUM DITHER PRESETS\n  ============================================================================*/\n  #if(FXAA_QUALITYPRESET == 10)\n#define FXAA_QUALITYPS 3\n#define FXAA_QUALITYP0 1.5\n#define FXAA_QUALITYP1 3.0\n#define FXAA_QUALITYP2 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 11)\n#define FXAA_QUALITYPS 4\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 3.0\n#define FXAA_QUALITYP3 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 12)\n#define FXAA_QUALITYPS 5\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 4.0\n#define FXAA_QUALITYP4 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 13)\n#define FXAA_QUALITYPS 6\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 4.0\n#define FXAA_QUALITYP5 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 14)\n#define FXAA_QUALITYPS 7\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 4.0\n#define FXAA_QUALITYP6 12.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 15)\n#define FXAA_QUALITYPS 8\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 2.0\n#define FXAA_QUALITYP6 4.0\n#define FXAA_QUALITYP7 12.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - LOW DITHER PRESETS\n============================================================================*/\n#if (FXAA_QUALITYPRESET == 20)\n#define FXAA_QUALITYPS 3\n#define FXAA_QUALITYP0 1.5\n#define FXAA_QUALITYP1 2.0\n#define FXAA_QUALITYP2 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 21)\n#define FXAA_QUALITYPS 4\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 22)\n#define FXAA_QUALITYPS 5\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 23)\n#define FXAA_QUALITYPS 6\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 24)\n#define FXAA_QUALITYPS 7\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 3.0\n#define FXAA_QUALITYP6 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 25)\n#define FXAA_QUALITYPS 8\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 2.0\n#define FXAA_QUALITYP6 4.0\n#define FXAA_QUALITYP7 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 26)\n#define FXAA_QUALITYPS 9\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 2.0\n#define FXAA_QUALITYP6 2.0\n#define FXAA_QUALITYP7 4.0\n#define FXAA_QUALITYP8 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 27)\n#define FXAA_QUALITYPS 10\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 2.0\n#define FXAA_QUALITYP6 2.0\n#define FXAA_QUALITYP7 2.0\n#define FXAA_QUALITYP8 4.0\n#define FXAA_QUALITYP9 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 28)\n#define FXAA_QUALITYPS 11\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 2.0\n#define FXAA_QUALITYP6 2.0\n#define FXAA_QUALITYP7 2.0\n#define FXAA_QUALITYP8 2.0\n#define FXAA_QUALITYP9 4.0\n#define FXAA_QUALITYP10 8.0\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_QUALITYPRESET == 29)\n#define FXAA_QUALITYPS 12\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.5\n#define FXAA_QUALITYP2 2.0\n#define FXAA_QUALITYP3 2.0\n#define FXAA_QUALITYP4 2.0\n#define FXAA_QUALITYP5 2.0\n#define FXAA_QUALITYP6 2.0\n#define FXAA_QUALITYP7 2.0\n#define FXAA_QUALITYP8 2.0\n#define FXAA_QUALITYP9 2.0\n#define FXAA_QUALITYP10 4.0\n#define FXAA_QUALITYP11 8.0\n#endif\n\n/*============================================================================\n                     FXAA QUALITY - EXTREME QUALITY\n============================================================================*/\n#if (FXAA_QUALITYPRESET == 39)\n#define FXAA_QUALITYPS 12\n#define FXAA_QUALITYP0 1.0\n#define FXAA_QUALITYP1 1.0\n#define FXAA_QUALITYP2 1.0\n#define FXAA_QUALITYP3 1.0\n#define FXAA_QUALITYP4 1.0\n#define FXAA_QUALITYP5 1.5\n#define FXAA_QUALITYP6 2.0\n#define FXAA_QUALITYP7 2.0\n#define FXAA_QUALITYP8 2.0\n#define FXAA_QUALITYP9 2.0\n#define FXAA_QUALITYP10 4.0\n#define FXAA_QUALITYP11 8.0\n#endif\n\n\n\n/*============================================================================\n                                API PORTING\n============================================================================*/\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\n#define FxaaBool bool\n#define FxaaDiscard discard\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 ivec2\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTex sampler2D\n#else\n#define FxaaBool bool\n#define FxaaDiscard clip(-1)\n#define FxaaFloat float\n#define FxaaFloat2 float2\n#define FxaaFloat3 float3\n#define FxaaFloat4 float4\n#define FxaaHalf half\n#define FxaaHalf2 half2\n#define FxaaHalf3 half3\n#define FxaaHalf4 half4\n#define FxaaSat(x) saturate(x)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_100 == 1)\n#define FxaaTexTop(t, p) texture2D(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_120 == 1)\n// Requires,\n//  #version 120\n// And at least,\n//  #extension GLEXT_gpu_shader4 : enable\n//  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\n#define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\n#if (FXAA_FAST_PIXEL_OFFSET == 1)\n#define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\n#else\n#define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\n#endif\n#if (FXAA_GATHER4_ALPHA == 1)\n// use #extension GLARB_gpu_shader5 : enable\n#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n#endif\n#endif\n/*--------------------------------------------------------------------------*/\n#if (FXAA_GLSL_130 == 1)\n// Requires \"#version 130\" or better\n#define FxaaTexTop(t, p) textureLod(t, p, 0.0)\n#define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\n#if (FXAA_GATHER4_ALPHA == 1)\n// use #extension GLARB_gpu_shader5 : enable\n#define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\n#define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\n#define FxaaTexGreen4(t, p) textureGather(t, p, 1)\n#define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\n#endif\n#endif\n\n\n/*============================================================================\n                   GREEN AS LUMA OPTION SUPPORT FUNCTION\n============================================================================*/\n#if (FXAA_GREEN_AS_LUMA == 0)\n  FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return dot(rgba.rgb, vec3(0.298912, 0.586611, 0.114478)); }\n  // FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\n#else\n  FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\n#endif\n\n\n\n\n\n\n\n\n\n/*============================================================================\n                             FXAA3 QUALITY - PC\n============================================================================*/\n#if (FXAA_PC == 1)\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat4 FxaaPixelShader(\n    //\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = center of pixel\n    FxaaFloat2 pos,\n    //\n    // Used only for FXAA Console, and not used on the 360 version.\n    // Use noperspective interpolation here (turn off perspective interpolation).\n    // {xy} = upper left of pixel\n    // {zw} = lower right of pixel\n    FxaaFloat4 fxaaConsolePosPos,\n    //\n    // Input color texture.\n    // {rgb_} = color in linear or perceptual color space\n    // if (FXAA_GREEN_AS_LUMA == 0)\n    //     {_a} = luma in perceptual color space (not linear)\n    FxaaTex tex,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for \"tex\".\n    // For 360, same texture, just alias with a 2nd sampler.\n    // This sampler needs to have an exponent bias of -1.\n    FxaaTex fxaaConsole360TexExpBiasNegOne,\n    //\n    // Only used on the optimized 360 version of FXAA Console.\n    // For everything but 360, just use the same input here as for \"tex\".\n    // For 360, same texture, just alias with a 3nd sampler.\n    // This sampler needs to have an exponent bias of -2.\n    FxaaTex fxaaConsole360TexExpBiasNegTwo,\n    //\n    // Only used on FXAA Quality.\n    // This must be from a constant/uniform.\n    // {x_} = 1.0/screenWidthInPixels\n    // {_y} = 1.0/screenHeightInPixels\n    FxaaFloat2 fxaaQualityRcpFrame,\n    //\n    // Only used on FXAA Console.\n    // This must be from a constant/uniform.\n    // This effects sub-pixel AA quality and inversely sharpness.\n    //   Where N ranges between,\n    //     N = 0.50 (default)\n    //     N = 0.33 (sharper)\n    // {x_} = -N/screenWidthInPixels\n    // {_y} = -N/screenHeightInPixels\n    // {z_} =  N/screenWidthInPixels\n    // {_w} =  N/screenHeightInPixels\n    FxaaFloat4 fxaaConsoleRcpFrameOpt,\n    //\n    // Only used on FXAA Console.\n    // Not used on 360, but used on PS3 and PC.\n    // This must be from a constant/uniform.\n    // {x_} = -2.0/screenWidthInPixels\n    // {_y} = -2.0/screenHeightInPixels\n    // {z_} =  2.0/screenWidthInPixels\n    // {_w} =  2.0/screenHeightInPixels\n    FxaaFloat4 fxaaConsoleRcpFrameOpt2,\n    //\n    // Only used on FXAA Console.\n    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\n    // This must be from a constant/uniform.\n    // {x_} =  8.0/screenWidthInPixels\n    // {_y} =  8.0/screenHeightInPixels\n    // {z_} = -4.0/screenWidthInPixels\n    // {_w} = -4.0/screenHeightInPixels\n    FxaaFloat4 fxaaConsole360RcpFrameOpt2,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITYSUBPIX define.\n    // It is here now to allow easier tuning.\n    // Choose the amount of sub-pixel aliasing removal.\n    // This can effect sharpness.\n    //   1.00 - upper limit (softer)\n    //   0.75 - default amount of filtering\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\n    //   0.25 - almost off\n    //   0.00 - completely off\n    FxaaFloat fxaaQualitySubpix,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITYEDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // The minimum amount of local contrast required to apply algorithm.\n    //   0.333 - too little (faster)\n    //   0.250 - low quality\n    //   0.166 - default\n    //   0.125 - high quality\n    //   0.063 - overkill (slower)\n    FxaaFloat fxaaQualityEdgeThreshold,\n    //\n    // Only used on FXAA Quality.\n    // This used to be the FXAA_QUALITYEDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\n    //   0.0625 - high quality (faster)\n    //   0.0312 - visible limit (slower)\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaQualityEdgeThresholdMin,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLEEDGE_SHARPNESS define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLEPS3_EDGE_SHARPNESS for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only three safe values here: 2 and 4 and 8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // For all other platforms can be a non-power of two.\n    //   8.0 is sharper (default!!!)\n    //   4.0 is softer\n    //   2.0 is really soft (good only for vector graphics inputs)\n    FxaaFloat fxaaConsoleEdgeSharpness,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLEEDGE_THRESHOLD define.\n    // It is here now to allow easier tuning.\n    // This does not effect PS3, as this needs to be compiled in.\n    //   Use FXAA_CONSOLEPS3_EDGE_THRESHOLD for PS3.\n    //   Due to the PS3 being ALU bound,\n    //   there are only two safe values here: 1/4 and 1/8.\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\n    // The console setting has a different mapping than the quality setting.\n    // Other platforms can use other values.\n    //   0.125 leaves less aliasing, but is softer (default!!!)\n    //   0.25 leaves more aliasing, and is sharper\n    FxaaFloat fxaaConsoleEdgeThreshold,\n    //\n    // Only used on FXAA Console.\n    // This used to be the FXAA_CONSOLEEDGE_THRESHOLD_MIN define.\n    // It is here now to allow easier tuning.\n    // Trims the algorithm from processing darks.\n    // The console setting has a different mapping than the quality setting.\n    // This only applies when FXAA_EARLY_EXIT is 1.\n    // This does not apply to PS3,\n    // PS3 was simplified to avoid more shader instructions.\n    //   0.06 - faster but more aliasing in darks\n    //   0.05 - default\n    //   0.04 - slower and less aliasing in darks\n    // Special notes when using FXAA_GREEN_AS_LUMA,\n    //   Likely want to set this to zero.\n    //   As colors that are mostly not-green\n    //   will appear very dark in the green channel!\n    //   Tune by looking at mostly non-green content,\n    //   then start at zero and increase until aliasing is a problem.\n    FxaaFloat fxaaConsoleEdgeThresholdMin,\n    //\n    // Extra constants for 360 FXAA Console only.\n    // Use zeros or anything else for other platforms.\n    // These must be in physical constant registers and NOT immedates.\n    // Immedates will result in compiler un-optimizing.\n    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\n    FxaaFloat4 fxaaConsole360ConstDir\n  ) {\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat2 posM;\n  posM.x = pos.x;\n  posM.y = pos.y;\n  #if (FXAA_GATHER4_ALPHA == 1)\n  #if (FXAA_DISCARD == 0)\n    FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n  #if (FXAA_GREEN_AS_LUMA == 0)\n  #define lumaM rgbyM.w\n  #else\n  #define lumaM rgbyM.y\n  #endif\n  #endif\n  #if (FXAA_GREEN_AS_LUMA == 0)\n    FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\n  FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\n  #else\n  FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\n  FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\n  #endif\n  #if (FXAA_DISCARD == 1)\n  #define lumaM luma4A.w\n  #endif\n  #define lumaE luma4A.z\n  #define lumaS luma4A.x\n  #define lumaSE luma4A.y\n  #define lumaNW luma4B.w\n  #define lumaN luma4B.z\n  #define lumaW luma4B.x\n  #else\n  FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\n  #if (FXAA_GREEN_AS_LUMA == 0)\n  #define lumaM rgbyM.w\n  #else\n  #define lumaM rgbyM.y\n  #endif\n  #if (FXAA_GLSL_100 == 1)\n    FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(0.0, 1.0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0, 0.0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(0.0, -1.0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\n  #else\n  FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(0, 1), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, 0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(0, -1), fxaaQualityRcpFrame.xy));\n  #endif\n  #endif\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat maxSM = max(lumaS, lumaM);\n  FxaaFloat minSM = min(lumaS, lumaM);\n  FxaaFloat maxESM = max(lumaE, maxSM);\n  FxaaFloat minESM = min(lumaE, minSM);\n  FxaaFloat maxWN = max(lumaN, lumaW);\n  FxaaFloat minWN = min(lumaN, lumaW);\n  FxaaFloat rangeMax = max(maxWN, maxESM);\n  FxaaFloat rangeMin = min(minWN, minESM);\n  FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\n  FxaaFloat range = rangeMax - rangeMin;\n  FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\n  FxaaBool earlyExit = range < rangeMaxClamped;\n  /*--------------------------------------------------------------------------*/\n  if (earlyExit)\n  #if (FXAA_DISCARD == 1)\n    FxaaDiscard;\n  #else\n  return rgbyM;\n  #endif\n  /*--------------------------------------------------------------------------*/\n  #if (FXAA_GATHER4_ALPHA == 0)\n  #if (FXAA_GLSL_100 == 1)\n    FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, -1.0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0, 1.0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(1.0, -1.0), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\n  #else\n  FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, -1), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, 1), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n  #endif\n  #else\n  FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\n  FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\n  #endif\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat lumaNS = lumaN + lumaS;\n  FxaaFloat lumaWE = lumaW + lumaE;\n  FxaaFloat subpixRcpRange = 1.0 / range;\n  FxaaFloat subpixNSWE = lumaNS + lumaWE;\n  FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\n  FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat lumaNESE = lumaNE + lumaSE;\n  FxaaFloat lumaNWNE = lumaNW + lumaNE;\n  FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\n  FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat lumaNWSW = lumaNW + lumaSW;\n  FxaaFloat lumaSWSE = lumaSW + lumaSE;\n  FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\n  FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\n  FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\n  FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\n  FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\n  FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\n  FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\n  FxaaBool horzSpan = edgeHorz >= edgeVert;\n  FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\n  /*--------------------------------------------------------------------------*/\n  if (!horzSpan) lumaN = lumaW;\n  if (!horzSpan) lumaS = lumaE;\n  if (horzSpan) lengthSign = fxaaQualityRcpFrame.y;\n  FxaaFloat subpixB = (subpixA * (1.0 / 12.0)) - lumaM;\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat gradientN = lumaN - lumaM;\n  FxaaFloat gradientS = lumaS - lumaM;\n  FxaaFloat lumaNN = lumaN + lumaM;\n  FxaaFloat lumaSS = lumaS + lumaM;\n  FxaaBool pairN = abs(gradientN) >= abs(gradientS);\n  FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\n  if (pairN) lengthSign = -lengthSign;\n  FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat2 posB;\n  posB.x = posM.x;\n  posB.y = posM.y;\n  FxaaFloat2 offNP;\n  offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\n  offNP.y = (horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\n  if (!horzSpan) posB.x += lengthSign * 0.5;\n  if (horzSpan) posB.y += lengthSign * 0.5;\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat2 posN;\n  posN.x = posB.x - offNP.x * FXAA_QUALITYP0;\n  posN.y = posB.y - offNP.y * FXAA_QUALITYP0;\n  FxaaFloat2 posP;\n  posP.x = posB.x + offNP.x * FXAA_QUALITYP0;\n  posP.y = posB.y + offNP.y * FXAA_QUALITYP0;\n  FxaaFloat subpixD = ((-2.0) * subpixC) + 3.0;\n  FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\n  FxaaFloat subpixE = subpixC * subpixC;\n  FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\n  /*--------------------------------------------------------------------------*/\n  if (!pairN) lumaNN = lumaSS;\n  FxaaFloat gradientScaled = gradient * 1.0 / 4.0;\n  FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\n  FxaaFloat subpixF = subpixD * subpixE;\n  FxaaBool lumaMLTZero = lumaMM < 0.0;\n  /*--------------------------------------------------------------------------*/\n  lumaEndN -= lumaNN * 0.5;\n  lumaEndP -= lumaNN * 0.5;\n  FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\n  FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\n  if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP1;\n  if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP1;\n  FxaaBool doneNP = (!doneN) || (!doneP);\n  if (!doneP) posP.x += offNP.x * FXAA_QUALITYP1;\n  if (!doneP) posP.y += offNP.y * FXAA_QUALITYP1;\n  /*--------------------------------------------------------------------------*/\n  if (doneNP) {\n    if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n    if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n    if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n    if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n    doneN = abs(lumaEndN) >= gradientScaled;\n    doneP = abs(lumaEndP) >= gradientScaled;\n    if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP2;\n    if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP2;\n    doneNP = (!doneN) || (!doneP);\n    if (!doneP) posP.x += offNP.x * FXAA_QUALITYP2;\n    if (!doneP) posP.y += offNP.y * FXAA_QUALITYP2;\n    /*--------------------------------------------------------------------------*/\n    #if (FXAA_QUALITYPS > 3)\n      if (doneNP) {\n        if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n        if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n        if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n        if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n        doneN = abs(lumaEndN) >= gradientScaled;\n        doneP = abs(lumaEndP) >= gradientScaled;\n        if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP3;\n        if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP3;\n        doneNP = (!doneN) || (!doneP);\n        if (!doneP) posP.x += offNP.x * FXAA_QUALITYP3;\n        if (!doneP) posP.y += offNP.y * FXAA_QUALITYP3;\n        /*--------------------------------------------------------------------------*/\n        #if (FXAA_QUALITYPS > 4)\n          if (doneNP) {\n            if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n            if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n            if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n            if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n            doneN = abs(lumaEndN) >= gradientScaled;\n            doneP = abs(lumaEndP) >= gradientScaled;\n            if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP4;\n            if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP4;\n            doneNP = (!doneN) || (!doneP);\n            if (!doneP) posP.x += offNP.x * FXAA_QUALITYP4;\n            if (!doneP) posP.y += offNP.y * FXAA_QUALITYP4;\n            /*--------------------------------------------------------------------------*/\n            #if (FXAA_QUALITYPS > 5)\n              if (doneNP) {\n                if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                doneN = abs(lumaEndN) >= gradientScaled;\n                doneP = abs(lumaEndP) >= gradientScaled;\n                if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP5;\n                if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP5;\n                doneNP = (!doneN) || (!doneP);\n                if (!doneP) posP.x += offNP.x * FXAA_QUALITYP5;\n                if (!doneP) posP.y += offNP.y * FXAA_QUALITYP5;\n                /*--------------------------------------------------------------------------*/\n                #if (FXAA_QUALITYPS > 6)\n                  if (doneNP) {\n                    if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                    if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                    if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                    if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                    doneN = abs(lumaEndN) >= gradientScaled;\n                    doneP = abs(lumaEndP) >= gradientScaled;\n                    if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP6;\n                    if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP6;\n                    doneNP = (!doneN) || (!doneP);\n                    if (!doneP) posP.x += offNP.x * FXAA_QUALITYP6;\n                    if (!doneP) posP.y += offNP.y * FXAA_QUALITYP6;\n                    /*--------------------------------------------------------------------------*/\n                    #if (FXAA_QUALITYPS > 7)\n                      if (doneNP) {\n                        if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                        if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                        if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                        if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                        doneN = abs(lumaEndN) >= gradientScaled;\n                        doneP = abs(lumaEndP) >= gradientScaled;\n                        if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP7;\n                        if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP7;\n                        doneNP = (!doneN) || (!doneP);\n                        if (!doneP) posP.x += offNP.x * FXAA_QUALITYP7;\n                        if (!doneP) posP.y += offNP.y * FXAA_QUALITYP7;\n                        /*--------------------------------------------------------------------------*/\n                        #if (FXAA_QUALITYPS > 8)\n                          if (doneNP) {\n                            if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                            if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                            if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                            if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                            doneN = abs(lumaEndN) >= gradientScaled;\n                            doneP = abs(lumaEndP) >= gradientScaled;\n                            if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP8;\n                            if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP8;\n                            doneNP = (!doneN) || (!doneP);\n                            if (!doneP) posP.x += offNP.x * FXAA_QUALITYP8;\n                            if (!doneP) posP.y += offNP.y * FXAA_QUALITYP8;\n                            /*--------------------------------------------------------------------------*/\n                            #if (FXAA_QUALITYPS > 9)\n                              if (doneNP) {\n                                if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                                if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                                if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                                if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                                doneN = abs(lumaEndN) >= gradientScaled;\n                                doneP = abs(lumaEndP) >= gradientScaled;\n                                if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP9;\n                                if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP9;\n                                doneNP = (!doneN) || (!doneP);\n                                if (!doneP) posP.x += offNP.x * FXAA_QUALITYP9;\n                                if (!doneP) posP.y += offNP.y * FXAA_QUALITYP9;\n                                /*--------------------------------------------------------------------------*/\n                                #if (FXAA_QUALITYPS > 10)\n                                  if (doneNP) {\n                                    if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                                    if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                                    if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                                    if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                                    doneN = abs(lumaEndN) >= gradientScaled;\n                                    doneP = abs(lumaEndP) >= gradientScaled;\n                                    if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP10;\n                                    if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP10;\n                                    doneNP = (!doneN) || (!doneP);\n                                    if (!doneP) posP.x += offNP.x * FXAA_QUALITYP10;\n                                    if (!doneP) posP.y += offNP.y * FXAA_QUALITYP10;\n                                    /*--------------------------------------------------------------------------*/\n                                    #if (FXAA_QUALITYPS > 11)\n                                      if (doneNP) {\n                                        if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                                        if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                                        if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                                        if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                                        doneN = abs(lumaEndN) >= gradientScaled;\n                                        doneP = abs(lumaEndP) >= gradientScaled;\n                                        if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP11;\n                                        if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP11;\n                                        doneNP = (!doneN) || (!doneP);\n                                        if (!doneP) posP.x += offNP.x * FXAA_QUALITYP11;\n                                        if (!doneP) posP.y += offNP.y * FXAA_QUALITYP11;\n                                        /*--------------------------------------------------------------------------*/\n                                        #if (FXAA_QUALITYPS > 12)\n                                          if (doneNP) {\n                                            if (!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\n                                            if (!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\n                                            if (!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\n                                            if (!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\n                                            doneN = abs(lumaEndN) >= gradientScaled;\n                                            doneP = abs(lumaEndP) >= gradientScaled;\n                                            if (!doneN) posN.x -= offNP.x * FXAA_QUALITYP12;\n                                            if (!doneN) posN.y -= offNP.y * FXAA_QUALITYP12;\n                                            doneNP = (!doneN) || (!doneP);\n                                            if (!doneP) posP.x += offNP.x * FXAA_QUALITYP12;\n                                            if (!doneP) posP.y += offNP.y * FXAA_QUALITYP12;\n                                            /*--------------------------------------------------------------------------*/\n                                          }\n                                        #endif\n                                        /*--------------------------------------------------------------------------*/\n                                      }\n                                    #endif\n                                    /*--------------------------------------------------------------------------*/\n                                  }\n                                #endif\n                                /*--------------------------------------------------------------------------*/\n                              }\n                            #endif\n                            /*--------------------------------------------------------------------------*/\n                          }\n                        #endif\n                        /*--------------------------------------------------------------------------*/\n                      }\n                    #endif\n                    /*--------------------------------------------------------------------------*/\n                  }\n                #endif\n                /*--------------------------------------------------------------------------*/\n              }\n            #endif\n            /*--------------------------------------------------------------------------*/\n          }\n        #endif\n        /*--------------------------------------------------------------------------*/\n      }\n    #endif\n    /*--------------------------------------------------------------------------*/\n  }\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat dstN = posM.x - posN.x;\n  FxaaFloat dstP = posP.x - posM.x;\n  if (!horzSpan) dstN = posM.y - posN.y;\n  if (!horzSpan) dstP = posP.y - posM.y;\n  /*--------------------------------------------------------------------------*/\n  FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\n  FxaaFloat spanLength = (dstP + dstN);\n  FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\n  FxaaFloat spanLengthRcp = 1.0 / spanLength;\n  /*--------------------------------------------------------------------------*/\n  FxaaBool directionN = dstN < dstP;\n  FxaaFloat dst = min(dstN, dstP);\n  FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\n  FxaaFloat subpixG = subpixF * subpixF;\n  FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\n  FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\n  /*--------------------------------------------------------------------------*/\n  FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\n  FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\n  if (!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\n  if (horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\n  #if (FXAA_DISCARD == 1)\n    return FxaaTexTop(tex, posM);\n  #else\n  return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n  #endif\n}\n/*==========================================================================*/\n#endif\n\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  vec2 screenInfo = get_screenInfo(materialSID, 0);\n  rt0 = FxaaPixelShader(\n      v_texcoord_0,\n      vec4(0.0),\n      u_baseColorTexture,\n      u_baseColorTexture,\n      u_baseColorTexture,\n      1.0 / screenInfo,\n      vec4(0.0),\n      vec4(0.0),\n      vec4(0.0),\n      0.75,\n      0.166,\n      0.0833,\n      0.0,\n      0.0,\n      0.0,\n      vec4(0.0)\n  );\n  rt0.a = 1.0;\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class b extends o.Z{constructor(){super(null,"FXAA3QualityShading",{isMorphing:!1,isSkinning:!1,isLighting:!1},y,I);const e=[{semantic:d.f.BaseColorTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[0,o.Z.__dummyWhiteTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:d.f.ScreenInfo,compositionType:_.d.Vec2,componentType:c.r.Float,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.FirstTimeOnly,soloDatum:!1,initialValue:v.ZP.fromCopyArray2([0,0]),min:0,max:Number.MAX_SAFE_INTEGER}];this.setShaderSemanticsInfoArray(e)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&this.setWorldMatrix(t,i.worldMatrix);let a=i.renderPass.cameraComponent;null==a&&(a=l.Z.getInstance().getComponent(s.Z,s.Z.main)),a&&(this.setViewInfo(t,a,i.isVr,i.displayIdx),this.setProjection(t,a,i.isVr,i.displayIdx))}}var T=n(3474),S=n(8346);const E={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec3 a_position;\nout vec2 v_texcoord_0;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main()\n{\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n\nv_texcoord_0 = a_texcoord_0;\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},C={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec2 v_texcoord_0;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\nvec3 srgbToLinear(vec3 srgbColor) {\n  return pow(srgbColor, vec3(2.2));\n}\n\n\nvoid main ()\n{\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nvec4 baseColor = texture2D(u_baseColorTexture, v_texcoord_0);\nbaseColor.rgb = linearToSrgb(baseColor.rgb);\n\nrt0 = baseColor;\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class w extends o.Z{constructor(){super(null,"GammaCorrection",{},E,C);const e=[{semantic:d.f.BaseColorTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[0,o.Z.__dummyWhiteTexture],min:0,max:10}];this.setShaderSemanticsInfoArray(e)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&this.setWorldMatrix(t,i.worldMatrix);let a=i.renderPass.cameraComponent;null==a&&(a=l.Z.getInstance().getComponent(s.Z,s.Z.main)),a&&(this.setViewInfo(t,a,i.isVr,i.displayIdx),this.setProjection(t,a,i.isVr,i.displayIdx))}}var D=n(871),N=n(3496),B=n(2566);const P={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec4 a_joint;\nin vec4 a_weight;\nout vec3 v_color;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\nout vec2 v_texcoord_0;\nout float v_instanceID;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\n\nvoid main()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  // Skeletal\n  processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n// #ifdef RN_IS_POINTSPRITE\n\nvec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\nvec3 viewPosition = get_viewPosition(cameraSID, 0);\nfloat distanceFromCamera = length(position_inWorld.xyz - viewPosition);\nvec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\nfloat distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\nfloat maxPointSize = get_pointSize(materialSID, 0);\ngl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);\n\n// #endif\n\n\n  v_instanceID = a_instanceID;\n}\n",shaderStage:"vertex",isFragmentShader:!1},M={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec3 v_normal_inWorld;\nin vec4 v_position_inWorld;\nin float v_instanceID;\n\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\nconst vec4 bitEnc = vec4(1.,255.,65025.,16581375.);\nconst vec4 bitDec = 1./bitEnc;\n\nvec4 encodeFloatRGBA(float v) {\n  float val = v;\n  float r = mod(val, 255.0);\n  val -= r;\n  float g = mod(val, 65025.0);\n  val -= g;\n  float b = mod(val, 16581375.0);\n  return vec4(r/255.0, g/65025.0, b/16581375.0, 1.0);\n}\n\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  rt0 = encodeFloatRGBA(v_instanceID);\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class F extends o.Z{constructor(){super(null,"entityUidOutputShading+skinning-lighting",{isMorphing:!1,isSkinning:!0,isLighting:!1},P,M);const e=[{semantic:d.f.WorldMatrix,isComponentData:!0,compositionType:_.d.Mat4,componentType:c.r.Float,stage:u.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:m.a.EveryTime,initialValue:N.Z.zero()},{semantic:d.f.NormalMatrix,isComponentData:!0,compositionType:_.d.Mat3,componentType:c.r.Float,stage:u.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:m.a.EveryTime,initialValue:B.Z.zero()},{semantic:d.f.PointSize,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.VertexShader,isSystem:!1,updateInterval:m.a.FirstTimeOnly,soloDatum:!0,initialValue:h.ZP.fromCopyNumber(30),min:0,max:100},{semantic:d.f.PointDistanceAttenuation,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.VertexShader,isSystem:!1,updateInterval:m.a.FirstTimeOnly,soloDatum:!0,initialValue:x.ZP.fromCopyArray([0,.1,.01]),min:0,max:1}];this.__definitions+="#define RN_IS_SKINNING\n",this.setShaderSemanticsInfoArray(e)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let a=i.renderPass.cameraComponent;null==a&&(a=l.Z.getInstance().getComponent(s.Z,s.Z.main)),this.setViewInfo(t,a,i.isVr,i.displayIdx),this.setProjection(t,a,i.isVr,i.displayIdx);const r=i.entity.getComponent(D.Z);this.setSkinning(t,r,i.setUniform),this.setLightsInfo(t,i.lightComponents,e,i.setUniform)}}var R=n(5704),L=n(85),V=n(7987),W=n(6019),z=n(4255),H=n(8268);const O={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\n// This shader is based on https://github.com/Santarh/MToon\n\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec3 a_position;\nin vec3 a_normal;\nin vec4 a_baryCentricCoord;\nin vec4 a_joint;\nin vec4 a_weight;\n\nout vec2 v_texcoord_0;\nout vec3 v_baryCentricCoord;\nout vec3 v_normal_inView;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\n\n#ifdef RN_USE_TANGENT_ATTRIBUTE\nin vec4 a_tangent;\nout vec3 v_tangent_inWorld;\nout vec3 v_binormal_inWorld; // bitangent_inWorld\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main(){\n  #ifdef RN_MTOON_IS_OUTLINE\n    #ifdef RN_MTOON_OUTLINE_NONE\n      return;\n    #endif\n  #endif\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n  bool isSkinning = false;\n  isSkinning = processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n\n  v_normal_inView = vec3(viewMatrix * vec4(v_normal_inWorld, 0.0));\n\n  #ifndef RN_MTOON_IS_OUTLINE\n    gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n  #else\n    #if defined(RN_MTOON_HAS_OUTLINE_WIDTH_TEXTURE)\n      float outlineTex = texture(u_outlineWidthTexture, a_texcoord_0).r;\n    #else\n      float outlineTex = 1.0;\n    #endif\n\n    #if defined(RN_MTOON_OUTLINE_WIDTH_WORLD)\n      float outlineWidth = get_outlineWidth(materialSID, 0);\n      vec3 outlineOffset = 0.01 * outlineWidth * outlineTex * a_normal;\n      vec4 worldOutlineOffset = worldMatrix * vec4(outlineOffset, 0.0);\n      gl_Position = projectionMatrix * viewMatrix * (v_position_inWorld + worldOutlineOffset);\n\n    #elif defined(RN_MTOON_OUTLINE_WIDTH_SCREEN)\n      vec4 vertex = projectionMatrix * viewMatrix * v_position_inWorld;\n\n      vec3 clipNormal = (projectionMatrix * vec4(v_normal_inView, 1.0)).xyz;\n      vec2 projectedNormal = normalize(clipNormal.xy);\n      float outlineScaledMaxDistance = get_outlineScaledMaxDistance(materialSID, 0);\n      projectedNormal *= min(vertex.w, outlineScaledMaxDistance);\n      float aspect = abs(get_aspect(0.0, 0)); //solo datum\n      projectedNormal.x *= aspect;\n\n      float outlineWidth = get_outlineWidth(materialSID, 0);\n      vertex.xy += 0.01 * outlineWidth * outlineTex * projectedNormal * clamp(1.0 - abs(v_normal_inView.z), 0.0, 1.0); // ignore offset when normal toward camera\n\n      gl_Position = vertex;\n    #else\n      gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n    #endif\n  #endif\n\n  #ifdef RN_USE_TANGENT_ATTRIBUTE\n    v_tangent_inWorld = normalMatrix * a_tangent.xyz;\n    v_binormal_inWorld = cross(v_normal_inWorld, v_tangent_inWorld) * a_tangent.w;\n  #endif\n\n  v_texcoord_0 = a_texcoord_0;\n  v_baryCentricCoord = a_baryCentricCoord.xyz;\n}\n",shaderStage:"vertex",isFragmentShader:!1},G={code:"\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nconst float EPS_COL = 0.00001;\n\nin vec2 v_texcoord_0;\nin vec3 v_baryCentricCoord;\nin vec3 v_normal_inView;\nin vec3 v_normal_inWorld;\nin vec4 v_position_inWorld;\n#ifdef RN_USE_TANGENT_ATTRIBUTE\n  in vec3 v_tangent_inWorld;\n  in vec3 v_binormal_inWorld; // bitangent_inWorld\n#endif\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3+vec3(1.0 - wireframeWidthInner)*d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\nvec3 srgbToLinear(vec3 srgbColor) {\n  return pow(srgbColor, vec3(2.2));\n}\n\n#ifdef RN_USE_TANGENT_ATTRIBUTE\n  vec3 perturb_normal(vec3 normal_inWorld, vec3 viewVector, vec2 texcoord) {\n    vec3 tangent_inWorld = normalize(v_tangent_inWorld);\n    vec3 binormal_inWorld = normalize(v_binormal_inWorld);\n    mat3 tbnMat_tangent_to_world = mat3(tangent_inWorld, binormal_inWorld, normal_inWorld);\n\n    vec3 normal = texture(u_normalTexture, texcoord).xyz * 2.0 - 1.0;\n    return normalize(tbnMat_tangent_to_world * normal);\n  }\n#else\n  #ifdef RN_IS_SUPPORTING_STANDARD_DERIVATIVES\n    // This is based on http://www.thetenthplanet.de/archives/1180\n    mat3 cotangent_frame(vec3 normal, vec3 position, vec2 uv) {\n      uv = gl_FrontFacing ? uv : -uv;\n\n      // get edge vectors of the pixel triangle\n      vec3 dp1 = dFdx(position);\n      vec3 dp2 = dFdy(position);\n      vec2 duv1 = dFdx(uv);\n      vec2 duv2 = dFdy(uv);\n\n      // solve the linear system\n      vec3 dp2perp = cross(dp2, normal);\n      vec3 dp1perp = cross(normal, dp1);\n      vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n      vec3 bitangent = dp2perp * duv1.y + dp1perp * duv2.y;\n\n      // construct a scale-invariant frame\n      float invMat = inversesqrt(max(dot(tangent, tangent), dot(bitangent, bitangent)));\n      return mat3(tangent * invMat, bitangent * invMat, normal);\n    }\n\n    vec3 perturb_normal(vec3 normal, vec3 viewVector, vec2 texcoord) {\n      vec3 normalTex = texture(u_normalTexture, texcoord).xyz * 2.0 - 1.0;\n\n      mat3 tbnMat_tangent_to_world = cotangent_frame(normal, -viewVector, texcoord);\n      return normalize(tbnMat_tangent_to_world * normalTex);\n    }\n  #else\n    vec3 perturb_normal(vec3 normal, vec3 viewVector, vec2 texcoord) {\n      return normal;\n    }\n  #endif\n#endif\n\n\nvoid main (){\n  #ifdef RN_MTOON_IS_OUTLINE\n    #ifdef RN_MTOON_OUTLINE_NONE\n      discard;\n    #endif\n  #endif\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n\n  // TODO\n  // uv transform\n\n  // TODO\n  // uv animation\n\n  // main color\n  vec4 litTextureColor = texture(u_litColorTexture, v_texcoord_0);\n  vec4 litColorFactor = get_litColor(materialSID, 0);\n\n  // alpha\n  float alpha = 1.0;\n\n  #ifdef RN_ALPHATEST_ON\n    alpha = litTextureColor.a * litColorFactor.a;\n    float cutoff = get_cutoff(materialSID, 0);\n    if(alpha < cutoff) discard;\n  #elif defined(RN_ALPHABLEND_ON)\n    alpha = litTextureColor.a * litColorFactor.a;\n  #endif\n\n  if (alpha < 0.01) {\n    discard;\n  }else{\n    rt0.w = alpha;\n  }\n\n\n  #ifdef RN_MTOON_IS_OUTLINE\n    #ifdef RN_MTOON_OUTLINE_COLOR_FIXED\n      vec3 outlineColor = get_outlineColor(materialSID, 0);\n      rt0.xyz = outlineColor;\n\n      rt0.xyz = srgbToLinear(rt0.xyz);\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n      return;\n    #endif\n  #endif\n\n  // view vector\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  vec3 viewPosition = get_viewPosition(cameraSID, 0);\n  vec3 viewVector = viewPosition - v_position_inWorld.xyz;\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n  #ifdef RN_MTOON_HAS_BUMPMAP\n    normal_inWorld = perturb_normal(normal_inWorld, viewVector, v_texcoord_0);\n  #endif\n\n  #ifdef RN_MTOON_IS_OUTLINE\n    normal_inWorld *= -1.0;\n  #endif\n\n\n  // Lighting, Direct Light\n\n  float shadowAttenuation = 1.0;\n  // TODO: shadowmap computation\n\n  float receiveShadowRate = get_receiveShadowRate(materialSID, 0);\n  float lightAttenuation = shadowAttenuation * mix(1.0, shadowAttenuation, receiveShadowRate * texture(u_receiveShadowTexture, v_texcoord_0).r);\n\n  float shadingGradeRate = get_shadingGradeRate(materialSID, 0);\n  float shadingGrade = 1.0 - shadingGradeRate * (1.0 - texture(u_shadingGradeTexture, v_texcoord_0).r);\n  float lightColorAttenuation = get_lightColorAttenuation(materialSID, 0);\n\n  vec3 shadeColorFactor = get_shadeColor(materialSID, 0);\n  vec3 shadeColor = shadeColorFactor * texture(u_shadeColorTexture, v_texcoord_0).xyz;\n  shadeColor.xyz = srgbToLinear(shadeColor.xyz);\n\n  vec3 litColor = litColorFactor.xyz * litTextureColor.xyz;\n  litColor.xyz = srgbToLinear(litColor.xyz);\n\n\n  float shadeShift = get_shadeShift(materialSID, 0);\n  float shadeToony = get_shadeToony(materialSID, 0);\n\n  vec3 lightings[/* shaderity: @{Config.maxLightNumberInShader} */];\n  #ifdef RN_MTOON_DEBUG_LITSHADERATE\n    float lightIntensities[/* shaderity: @{Config.maxLightNumberInShader} */];\n  #endif\n  for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */; i++) {\n    if (i >= lightNumber) {\n      break;\n    }\n\n    // Rn_Light\n    vec4 gotLightDirection = get_lightDirection(0.0, i);\n    vec4 gotLightIntensity = get_lightIntensity(0.0, i); //light color\n    vec4 gotLightPosition = get_lightPosition(0.0, i);\n    vec3 lightDirection = gotLightDirection.xyz;\n    vec3 lightColor = gotLightIntensity.xyz;\n    vec3 lightPosition = gotLightPosition.xyz;\n    float lightType = gotLightPosition.w;\n    float spotCosCutoff = gotLightDirection.w;\n    float spotExponent = gotLightIntensity.w;\n\n    float distanceAttenuation = 1.0;\n    if (lightType > 0.75) { // is point light or spotlight\n      lightDirection = normalize(lightPosition.xyz - v_position_inWorld.xyz);\n\n      float distance = dot(lightPosition - v_position_inWorld.xyz, lightPosition - v_position_inWorld.xyz);\n      distanceAttenuation = 1.0 / pow(distance, 2.0);\n    }\n\n    float spotEffect = 1.0;\n    if (lightType > 1.75) { // is spotlight\n      spotEffect *= dot(gotLightDirection.xyz, lightDirection);\n      if (spotEffect > spotCosCutoff) {\n        spotEffect *= pow(clamp(spotEffect, 0.0, 1.0), spotExponent);\n      } else {\n        spotEffect = 0.0;\n      }\n    }\n\n    // lightAttenuation *= distanceAttenuation * spotEffect;\n    float dotNL = dot(lightDirection, normal_inWorld);\n    float lightIntensity = dotNL * 0.5 + 0.5; // from [-1, +1] to [0, 1]\n    lightIntensity = lightIntensity * lightAttenuation; // TODO: receive shadow\n    lightIntensity = lightIntensity * shadingGrade; // darker\n    lightIntensity = lightIntensity * 2.0 - 1.0; // from [0, 1] to [-1, +1]\n\n    // tooned. mapping from [minIntensityThreshold, maxIntensityThreshold] to [0, 1]\n    float maxIntensityThreshold = mix(1.0, shadeShift, shadeToony);\n    float minIntensityThreshold = shadeShift;\n    lightIntensity = clamp((lightIntensity - minIntensityThreshold) / max(EPS_COL, (maxIntensityThreshold - minIntensityThreshold)), 0.0, 1.0);\n    #ifdef RN_MTOON_DEBUG_LITSHADERATE\n      lightIntensities[i] = lightIntensity;\n    #endif\n\n    // Albedo color\n    vec3 col = mix(shadeColor, litColor, lightIntensity);\n\n    // Direct Light\n    vec3 lighting = lightColor;\n    lighting = mix(lighting, vec3(max(EPS_COL, max(lighting.x, max(lighting.y, lighting.z)))), lightColorAttenuation); // color atten\n\n\n    if(i > 0){\n      lighting *= 0.5; // darken if additional light.\n      lighting *= min(0.0, dotNL) + 1.0; // darken dotNL < 0 area by using half lambert\n      // lighting *= shadowAttenuation; // darken if receiving shadow\n      #ifdef RN_ALPHABLEND_ON\n        lighting *= step(0.0, dotNL); // darken if transparent. Because Unity's transparent material can't receive shadowAttenuation.\n      #endif\n    }\n\n    col *= lighting;\n    lightings[i] = lighting;\n\n    rt0.xyz += col;\n\n    lightAttenuation = 1.0;\n  }\n\n\n  // Indirect Light\n  vec3 indirectLighting = get_ambientColor(materialSID, 0);\n  indirectLighting = srgbToLinear(indirectLighting);\n  indirectLighting = mix(indirectLighting, vec3(max(EPS_COL, max(indirectLighting.x, max(indirectLighting.y, indirectLighting.z)))), lightColorAttenuation); // color atten\n  // TODO: use ShadeIrad in www.ppsloan.org/publications/StupidSH36.pdf\n\n  rt0.xyz += indirectLighting * litColor;\n  rt0.xyz = min(rt0.xyz, litColor); // comment out if you want to PBR absolutely.\n\n\n  #ifdef RN_MTOON_IS_OUTLINE\n    #ifdef RN_MTOON_OUTLINE_COLOR_MIXED\n      vec3 outlineColor = get_outlineColor(materialSID, 0);\n      outlineColor = srgbToLinear(outlineColor);\n      float outlineLightingMix = get_outlineLightingMix(materialSID, 0);\n      rt0.xyz = outlineColor * mix(vec3(1.0), rt0.xyz, outlineLightingMix);\n    #endif\n  #else\n    vec3 viewDirection = normalize(viewVector);\n\n    float rimFresnelPower = get_rimFresnelPower(materialSID, 0);\n    float rimLift = get_rimLift(materialSID, 0);\n    vec3 rimColorFactor = get_rimColor(materialSID, 0);\n    vec3 rimTextureColor = texture(u_rimTexture, v_texcoord_0).xyz;\n    vec3 rimColor = srgbToLinear(rimColorFactor * rimTextureColor);\n    vec3 rim = pow(clamp(1.0 - dot(normal_inWorld, viewDirection) + rimLift, 0.0, 1.0), rimFresnelPower) * rimColor;\n\n    float staticRimLighting = 1.0;\n    float rimLightingMix = get_rimLightingMix(materialSID, 0);\n    for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */; i++) {\n      if (i >= lightNumber) break;\n\n      if(i > 0) staticRimLighting = 0.0;\n\n      vec3 rimLighting = mix(vec3(staticRimLighting), lightings[i], vec3(rimLightingMix));\n      rt0.xyz += rim * rimLighting;\n    }\n\n    // additive matcap\n    vec3 cameraUp = get_cameraUp(0.0, 0); //solo datum\n    vec3 worldViewUp = normalize(cameraUp - viewDirection * dot(viewDirection, cameraUp));\n    vec3 worldViewRight = normalize(cross(viewDirection, worldViewUp));\n    vec2 matcapUv = vec2(dot(worldViewRight, normal_inWorld), dot(worldViewUp, normal_inWorld)) * 0.5 + 0.5;\n    vec3 matCapColor = srgbToLinear(texture(u_matCapTexture, matcapUv).xyz);\n    rt0.xyz += matCapColor;\n\n\n    // Emission\n    vec3 emissionColor = get_emissionColor(materialSID, 0);\n    vec3 emission = srgbToLinear(texture(u_emissionTexture, v_texcoord_0).xyz) * emissionColor;\n    rt0.xyz += emission;\n  #endif\n\n\n  // debug\n  #ifdef RN_MTOON_DEBUG_NORMAL\n    rt0 = vec4(normal_inWorld * 0.5 + 0.5, alpha);\n\n    rt0.xyz = srgbToLinear(rt0.xyz);\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n    return;\n  #elif defined(RN_MTOON_DEBUG_LITSHADERATE)\n    rt0 = vec4(0.0);\n    for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */; i++) {\n      if (i >= lightNumber) break;\n      rt0 += vec4(lightIntensities[i] * lightings[i], alpha);\n    }\n\n    rt0.xyz = srgbToLinear(rt0.xyz);\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n    return;\n  #endif\n\n\n  // Wireframe\n  float threshold = 0.001;\n  vec3 wireframe = get_wireframe(materialSID, 0);\n  float wireframeWidthInner = wireframe.z;\n  float wireframeWidthRelativeScale = 1.0;\n  if (wireframe.x > 0.5 && wireframe.y < 0.5) {\n    rt0.a = 0.0;\n  }\n  vec4 wireframeResult = rt0;\n  vec4 wireframeColor = vec4(0.2, 0.75, 0.0, 1.0);\n  float edgeRatio = edge_ratio(v_baryCentricCoord, wireframeWidthInner, wireframeWidthRelativeScale);\n  float edgeRatioModified = mix(step(threshold, edgeRatio), clamp(edgeRatio*4.0, 0.0, 1.0), wireframeWidthInner / wireframeWidthRelativeScale/4.0);\n  // if r0.a is 0.0, it is wireframe not on shaded\n  wireframeResult.rgb = wireframeColor.rgb * edgeRatioModified + rt0.rgb * (1.0 - edgeRatioModified);\n  wireframeResult.a = max(rt0.a, wireframeColor.a * mix(edgeRatioModified, pow(edgeRatioModified, 100.0), wireframeWidthInner / wireframeWidthRelativeScale/1.0));\n\n  if (wireframe.x > 0.5) {\n    rt0 = wireframeResult;\n    if (wireframe.y < 0.5 && rt0.a == 0.0) {\n      discard;\n    }\n  }\n\nfloat makeOutputSrgb = float(get_makeOutputSrgb(materialSID, 0));\nrt0.rgb = mix(rt0.rgb, linearToSrgb(rt0.rgb), makeOutputSrgb);\n\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class Q extends o.Z{constructor(e,t,n,a,r,s,l,A,p){super(null,"MToonShading"+(a?"+morphing":"")+(r?"+skinning":"")+(s?"":"-lighting")+(l?"+tangentAttribute":""),{isMorphing:a,isSkinning:r,isLighting:s},O,G),this.__OutlineWidthModeIsScreen=!1,this.__floatProperties={},this.__vectorProperties={},this.__textureProperties={};const g=[];switch(null!=t?(this.__floatProperties=t.floatProperties,this.__vectorProperties=t.vectorProperties,this.__textureProperties=t.textureProperties):(this.__floatProperties._BlendMode=0,this.__floatProperties._BumpScale=1,this.__floatProperties._CullMode=2,this.__floatProperties._Cutoff=.5,this.__floatProperties._DebugMode=0,this.__floatProperties._DstBlend=0,this.__floatProperties._IndirectLightIntensity=.1,this.__floatProperties._LightColorAttenuation=0,this.__floatProperties._OutlineColorMode=0,this.__floatProperties._OutlineCullMode=1,this.__floatProperties._OutlineLightingMix=1,this.__floatProperties._OutlineScaledMaxDistance=1,this.__floatProperties._OutlineWidth=.5,this.__floatProperties._OutlineWidthMode=0,this.__floatProperties._ReceiveShadowRate=1,this.__floatProperties._RimFresnelPower=1,this.__floatProperties._RimLift=0,this.__floatProperties._RimLightingMix=0,this.__floatProperties._ShadeShift=0,this.__floatProperties._ShadeToony=.9,this.__floatProperties._ShadingGradeRate=1,this.__floatProperties._SrcBlend=1,this.__floatProperties._ZWrite=1,this.__vectorProperties._Color=[1,1,1,1],this.__vectorProperties._EmissionColor=[0,0,0],this.__vectorProperties._OutlineColor=[0,0,0,1],this.__vectorProperties._ShadeColor=[.97,.81,.86,1],this.__vectorProperties._RimColor=[0,0,0],this.__textureProperties._BumpMap=0,this.__textureProperties._EmissionMap=1,this.__textureProperties._MainTex=0,this.__textureProperties._OutlineWidthTexture=0,this.__textureProperties._ReceiveShadowTexture=0,this.__textureProperties._RimTexture=1,this.__textureProperties._ShadeTexture=0,this.__textureProperties._ShadingGradeTexture=0,this.__textureProperties._SphereAdd=1,n=[o.Z.__dummyWhiteTexture,o.Z.__dummyBlackTexture]),A&&(this.__floatProperties._DebugMode=A),g.push({semantic:Q._Cutoff,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._Cutoff),min:0,max:1},{semantic:Q._Color,componentType:c.r.Float,compositionType:_.d.Vec4,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:f.ZP.fromCopyArray(this.__vectorProperties._Color),min:0,max:1},{semantic:Q._ShadeColor,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyArray(this.__vectorProperties._ShadeColor),min:0,max:1},{semantic:Q._BumpScale,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._BumpScale),min:0,max:1},{semantic:Q._ReceiveShadowRate,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._ReceiveShadowRate),min:0,max:1},{semantic:Q._ShadingGradeRate,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._ShadingGradeRate),min:0,max:1},{semantic:Q._ShadeShift,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._ShadeShift),min:0,max:1},{semantic:Q._ShadeToony,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._ShadeToony),min:0,max:1},{semantic:Q._LightColorAttenuation,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._LightColorAttenuation),min:0,max:1},{semantic:Q._AmbientColor,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyArray([.5785,.5785,.5785]),min:0,max:1},{semantic:Q._RimColor,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyArray(this.__vectorProperties._RimColor),min:0,max:1},{semantic:Q._RimLightingMix,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._RimLightingMix),min:0,max:1},{semantic:Q._RimFresnelPower,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._RimFresnelPower),min:0,max:1},{semantic:Q._RimLift,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._RimLift),min:0,max:1},{semantic:Q.CameraUp,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.PixelShader,isSystem:!0,soloDatum:!0,initialValue:x.ZP.fromCopyArray([0,1,0]),min:0,max:1},{semantic:Q._EmissionColor,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyArray(this.__vectorProperties._EmissionColor),min:0,max:1},{semantic:d.f.Wireframe,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyArray([0,0,1]),min:0,max:10},{semantic:d.f.MakeOutputSrgb,compositionType:_.d.Scalar,componentType:c.r.Bool,stage:u.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:h.ZP.fromCopyNumber(p?1:0)}),this.__floatProperties._DebugMode){case 1:this.__definitions+="#define RN_MTOON_DEBUG_NORMAL\n";break;case 2:this.__definitions+="#define RN_MTOON_DEBUG_LITSHADERATE\n"}if(e){switch(this.__definitions+="#define RN_MTOON_IS_OUTLINE\n",this.__floatProperties._OutlineWidthMode){case 0:this.__definitions+="#define RN_MTOON_OUTLINE_NONE\n";break;case 1:this.__definitions+="#define RN_MTOON_OUTLINE_WIDTH_WORLD\n";break;case 2:this.__definitions+="#define RN_MTOON_OUTLINE_WIDTH_SCREEN\n",this.__OutlineWidthModeIsScreen=!0}switch(this.__floatProperties._OutlineColorMode){case 0:this.__definitions+="#define RN_MTOON_OUTLINE_COLOR_FIXED\n";break;case 1:this.__definitions+="#define RN_MTOON_OUTLINE_COLOR_MIXED\n"}g.push({semantic:Q._OutlineWidth,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.VertexShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._OutlineWidth),min:0,max:1},{semantic:Q._OutlineScaledMaxDistance,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.VertexShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._OutlineScaledMaxDistance),min:0,max:1},{semantic:Q._OutlineColor,componentType:c.r.Float,compositionType:_.d.Vec3,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyArray(this.__vectorProperties._OutlineColor),min:0,max:1},{semantic:Q._OutlineLightingMix,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,soloDatum:!1,initialValue:h.ZP.fromCopyNumber(this.__floatProperties._OutlineLightingMix),min:0,max:1},{semantic:Q.Aspect,componentType:c.r.Float,compositionType:_.d.Scalar,stage:u.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:h.ZP.fromCopyNumber(1),min:0,max:1})}s&&(this.__definitions+="#define RN_IS_LIGHTING\n"),r&&(this.__definitions+="#define RN_IS_SKINNING\n"),a&&(this.__definitions+="#define RN_IS_MORPHING\n",g.push({semantic:d.f.MorphTargetNumber,componentType:c.r.Int,compositionType:_.d.Scalar,stage:u.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:h.ZP.fromCopyNumber(0),min:0,max:i.Z.maxVertexMorphNumberInShader,needUniformInFastest:!0},{semantic:d.f.DataTextureMorphOffsetPosition,componentType:c.r.Int,compositionType:_.d.ScalarArray,maxIndex:i.Z.maxVertexMorphNumberInShader,stage:u.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new z.Z(new Int32Array(i.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0},{semantic:d.f.MorphWeights,componentType:c.r.Float,compositionType:_.d.ScalarArray,maxIndex:i.Z.maxVertexMorphNumberInShader,stage:u.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new z.Z(new Float32Array(i.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0})),l&&(this.__definitions+="#define RN_USE_TANGENT_ATTRIBUTE\n"),this.__setTextures(n,g,e),this.setShaderSemanticsInfoArray(g)}__setTextures(e,t,n){t.push({semantic:Q._MainTex,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[0,e[this.__textureProperties._MainTex]],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:Q._ShadeTexture,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[1,e[this.__textureProperties._ShadeTexture]],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:Q._ReceiveShadowTexture,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[2,e[this.__textureProperties._ReceiveShadowTexture]],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:Q._ShadingGradeTexture,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[3,e[this.__textureProperties._ShadingGradeTexture]],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:Q._RimTexture,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[4,e[this.__textureProperties._RimTexture]],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:Q._SphereAdd,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[5,e[this.__textureProperties._SphereAdd]],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:Q._EmissionMap,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[6,e[this.__textureProperties._EmissionMap]],min:0,max:Number.MAX_SAFE_INTEGER});const i=H.Z.getInstance().currentWebGLContextWrapper.getRawContext();i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS)>9&&(t.push({semantic:Q._BumpMap,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[8,e[this.__textureProperties._BumpMap]],min:0,max:Number.MAX_SAFE_INTEGER}),this.__textureProperties._BumpMap!==e.length-2&&(this.__definitions+="#define RN_MTOON_HAS_BUMPMAP\n"),n&&(t.push({semantic:Q._OutlineWidthTexture,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.VertexShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[9,e[this.__textureProperties._OutlineWidthTexture]],min:0,max:Number.MAX_SAFE_INTEGER}),this.__textureProperties._OutlineWidthTexture!==e.length-2&&(this.__definitions+="#define RN_MTOON_HAS_OUTLINE_WIDTH_TEXTURE\n")))}setMaterialParameters(e,t){if(null==Q.usableBlendEquationModeAlpha&&Q.__initializeUsableBlendEquationModeAlpha(),0!==this.__floatProperties._BlendMode){switch(this.__floatProperties._BlendMode){case 1:this.__definitions+="#define RN_ALPHATEST_ON\n",e.alphaMode=R.F.Mask;break;case 2:case 3:this.__definitions+="#define RN_ALPHABLEND_ON\n",e.alphaMode=R.F.Translucent}const t=32774,n=Q.usableBlendEquationModeAlpha,i=Q.unityBlendEnumCorrespondence(this.__floatProperties._SrcBlend),a=Q.unityBlendEnumCorrespondence(this.__floatProperties._DstBlend);e.setBlendEquationMode(t,n),e.setBlendFuncFactor(i,a)}if(t)switch(this.__floatProperties._OutlineCullMode){case 0:e.cullFace=!1;break;case 1:e.cullFace=!0,e.cullFrontFaceCCW=!1;break;case 2:e.cullFace=!0,e.cullFrontFaceCCW=!0}else switch(this.__floatProperties._CullMode){case 0:e.cullFace=!1;break;case 1:e.cullFace=!0,e.cullFrontFaceCCW=!1;break;case 2:e.cullFace=!0,e.cullFrontFaceCCW=!0}}static __initializeUsableBlendEquationModeAlpha(){const e=V.Z.getWebGLResourceRepository().currentWebGLContextWrapper,t=e.getRawContextAsWebGL2();e.isWebGL2?Q.usableBlendEquationModeAlpha=t.MAX:e.webgl1ExtBM?Q.usableBlendEquationModeAlpha=e.webgl1ExtBM.MAX_EXT:Q.usableBlendEquationModeAlpha=t.FUNC_ADD}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){let a=i.renderPass.cameraComponent;if(null==a&&(a=l.Z.getInstance().getComponent(s.Z,s.Z.main)),i.setUniform){this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix),this.setViewInfo(t,a,i.isVr,i.displayIdx),this.setProjection(t,a,i.isVr,i.displayIdx);const n=i.entity.getSkeletal();this.setSkinning(t,n,i.setUniform),this.setLightsInfo(t,i.lightComponents,e,i.setUniform),t._gl.uniform3fv(t.cameraUp,a.upInner._v),this.__OutlineWidthModeIsScreen&&t._gl.uniform1f(t.aspect,a.aspect)}else e.setParameter(Q.CameraUp,a.upInner),this.__OutlineWidthModeIsScreen&&e.setParameter(Q.Aspect,a.aspect);this.setMorphInfo(t,i.entity.getComponent(W.Z),i.entity.getComponent(L.Z),i.primitive)}static unityBlendEnumCorrespondence(e){const t=V.Z.getWebGLResourceRepository().currentWebGLContextWrapper.getRawContext();let n=t.ZERO;switch(e){case 0:n=t.ZERO;break;case 1:n=t.ONE;break;case 2:n=t.DST_COLOR;break;case 3:n=t.SRC_COLOR;break;case 4:n=t.ONE_MINUS_DST_COLOR;break;case 5:n=t.SRC_ALPHA;break;case 6:n=t.ONE_MINUS_SRC_COLOR;break;case 7:n=t.DST_ALPHA;break;case 8:n=t.ONE_MINUS_DST_ALPHA;break;case 9:n=t.SRC_ALPHA_SATURATE;break;case 10:n=t.ONE_MINUS_SRC_ALPHA}return n}}Q._Cutoff=new d.w({str:"cutoff"}),Q._Color=new d.w({str:"litColor"}),Q._ShadeColor=new d.w({str:"shadeColor"}),Q._MainTex=new d.w({str:"litColorTexture"}),Q._ShadeTexture=new d.w({str:"shadeColorTexture"}),Q._BumpScale=new d.w({str:"normalScale"}),Q._BumpMap=new d.w({str:"normalTexture"}),Q._ReceiveShadowRate=new d.w({str:"receiveShadowRate"}),Q._ReceiveShadowTexture=new d.w({str:"receiveShadowTexture"}),Q._ShadingGradeRate=new d.w({str:"shadingGradeRate"}),Q._ShadingGradeTexture=new d.w({str:"shadingGradeTexture"}),Q._ShadeShift=new d.w({str:"shadeShift"}),Q._ShadeToony=new d.w({str:"shadeToony"}),Q._LightColorAttenuation=new d.w({str:"lightColorAttenuation"}),Q._AmbientColor=new d.w({str:"ambientColor"}),Q._RimTexture=new d.w({str:"rimTexture"}),Q._RimColor=new d.w({str:"rimColor"}),Q._RimLightingMix=new d.w({str:"rimLightingMix"}),Q._RimFresnelPower=new d.w({str:"rimFresnelPower"}),Q._RimLift=new d.w({str:"rimLift"}),Q._SphereAdd=new d.w({str:"matCapTexture"}),Q._EmissionColor=new d.w({str:"emissionColor"}),Q._EmissionMap=new d.w({str:"emissionTexture"}),Q._OutlineWidthTexture=new d.w({str:"outlineWidthTexture"}),Q._OutlineWidth=new d.w({str:"outlineWidth"}),Q._OutlineScaledMaxDistance=new d.w({str:"outlineScaledMaxDistance"}),Q._OutlineColor=new d.w({str:"outlineColor"}),Q._OutlineLightingMix=new d.w({str:"outlineLightingMix"}),Q.Aspect=new d.w({str:"aspect"}),Q.CameraUp=new d.w({str:"cameraUp"});var k=n(1986),U=n(6773);class Z extends o.Z{constructor({name:e,isMorphing:t,isSkinning:n,isLighting:i,alphaMode:a,vertexShader:r,pixelShader:s}){super(null,e+(t?"+morphing":"")+(n?"+skinning":"")+(i?"":"-lighting")+" alpha_"+a.str.toLowerCase(),{isMorphing:t,isSkinning:n,isLighting:i});const l=U.Z.getShaderDataRefection(r,o.Z.__semanticsMap.get(this.shaderFunctionName)),c=U.Z.getShaderDataRefection(s,o.Z.__semanticsMap.get(this.shaderFunctionName));this.__vertexShaderityObject=l.shaderityObject,this.__pixelShaderityObject=c.shaderityObject;const _=[];for(const e of l.shaderSemanticsInfoArray)e.stage=u.H.VertexShader,_.push(e);for(const e of c.shaderSemanticsInfoArray){const t=_.find((t=>t.semantic.str===e.semantic.str));t?t.stage=u.H.VertexAndPixelShader:(e.stage=u.H.PixelShader,_.push(e))}i&&(this.__definitions+="#define RN_IS_LIGHTING\n"),n&&(this.__definitions+="#define RN_IS_SKINNING\n"),t&&(this.__definitions+="#define RN_IS_MORPHING\n"),this.__definitions+="#define RN_IS_ALPHAMODE_"+a.str+"\n",this.setShaderSemanticsInfoArray(_)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){if(i.setUniform){if(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix),n||i.isVr){let e=i.renderPass.cameraComponent;null==e&&(e=l.Z.getInstance().getComponent(s.Z,s.Z.main)),this.setViewInfo(t,e,i.isVr,i.displayIdx),this.setProjection(t,e,i.isVr,i.displayIdx)}n&&this.setLightsInfo(t,i.lightComponents,e,i.setUniform);const a=i.entity.getSkeletal();this.setSkinning(t,a,i.setUniform)}if(i.diffuseCube&&i.diffuseCube.isTextureReady?this.__webglResourceRepository.setUniformValue(t,d.f.DiffuseEnvTexture.str,n,[5,i.diffuseCube]):this.__webglResourceRepository.setUniformValue(t,d.f.DiffuseEnvTexture.str,n,[5,o.Z.__dummyBlackCubeTexture]),i.specularCube&&i.specularCube.isTextureReady?this.__webglResourceRepository.setUniformValue(t,d.f.SpecularEnvTexture.str,n,[6,i.specularCube]):this.__webglResourceRepository.setUniformValue(t,d.f.SpecularEnvTexture.str,n,[6,o.Z.__dummyBlackCubeTexture]),i.setUniform){if(n){const{mipmapLevelNumber:e,meshRenderComponent:a,diffuseHdriType:r,specularHdriType:o}=this.setupHdriParameters(i);this.__webglResourceRepository.setUniformValue(t,d.f.IBLParameter.str,n,{x:e,y:a.diffuseCubeMapContribution,z:a.specularCubeMapContribution,w:a.rotationOfCubeMap}),this.__webglResourceRepository.setUniformValue(t,d.f.HDRIFormat.str,n,{x:r,y:o})}}else{const{mipmapLevelNumber:t,meshRenderComponent:n,diffuseHdriType:a,specularHdriType:r}=this.setupHdriParameters(i),s=o.Z.__tmp_vector4;s.x=t,s.y=n.diffuseCubeMapContribution,s.z=n.specularCubeMapContribution,s.w=n.rotationOfCubeMap,e.setParameter(d.f.IBLParameter,s);const l=o.Z.__tmp_vector2;l.x=a,l.y=r,e.setParameter(d.f.HDRIFormat,l)}this.setMorphInfo(t,i.entity.getComponent(W.Z),i.entity.getComponent(L.Z),i.primitive)}setupHdriParameters(e){let t=1;e.specularCube&&(t=e.specularCube.mipmapLevelNumber);const n=e.entity.getMeshRenderer();let i=k.c.LDR_SRGB.index,a=k.c.LDR_SRGB.index;return n.diffuseCubeMap&&(i=n.diffuseCubeMap.hdriFormat.index),n.specularCubeMap&&(a=n.specularCubeMap.hdriFormat.index),{mipmapLevelNumber:t,meshRenderComponent:n,diffuseHdriType:i,specularHdriType:a}}}Z.__pbrCookTorranceBrdfLutDataUrlUid=V.Z.InvalidCGAPIResourceUid,Z.BaseColorTextureTransform=new d.w({str:"baseColorTextureTransform"}),Z.BaseColorTextureRotation=new d.w({str:"baseColorTextureRotation"}),Z.NormalTextureTransform=new d.w({str:"normalTextureTransform"}),Z.NormalTextureRotation=new d.w({str:"normalTextureRotation"}),Z.MetallicRoughnessTextureTransform=new d.w({str:"metallicRoughnessTextureTransform"}),Z.MetallicRoughnessTextureRotation=new d.w({str:"metallicRoughnessTextureRotation"});var X=n(4507),q=n(9434),Y=n(4200),j=n(7860),K=n(2939),J=n(4722),$=n(7290),ee=n(2651),te=n(5981);const ne={code:"\nprecision highp float;\nprecision highp int;\n\n\nin float a_instanceID;\nin vec2 a_texcoord;\nin vec3 a_position;\n\nout vec2 v_texcoord;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n\n  v_texcoord = a_texcoord;\n}\n",shaderStage:"vertex",isFragmentShader:!1},ie={code:"\nprecision highp float;\nprecision highp int;\n\n\nin vec2 v_texcoord;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  vec4 textureColor = texture2D(u_baseColorTexture, v_texcoord);\n\n  float r = textureColor.r;\n  float g = textureColor.g;\n  float b = textureColor.b;\n  float r16 = r * 15.0;\n  float g16 = g * 15.0;\n  float b16 = b * 15.0;\n  float rInt = floor(r16);\n  float gInt = floor(g16);\n  float bInt = floor(b16);\n\n  float rRate, gRate, bRate;\n  float rIntAdjust, gIntAdjust, bIntAdjust;\n\n  vec3 newColor = vec3(0.0);\n  for(int i=0; i<8; i++){\n    rRate = 1.0 - fract(r16);\n    gRate = 1.0 - fract(g16);\n    bRate = 1.0 - fract(b16);\n    rIntAdjust = rInt;\n    gIntAdjust = gInt;\n    bIntAdjust = bInt;\n\n    if(fract(float(i) / 2.0) != 0.0){\n      rIntAdjust += 1.0;\n      rRate = 1.0 - rRate;\n    }\n    if(fract(float(i / 2) / 2.0) != 0.0){\n      gIntAdjust += 1.0;\n      gRate = 1.0 - gRate;\n    }\n    if(fract(float(i / 4) / 2.0) != 0.0){\n      bIntAdjust += 1.0;\n      bRate = 1.0 - bRate;\n    }\n\n    if( rRate * gRate * bRate != 0.0){\n      newColor += texture2D(u_lookupTableTexture, vec2(rIntAdjust / 256.0 + bIntAdjust / 16.0  + 1.0 / 512.0, gIntAdjust / 16.0 + 1.0 / 32.0)).rgb * rRate * gRate * bRate;\n    }\n  }\n\n  rt0 = vec4(newColor, 1.0);\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class ae extends o.Z{constructor(e,t,n,i){let a;super(null,"colorGradingUsingLUTsShading",{},ne,ie);const r=e.getFramebuffer();let s;null!=r&&null!=r.colorAttachments[t]?a=r.colorAttachments[t]:(a=o.Z.__dummyBlackTexture,null!=r?console.warn("renderPass does not have framebuffer.colorAttachments["+t+"]"):console.warn("renderPass does not have framebuffer")),"string"==typeof n?(s=new ee.Z,async function(e){await s.generateTextureFromUri(e,{minFilter:te.d.Nearest,magFilter:te.d.Nearest,wrapS:te.d.ClampToEdge,wrapT:te.d.ClampToEdge,type:c.r.UnsignedByte,anisotropy:!1})}(n)):i instanceof $.Z?s=i:(console.warn("no LUT texture is specified"),s=o.Z.__dummyBlackTexture);const l=[{semantic:d.f.BaseColorTexture,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[0,a],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:ae.lookupTableTexture,componentType:c.r.Int,compositionType:_.d.Texture2D,stage:u.H.PixelShader,isSystem:!1,updateInterval:m.a.EveryTime,initialValue:[1,s],min:0,max:Number.MAX_SAFE_INTEGER}];this.setShaderSemanticsInfoArray(l)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&this.setWorldMatrix(t,i.worldMatrix);let a=i.renderPass.cameraComponent;null==a&&(a=l.Z.getInstance().getComponent(s.Z,s.Z.main)),a&&(this.setViewInfo(t,a,i.isVr,i.displayIdx),this.setProjection(t,a,i.isVr,i.displayIdx))}}ae.lookupTableTexture=new d.w({str:"lookupTableTexture"});var re=n(5170),oe=n(8985),se=n(2992);const le={code:'\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec3 v_color;\nin vec3 v_normal_inWorld;\nin vec3 v_faceNormal_inWorld;\nin vec3 v_tangent_inWorld;\nin vec3 v_binormal_inWorld;\nin vec4 v_position_inWorld;\nin vec2 v_texcoord;\nin vec3 v_baryCentricCoord;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nfloat angular_n_h(float NH) {\n  return acos(NH);\n}\n\nfloat sqr(float x) {\n  return x*x;\n}\n\nfloat d_phong(float NH, float c1) {\n  return pow(\n    cos(acos(NH))\n    , c1\n  );\n}\n\n// this is from https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec3 envBRDFApprox( vec3 F0, float Roughness, float NoV ) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022 );\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04 );\n  vec4 r = Roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n  return F0 * AB.x + AB.y;\n}\n\n// GGX NDF\nfloat d_ggx(float NH, float alphaRoughness) {\n  float roughnessSqr = alphaRoughness * alphaRoughness;\n  float f = (roughnessSqr - 1.0) * NH * NH + 1.0;\n  return roughnessSqr / (M_PI * f * f);\n}\n\nfloat d_torrance_reiz(float NH, float c3) {\n  float CosSquared = NH*NH;\n  float TanSquared = (1.0 - CosSquared)/CosSquared;\n  //return (1.0/M_PI) * sqr(c3/(CosSquared * (c3*c3 + TanSquared)));  // gamma = 2, aka GGX\n  return (1.0/sqrt(M_PI)) * (sqr(c3)/(CosSquared * (c3*c3 + TanSquared))); // gamma = 1, D_Berry\n}\n\nfloat d_beckmann(float NH, float m) {\n  float co = 1.0 / (4.0 * m * m * NH * NH * NH * NH);\n  float expx = exp((NH * NH - 1.0) / (m * m * NH * NH));\n  return co * expx;\n}\n\n// the same as glTF WebGL sample\n// https://github.com/KhronosGroup/glTF-WebGL-PBR/blob/88eda8c5358efe03128b72b6c5f5f6e5b6d023e1/shaders/pbr-frag.glsl#L188\n// That is, Unreal Engine based approach, but modified to use alphaRoughness (squared artist\'s roughness parameter),\n// and based on \'Separable Masking and Shadowing\' approximation (propesed by Christophe Schlick)\n// https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\nfloat g_shielding(float NL, float NV, float alphaRoughness) {\n  float r = alphaRoughness;\n\n  // Local Shadowing using "Schlick-Smith" Masking Function\n  float localShadowing = 2.0 * NL / (NL + sqrt(r * r + (1.0 - r * r) * (NL * NL)));\n\n  // Local Masking using "Schlick-Smith" Masking Function\n  float localMasking = 2.0 * NV / (NV + sqrt(r * r + (1.0 - r * r) * (NV * NV)));\n\n  return localShadowing * localMasking;\n}\n\n// The code from https://google.github.io/filament/Filament.html#listing_approximatedspecularv\n// The idea is from [Heitz14] Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs.\nfloat v_SmithGGXCorrelated(float NL, float NV, float alphaRoughness) {\n  float a2 = alphaRoughness * alphaRoughness;\n  float GGXV = NL * sqrt(NV * NV * (1.0 - a2) + a2);\n  float GGXL = NV * sqrt(NL * NL * (1.0 - a2) + a2);\n  return 0.5 / (GGXV + GGXL);\n}\n\nfloat v_SmithGGXCorrelatedFast(float NL, float NV, float alphaRoughness) {\n  float a = alphaRoughness;\n  float GGXV = NL * (NV * (1.0 - a) + a);\n  float GGXL = NV * (NL * (1.0 - a) + a);\n  return 0.5 / (GGXV + GGXL);\n}\n\n// The Schlick Approximation to Fresnel\nvec3 fresnel(vec3 f0, float VH) {\n  return vec3(f0) + (vec3(1.0) - f0) * pow(1.0 - VH, 5.0);\n}\n\nvec3 cook_torrance_specular_brdf(float NH, float NL, float NV, vec3 F, float alphaRoughness) {\n  float D = d_ggx(NH, alphaRoughness);\n  float V = v_SmithGGXCorrelated(NL, NV, alphaRoughness);\n  return vec3(D)*vec3(V)*F;\n//      float G = g_shielding(NL, NV, alphaRoughness);\n//      return vec3(D)*vec3(G)*F/vec3(4.0*NL*NV);\n\n}\n\nvec3 diffuse_brdf(vec3 albedo)\n{\n  return albedo / M_PI;\n}\n\nvec3 srgbToLinear(vec3 srgbColor) {\n  return pow(srgbColor, vec3(2.2));\n}\n\nfloat srgbToLinear(float value) {\n  return pow(value, 2.2);\n}\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\nfloat linearToSrgb(float value) {\n  return pow(value, 1.0/2.2);\n}\n\nvec3 fresnelSchlickRoughness(vec3 F0, float cosTheta, float roughness)\n{\n  return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n}\n\nvec3 normalBlendingUDN(sampler2D baseMap, sampler2D detailMap, vec2 baseUv, vec2 detailUv) {\n  vec3 t = texture2D(baseMap,   baseUv).xyz * 2.0 - 1.0;\n  vec3 u = texture2D(detailMap, detailUv).xyz * 2.0 - 1.0;\n  vec3 r = normalize(vec3(t.xy + u.xy, t.z));\n  return r;\n}\n\nvec2 uvTransform(vec2 scale, vec2 offset, float rotation, vec2 uv) {\n  mat3 translationMat = mat3(1,0,0, 0,1,0, offset.x, offset.y, 1);\n  mat3 rotationMat = mat3(\n      cos(rotation), -sin(rotation), 0,\n      sin(rotation), cos(rotation), 0,\n                  0,             0, 1\n  );\n  mat3 scaleMat = mat3(scale.x,0,0, 0,scale.y,0, 0,0,1);\n\n  mat3 matrix = translationMat * rotationMat * scaleMat;\n  vec2 uvTransformed = ( matrix * vec3(uv.xy, 1) ).xy;\n\n  return uvTransformed;\n}\n\n\n/* shaderity: @{getters} */\n\nvec3 IBLContribution(float materialSID, vec3 n, float NV, vec3 reflection, vec3 albedo, vec3 F0, float userRoughness, vec3 F)\n{\n  vec4 iblParameter = get_iblParameter(materialSID, 0);\n  float mipCount = iblParameter.x;\n  float lod = (userRoughness * mipCount);\n\n  vec4 diffuseTexel = textureCube(u_diffuseEnvTexture, vec3(-n.x, n.y, n.z));\n  vec3 diffuseLight;\n  ivec2 hdriFormat = get_hdriFormat(materialSID, 0);\n  if (hdriFormat.x == 0) {\n    // LDR_SRGB\n    diffuseLight = srgbToLinear(diffuseTexel.rgb);\n  }\n  else if (hdriFormat.x == 3) {\n    // RGBE\n    diffuseLight = diffuseTexel.rgb * pow(2.0, diffuseTexel.a*255.0-128.0);\n  }\n  else {\n    diffuseLight = diffuseTexel.rgb;\n  }\n\nreflection.x *= -1.0;\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n  vec4 specularTexel = textureCubeLodEXT(u_specularEnvTexture, reflection, lod);\n#elif defined(GLSL_ES3)\n  vec4 specularTexel = textureLod(u_specularEnvTexture, reflection, lod);\n#else\n  vec4 specularTexel = textureCube(u_specularEnvTexture, reflection);\n#endif\n\n\n  vec3 specularLight;\n  if (hdriFormat.y == 0) {\n    // LDR_SRGB\n    specularLight = srgbToLinear(specularTexel.rgb);\n  }\n  else if (hdriFormat.y == 3) {\n    // RGBE\n    specularLight = specularTexel.rgb * pow(2.0, specularTexel.a*255.0-128.0);\n  }\n  else {\n    specularLight = specularTexel.rgb;\n  }\n\n  vec3 kS = fresnelSchlickRoughness(F0, NV, userRoughness);\n  vec3 kD = 1.0 - kS;\n  vec3 diffuse = diffuseLight * albedo * kD;\n  vec3 brdf = texture2D(u_brdfLutTexture, vec2(1.0 - NV, 1.0 - userRoughness)).rgb;\n  vec3 specular = specularLight * (F0 * brdf.x + brdf.y);\n  // vec3 specular = specularLight * envBRDFApprox(F0, userRoughness, NV);\n\n  float IBLDiffuseContribution = iblParameter.y;\n  float IBLSpecularContribution = iblParameter.z;\n  diffuse *= IBLDiffuseContribution;\n  specular *= IBLSpecularContribution;\n  return diffuse + specular;\n}\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3+vec3(1.0 - wireframeWidthInner)*d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\n\n\n\n\n\nvoid main ()\n{\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n  vec4 iblParameter = get_iblParameter(materialSID, 0);\n  float rot = iblParameter.w + 3.1415;\n  mat3 rotEnvMatrix = mat3(cos(rot), 0.0, -sin(rot), 0.0, 1.0, 0.0, sin(rot), 0.0, cos(rot));\n  vec3 normal_forEnv = rotEnvMatrix * normal_inWorld;\n\n  if (abs(length(v_tangent_inWorld)) > 0.01) {\n    vec4 normalTextureTransform = get_normalTextureTransform(materialSID, 0);\n    float normalTextureRotation = get_normalTextureRotation(materialSID, 0);\n    vec2 normalTexUv = uvTransform(normalTextureTransform.xy, normalTextureTransform.zw, normalTextureRotation, v_texcoord);\n    vec3 normal = texture2D(u_normalTexture, normalTexUv).xyz*2.0 - 1.0;\n    vec3 tangent_inWorld = normalize(v_tangent_inWorld);\n    vec3 binormal_inWorld = normalize(v_binormal_inWorld);\n    normal_inWorld = normalize(normal_inWorld);\n\n    mat3 tbnMat_tangent_to_world = mat3(\n      tangent_inWorld.x, tangent_inWorld.y, tangent_inWorld.z,\n      binormal_inWorld.x, binormal_inWorld.y, binormal_inWorld.z,\n      normal_inWorld.x, normal_inWorld.y, normal_inWorld.z\n    );\n\n    normal = normalize(tbnMat_tangent_to_world * normal);\n    normal_inWorld = normal;\n  }\n\n\n\n  // BaseColorFactor\n  vec3 baseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  vec4 baseColorFactor = get_baseColorFactor(materialSID, 0);\n  if (v_color != baseColor && baseColorFactor.rgb != baseColor) {\n    baseColor = v_color * baseColorFactor.rgb;\n    alpha = baseColorFactor.a;\n  } else if (v_color == baseColor) {\n    baseColor = baseColorFactor.rgb;\n    alpha = baseColorFactor.a;\n  } else if (baseColorFactor.rgb == baseColor) {\n    baseColor = v_color;\n  } else {\n    baseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n\n  // BaseColor (take account for BaseColorTexture)\n  vec4 baseColorTextureTransform = get_baseColorTextureTransform(materialSID, 0);\n  float baseColorTextureRotation = get_baseColorTextureRotation(materialSID, 0);\n  vec2 baseColorTexUv = uvTransform(baseColorTextureTransform.xy, baseColorTextureTransform.zw, baseColorTextureRotation, v_texcoord);\nvec4 textureColor = texture2D(u_baseColorTexture, baseColorTexUv);\n  baseColor *= srgbToLinear(textureColor.rgb);\n  alpha *= textureColor.a;\n\n  if (alpha < 0.01) {\n    discard;\n  }\n\n  // Metallic & Roughness\n  vec2 metallicRoughnessFactor = get_metallicRoughnessFactor(materialSID, 0);\n  float userRoughness = metallicRoughnessFactor.y;\n  float metallic = metallicRoughnessFactor.x;\n\n  vec4 metallicRoughnessTextureTransform = get_metallicRoughnessTextureTransform(materialSID, 0);\n  float metallicRoughnessTextureRotation = get_metallicRoughnessTextureRotation(materialSID, 0);\n  vec2 metallicRoughnessTexUv = uvTransform(metallicRoughnessTextureTransform.xy, metallicRoughnessTextureTransform.zw, metallicRoughnessTextureRotation, v_texcoord);\n  vec4 ormTexel = texture2D(u_metallicRoughnessTexture, metallicRoughnessTexUv);\n  userRoughness = ormTexel.g * userRoughness;\n  metallic = ormTexel.b * metallic;\n\n  userRoughness = clamp(userRoughness, c_MinRoughness, 1.0);\n  metallic = clamp(metallic, 0.0, 1.0);\n  float alphaRoughness = userRoughness * userRoughness;\n\n  // F0\n  vec3 diffuseMatAverageF0 = vec3(0.04);\n  vec3 F0 = mix(diffuseMatAverageF0, baseColor.rgb, metallic);\n\n  // Albedo\n  vec3 albedo = baseColor.rgb * (vec3(1.0) - diffuseMatAverageF0);\n  albedo.rgb *= (1.0 - metallic);\n\n  // ViewDirection\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  vec3 viewPosition = get_viewPosition(cameraSID, 0);\n  vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n\n  // NV\n  float NV = clamp(abs(dot(normal_inWorld, viewDirection)), 0.0, 1.0);\n\n  rt0 = vec4(0.0, 0.0, 0.0, alpha);\n\n  // Lighting\n  if (length(normal_inWorld) > 0.02) {\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      // Light\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float lightType = gotLightPosition.w;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition.xyz - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(lightDirection, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n      //diffuse += 1.0 * max(0.0, dot(normal_inWorld, lightDirection)) * spotEffect * lightIntensity.xyz;\n\n      // IncidentLight\n      vec3 incidentLight = spotEffect * lightIntensity.xyz;\n      incidentLight *= M_PI;\n\n      // Fresnel\n      vec3 halfVector = normalize(lightDirection + viewDirection);\n      float VH = clamp(dot(viewDirection, halfVector), 0.0, 1.0);\n      vec3 F = fresnel(F0, VH);\n\n      // Diffuse\n      vec3 diffuseContrib = (vec3(1.0) - F) * diffuse_brdf(albedo);\n\n      // Specular\n      float NL = clamp(dot(normal_inWorld, lightDirection), 0.0, 1.0);\n      float NH = clamp(dot(normal_inWorld, halfVector), 0.0, 1.0);\n      vec3 specularContrib = cook_torrance_specular_brdf(NH, NL, NV, F, alphaRoughness);\n      vec3 diffuseAndSpecular = (diffuseContrib + specularContrib) * vec3(NL) * incidentLight.rgb;\n\n      rt0.xyz += diffuseAndSpecular;\n//      rt0.xyz += specularContrib * vec3(NL) * incidentLight.rgb;\n  //    rt0.xyz += diffuseContrib * vec3(NL) * incidentLight.rgb;\n  //    rt0.xyz += (vec3(1.0) - F) * diffuse_brdf(albedo);//diffuseContrib;//vec3(NL) * incidentLight.rgb;\n    }\n\n    vec3 reflection = rotEnvMatrix * reflect(-viewDirection, normal_inWorld);\n\n    vec3 F = fresnel(F0, NV);\n    vec3 ibl = IBLContribution(materialSID, normal_forEnv, NV, reflection, albedo, F0, userRoughness, F);\n    float occlusion = texture2D(u_occlusionTexture, v_texcoord).r;\n\n    // Occlution to Indirect Lights\n    rt0.xyz += ibl * occlusion;\n\n  } else {\n    rt0 = vec4(baseColor, alpha);\n  }\n\n  // Emissive\n  vec3 emissive = srgbToLinear(texture2D(u_emissiveTexture, v_texcoord).xyz);\n\n  rt0.xyz += emissive;\n\n  bool isOutputHDR = get_isOutputHDR(materialSID, 0);\n  if(isOutputHDR){\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n    return;\n  }\n\n\n\n  // Wireframe\n  float threshold = 0.001;\n  vec3 wireframe = get_wireframe(materialSID, 0);\n  float wireframeWidthInner = wireframe.z;\n  float wireframeWidthRelativeScale = 1.0;\n  if (wireframe.x > 0.5 && wireframe.y < 0.5) {\n    rt0.a = 0.0;\n  }\n  vec4 wireframeResult = rt0;\n  vec4 wireframeColor = vec4(0.2, 0.75, 0.0, 1.0);\n  float edgeRatio = edge_ratio(v_baryCentricCoord, wireframeWidthInner, wireframeWidthRelativeScale);\n  float edgeRatioModified = mix(step(threshold, edgeRatio), clamp(edgeRatio*4.0, 0.0, 1.0), wireframeWidthInner / wireframeWidthRelativeScale/4.0);\n  // if r0.a is 0.0, it is wireframe not on shaded\n  wireframeResult.rgb = wireframeColor.rgb * edgeRatioModified + rt0.rgb * (1.0 - edgeRatioModified);\n  wireframeResult.a = max(rt0.a, wireframeColor.a * mix(edgeRatioModified, pow(edgeRatioModified, 100.0), wireframeWidthInner / wireframeWidthRelativeScale/1.0));\n\n  if (wireframe.x > 0.5) {\n    rt0 = wireframeResult;\n    if (wireframe.y < 0.5 && rt0.a == 0.0) {\n      discard;\n    }\n  }\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n',shaderStage:"fragment",isFragmentShader:!0};class ce extends o.Z{constructor({isMorphing:e,isSkinning:t,isLighting:n}){super(null,"pbrShading"+(e?"+morphing":"")+(t?"+skinning":"")+(n?"":"-lighting"),{isMorphing:e,isSkinning:t,isLighting:n},se.Z,le);const a=[{semantic:d.f.BaseColorFactor,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:2,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:f.ZP.fromCopyArray([1,1,1,1])},{semantic:d.f.BaseColorTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:[0,o.Z.__dummyWhiteTexture]},{semantic:d.f.MetallicRoughnessFactor,compositionType:_.d.Vec2,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:2,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:v.ZP.fromCopyArray2([1,1])},{semantic:d.f.MetallicRoughnessTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:[1,o.Z.__dummyWhiteTexture]},{semantic:d.f.NormalTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:[2,o.Z.__dummyBlueTexture]},{semantic:d.f.OcclusionTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:[3,o.Z.__dummyWhiteTexture]},{semantic:d.f.EmissiveTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:[4,o.Z.__dummyBlackTexture]},{semantic:ce.pbrKelemenSzirmayKalosBrdfLutTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:[8,o.Z.__dummyPbrKelemenSzirmayKalosBrdfLutTexture]},{semantic:d.f.Wireframe,compositionType:_.d.Vec3,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:10,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:x.ZP.fromCopyArray([0,0,1])},{semantic:ce.IsOutputHDR,compositionType:_.d.Scalar,componentType:c.r.Bool,stage:u.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:h.ZP.fromCopyNumber(0)},{semantic:d.f.IBLParameter,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,initialValue:f.ZP.fromCopyArray([1,1,1,1]),updateInterval:m.a.FirstTimeOnly},{semantic:d.f.HDRIFormat,compositionType:_.d.Vec2,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:5,isSystem:!0,updateInterval:m.a.FirstTimeOnly,initialValue:v.ZP.fromCopyArray2([0,0])},{semantic:d.f.DiffuseEnvTexture,compositionType:_.d.TextureCube,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInterval:m.a.FirstTimeOnly,initialValue:[5,o.Z.__dummyWhiteTexture]},{semantic:d.f.SpecularEnvTexture,compositionType:_.d.TextureCube,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInterval:m.a.FirstTimeOnly,initialValue:[6,o.Z.__dummyWhiteTexture]},{semantic:ce.baseColorTextureTransform,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-10,max:10,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:f.ZP.fromCopyArray([1,1,0,0])},{semantic:ce.baseColorTextureRotation,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:h.ZP.fromCopyNumber(0)},{semantic:ce.normalTextureTransform,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-10,max:10,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:f.ZP.fromCopyArray([1,1,0,0])},{semantic:ce.normalTextureRotation,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:h.ZP.fromCopyNumber(0)},{semantic:ce.metallicRoughnessTextureTransform,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-10,max:10,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:f.ZP.fromCopyArray([1,1,0,0])},{semantic:ce.metallicRoughnessTextureRotation,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,updateInterval:m.a.FirstTimeOnly,initialValue:h.ZP.fromCopyNumber(0)}];a.push({semantic:d.f.PointSize,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.VertexShader,isSystem:!1,updateInterval:m.a.FirstTimeOnly,soloDatum:!0,initialValue:h.ZP.fromCopyNumber(100),min:0,max:100},{semantic:d.f.PointDistanceAttenuation,compositionType:_.d.Vec3,componentType:c.r.Float,stage:u.H.VertexShader,isSystem:!1,updateInterval:m.a.FirstTimeOnly,soloDatum:!0,initialValue:x.ZP.fromCopyArray([0,.1,.01]),min:0,max:1}),n&&(this.__definitions+="#define RN_IS_LIGHTING\n"),t&&(this.__definitions+="#define RN_IS_SKINNING\n"),e&&(this.__definitions+="#define RN_IS_MORPHING\n",a.push({semantic:d.f.MorphTargetNumber,componentType:c.r.Int,compositionType:_.d.Scalar,stage:u.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:h.ZP.fromCopyNumber(0),min:0,max:i.Z.maxVertexMorphNumberInShader,needUniformInFastest:!0},{semantic:d.f.DataTextureMorphOffsetPosition,componentType:c.r.Int,compositionType:_.d.ScalarArray,maxIndex:i.Z.maxVertexMorphNumberInShader,stage:u.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new z.Z(new Int32Array(i.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0},{semantic:d.f.MorphWeights,componentType:c.r.Float,compositionType:_.d.ScalarArray,maxIndex:i.Z.maxVertexMorphNumberInShader,stage:u.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new z.Z(new Float32Array(i.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0})),this.setShaderSemanticsInfoArray(a)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){if(i.setUniform){if(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix),n){let n=i.renderPass.cameraComponent;null==n&&(n=l.Z.getInstance().getComponent(s.Z,s.Z.main)),this.setViewInfo(t,n,i.isVr,i.displayIdx),this.setProjection(t,n,i.isVr,i.displayIdx),this.setLightsInfo(t,i.lightComponents,e,i.setUniform)}const a=i.entity.getSkeletal();this.setSkinning(t,a,i.setUniform)}if(i.diffuseCube&&i.diffuseCube.isTextureReady?this.__webglResourceRepository.setUniformValue(t,d.f.DiffuseEnvTexture.str,n,[5,i.diffuseCube]):this.__webglResourceRepository.setUniformValue(t,d.f.DiffuseEnvTexture.str,n,[5,o.Z.__dummyBlackCubeTexture]),i.specularCube&&i.specularCube.isTextureReady?this.__webglResourceRepository.setUniformValue(t,d.f.SpecularEnvTexture.str,n,[6,i.specularCube]):this.__webglResourceRepository.setUniformValue(t,d.f.SpecularEnvTexture.str,n,[6,o.Z.__dummyBlackCubeTexture]),i.setUniform){if(n){const{mipmapLevelNumber:e,meshRenderComponent:a,diffuseHdriType:r,specularHdriType:o}=this.setupHdriParameters(i);this.__webglResourceRepository.setUniformValue(t,d.f.IBLParameter.str,n,{x:e,y:a.diffuseCubeMapContribution,z:a.specularCubeMapContribution,w:a.rotationOfCubeMap}),this.__webglResourceRepository.setUniformValue(t,d.f.HDRIFormat.str,n,{x:r,y:o})}}else{const{mipmapLevelNumber:t,meshRenderComponent:n,diffuseHdriType:a,specularHdriType:r}=this.setupHdriParameters(i),s=o.Z.__tmp_vector4;s.x=t,s.y=n.diffuseCubeMapContribution,s.z=n.specularCubeMapContribution,s.w=n.rotationOfCubeMap,e.setParameter(d.f.IBLParameter,s);const l=o.Z.__tmp_vector2;l.x=a,l.y=r,e.setParameter(d.f.HDRIFormat,l)}this.setMorphInfo(t,i.entity.getComponent(W.Z),i.entity.getComponent(L.Z),i.primitive)}setupHdriParameters(e){let t=1;e.specularCube&&(t=e.specularCube.mipmapLevelNumber);const n=e.entity.getMeshRenderer();let i=k.c.LDR_SRGB.index,a=k.c.LDR_SRGB.index;return n.diffuseCubeMap&&(i=n.diffuseCubeMap.hdriFormat.index),n.specularCubeMap&&(a=n.specularCubeMap.hdriFormat.index),{mipmapLevelNumber:t,meshRenderComponent:n,diffuseHdriType:i,specularHdriType:a}}}ce.__pbrCookTorranceBrdfLutDataUrlUid=V.Z.InvalidCGAPIResourceUid,ce.IsOutputHDR=new d.w({str:"isOutputHDR"}),ce.baseColorTextureTransform=new d.w({str:"baseColorTextureTransform"}),ce.baseColorTextureRotation=new d.w({str:"baseColorTextureRotation"}),ce.normalTextureTransform=new d.w({str:"normalTextureTransform"}),ce.normalTextureRotation=new d.w({str:"normalTextureRotation"}),ce.metallicRoughnessTextureTransform=new d.w({str:"metallicRoughnessTextureTransform"}),ce.metallicRoughnessTextureRotation=new d.w({str:"metallicRoughnessTextureRotation"}),ce.pbrKelemenSzirmayKalosBrdfLutTexture=new d.w({str:"brdfLutTexture"});var _e=n(5850);const he={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\nin vec4 a_tangent;\nin float a_instanceID;\nin vec2 a_texcoord;\nin vec4 a_joint;\nin vec4 a_weight;\nin vec3 a_baryCentricCoord;\nout vec3 v_color;\nout vec3 v_normal_inWorld;\nout vec3 v_tangent_inWorld;\nout vec3 v_binormal_inWorld;\nout vec4 v_position_inWorld;\nout vec2 v_texcoord;\nout vec3 v_baryCentricCoord;\nout vec3 v_normal_inView;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  v_color = a_color;\n\n  bool isSkinning = false;\n  isSkinning = processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n  v_texcoord = a_texcoord;\n\n  if (abs(length(a_normal)) > 0.01) {\n    // if normal exist\n    vec3 tangent_inWorld = normalMatrix * a_tangent.xyz;\n    v_binormal_inWorld = cross(v_normal_inWorld, tangent_inWorld) * a_tangent.w;\n    v_tangent_inWorld = cross(v_binormal_inWorld, v_normal_inWorld);\n  }\n  v_baryCentricCoord = a_baryCentricCoord;\n\n\n//  v_color = vec3(u_boneMatrices[int(a_joint.x)][1].xyz);\n\n  mat3 viewMat = mat3(viewMatrix);\n  vec3 result = viewMat * v_normal_inWorld;\n  v_normal_inView = result.rgb;\n}\n",shaderStage:"vertex",isFragmentShader:!1},de={code:'\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\n#define PI 3.141592\n\nin vec3 v_color;\nin vec3 v_normal_inWorld;\nin vec3 v_normal_inView;\nin vec3 v_tangent_inWorld;\nin vec3 v_binormal_inWorld;\nin vec4 v_position_inWorld;\nin vec2 v_texcoord;\nin vec3 v_baryCentricCoord;\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n\nvec2 hash(ivec2 p) {\n    return fract(sin(vec2(p) * mat2(127.1, 311.7, 269.5, 183.3))*43758.5453123);\n}\n\n// Decorrelated color space vectors and origin\nvec3 returnToOriginalColorSpace(\n  vec3 color,\n  vec3 colorSpaceOrigin,\n  vec3 colorSpaceVector1,\n  vec3 colorSpaceVector2,\n  vec3 colorSpaceVector3)\n{\n  vec3 result =\n    colorSpaceOrigin +\n    colorSpaceVector1 * color.r +\n    colorSpaceVector2 * color.g +\n    colorSpaceVector3 * color.b;\n  return result;\n}\n\nvoid triangleGrid(\n  vec2 uv,\n  out float w1, out float w2, out float w3,\n  out ivec2 vertex1, out ivec2 vertex2, out ivec2 vertex3)\n{\n  // Scaling of the input\n  uv *= 3.464; // 2 * sqrt(3)\n\n  // Skew input space into simplex triangle grid\n  const mat2 gridToSkewedGrid = mat2(1.0, 0.0, -0.57735027, 1.15470054);\n  vec2 skewedCoord = gridToSkewedGrid * uv;\n\n  // Compute local triangle vertex IDs and local barycentric coordinates\n  ivec2 baseId = ivec2(floor(skewedCoord));\n  vec3 temp = vec3(fract(skewedCoord), 0);\n  temp.z = 1.0 - temp.x - temp.y;\n  if (temp.z > 0.0)\n  {\n    w1 = temp.z;\n    w2 = temp.y;\n    w3 = temp.x;\n    vertex1 = baseId;\n    vertex2 = baseId + ivec2(0, 1);\n    vertex3 = baseId + ivec2(1, 0);\n  }\n  else\n  {\n    w1 = -temp.z;\n    w2 = 1.0 - temp.y;\n    w3 = 1.0 - temp.x;\n    vertex1 = baseId + ivec2(1, 1);\n    vertex2 = baseId + ivec2(1, 0);\n    vertex3 = baseId + ivec2(0, 1);\n  }\n}\n\n// https://stackoverflow.com/questions/24388346/how-to-access-automatic-mipmap-level-in-glsl-fragment-shader-texture\nfloat mipmapLevel(in vec2 uv_as_texel)\n{\n  vec2  dx_vtc        = dFdx(uv_as_texel);\n  vec2  dy_vtc        = dFdy(uv_as_texel);\n  float delta_max_sqr = max(dot(dx_vtc, dx_vtc), dot(dy_vtc, dy_vtc));\n  float mml = 0.5 * log2(delta_max_sqr);\n  return max( 0.0, mml );\n}\n\n// By-Example procedural noise at uv\nvec3 byExampleProceduralNoise(highp sampler2D Tinput, highp sampler2D Tinv, vec2 uv,\n  vec3 colorSpaceOrigin,\n  vec3 colorSpaceVector1,\n  vec3 colorSpaceVector2,\n  vec3 colorSpaceVector3)\n{\n\t// Get triangle info\n\tfloat w1, w2, w3;\n\tivec2 vertex1, vertex2, vertex3;\n\ttriangleGrid(uv, w1, w2, w3, vertex1, vertex2, vertex3);\n\n\t// Assign random offset to each triangle vertex\n\tvec2 uv1 = uv + hash(vertex1);\n\tvec2 uv2 = uv + hash(vertex2);\n\tvec2 uv3 = uv + hash(vertex3);\n\n\t// Precompute UV derivatives\n\tvec2 duvdx = dFdx(uv);\n\tvec2 duvdy = dFdy(uv);\n\n\t// Fetch Gaussian input\n  // \'textureGrad\' is webGL2 only\n\tvec3 G1 = textureGrad(Tinput, uv1, duvdx, duvdy).rgb;\n\tvec3 G2 = textureGrad(Tinput, uv2, duvdx, duvdy).rgb;\n\tvec3 G3 = textureGrad(Tinput, uv3, duvdx, duvdy).rgb;\n\n\t// Variance-preserving blending\n\tvec3 G = w1*G1 + w2*G2 + w3*G3;\n\tG = G - vec3(0.5);\n\tG = G * inversesqrt(w1*w1 + w2*w2 + w3*w3);\n\tG = G + vec3(0.5);\n\n\t// Compute LOD level to fetch the prefiltered look-up table invT\n\tfloat LOD = mipmapLevel(uv * vec2(textureSize(Tinput, 0))) / float(textureSize(Tinv, 0).y);\n\n\t// Fetch prefiltered LUT (T^{-1})\n\tvec3 color;\n\tcolor.r\t= texture(Tinv, vec2(G.r, LOD)).r;\n\tcolor.g\t= texture(Tinv, vec2(G.g, LOD)).g;\n\tcolor.b\t= texture(Tinv, vec2(G.b, LOD)).b;\n\n\t// Original color space\n\tvec3 outColor = returnToOriginalColorSpace(color,\n      colorSpaceOrigin,\n      colorSpaceVector1,\n      colorSpaceVector2,\n      colorSpaceVector3\n    );\n\n\treturn outColor;\n}\n\n\nvec4 texture2DSeamless(highp sampler2D Tinput, highp sampler2D Tinv, vec2 uv,\n  vec3 colorSpaceOrigin,\n  vec3 colorSpaceVector1,\n  vec3 colorSpaceVector2,\n  vec3 colorSpaceVector3,\n  vec4 scaleTranslate) {\n  vec4 color = vec4(byExampleProceduralNoise(Tinput, Tinv,\n      uv * scaleTranslate.xy + scaleTranslate.zw,\n      colorSpaceOrigin,\n      colorSpaceVector1,\n      colorSpaceVector2,\n      colorSpaceVector3\n    ),\n    1);\n  return color;\n}\n\n\n/* shaderity: @{getters} */\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nfloat angular_n_h(float NH) {\n  return acos(NH);\n}\n\nfloat sqr(float x) {\n  return x*x;\n}\n\nfloat d_phong(float NH, float c1) {\n  return pow(\n    cos(acos(NH))\n    , c1\n  );\n}\n\n// this is from https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec3 envBRDFApprox( vec3 F0, float Roughness, float NoV ) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022 );\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04 );\n  vec4 r = Roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n  return F0 * AB.x + AB.y;\n}\n\n// GGX NDF\nfloat d_ggx(float NH, float alphaRoughness) {\n  float roughnessSqr = alphaRoughness * alphaRoughness;\n  float f = (roughnessSqr - 1.0) * NH * NH + 1.0;\n  return roughnessSqr / (M_PI * f * f);\n}\n\nfloat d_torrance_reiz(float NH, float c3) {\n  float CosSquared = NH*NH;\n  float TanSquared = (1.0 - CosSquared)/CosSquared;\n  //return (1.0/M_PI) * sqr(c3/(CosSquared * (c3*c3 + TanSquared)));  // gamma = 2, aka GGX\n  return (1.0/sqrt(M_PI)) * (sqr(c3)/(CosSquared * (c3*c3 + TanSquared))); // gamma = 1, D_Berry\n}\n\nfloat d_beckmann(float NH, float m) {\n  float co = 1.0 / (4.0 * m * m * NH * NH * NH * NH);\n  float expx = exp((NH * NH - 1.0) / (m * m * NH * NH));\n  return co * expx;\n}\n\n// the same as glTF WebGL sample\n// https://github.com/KhronosGroup/glTF-WebGL-PBR/blob/88eda8c5358efe03128b72b6c5f5f6e5b6d023e1/shaders/pbr-frag.glsl#L188\n// That is, Unreal Engine based approach, but modified to use alphaRoughness (squared artist\'s roughness parameter),\n// and based on \'Separable Masking and Shadowing\' approximation (propesed by Christophe Schlick)\n// https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\nfloat g_shielding(float NL, float NV, float alphaRoughness) {\n  float r = alphaRoughness;\n\n  // Local Shadowing using "Schlick-Smith" Masking Function\n  float localShadowing = 2.0 * NL / (NL + sqrt(r * r + (1.0 - r * r) * (NL * NL)));\n\n  // Local Masking using "Schlick-Smith" Masking Function\n  float localMasking = 2.0 * NV / (NV + sqrt(r * r + (1.0 - r * r) * (NV * NV)));\n\n  return localShadowing * localMasking;\n}\n\n// The code from https://google.github.io/filament/Filament.html#listing_approximatedspecularv\n// The idea is from [Heitz14] Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs.\nfloat v_SmithGGXCorrelated(float NL, float NV, float alphaRoughness) {\n  float a2 = alphaRoughness * alphaRoughness;\n  float GGXV = NL * sqrt(NV * NV * (1.0 - a2) + a2);\n  float GGXL = NV * sqrt(NL * NL * (1.0 - a2) + a2);\n  return 0.5 / (GGXV + GGXL);\n}\n\nfloat v_SmithGGXCorrelatedFast(float NL, float NV, float alphaRoughness) {\n  float a = alphaRoughness;\n  float GGXV = NL * (NV * (1.0 - a) + a);\n  float GGXL = NV * (NL * (1.0 - a) + a);\n  return 0.5 / (GGXV + GGXL);\n}\n\n// The Schlick Approximation to Fresnel\nvec3 fresnel(vec3 f0, float VH) {\n  return vec3(f0) + (vec3(1.0) - f0) * pow(1.0 - VH, 5.0);\n}\n\nvec3 cook_torrance_specular_brdf(float NH, float NL, float NV, vec3 F, float alphaRoughness) {\n  float D = d_ggx(NH, alphaRoughness);\n  float V = v_SmithGGXCorrelated(NL, NV, alphaRoughness);\n  return vec3(D)*vec3(V)*F;\n//      float G = g_shielding(NL, NV, alphaRoughness);\n//      return vec3(D)*vec3(G)*F/vec3(4.0*NL*NV);\n\n}\n\nvec3 diffuse_brdf(vec3 albedo)\n{\n  return albedo / M_PI;\n}\n\nvec3 srgbToLinear(vec3 srgbColor) {\n  return pow(srgbColor, vec3(2.2));\n}\n\nfloat srgbToLinear(float value) {\n  return pow(value, 2.2);\n}\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\nfloat linearToSrgb(float value) {\n  return pow(value, 1.0/2.2);\n}\n\nvec3 fresnelSchlickRoughness(vec3 F0, float cosTheta, float roughness)\n{\n  return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n}\n\nvec3 normalBlendingUDN(sampler2D baseMap, sampler2D detailMap, vec2 baseUv, vec2 detailUv) {\n  vec3 t = texture2D(baseMap,   baseUv).xyz * 2.0 - 1.0;\n  vec3 u = texture2D(detailMap, detailUv).xyz * 2.0 - 1.0;\n  vec3 r = normalize(vec3(t.xy + u.xy, t.z));\n  return r;\n}\n\nvec2 uvTransform(vec2 scale, vec2 offset, float rotation, vec2 uv) {\n  mat3 translationMat = mat3(1,0,0, 0,1,0, offset.x, offset.y, 1);\n  mat3 rotationMat = mat3(\n      cos(rotation), -sin(rotation), 0,\n      sin(rotation), cos(rotation), 0,\n                  0,             0, 1\n  );\n  mat3 scaleMat = mat3(scale.x,0,0, 0,scale.y,0, 0,0,1);\n\n  mat3 matrix = translationMat * rotationMat * scaleMat;\n  vec2 uvTransformed = ( matrix * vec3(uv.xy, 1) ).xy;\n\n  return uvTransformed;\n}\n\n\nfloat d_Charlie(float alphaRoughness, float NoH) {\n  // Estevez and Kulla 2017, "Production Friendly Microfacet Sheen BRDF"\n  float invAlpha  = 1.0 / alphaRoughness;\n  float cos2h = NoH * NoH;\n  float sin2h = max(1.0 - cos2h, 0.0078125);\n  return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\n\n// https://google.github.io/filament/Filament.html#materialsystem/anisotropicmodel/anisotropicspecularbrdf\nfloat d_GGX_Anisotropic(float NoH, const vec3 h, const vec3 t, const vec3 b, float at, float ab) {\n  float ToH = dot(t, h);\n  float BoH = dot(b, h);\n  float a2 = at * ab;\n  highp vec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);\n  highp float v2 = dot(v, v);\n  float w2 = a2 / v2;\n  return a2 * w2 * w2 * (1.0 / PI);\n}\n\nfloat v_SmithGGXCorrelated_Anisotropic(float ToV, float BoV, float ToL, float BoL, float NoV, float NoL, float at, float ab) {\n  float lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\n  float lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\n  float v = 0.5 / (lambdaV + lambdaL);\n  return v;\n}\n\nfloat v_Neubelt(float NoV, float NoL) {\n  // Neubelt and Pettineo 2013, "Crafting a Next-gen Material Pipeline for The Order: 1886"\n  return 1.0 / (4.0 * (NoL + NoV - NoL * NoV));\n}\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3+vec3(1.0 - wireframeWidthInner)*d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\nvec3 baseSpecularLayer(float NH, float NL, float NV, vec3 F, vec3 l, vec3 h, vec3 v, const vec3 t, const vec3 b, float alphaRoughness, float anisotropy) {\n  float at = max(alphaRoughness * (1.0 + anisotropy), 0.001);\n  float ab = max(alphaRoughness * (1.0 - anisotropy), 0.001);\n\n  float D = d_GGX_Anisotropic(NH, h, t, b, at, ab);\n  float V = v_SmithGGXCorrelated_Anisotropic(dot(t,v), dot(b,v), dot(t,l), dot(b,l), NV, NL, at, ab);\n  return vec3(D) * vec3(V) * F;\n}\n\nvec3 clearcoatLayer(float NH, float NL, float NV, vec3 F, vec3 l, vec3 h, vec3 v, const vec3 t, const vec3 b, float alphaRoughness, float anisotropy) {\n  float at = max(alphaRoughness * (1.0 + anisotropy), 0.001);\n  float ab = max(alphaRoughness * (1.0 - anisotropy), 0.001);\n\n  float D = d_GGX_Anisotropic(NH, h, t, b, at, ab);\n  float V = v_SmithGGXCorrelated_Anisotropic(dot(t,v), dot(b,v), dot(t,l), dot(b,l), NV, NL, at, ab);\n  return vec3(D) * vec3(V) * F;\n}\n\nvec3 sheenLayer(float NH, float NL, float NV, vec3 F, float alphaRoughness) {\n  float D = d_Charlie(alphaRoughness, NH);\n  float V = v_Neubelt(NV, NL);\n\n  vec3 specular = vec3(D) * vec3(V) * F;\n  return specular;\n}\n\nvec3 baseSpecularLayerWithoutD(float NH, float NL, float NV, vec3 F, vec3 l, vec3 h, vec3 v, const vec3 t, const vec3 b, float alphaRoughness, float anisotropy) {\n  float at = max(alphaRoughness * (1.0 + anisotropy), 0.001);\n  float ab = max(alphaRoughness * (1.0 - anisotropy), 0.001);\n\n  float V = v_SmithGGXCorrelated_Anisotropic(dot(t,v), dot(b,v), dot(t,l), dot(b,l), NV, NL, at, ab);\n  return vec3(V) * F;\n}\n\nvec3 clearcoatLayerWithoutD(float NH, float NL, float NV, vec3 F, vec3 l, vec3 h, vec3 v, const vec3 t, const vec3 b, float alphaRoughness, float anisotropy) {\n  float at = max(alphaRoughness * (1.0 + anisotropy), 0.001);\n  float ab = max(alphaRoughness * (1.0 - anisotropy), 0.001);\n\n  float V = v_SmithGGXCorrelated_Anisotropic(dot(t,v), dot(b,v), dot(t,l), dot(b,l), NV, NL, at, ab);\n  return vec3(V) * F;\n}\n\nvec3 sheenLayerWithoutD(float NH, float NL, float NV, vec3 F, float alphaRoughness) {\n  float V = v_Neubelt(NV, NL);\n\n  vec3 specular = vec3(V) * F;\n  return specular;\n}\n\nvec3 surfaceShading(float materialSID, float NH, float NL, float NV, float VH, vec3 F0, vec3 lightDirection, vec3 halfVector, vec3 viewDirection, const vec3 t, const vec3 b, vec3 albedo, vec3 incidentLight,\n  float alphaRoughness, float clearcoatRoughness, float clearcoatFactor, float baseAnisotropy, float clearcoatAnisotropy) {\n\n  // Fresnel\n  vec3 F_diffuse = fresnel(F0, NL);\n  vec3 F_specular = fresnel(F0, VH);\n  vec3 F_clearcoat = fresnel(vec3(0.04), VH) * clearcoatFactor;\n  vec3 sheenColor = get_sheenParameter(materialSID, 0);\n  vec3 F_sheen = sheenColor;\n\n  // Diffuse\n  vec3 diffuseContrib = (vec3(1.0) - F_diffuse) * diffuse_brdf(albedo);\n\n  float clearcoatAlphaRoughness = clearcoatRoughness * clearcoatRoughness;\n  vec3 baseSpecularContrib = baseSpecularLayer(NH, NL, NV, F_specular, lightDirection, halfVector, viewDirection, t, b, alphaRoughness, baseAnisotropy);\n  vec3 clearcoatContrib = clearcoatLayer(NH, NL, NV, F_clearcoat, lightDirection, halfVector, viewDirection, t, b, clearcoatAlphaRoughness, clearcoatAnisotropy);\n  vec3 sheenContrib = sheenLayer(NH, NL, NV, F_sheen, alphaRoughness);\n\n  vec3 diffuseAndBaseSpecular = diffuseContrib + baseSpecularContrib;\n  vec3 diffuse_baseSpecular_clearcoat = diffuseAndBaseSpecular * (1.0 - F_clearcoat) + clearcoatContrib;\n  vec3 diffuse_baseSpecular_clearcoat_sheen = diffuse_baseSpecular_clearcoat * (1.0 - F_sheen) + sheenContrib;\n  vec3 totalContrib = diffuse_baseSpecular_clearcoat_sheen * vec3(NL) * incidentLight.rgb;\n\n  return totalContrib;\n  // return baseSpecularContrib * vec3(NL) * incidentLight.rgb;\n}\n\nvec3 surfaceShadingIBL(float NH, float NL, float NV, float VH, vec3 F0, vec3 lightDirection, vec3 halfVector, vec3 viewDirection, const vec3 t, const vec3 b, vec3 albedo, vec3 diffuseLight, vec3 specularLight,\n  float alphaRoughness, float clearcoatRoughness, float clearcoatFactor, float baseAnisotropy, float clearcoatAnisotropy) {\n\n  // Fresnel\n  vec3 F_diffuse = fresnel(F0, NL);\n  vec3 F_specular = fresnel(F0, VH);\n  vec3 F_clearcoat = fresnel(vec3(0.04), VH) * clearcoatFactor;\n  vec3 F_sheen = vec3(0.04);\n\n  // Diffuse\n  // vec3 diffuseContrib = (vec3(1.0) - F_diffuse) * diffuse_brdf(albedo);\n  vec3 diffuseContrib = diffuse_brdf(albedo);\n\n  float clearcoatAlphaRoughness = clearcoatRoughness * clearcoatRoughness;\n  vec3 baseSpecularContrib = baseSpecularLayer(NH, NL, NV, F_specular, lightDirection, halfVector, viewDirection, t, b, alphaRoughness, baseAnisotropy);\n  vec3 clearcoatContrib = clearcoatLayer(NH, NL, NV, F_clearcoat, lightDirection, halfVector, viewDirection, t, b, clearcoatAlphaRoughness, clearcoatAnisotropy);\n  vec3 sheenContrib = sheenLayer(NH, NL, NV, F_sheen, alphaRoughness);\n\n  vec3 diffuse = diffuseContrib * diffuseLight; // Note that NoL is 1.0 because light direction is geometry normal in diffuse IBL\n  vec3 specularLightCos = specularLight;\n  vec3 baseSpecular = baseSpecularContrib * specularLightCos;\n  vec3 clearcoat = clearcoatContrib * specularLightCos;\n  vec3 sheen = sheenContrib * specularLightCos;\n\n  // vec3 diffuseAndBaseSpecular = diffuse + baseSpecular;\n  vec3 diffuse_baseSpecular_clearcoat = (diffuse + baseSpecular * (1.0 - F_clearcoat)) * (1.0 - F_clearcoat) + clearcoat;\n  vec3 diffuse_baseSpecular_clearcoat_sheen = diffuse_baseSpecular_clearcoat * (1.0) + sheen;\n  vec3 totalContrib = diffuse_baseSpecular_clearcoat_sheen;\n\n  return totalContrib;\n  // return baseSpecular;\n}\n\nvec3 getReflectedVector(const vec3 v, const vec3 n, float anisotropy, vec3 t, vec3 b, float userRoughness) {\n  vec3  anisotropyDirection = anisotropy >= 0.0 ? b : t;\n  vec3  anisotropyDirectionPerp = anisotropy <= 0.0 ? b : t;\n  vec3  anisotropicTangent  = cross(anisotropyDirection, v);\n  vec3  anisotropicTangentPerp  = cross(anisotropyDirectionPerp, v);\n  vec3  anisotropicNormal   = cross(anisotropicTangent, anisotropyDirection);\n  vec3  anisotropicNormalPerp   = cross(anisotropicTangentPerp, anisotropyDirectionPerp);\n  float bendFactor          = abs(anisotropy) * clamp(5.0 * userRoughness, 0.0, 1.0);\n  vec3  bentNormal          = normalize(mix(n, anisotropicNormal, bendFactor));\n  bentNormal          = normalize(mix(bentNormal, anisotropicNormalPerp, -bendFactor));\n\n  vec3 r = reflect(-v, bentNormal);\n\n  return r;\n}\n\n/*\nvec3 IBLContribution2(vec3 n, vec3 reflection, float NV, vec3 F0, vec3 viewDirection, const vec3 t, const vec3 b, vec3 albedo,\n  float userRoughness, float alphaRoughness, float clearcoatRoughness, float clearcoatFactor, float baseAnisotropy, float clearcoatAnisotropy)\n{\n  vec4 iblParameter = get_iblParameter(materialSID, 0);\n  float mipCount = iblParameter.x;\n  float lod = userRoughness * (mipCount - 1.0);\n\n  vec3 brdf = texture2D(u_brdfLutTexture, vec2(NV, 1.0 - userRoughness)).rgb;\n  vec4 diffuseTexel = textureCube(u_diffuseEnvTexture, n);\n  vec3 diffuseLight;\n\n  ivec2 hdriFormat = get_hdriFormat(materialSID, 0);\n\n  if (hdriFormat.x == 0) { // LDR_SRGB\n    diffuseLight = srgbToLinear(diffuseTexel.rgb);\n  } else if (hdriFormat.x == 3) { // RGBE\n    diffuseLight = diffuseTexel.rgb * pow(2.0, diffuseTexel.a*255.0-128.0);\n  } else {\n    diffuseLight = diffuseTexel.rgb;\n  }\n\n  vec3 specularLightDir = mix(reflection, n, lod/(mipCount - 1.0));\nreflection.x *= -1.0;\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n  vec4 specularTexel = textureCubeLodEXT(u_specularEnvTexture, reflection, lod);\n#elif defined(GLSL_ES3)\n  vec4 specularTexel = textureLod(u_specularEnvTexture, reflection, lod);\n#else\n  vec4 specularTexel = textureCube(u_specularEnvTexture, reflection);\n#endif\n\n\n  vec3 specularLight;\n  if (hdriFormat.y == 0) { // LDR_SRGB\n    specularLight = srgbToLinear(specularTexel.rgb);\n  } else if (hdriFormat.y == 3) { // RGBE\n    specularLight = specularTexel.rgb * pow(2.0, specularTexel.a*255.0-128.0);\n  } else {\n    specularLight = specularTexel.rgb;\n  }\n\n  vec3 halfVector = normalize(specularLightDir + viewDirection);\n//  float LH = clamp(dot(specularLightDir, halfVector), 0.0, 1.0);\n  float NL = clamp(dot(n, specularLightDir), 0.0, 1.0);\n  float NH = clamp(dot(n, halfVector), 0.0, 1.0);\n  float VH = clamp(dot(viewDirection, halfVector), 0.0, 1.0);\n\n  vec3 totalContrib = surfaceShadingIBL(NH, NL, NV, VH, F0, specularLightDir, halfVector, viewDirection, t, b, albedo, diffuseLight, specularLight,\n    alphaRoughness, clearcoatRoughness, clearcoatFactor, baseAnisotropy, clearcoatAnisotropy);\n\n  return totalContrib;\n}\n*/\n\nvec3 prefilteredRadiance(float materialSID, vec3 v, vec3 n, float NV, float anisotropy, vec3 t, vec3 b, float userRoughness, vec3 F0) {\n  vec4 iblParameter = get_iblParameter(materialSID, 0);\n  float mipCount = iblParameter.x;\n  float lod = (userRoughness * mipCount);\n\n  vec3 reflectedVecAnisotropy = getReflectedVector(v, n, anisotropy, t, b, userRoughness);\n  vec3 specularLightDir = mix(reflectedVecAnisotropy, n, lod/(mipCount - 1.0));\n\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n  vec4 specularTexel = textureCubeLodEXT(u_specularEnvTexture, specularLightDir, lod);\n#elif defined(GLSL_ES3)\n  vec4 specularTexel = textureLod(u_specularEnvTexture, specularLightDir, lod);\n#else\n  float specularCubeSize = pow(2.0, mipCount - 1.0);\n  float emulatedLod = mipmapLevel((specularLightDir) * specularCubeSize);\n  vec4 specularTexel = textureCube(u_specularEnvTexture, specularLightDir, lod - emulatedLod);\n#endif\n\n  vec3 specularLight;\n  ivec2 hdriFormat = get_hdriFormat(materialSID, 0);\n  if (hdriFormat.y == 0) { // LDR_SRGB\n    specularLight = srgbToLinear(specularTexel.rgb);\n  } else if (hdriFormat.y == 3) { // RGBE\n    specularLight = specularTexel.rgb * pow(2.0, specularTexel.a*255.0-128.0);\n  } else {\n    specularLight = specularTexel.rgb;\n  }\n\n\n  return specularLight;\n}\n\nvec3 IBLContribution(float materialSID, vec3 n, vec3 v, float NV, vec3 reflection, vec3 albedo, vec3 F0, float userRoughness, float clearcoatFactor, float clearcoatRoughness, float baseAnisotropy, float clearcoatAnisotropy, vec3 t, vec3 b)\n{\n  vec4 diffuseTexel = textureCube(u_diffuseEnvTexture, n);\n  vec3 diffuseLight;\n  ivec2 hdriFormat = get_hdriFormat(materialSID, 0);\n  if (hdriFormat.x == 0) { // LDR_SRGB\n    diffuseLight = srgbToLinear(diffuseTexel.rgb);\n  } else if (hdriFormat.x == 3) { // RGBE\n    diffuseLight = diffuseTexel.rgb * pow(2.0, diffuseTexel.a*255.0-128.0);\n  } else {\n    diffuseLight = diffuseTexel.rgb;\n  }\n\n  vec4 iblParameter = get_iblParameter(materialSID, 0);\n  vec3 diffuse = diffuseLight * albedo * iblParameter.y;\n\n  vec3 specularLight = prefilteredRadiance(materialSID, v, n, NV, baseAnisotropy, t, b, userRoughness, F0) * iblParameter.z;\n  // vec3 brdf = texture2D(u_brdfLutTexture, vec2(NV, 1.0 - userRoughness)).rgb;\n  // vec3 baseSpecular = specularLight * (F0 * brdf.x + brdf.y);\n  vec3 baseSpecular = specularLight * envBRDFApprox(F0, userRoughness, NV);\n  vec3 clearcoatSpecular = prefilteredRadiance(materialSID, v, n, NV, clearcoatAnisotropy, t, b, clearcoatRoughness, vec3(0.04));\n  // vec3 sheenSpecular = specularLight * (F0 * brdf.z);\n  vec3 sheenSpecular = specularLight * (F0 * 1.0);\n\n  vec3 sheenParameter = get_sheenParameter(materialSID, 0);\n  vec3 sheenColor = sheenParameter;\n  vec3 Fs = sheenColor;\n  vec3 Fc = fresnel(vec3(0.04), NV) * clearcoatFactor;\n  vec3 Fb = fresnel(F0, NV);\n  vec3 attenuationC = 1.0 - Fc;\n  vec3 attenuationB = 1.0 - Fb;\n\n  return ((diffuse + baseSpecular * attenuationC) * attenuationC + clearcoatSpecular * Fc) *\n    vec3(1.0) + sheenSpecular * Fs;\n\n}\n\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n  vec4 iblParameter = get_iblParameter(materialSID, 0);\n  float rot = iblParameter.w + 3.1415;\n  mat3 rotEnvMatrix = mat3(cos(rot), 0.0, -sin(rot), 0.0, 1.0, 0.0, sin(rot), 0.0, cos(rot));\n\n  vec3 tangent_inWorld = vec3(0.0);\n  vec3 binormal_inWorld = vec3(0.0);\n  vec4 normalTextureTransform = get_normalTextureTransform(materialSID, 0);\n  float normalTextureRotation = get_normalTextureRotation(materialSID, 0);\n  vec2 baseUv = uvTransform(normalTextureTransform.xy, normalTextureTransform.zw, normalTextureRotation, v_texcoord);\n  vec4 detailNormalTextureTransform = get_detailNormalTextureTransform(materialSID, 0);\n  float detailNormalTextureRotation = get_detailNormalTextureRotation(materialSID, 0);\n  vec2 detailUv = uvTransform(detailNormalTextureTransform.xy, detailNormalTextureTransform.zw, detailNormalTextureRotation, v_texcoord);\n  if (abs(length(v_tangent_inWorld)) > 0.01) {\n    vec3 normal = normalBlendingUDN(u_normalTexture, u_detailNormalTexture, baseUv, detailUv);\n    // vec3 normal = texture2D(u_normalTexture, baseUv).xyz * 2.0 - 1.0;\n    tangent_inWorld = normalize(v_tangent_inWorld);\n    binormal_inWorld = normalize(v_binormal_inWorld);\n    normal_inWorld = normalize(v_normal_inWorld);\n\n    mat3 tbnMat_tangent_to_world = mat3(\n      tangent_inWorld.x, tangent_inWorld.y, tangent_inWorld.z,\n      binormal_inWorld.x, binormal_inWorld.y, binormal_inWorld.z,\n      normal_inWorld.x, normal_inWorld.y, normal_inWorld.z\n    );\n\n    normal = normalize(tbnMat_tangent_to_world * normal);\n    normal_inWorld = normal;\n  }\n  vec3 normal_forEnv = rotEnvMatrix * normal_inWorld;\n  normal_forEnv.x *= -1.0;\n  vec3 tangent_forEnv = rotEnvMatrix * tangent_inWorld;\n  tangent_forEnv.x *= -1.0;\n  vec3 binormal_forEnv = rotEnvMatrix * binormal_inWorld;\n  binormal_forEnv.x *= -1.0;\n  if (v_normal_inView.z < 0.0) {\n    normal_forEnv = -normal_forEnv;\n    tangent_forEnv = -tangent_forEnv;\n    binormal_forEnv = -binormal_forEnv;\n  }\n\n  // BaseColorFactor\n  vec3 baseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  vec4 diffuseColorFactor = get_diffuseColorFactor(materialSID, 0);\n  if (v_color != baseColor && diffuseColorFactor.rgb != baseColor) {\n    baseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == baseColor) {\n    baseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == baseColor) {\n    baseColor = v_color;\n  } else {\n    baseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n\n  // Diffuse Color (take account for BaseColorTexture)\n  vec2 baseTexUv = uvTransform(u_diffuseTextureTransform.xy, u_diffuseTextureTransform.zw, u_diffuseTextureRotation, v_texcoord);\n  vec2 detailTexUv = uvTransform(u_detailColorTextureTransform.xy, u_detailColorTextureTransform.zw, u_detailColorTextureRotation, v_texcoord);\n  vec4 textureColor = texture2D(u_diffuseColorTexture, baseTexUv);\n  textureColor.rgb = pow(textureColor.rgb, vec3(2.2));\n  vec4 baseDiffuseColor = textureColor;\n  vec4 detailColor = texture2D(u_detailColorTexture, detailTexUv);\n  detailColor.rgb = pow(detailColor.rgb, vec3(2.2));\n  textureColor.xyz += clamp(detailColor.xyz - vec3(0.5, 0.5, 0.5), vec3(-0.5), vec3(0.5));\n  baseColor *= textureColor.rgb;\n  alpha *= textureColor.a;\n\n  if (alpha < 0.01) {\n    discard;\n  }\n\n  // Specular & Glossiness\n  vec4 specularGlossinessFactor = get_specularGlossinessFactor(materialSID, 0);\n  float userGlossiness = specularGlossinessFactor.a;\n  vec3 specular = specularGlossinessFactor.rgb;\n\n  vec4 specularGlossiness = texture2D(u_specularGlossinessTexture, v_texcoord);\n  specularGlossiness = pow(specularGlossiness, vec4(2.2)); // sRGB to Linear\n  userGlossiness = specularGlossiness.a * userGlossiness;\n  specular = specularGlossiness.rgb * specular;\n\n  float userRoughness = max(1.0 - userGlossiness, 0.04);\n  float alphaRoughness = userRoughness * userRoughness;\n  alphaRoughness = max(alphaRoughness, 0.0078125);\n\n  // F0\n  vec3 F0 = specular;\n\n  // Albedo\n  vec3 albedo = baseColor;\n\n  // Anisotropy\n  vec2 anisotropy = get_anisotropy(materialSID, 0);\n  float baseAnisotropy = anisotropy.x;\n  float clearcoatAnisotropy = anisotropy.y;\n\n  // ViewDirection\n  vec3 viewPosition = get_viewPosition(materialSID, 0);\n  vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n  vec3 env_viewDirection = rotEnvMatrix * normalize(viewPosition - v_position_inWorld.xyz);\n  env_viewDirection.x *= -1.0;\n\n  // NV\n  float NV = clamp(dot(normal_inWorld, viewDirection), 0.0078125, 1.0);\n\n  rt0 = vec4(0.0, 0.0, 0.0, alpha);\n\n  vec2 clearcoatParameter = get_clearcoatParameter(materialSID, 0);\n  float clearcoatFactor = clearcoatParameter.x;\n  float clearcoatRoughness = max(1.0 - clearcoatParameter.y, 0.04);\n\n\n  // Lighting\n  if (length(normal_inWorld) > 0.02) {\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      // Light\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float lightType = gotLightPosition.w;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(lightDirection, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n\n      // IncidentLight\n      vec3 incidentLight = spotEffect * lightIntensity.xyz;\n      incidentLight *= M_PI;\n\n      vec3 halfVector = normalize(lightDirection + viewDirection);\n      float LH = clamp(dot(lightDirection, halfVector), 0.0, 1.0);\n\n      // Specular\n      float NL = clamp(dot(normal_inWorld, lightDirection), 0.0078125, 1.0);\n      float NH = clamp(dot(normal_inWorld, halfVector), 0.0, 1.0);\n      float VH = clamp(dot(viewDirection, halfVector), 0.0, 1.0);\n\n      vec3 totalContrib = surfaceShading(materialSID, NH, NL, NV, VH, F0, lightDirection, halfVector, viewDirection, tangent_inWorld, binormal_inWorld, albedo, incidentLight,\n        alphaRoughness, clearcoatRoughness, clearcoatFactor, baseAnisotropy, clearcoatAnisotropy);\n\n      rt0.xyz += totalContrib;\n//      rt0.xyz += specularContrib * vec3(NL) * incidentLight.rgb;\n  //    rt0.xyz += diffuseContrib * vec3(NL) * incidentLight.rgb;\n  //    rt0.xyz += (vec3(1.0) - F) * diffuse_brdf(albedo);//diffuseContrib;//vec3(NL) * incidentLight.rgb;\n    }\n\n    vec3 reflection = reflect(-env_viewDirection, normal_forEnv);\n\n    vec3 ibl = IBLContribution(materialSID, normal_forEnv, env_viewDirection, NV, reflection, albedo, F0, userRoughness, clearcoatFactor, clearcoatRoughness, baseAnisotropy, clearcoatAnisotropy, tangent_forEnv, binormal_forEnv);\n    // vec3 ibl = IBLContribution2(normal_forEnv, reflection, NV, F0, viewDirection, tangent_inWorld, binormal_inWorld, albedo,\n      // userRoughness, alphaRoughness, clearcoatRoughness, clearcoatFactor, baseAnisotropy, clearcoatAnisotropy);\n\n    // float occlusion = texture2D(u_occlusionTexture, v_texcoord).a;\n\n    // Occlution to Indirect Lights\n    rt0.xyz += ibl;\n    // rt0.xyz += ibl * occlusion;\n\n  } else {\n    rt0 = vec4(baseColor, alpha);\n  }\n\n  // Emissive\n  // vec3 emissive = srgbToLinear(texture2D(u_emissiveTexture, v_texcoord).xyz);\n  // rt0.xyz += emissive;\n\n/*\n  // Wireframe\n  float threshold = 0.001;\n  vec3 wireframe = get_wireframe(materialSID, 0);\n  float wireframeWidthInner = wireframe.z;\n  float wireframeWidthRelativeScale = 1.0;\n  if (wireframe.x > 0.5 && wireframe.y < 0.5) {\n    rt0.a = 0.0;\n  }\n  vec4 wireframeResult = rt0;\n  vec4 wireframeColor = vec4(0.2, 0.75, 0.0, 1.0);\n  float edgeRatio = edge_ratio(v_baryCentricCoord, wireframeWidthInner, wireframeWidthRelativeScale);\n  float edgeRatioModified = mix(step(threshold, edgeRatio), clamp(edgeRatio*4.0, 0.0, 1.0), wireframeWidthInner / wireframeWidthRelativeScale/4.0);\n  // if r0.a is 0.0, it is wireframe not on shaded\n  wireframeResult.rgb = wireframeColor.rgb * edgeRatioModified + rt0.rgb * (1.0 - edgeRatioModified);\n  wireframeResult.a = max(rt0.a, wireframeColor.a * mix(edgeRatioModified, pow(edgeRatioModified, 100.0), wireframeWidthInner / wireframeWidthRelativeScale/1.0));\n\n  if (wireframe.x > 0.5) {\n    rt0 = wireframeResult;\n    if (wireframe.y < 0.5 && rt0.a == 0.0) {\n      discard;\n    }\n  }\n  */\n\n  rt0.rgb *= alpha;\n  rt0.a = alpha;\n  int debugDisplay = get_debugDisplay(materialSID, 0);\n  if (debugDisplay == 1) {\n    rt0.rgb = baseDiffuseColor.rgb;\n    rt0.a = 1.0;\n  } else if (debugDisplay == 2) {\n    rt0.rgb = detailColor.rgb;\n    rt0.a = 1.0;\n  } else if (debugDisplay == 3) {\n    rt0.rgb = texture2D(u_normalTexture, baseUv).xyz * 2.0 - 1.0;\n    rt0.a = 1.0;\n  } else if (debugDisplay == 4) {\n    rt0.rgb = texture2D(u_detailNormalTexture, detailUv).xyz * 2.0 - 1.0;\n    rt0.a = 1.0;\n  } else if (debugDisplay == 5) {\n    rt0.rgb = specularGlossiness.rgb;\n    rt0.a = 1.0;\n  } else if (debugDisplay == 6) {\n    rt0.rgb = vec3(specularGlossiness.w);\n    rt0.a = 1.0;\n  }\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n',shaderStage:"fragment",isFragmentShader:!0};class ue extends o.Z{constructor({isMorphing:e,isSkinning:t,isLighting:n}){super(null,"PbrExtendedShading"+(e?"+morphing":"")+(t?"+skinning":"")+(n?"":"-lighting"),{isMorphing:e,isSkinning:t,isLighting:n},he,de),o.Z.initDefaultTextures();const i=[{semantic:d.f.DiffuseColorFactor,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:2,isSystem:!1,initialValue:f.ZP.fromCopyArray([1,1,1,1])},{semantic:d.f.DiffuseColorTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[0,o.Z.__dummyWhiteTexture]},{semantic:d.f.SpecularGlossinessFactor,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:2,isSystem:!1,initialValue:f.ZP.fromCopyArray([0,0,0,0])},{semantic:d.f.SpecularGlossinessTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[1,o.Z.__dummyWhiteTexture]},{semantic:d.f.NormalTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,initialValue:[2,o.Z.__dummyBlueTexture]},{semantic:d.f.Wireframe,compositionType:_.d.Vec3,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:10,isSystem:!1,initialValue:x.ZP.fromCopyArray([0,0,1])},{semantic:d.f.Anisotropy,compositionType:_.d.Vec2,componentType:c.r.Float,stage:u.H.PixelShader,min:-1,max:1,isSystem:!1,initialValue:v.ZP.fromCopyArray2([0,0])},{semantic:d.f.ClearCoatParameter,compositionType:_.d.Vec2,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:1,isSystem:!1,initialValue:v.ZP.fromCopyArray2([0,.5])},{semantic:d.f.SheenParameter,compositionType:_.d.Vec3,componentType:c.r.Float,stage:u.H.PixelShader,min:0,max:1,isSystem:!1,initialValue:x.ZP.fromCopyArray([0,0,0])},{semantic:ue.detailNormalTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:10,isSystem:!1,initialValue:[3,o.Z.__dummyBlueTexture]},{semantic:ue.detailColorTexture,compositionType:_.d.Texture2D,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:10,isSystem:!1,initialValue:[4,o.Z.__dummySRGBGrayTexture]},{semantic:ue.diffuseTextureTransform,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-10,max:10,isSystem:!1,initialValue:f.ZP.fromCopyArray([1,1,0,0])},{semantic:ue.diffuseTextureRotation,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,initialValue:h.ZP.fromCopyNumber(0)},{semantic:ue.normalTextureTransform,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-10,max:10,isSystem:!1,initialValue:f.ZP.fromCopyArray([1,1,0,0])},{semantic:ue.normalTextureRotation,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,initialValue:h.ZP.fromCopyNumber(0)},{semantic:ue.detailColorTextureTransform,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-10,max:10,isSystem:!1,initialValue:f.ZP.fromCopyArray([1,1,0,0])},{semantic:ue.detailColorTextureRotation,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,initialValue:h.ZP.fromCopyNumber(0)},{semantic:ue.detailNormalTextureTransform,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-10,max:10,isSystem:!1,initialValue:f.ZP.fromCopyArray([1,1,0,0])},{semantic:ue.detailNormalTextureRotation,compositionType:_.d.Scalar,componentType:c.r.Float,stage:u.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,initialValue:h.ZP.fromCopyNumber(0)},{semantic:ue.debugDisplay,compositionType:_.d.Scalar,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:20,isSystem:!1,initialValue:h.ZP.fromCopyNumber(0)},{semantic:d.f.IBLParameter,compositionType:_.d.Vec4,componentType:c.r.Float,stage:u.H.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:m.a.EveryTime,initialValue:f.ZP.fromCopyArray([1,1,1,1])},{semantic:d.f.HDRIFormat,compositionType:_.d.Vec2,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:5,isSystem:!0,updateInterval:m.a.EveryTime,initialValue:v.ZP.fromCopyArray2([0,0])},{semantic:d.f.DiffuseEnvTexture,compositionType:_.d.TextureCube,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInterval:m.a.EveryTime,initialValue:[5,o.Z.__dummyWhiteTexture]},{semantic:d.f.SpecularEnvTexture,compositionType:_.d.TextureCube,componentType:c.r.Int,stage:u.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInterval:m.a.EveryTime,initialValue:[6,o.Z.__dummyWhiteTexture]}];n&&(this.__definitions+="#define RN_IS_LIGHTING\n"),t&&(this.__definitions+="#define RN_IS_SKINNING\n"),this.setShaderSemanticsInfoArray(i)}static async initDefaultTextures(){}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let a=i.renderPass.cameraComponent;null==a&&(a=l.Z.getInstance().getComponent(s.Z,s.Z.main)),a&&(this.setViewInfo(t,a,i.isVr,i.displayIdx),this.setProjection(t,a,i.isVr,i.displayIdx));const r=i.entity.getComponent(D.Z);if(this.setSkinning(t,r,i.setUniform),this.__webglResourceRepository.setUniformValue(t,d.f.DiffuseEnvTexture.str,n,[5,-1]),i.diffuseCube&&i.diffuseCube.isTextureReady){const e=this.__webglResourceRepository.getWebGLResource(i.diffuseCube.cgApiResourceUid);i.glw.bindTextureCube(5,e)}else{const e=this.__webglResourceRepository.getWebGLResource(o.Z.__dummyBlackCubeTexture.cgApiResourceUid);i.glw.bindTextureCube(5,e)}if(this.__webglResourceRepository.setUniformValue(t,d.f.SpecularEnvTexture.str,n,[6,-1]),i.specularCube&&i.specularCube.isTextureReady){const e=this.__webglResourceRepository.getWebGLResource(i.specularCube.cgApiResourceUid);i.glw.bindTextureCube(6,e)}else{const e=this.__webglResourceRepository.getWebGLResource(o.Z.__dummyBlackCubeTexture.cgApiResourceUid);i.glw.bindTextureCube(6,e)}let c=1;i.specularCube&&(c=i.specularCube.mipmapLevelNumber);const _=i.entity.getComponent(_e.Z);let h=k.c.LDR_SRGB.index,u=k.c.LDR_SRGB.index;if(_.diffuseCubeMap&&(h=_.diffuseCubeMap.hdriFormat.index),_.specularCubeMap&&(u=_.specularCubeMap.hdriFormat.index),i.setUniform)this.__webglResourceRepository.setUniformValue(t,d.f.IBLParameter.str,n,{x:c,y:_.diffuseCubeMapContribution,z:_.specularCubeMapContribution,w:_.rotationOfCubeMap}),this.__webglResourceRepository.setUniformValue(t,d.f.HDRIFormat.str,n,{x:h,y:u});else{const t=o.Z.__tmp_vector4;t.x=c,t.y=_.diffuseCubeMapContribution,t.z=_.specularCubeMapContribution,t.w=_.rotationOfCubeMap,e.setParameter(d.f.IBLParameter,t);const n=o.Z.__tmp_vector2;n.x=h,n.y=u,e.setParameter(d.f.IBLParameter,n)}this.setLightsInfo(t,i.lightComponents,e,i.setUniform)}}ue.detailNormalTexture=new d.w({str:"detailNormalTexture"}),ue.detailColorTexture=new d.w({str:"detailColorTexture"}),ue.diffuseTextureTransform=new d.w({str:"diffuseTextureTransform"}),ue.diffuseTextureRotation=new d.w({str:"diffuseTextureRotation"}),ue.normalTextureTransform=new d.w({str:"normalTextureTransform"}),ue.normalTextureRotation=new d.w({str:"normalTextureRotation"}),ue.detailColorTextureTransform=new d.w({str:"detailColorTextureTransform"}),ue.detailColorTextureRotation=new d.w({str:"detailColorTextureRotation"}),ue.detailNormalTextureTransform=new d.w({str:"detailNormalTextureTransform"}),ue.detailNormalTextureRotation=new d.w({str:"detailNormalTextureRotation"}),ue.debugDisplay=new d.w({str:"debugDisplay"}),ue.__pbrCookTorranceBrdfLutDataUrlUid=V.Z.InvalidCGAPIResourceUid;var me=n(7348);class xe extends o.Z{constructor({name:e,vertexShaderityObj:t,pixelShaderityObj:n}){super(null,e,{});const i=U.Z.getShaderDataRefection(t,o.Z.__semanticsMap.get(this.shaderFunctionName)),a=U.Z.getShaderDataRefection(n,o.Z.__semanticsMap.get(this.shaderFunctionName));this.__vertexShaderityObject=t,this.__pixelShaderityObject=n;const r=i.shaderSemanticsInfoArray.concat();for(const e of a.shaderSemanticsInfoArray){const t=r.find((t=>t.semantic.str===e.semantic.str));t?t.stage=u.H.VertexAndPixelShader:r.push(e)}xe.__removeUselessShaderSemantics(r),this.setShaderSemanticsInfoArray(r)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){if(i.setUniform){if(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix),n||i.isVr){let e=i.renderPass.cameraComponent;null==e&&(e=l.Z.getInstance().getComponent(s.Z,s.Z.main)),this.setViewInfo(t,e,i.isVr,i.displayIdx),this.setProjection(t,e,i.isVr,i.displayIdx)}n&&this.setLightsInfo(t,i.lightComponents,e,i.setUniform);const a=i.entity.getSkeletal();this.setSkinning(t,a,i.setUniform)}this.setMorphInfo(t,i.entity.getComponent(W.Z),i.entity.getComponent(L.Z),i.primitive)}static __removeUselessShaderSemantics(e){const t=me.Z.getInstance().getGlobalProperties();for(const n of t){const t=n.shaderSemanticsInfo,i=e.findIndex((e=>e.semantic.str===t.semantic.str));-1!==i&&e.splice(i,1)}const n=[d.f.VertexAttributesExistenceArray,d.f.WorldMatrix,d.f.NormalMatrix,d.f.PointSize,d.f.PointDistanceAttenuation];for(const t of n){const n=e.findIndex((e=>e.semantic.str===t.str));-1!==n&&e.splice(n,1)}}}function fe(e,t,n){return a.Z.isRegisteredMaterialType(e)||a.Z.registerMaterial(e,t,n),a.Z.createMaterial(e,t)}function Ae(e,t,n){return a.Z.forceRegisterMaterial(e,t,n),a.Z.createMaterial(e,t)}const pe=Object.freeze({createMaterial:fe,recreateMaterial:Ae,recreateCustomMaterial:function(e,t,{additionalName:n="",isSkinning:a=!0,isLighting:r=!1,isMorphing:o=!1,alphaMode:s=R.F.Opaque,maxInstancesNumber:l=i.Z.maxMaterialInstanceForEachType}={}){const c=`Custom_${n}_`+(o?"+morphing":"")+(a?"+skinning":"")+(r?"":"-lighting")+" alpha_"+s.str.toLowerCase(),_=new Z({name:c,isSkinning:a,isLighting:r,isMorphing:o,alphaMode:s,vertexShader:{code:e,shaderStage:"vertex",isFragmentShader:!1},pixelShader:{code:t,shaderStage:"fragment",isFragmentShader:!0}});return _.isSingleOperation=!0,Ae(c,[_],l)},recreateShaderityMaterial:function(e,t,{additionalName:n="",maxInstancesNumber:a=i.Z.maxMaterialInstanceForEachType}={}){const r=`Shaderity_${n}`,o=new xe({name:r,vertexShaderityObj:e,pixelShaderityObj:t});return o.isSingleOperation=!0,Ae(r,[o],a)},createEmptyMaterial:function(){const e=fe("Empty",[],i.Z.maxMaterialInstanceForEachType);return e.tryToSetUniqueName("EmptyMaterial",!0),e},createClassicUberMaterial:function({additionalName:e="",isSkinning:t=!0,isLighting:n=!1,isMorphing:a=!1,alphaMode:r=R.F.Opaque,maxInstancesNumber:o=i.Z.maxMaterialInstanceForEachType}={}){const s=`ClassicUber_${e}_`+(t?"+skinning":"")+(n?"":"-lighting")+" alpha_"+r.str.toLowerCase(),l=new Z({name:"ClassicUber",isSkinning:t,isLighting:n,isMorphing:a,alphaMode:r,vertexShader:A,pixelShader:p});return l.isSingleOperation=!0,fe(s,[l],o)},createPbrUberMaterial:function({additionalName:e="",isMorphing:t=!1,isSkinning:n=!1,isLighting:a=!1,useTangentAttribute:o=!1,useNormalTexture:s=!0,alphaMode:l=R.F.Opaque,maxInstancesNumber:c=i.Z.maxMaterialInstanceForEachType,makeOutputSrgb:_=!0}={}){const h=`PbrUber_${e}_`+(t?"+morphing":"")+(n?"+skinning":"")+(a?"":"-lighting")+(o?"+tangentAttribute":"")+(s?"":"-normalTexture")+"_alpha_"+l.str.toLowerCase(),d=new r.Z({isMorphing:t,isSkinning:n,isLighting:a,useTangentAttribute:o,useNormalTexture:s,alphaMode:l,makeOutputSrgb:_});return d.isSingleOperation=!0,fe(h,[d],c)},createSkinPbrUberMaterial:function({additionalName:e="",isMorphing:t=!1,isSkinning:n=!1,isLighting:a=!1,maxInstancesNumber:r=i.Z.maxMaterialInstanceForEachType}={}){const o=`PbrUber_${e}_`+(t?"+morphing":"")+(n?"+skinning":"")+(a?"":"-lighting"),s=new ce({isMorphing:t,isSkinning:n,isLighting:a});return s.isSingleOperation=!0,fe(o,[s],r)},createEnvConstantMaterial:function({additionalName:e="",maxInstancesNumber:t=5,makeOutputSrgb:n=!0}={}){const i=`EnvConstant_${e}`,a=new g.Z(n);return a.isSingleOperation=!0,fe(i,[a],t)},createFXAA3QualityMaterial:function({additionalName:e="",maxInstancesNumber:t=1}={}){const n=`FXAA3Quality_${e}`,i=new b;return i.isSingleOperation=!0,fe(n,[i],t)},createDepthEncodeMaterial:function({additionalName:e="",isSkinning:t=!1,depthPow:n=1,maxInstancesNumber:i=10}={}){const a=`DepthEncode_${e}_`+(t?"+skinning":""),r=new T.Z(n,{isSkinning:t});return r.isSingleOperation=!0,fe(a,[r],i)},createShadowMapDecodeClassicSingleMaterial:function({additionalName:e="",isMorphing:t=!1,isSkinning:n=!1,isLighting:i=!0,isDebugging:a=!1,colorAttachmentsNumber:r=0,maxInstancesNumber:o=20}={},s){const l=`ShadowMapDecodeClassic_${e}_`+(n?"+skinning":"")+(i?"":"-lighting"),c=new S.Z({isMorphing:t,isSkinning:n,isLighting:i,isDebugging:a,colorAttachmentsNumber:r},s);return c.isSingleOperation=!0,fe(l,[c],o)},createGammaCorrectionMaterial:function({additionalName:e="",maxInstancesNumber:t=1}={}){const n=`GammaCorrection_${e}`,i=new w;return i.isSingleOperation=!0,fe(n,[i],t)},createVarianceShadowMapDecodeClassicSingleMaterial:function({additionalName:e="",isMorphing:t=!1,isSkinning:n=!1,isDebugging:i=!1,isLighting:a=!0,colorAttachmentsNumberDepth:r=0,colorAttachmentsNumberSquareDepth:o=0,depthCameraComponent:s,maxInstancesNumber:l=10},c){const _=`VarianceShadowMapDecodeShading_${e}_`+(t?"+morphing":"")+(n?"+skinning":"")+(a?"":"-lighting")+(i?"":"+debugging"),h=new oe.Z({isMorphing:t,isSkinning:n,isLighting:a,isDebugging:i,colorAttachmentsNumberDepth:r,colorAttachmentsNumberSquareDepth:o,depthCameraComponent:s},c);return h.isSingleOperation=!0,fe(_,[h],l)},createEntityUIDOutputMaterial:function({additionalName:e="",maxInstancesNumber:t=10}={}){const n=`EntityUIDOutput_${e}`,i=new F;return i.isSingleOperation=!0,fe(n,[i],t)},createMToonMaterial:function({additionalName:e="",isMorphing:t=!1,isSkinning:n=!1,isLighting:a=!0,useTangentAttribute:r=!1,isOutline:o=!1,materialProperties:s,textures:l,debugMode:c,maxInstancesNumber:_=i.Z.maxMaterialInstanceForEachType,makeOutputSrgb:h=!0}){const d=`MToon_${e}_`+(t?"+morphing":"")+(n?"+skinning":"")+(a?"":"-lighting")+(r?"+tangentAttribute":"")+(o?"-outline":""),u=new Q(o,s,l,t,n,a,r,c,h);u.isSingleOperation=!0;const m=fe(d,[u],_);return u.setMaterialParameters(m,o),m},createFurnaceTestMaterial:function({additionalName:e="",maxInstancesNumber:t=1}={}){const n=`FurnaceTest_${e}`,i=new q.Z;return i.isSingleOperation=!0,fe(n,[i],t)},createGaussianBlurForEncodedDepthMaterial:function({additionalName:e="",maxInstancesNumber:t=10}={}){const n=`GaussianBlurForEncodedDepth_${e}`,i=new Y.Z;return i.isSingleOperation=!0,fe(n,[i],t)},createDetectHighLuminanceMaterial:function({additionalName:e="",colorAttachmentsNumber:t=0,maxInstancesNumber:n=5}={},i){const a=`DetectHighLuminance_${e}_`,r=new K.Z(i,t);return r.isSingleOperation=!0,fe(a,[r],n)},createGaussianBlurMaterial:function({additionalName:e="",maxInstancesNumber:t=10}={}){const n=`GaussianBlur_${e}`,i=new j.Z;return i.isSingleOperation=!0,fe(n,[i],t)},createSynthesizeHDRMaterial:function({additionalName:e="",targetRegionTexture:t,maxInstancesNumber:n=1},i){const a=`SynthesizeHDR_${e}`,r=new J.Z(i,t);return r.isSingleOperation=!0,fe(a,[r],n)},createColorGradingUsingLUTsMaterial:function({additionalName:e="",colorAttachmentsNumber:t=0,uri:n,texture:i,maxInstancesNumber:a=1},r){const o=`ColorGradingUsingLUTs_${e}`,s=new ae(r,t,n,i);return s.isSingleOperation=!0,fe(o,[s],a)},createMatCapMaterial:function({additionalName:e="",isSkinning:t=!1,uri:n,texture:i,maxInstancesNumber:a=10}){const r=`MatCap_${e}`+(t?"+skinning":""),o=new re.Z(t,n,i);return o.isSingleOperation=!0,fe(r,[o],a)},createPbrExtendedUberMaterial:function(e){const t=new ue({isMorphing:false,isSkinning:false,isLighting:true});return t.isSingleOperation=!0,fe("PbrExtendedShadingUber",[t],e)},changeMaterial:function(e,t,n){const i=e.getMeshRenderer();t.material=n,i.moveStageTo(X.I.Load)}})},2749:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(3449),a=n(4252);class r{constructor(){}async import(e,t){var n;if(t&&t.files)for(const n in t.files){const a=i.Z.getExtension(n);if("gltf"===a||"glb"===a)return await this.importGltfOrGlbFromArrayBuffers(t.files[n],t.files,t,e).catch((e=>{console.log("this.__loadFromArrayBuffer error",e)}))}const a=await i.Z.fetchArrayBuffer(e);return await this.importGltfOrGlbFromArrayBuffers(a,null!==(n=null==t?void 0:t.files)&&void 0!==n?n:{},t,e).catch((e=>{console.log("this.__loadFromArrayBuffer error",e)}))}async importGltfOrGlbFromFile(e,t){const n=await i.Z.fetchArrayBuffer(e);return await this.importGltfOrGlbFromArrayBuffers(n,{},t,e).catch((e=>{console.log("this.__loadFromArrayBuffer error",e)}))}async importGltfOrGlbFromArrayBuffers(e,t,n,a){if(1179937895!==new DataView(e,0,20).getUint32(0,!0)){const r=i.Z.arrayBufferToString(e),o=JSON.parse(r);return await this.importGltf(o,t,n,a).catch((e=>{console.log("this.__loadAsTextJson error",e)}))}return await this.importGlb(e,t,n).catch((e=>{console.log("this.__loadAsBinaryJson error",e)}))}_getOptions(e,t,n){if(t.asset&&t.asset.extras&&t.asset.extras.rnLoaderOptions)for(const n in t.asset.extras.rnLoaderOptions)e[n]=t.asset.extras.rnLoaderOptions[n];for(const t in n)e[t]=n[t];return n&&n.loaderExtensionName&&"string"==typeof n.loaderExtensionName&&(null!=Rn[n.loaderExtensionName]?e.loaderExtension=Rn[n.loaderExtensionName].getInstance():(console.error(`${n.loaderExtensionName} not found!`),e.loaderExtension=void 0)),e}async importGlb(e,t,n){const a=new DataView(e,0,20);if(2!==a.getUint32(4,!0))throw new Error("invalid version field in this binary glTF file.");const r=a.getUint32(12,!0);if(1313821514!==a.getUint32(16,!0))throw new Error("invalid chunkType of chunk0 in this binary glTF file.");const o=new Uint8Array(e,20,r),s=i.Z.uint8ArrayToString(o),l=JSON.parse(s),c=i.Z.createDefaultGltfOptions();n=this._getOptions(c,l,n);const _=new Uint8Array(e,20+r+8);void 0===l.asset.extras&&(l.asset.extras={fileType:"glTF",version:"2"}),this._mergeExtendedJson(l,n.extendedJson),l.asset.extras.rnLoaderOptions=n;try{await this._loadInner(l,t,n,_)}catch(e){console.log("this._loadInner error in _loadAsBinaryJson",e)}return l}async importGltf(e,t,n,a){const r=(null==a?void 0:a.substring(0,null==a?void 0:a.lastIndexOf("/")))+"/";void 0===e.asset.extras&&(e.asset.extras={fileType:"glTF",version:"2"});const o=i.Z.createDefaultGltfOptions();n=this._getOptions(o,e,n),this._mergeExtendedJson(e,n.extendedJson),e.asset.extras.rnLoaderOptions=n;try{await this._loadInner(e,t,n,void 0,r)}catch(e){console.log("this._loadInner error in _loadAsTextJson",e)}return e}_loadInner(e,t,n,i,a){const r=[];return r.push(this._loadResources(i,e,t,n,a)),r.push(new Promise(((t,n)=>{this._loadJsonContent(e),t()}))),Promise.all(r)}_loadJsonContent(e){this._loadDependenciesOfScenes(e),this._loadDependenciesOfNodes(e),this._loadDependenciesOfMeshes(e),this._loadDependenciesOfMaterials(e),this._loadDependenciesOfTextures(e),this._loadDependenciesOfJoints(e),this._loadDependenciesOfAnimations(e),this._loadDependenciesOfAccessors(e),this._loadDependenciesOfBufferViews(e),void 0===e.asset.extras&&(e.asset.extras={})}_loadDependenciesOfScenes(e){for(const t of e.scenes){t.nodesIndices=t.nodes.concat();for(const n in t.nodesIndices)t.nodes[n]=e.nodes[t.nodes[n]]}}_loadDependenciesOfNodes(e){for(const t of e.nodes){if(t.children){t.childrenIndices=t.children.concat(),t.children=[];for(const n in t.childrenIndices)t.children[n]=e.nodes[t.childrenIndices[n]]}void 0!==t.mesh&&void 0!==e.meshes&&(t.meshIndex=t.mesh,t.mesh=e.meshes[t.meshIndex]),void 0!==t.skin&&void 0!==e.skins&&(t.skinIndex=t.skin,t.skin=e.skins[t.skinIndex],void 0===t.mesh.extras&&(t.mesh.extras={}),t.mesh.extras._skin=t.skin),void 0!==t.camera&&void 0!==e.cameras&&(t.cameraIndex=t.camera,t.camera=e.cameras[t.cameraIndex]),void 0!==t.extensions&&void 0!==e.extensions&&void 0!==e.extensions.KHR_lights_punctual&&(t.extensions.KHR_lights_punctual.lightIndex=t.extensions.KHR_lights_punctual.light,t.extensions.KHR_lights_punctual.light=e.extensions.KHR_lights_punctual.lights[t.extensions.KHR_lights_punctual.lightIndex])}}_loadDependenciesOfMeshes(e){for(const t of e.meshes)for(const n of t.primitives){void 0!==n.material&&(n.materialIndex=n.material,n.material=e.materials[n.materialIndex]),n.attributesIndex=Object.assign({},n.attributes);for(const t in n.attributesIndex)if(n.attributesIndex[t]>=0){const i=e.accessors[n.attributesIndex[t]];i.extras={toGetAsTypedArray:!0,attributeName:t},n.attributes[t]=i}else n.attributes[t]=void 0;if(null!=n.indices&&(n.indicesIndex=n.indices,n.indices=e.accessors[n.indicesIndex]),null!=n.targets){n.targetIndices=n.targets,n.targets=[];for(const t of n.targetIndices){const i={};for(const n in t)if(t[n]>=0){const a=e.accessors[t[n]];a.extras={toGetAsTypedArray:!0,attributeName:n},i[n]=a}else i[n]=void 0;n.targets.push(i)}}}}_checkRnGltfLoaderOptionsExist(e){return!(!e.asset.extras||!e.asset.extras.rnLoaderOptions)}_loadDependenciesOfMaterials(e){if(e.textures||(e.textures=[]),e.materials)for(const t of e.materials){if(t.pbrMetallicRoughness){const n=t.pbrMetallicRoughness.baseColorTexture;void 0!==n&&(n.texture=e.textures[n.index]);const i=t.pbrMetallicRoughness.metallicRoughnessTexture;void 0!==i&&(i.texture=e.textures[i.index])}const n=t.normalTexture;void 0!==n&&(n.texture=e.textures[n.index]);const i=t.occlusionTexture;void 0!==i&&(i.texture=e.textures[i.index]);const a=t.emissiveTexture;void 0!==a&&(a.texture=e.textures[a.index]),this._checkRnGltfLoaderOptionsExist(e)&&e.asset.extras.rnLoaderOptions.loaderExtension&&e.asset.extras.rnLoaderOptions.loaderExtension.setTextures&&e.asset.extras.rnLoaderOptions.loaderExtension.setTextures(e,t)}}_loadDependenciesOfTextures(e){var t,n;if(e.textures)for(const i of e.textures)void 0!==i.sampler&&(i.samplerIndex=i.sampler,i.sampler=e.samplers[i.samplerIndex]),null!=(null===(n=null===(t=i.extensions)||void 0===t?void 0:t.KHR_texture_basisu)||void 0===n?void 0:n.source)?(i.extensions.KHR_texture_basisu.fallbackSourceIndex=i.source,i.sourceIndex=i.extensions.KHR_texture_basisu.source,i.image=e.images[i.sourceIndex]):void 0!==i.source&&(i.sourceIndex=i.source,i.image=e.images[i.sourceIndex])}_loadDependenciesOfJoints(e){if(e.skins)for(const t of e.skins){t.skeletonIndex=t.skeleton,t.skeleton=e.nodes[t.skeletonIndex],t.inverseBindMatricesIndex=t.inverseBindMatrices,t.inverseBindMatrices=e.accessors[t.inverseBindMatricesIndex],null==t.skeleton&&(t.skeletonIndex=t.joints[0],t.skeleton=e.nodes[t.skeletonIndex]),t.jointsIndices=t.joints,t.joints=[];for(const n of t.jointsIndices)t.joints.push(e.nodes[n])}}_loadDependenciesOfAnimations(e){if(e.animations)for(const t of e.animations){for(const n of t.channels)n.samplerIndex=n.sampler,n.sampler=t.samplers[n.samplerIndex],n.target.nodeIndex=n.target.node,n.target.node=e.nodes[n.target.nodeIndex];for(const n of t.channels)if(n.sampler.inputIndex=n.sampler.input,n.sampler.outputIndex=n.sampler.output,n.sampler.input=e.accessors[n.sampler.inputIndex],n.sampler.output=e.accessors[n.sampler.outputIndex],void 0===n.sampler.output.extras&&(n.sampler.output.extras={}),"rotation"===n.target.path&&(n.sampler.output.extras.quaternionIfVec4=!0),"weights"===n.target.path){let e=n.sampler.output.count/n.sampler.input.count;"CUBICSPLINE"===n.sampler.interpolation&&(e=n.sampler.output.count/n.sampler.input.count/3),n.sampler.output.extras.weightsArrayLength=e}}}_loadDependenciesOfAccessors(e){for(const t of e.accessors)if(null==t.bufferView&&(t.bufferView=0),t.bufferViewIndex=t.bufferView,t.bufferView=e.bufferViews[t.bufferViewIndex],null!=t.sparse){const n=t.sparse;n.indices.indicesIndex=n.indices.bufferView,n.indices.bufferView=e.bufferViews[n.indices.indicesIndex],n.values.valuesIndex=n.values.bufferView,n.values.bufferView=e.bufferViews[n.values.valuesIndex]}}_loadDependenciesOfBufferViews(e){for(const t of e.bufferViews)void 0!==t.buffer&&(t.bufferIndex=t.buffer,t.buffer=e.buffers[t.bufferIndex])}_mergeExtendedJson(e,t){let n=null;if(t instanceof ArrayBuffer){const e=i.Z.arrayBufferToString(t);n=JSON.parse(e)}else"string"==typeof t?n=JSON.parse(t):"object"==typeof t&&(n=t);Object.assign(e,n)}_loadResources(e,t,n,r,o){var s;const l=[];let c;for(const r in t.buffers){const s=t.buffers[r];let _="";if(s.uri){const e=s.uri.split("/");_=e[e.length-1]}c=void 0===s.uri?new a.Z(((t,n)=>{s.buffer=e,t(e)})):s.uri.match(/^data:application\/(.*);base64,/)?new a.Z(((e,t)=>{const n=i.Z.dataUriToArrayBuffer(s.uri);s.buffer=new Uint8Array(n),e(n)})):n&&this.__containsFileName(n,_)?new a.Z(((e,t)=>{const i=this.__getFullPathOfFileName(n,_),a=n[i];s.buffer=new Uint8Array(a),e(a)})):new a.Z(i.Z.loadResourceAsync(o+s.uri,!0,((e,t)=>{s.buffer=new Uint8Array(t),e(t)}),((e,t)=>{}))),s.bufferPromise=c,l.push(c)}for(const r of null!==(s=t.images)&&void 0!==s?s:[])if(null==r.uri)if(null==e){let e=t.bufferViews[r.bufferView].buffer;if(!isNaN(e)){const n=e;e=t.buffers[n]}const o=e.bufferPromise,s=new a.Z((e=>{o.then((a=>{const o=i.Z.createUint8ArrayFromBufferViewInfo(t,r.bufferView,a),s=i.Z.createBlobImageUriFromUint8Array(o,r.mimeType);this.__loadImageUri(s,r,n).then((()=>{e(a)}))}))})),c=l.indexOf(o);l[c]=s,e.bufferPromise=s}else{const a=i.Z.createUint8ArrayFromBufferViewInfo(t,r.bufferView,e),o=i.Z.createBlobImageUriFromUint8Array(a,r.mimeType);l.push(this.__loadImageUri(o,r,n))}else{const e=r.uri,t=e.split("/"),a=t[t.length-1];let s;if(n&&this.__containsFileName(n,a)){const e=this.__getFullPathOfFileName(n,a),t=n[e];s=i.Z.createBlobImageUriFromUint8Array(new Uint8Array(t),r.mimeType)}else s=e.match(/^data:/)?e:o+e;l.push(this.__loadImageUri(s,r,n))}if(r.defaultTextures){const e=r.defaultTextures.basePath,t=r.defaultTextures.textureInfos;for(const n of t){const t=n.fileName,a=e+t,r=i.Z.getExtension(t),o=i.Z.getMimeTypeFromExtension(r),s=i.Z.createImageFromUri(a,o).then((e=>{e.crossOrigin="Anonymous",n.image={image:e}}));l.push(s)}}return Promise.all(l).catch((e=>{console.log("Promise.all error",e)}))}__containsFileName(e,t){for(const n in e){const e=n.split("/");if(e[e.length-1]===t)return!0}return!1}__getFullPathOfFileName(e,t){for(const n in e){const e=n.split("/");if(e[e.length-1]===t)return n}}__loadImageUri(e,t,n){var a,r;let o;return o=e.match(/basis$/)?new Promise((n=>{fetch(e,{mode:"cors"}).then((e=>{e.arrayBuffer().then((e=>{const i=new Uint8Array(e);t.basis=i,n()}))}))})):(null===(a=t.uri)||void 0===a?void 0:a.match(/basis$/))?new Promise((e=>{t.basis=new Uint8Array(n[t.uri]),e()})):e.match(/\.ktx2$/)||e.match(/^data:image\/ktx2/)||null!=t.bufferView&&"image/ktx2"===t.mimeType?new Promise((n=>{fetch(e,{mode:"cors"}).then((e=>{e.arrayBuffer().then((e=>{const i=new Uint8Array(e);t.ktx2=i,n()}))}))})):(null===(r=t.uri)||void 0===r?void 0:r.match(/ktx2$/))?new Promise((e=>{t.ktx2=new Uint8Array(n[t.uri]),e()})):i.Z.createImageFromUri(e,t.mimeType).then((e=>{e.crossOrigin="Anonymous",t.image=e})),o}static getInstance(){return this.__instance||(this.__instance=new r),this.__instance}}},6694:(e,t,n)=>{"use strict";n.d(t,{Z:()=>U});var i=n(1350),a=n(657),r=n(5333),o=n(6019),s=n(2471),l=n(4388),c=n(916),_=n(5850),h=n(1845),d=n(3395),u=n(8696),m=n(810),x=n(3999),f=n(128),A=n(1784),p=n(9646),g=n(2651),v=n(7192),y=n(7861),I=n(7305),b=n(3032),T=n(871),S=n(5704),E=n(2993),C=n(4587),w=n(2390),D=n(9840),N=n(6214),B=n(4536),P=n(4322),M=n(5634),F=n(346),R=n(752),L=n(9286),V=n(85),W=n(7348),z=n(1481),H=n(3616),O=n(5981),G=n(7987),Q=n(4690),k=n(3449);class U{constructor(){}static getInstance(){return this.__instance||(this.__instance=new U),this.__instance}_getDefaultShader(e){return null}__generateEntity(e,t){const n=i.Z.getInstance().createEntity(e);return n.tryToSetTag({tag:"SourceType",value:t.asset.extras.fileType}),n.tryToSetTag({tag:"SourceTypeVersion",value:t.asset.extras.version}),n}__generateGroupEntity(e){return this.__generateEntity([a.Z,r.Z],e)}__generateMeshEntity(e){return this.__generateEntity([a.Z,r.Z,o.Z,_.Z],e)}__generateCameraEntity(e){return this.__generateEntity([a.Z,r.Z,A.Z],e)}__generateLightEntity(e){return this.__generateEntity([a.Z,r.Z,P.Z],e)}convertToRhodoniteObject(e){var t;e.asset.extras.rnMeshesAtGltMeshIdx=[];const n=this.createRnBuffer(e);e.asset.extras.rnMaterials={};const{rnEntities:i,rnEntitiesByNames:a}=this.__setupObjects(e,n);e.asset.extras.rnEntities=i,this._setupTransform(e,i),this._setupSkeleton(e,i),this._setupHierarchy(e,i),this._setupAnimation(e,i);const r=this.__generateGroupEntity(e);if(r.tryToSetUniqueName("FileRoot",!0),r.tryToSetTag({tag:"ObjectType",value:"top"}),e.scenes[0].nodesIndices)for(const t of e.scenes[0].nodesIndices)r.getSceneGraph().addChild(i[t].getSceneGraph());if(e.asset.extras&&e.asset.extras.rnLoaderOptions){const n=e.asset.extras.rnLoaderOptions;n&&n.loaderExtension&&(null===(t=null==n?void 0:n.loaderExtension)||void 0===t?void 0:t.loadExtensionInfoAndSetToRootGroup)&&n.loaderExtension.loadExtensionInfoAndSetToRootGroup(r,e)}return r.tryToSetTag({tag:"rnEntities",value:i}),r.tryToSetTag({tag:"rnEntitiesByNames",value:a}),r.tryToSetTag({tag:"gltfModel",value:e}),r}_setupCamera(e){}createRnBuffer(e){const t=[];for(const n of e.buffers){const e=new d.Z({byteLength:n.byteLength,buffer:n.buffer,name:`gltf2Buffer_0_(${n.uri})`,byteAlign:4});t.push(e)}return t}_setupTransform(e,t){for(const n in e.nodes){const i=t[n],a=e.nodes[n];a.translation&&(i.getTransform().translate=s.ZP.fromCopyArray([a.translation[0],a.translation[1],a.translation[2]])),a.scale&&(i.getTransform().scale=s.ZP.fromCopyArray([a.scale[0],a.scale[1],a.scale[2]])),a.rotation&&(i.getTransform().quaternion=new l.Z(a.rotation[0],a.rotation[1],a.rotation[2],a.rotation[3])),a.matrix&&(i.getTransform().matrix=new c.Z(a.matrix,!0))}}_setupHierarchy(e,t){const n=t.map((e=>e.getSceneGraph()));for(const t in e.nodes){const i=parseInt(t),a=e.nodes[i];if(a.childrenIndices){const e=n[i];for(const t of a.childrenIndices){const i=n[t];e.addChild(i)}}}}_setupAnimation(e,t){var n;if(e.animations)for(const t of e.animations)for(const e of t.samplers)this._accessBinaryWithAccessor(e.input),this._accessBinaryWithAccessor(e.output);const a=i.Z.getInstance();if(e.animations&&e.animations.length>0)for(const i of e.animations)for(const e of i.channels){const r=e.sampler.input.extras.typedDataArray,o=e.sampler.output.extras.typedDataArray,s=null!==(n=e.sampler.interpolation)&&void 0!==n?n:"LINEAR";let l="undefined";l="translation"===e.target.path?"translate":"rotation"===e.target.path?"quaternion":e.target.path;const c=t[e.target.nodeIndex];if(c){a.addComponentsToEntity([y.Z],c.entityUID);const t=c.getComponent(y.Z);if(t){const n=e.sampler.output.extras.componentN;t.setAnimation(Q.Is.exist(i.name)?i.name:"Untitled",l,r,o,n,I.k.fromString(s))}}}}_setupSkeleton(e,t){var n,a,r;if(null==e.skins)return;W.Z.getInstance();const o=i.Z.getInstance();for(const t of e.skins)t.inverseBindMatrices&&this._accessBinaryWithAccessor(t.inverseBindMatrices);for(const i in e.nodes){const s=e.nodes[i],l=t[i].getSceneGraph();let _;if(null!=s.skin){const e=t[i];o.addComponentsToEntity([T.Z],e.entityUID),_=e.getComponent(T.Z),_._jointIndices=s.skin.jointsIndices,null!=s.skin.bindShapeMatrix&&(_._bindShapeMatrix=new c.Z(s.skin.bindShapeMatrix,!0))}if((null===(n=s.skin)||void 0===n?void 0:n.skeleton)&&(l.isRootJoint=!0,s.mesh)){const e=[];for(const n of s.skin.jointsIndices)e.push(t[n].getSceneGraph());_.joints=e,null!=s.skin.skeletonIndex?_.jointsHierarchy=t[s.skin.skeletonIndex].getSceneGraph():_.jointsHierarchy=e[0]}if(null===(a=s.skin)||void 0===a?void 0:a.joints)for(const e of s.skin.jointsIndices)t[e].getSceneGraph().jointIndex=e;if(null!=(null===(r=s.skin)||void 0===r?void 0:r.inverseBindMatrices)){const e=s.skin.inverseBindMatrices.extras.typedDataArray.length/16,t=new Array(e);for(let n=0;n<e;n++)t[n]=new c.Z(s.skin.inverseBindMatrices.extras.typedDataArray.subarray(16*n,16*(n+1)),!0,!0);_._inverseBindMatrices=t}}}__setupObjects(e,t){var n,a,r;const s=[],l=new Map;for(const c in e.nodes){const _=e.nodes[parseInt(c)];let h;if(null!=_.mesh){let n=_.meshIndex;null==n&&(n=_.meshNames[0]);const i=this.__setupMesh(_,_.mesh,n,t,e);_.name&&i.tryToSetUniqueName(_.name,!0),_.mesh.name&&i.getComponent(o.Z).tryToSetUniqueName(_.mesh.name,!0),h=i}else if(null!=_.camera){const t=this.__setupCamera(_.camera,e);_.name&&t.tryToSetUniqueName(_.name,!0),h=t}else if(null===(n=_.extensions)||void 0===n?void 0:n.KHR_lights_punctual)h=this.__setupLight(_.extensions.KHR_lights_punctual.light,e);else{const t=this.__generateGroupEntity(e);_.name&&t.tryToSetUniqueName(_.name,!0),h=t}if(h.tryToSetTag({tag:"gltf_node_index",value:""+c}),s.push(h),l.set(_.name,h),this.__isMorphing(_,e)){let e;if(_.weights)e=_.weights;else if(null===(a=_.mesh)||void 0===a?void 0:a.weights)e=_.mesh.weights;else{e=new Array(_.mesh.primitives[0].targets.length);for(let t=0;t<e.length;t++)e[t]=0}i.Z.getInstance().addComponentsToEntity([V.Z],h.entityUID);const t=h.getComponent(V.Z);t.weights=e,(null===(r=_.mesh.primitives[0].extras)||void 0===r?void 0:r.targetNames)&&(t.targetNames=_.mesh.primitives[0].extras.targetNames)}}return{rnEntities:s,rnEntitiesByNames:l}}__isMorphing(e,t){var n,i,a,r;const o=null===(a=null===(i=null===(n=null==t?void 0:t.asset)||void 0===n?void 0:n.extras)||void 0===i?void 0:i.rnLoaderOptions)||void 0===a?void 0:a.defaultMaterialHelperArgumentArray[0];return!1!==(null==o?void 0:o.isMorphing)&&null!=(null===(r=e.mesh)||void 0===r?void 0:r.primitives[0].targets)}__setupLight(e,t){const n=this.__generateLightEntity(t),i=n.getComponent(P.Z);if(null!=e.name){i.tryToSetUniqueName(e.name,!0),i.type=M.v.fromString(e.type);let t=s.ZP.fromCopyArray3([1,1,1]),n=1;null!=e.color&&(t=s.ZP.fromCopyArray3(e.color)),null!=e.intensity&&(n=e.intensity),i.intensity=s.ZP.multiply(t,n),null!=e.range&&(i.range=e.range)}return n}__setupCamera(e,t){const n=this.__generateCameraEntity(t),i=n.getComponent(A.Z);return i.direction=s.ZP.fromCopyArray([0,0,-1]),t.asset&&t.asset.LastSaved_ApplicationVendor&&(i.direction=s.ZP.fromCopyArray([1,0,0]),i.directionInner=s.ZP.fromCopyArray([1,0,0])),i.up=s.ZP.fromCopyArray([0,1,0]),i.type=p.i.fromString(e.type),i.type===p.i.Perspective?(i.aspect=e.perspective.aspectRatio?e.perspective.aspectRatio:1,i.setFovyAndChangeFocalLength(b.k.radianToDegree(e.perspective.yfov)),i.zNear=e.perspective.znear,i.zFar=e.perspective.zfar?e.perspective.zfar:1e5):i.type===p.i.Orthographic&&(i.xMag=e.orthographic.xmag,i.yMag=e.orthographic.ymag,i.zNear=e.orthographic.znear,i.zFar=e.orthographic.zfar),n}__setupMesh(e,t,n,i,a){var r;const o=this.__generateMeshEntity(a),s=a.asset.extras.rnMeshesAtGltMeshIdx[n];let l=u.T.Triangles;const c=o.getMesh(),_=new N.Z,d=a.asset.extras.rnLoaderOptions;null!=(null==d?void 0:d.tangentCalculationMode)&&(_.tangentCalculationMode=d.tangentCalculationMode),null!=(null==d?void 0:d.isPreComputeForRayCastPickingEnable)&&(_.isPreComputeForRayCastPickingEnable=d.isPreComputeForRayCastPickingEnable);let m=_;if(null!=s)_.setOriginalMesh(s),m=s;else{for(const n in t.primitives){const o=t.primitives[n];null!=o.mode&&(l=u.T.from(o.mode));const s=new h.Z,c=this.__setupMaterial(s,e,a,o,o.material);let m;!1===c.isEmptyMaterial()&&U.setDefaultTextures(c,a);const x=new Map;if(null===(r=o.extensions)||void 0===r?void 0:r.KHR_draco_mesh_compression){if(m=this.__decodeDraco(o,i,a,x),null==m)break}else{o.indices&&(m=this.__getRnAccessor(o.indices,i[o.indices.bufferView.bufferIndex]));for(const e in o.attributes){const t=o.attributes[e],n=this.__getRnAccessor(t,i[t.bufferView.bufferIndex]);t.sparse&&this.setSparseAccessor(t,n),x.set(f.T.fromString(t.extras.attributeName),n)}}if(s.setData(x,l,c,m),null!=o.targets){let e=F.Z.maxMorphTargetNumber;null!=(null==d?void 0:d.maxMorphTargetNumber)&&(e=d.maxMorphTargetNumber);const t=[];for(let n=0;n<o.targets.length&&!(n>=e);n++){const e=o.targets[n],a=new Map;for(const t in e){const n=e[t],r=this.__getRnAccessor(n,i[n.bufferView.bufferIndex]),o=this.__copyRnAccessorAndBufferView(r);a.set(f.T.fromString(t),o)}t.push(a)}s.setTargets(t)}_.addPrimitive(s)}t.weights&&(_.weights=t.weights)}return c.setMesh(_),a.asset.extras.rnMeshesAtGltMeshIdx[n]=m,o}setSparseAccessor(e,t){var n,i,a,r;const o=e.bufferView.buffer.buffer,s=e.sparse.count,l=e.sparse.indices,c=(null!==(n=l.bufferView.byteOffset)&&void 0!==n?n:0)+(null!==(i=l.byteOffset)&&void 0!==i?i:0),_=this._checkBytesPerComponent(l),h=_*s,d=new DataView(o.buffer,c+o.byteOffset,h),u=this._checkDataViewMethod(l),m=e.sparse.values,x=(null!==(a=m.bufferView.byteOffset)&&void 0!==a?a:0)+(null!==(r=m.byteOffset)&&void 0!==r?r:0),f=this._checkBytesPerComponent(e),A=this._checkComponentNumber(e),p=f*A*s,g=new DataView(o.buffer,x+o.byteOffset,p),v=this._checkDataViewMethod(e),y=t.getTypedArray();for(let e=0;e<s;e++){const t=d[u](_*e,!0);for(let n=0;n<A;n++){const i=g[v](f*A*e+f*n,!0);y[t*A+n]=i}}}static setDefaultTextures(e,t){var n,i,a,r,o,s,l,c,_,h,d;if(null==(null===(i=null===(n=t.asset.extras)||void 0===n?void 0:n.rnLoaderOptions)||void 0===i?void 0:i.defaultTextures))return;const u=t.asset.extras.rnLoaderOptions,m=t.asset.extras.rnLoaderOptions.defaultTextures,x=m.basePath,f=m.textureInfos;for(const t of f){const n=new g.Z;t.shaderSemantics!==C.f.BaseColorTexture&&t.shaderSemantics!==C.f.DiffuseColorTexture||(n.autoDetectTransparency=!0===u.autoDetectTextureTransparency),n.autoResize=!0===u.autoResizeTexture;const i={magFilter:null!==(r=O.d.from(null===(a=t.sampler)||void 0===a?void 0:a.magFilter))&&void 0!==r?r:O.d.Linear,minFilter:null!==(s=O.d.from(null===(o=t.sampler)||void 0===o?void 0:o.minFilter))&&void 0!==s?s:O.d.Linear,wrapS:null!==(c=O.d.from(null===(l=t.sampler)||void 0===l?void 0:l.wrapS))&&void 0!==c?c:O.d.Repeat,wrapT:null!==(h=O.d.from(null===(_=t.sampler)||void 0===_?void 0:_.wrapT))&&void 0!==h?h:O.d.Repeat},m=x+t.fileName;n.name=m;const f=t.image;if(null==f?void 0:f.image)!(null===(d=G.Z.getWebGLResourceRepository().currentWebGLContextWrapper)||void 0===d?void 0:d.isWebGL2)&&!this.__sizeIsPowerOfTwo(f.image)&&this.__needResizeToPowerOfTwoOnWebGl1(i)&&(n.autoResize=!0),n.generateTextureFromImage(f.image,i);else if(null==f?void 0:f.basis)n.generateTextureFromBasis(f.basis,i);else{if(!(null==f?void 0:f.ktx2)){console.warn("default image not found");continue}n.generateTextureFromKTX2(f.ktx2,i)}const A=t.shaderSemantics;e.setTextureParameter(A,n)}}__setVRMMaterial(e,t,n,i,a,r){const o=n.extensions.VRM,s=n.extensions.VRM.materialProperties[i.materialIndex];if("VRM/MToon"===s.shader){const l=r.defaultMaterialHelperArgumentArray[0],c=l.additionalName,_=this.__isMorphing(t,n),h=this.__isSkinning(t,n),d=this.__isLighting(n,a),u=this.__useTangentAttribute(n,i),m=l.textures,x=l.debugMode,f=l.maxInstancesNumber,A=this.__makeOutputSrgb(n);let p;const g=o.rnExtension;if(g&&(p=g.renderPassOutline,p.isVrRendering=!0),null!=p){let t;t=0!==s.floatProperties._OutlineWidthMode?E.Z.createMToonMaterial({additionalName:c,isMorphing:_,isSkinning:h,isLighting:d,useTangentAttribute:u,isOutline:!0,materialProperties:s,textures:m,debugMode:x,maxInstancesNumber:f,makeOutputSrgb:A}):E.Z.createEmptyMaterial(),p.setMaterialForPrimitive(t,e)}return E.Z.createMToonMaterial({additionalName:c,isMorphing:_,isSkinning:h,isLighting:d,useTangentAttribute:u,isOutline:!1,materialProperties:s,textures:m,debugMode:x,maxInstancesNumber:f,makeOutputSrgb:A})}if(r.defaultMaterialHelperArgumentArray[0].isOutline)return E.Z.createEmptyMaterial()}__generateAppropriateMaterial(e,t,n,i,a){var r,o,s,l,c,_;if(null!=(null===(r=n.asset.extras)||void 0===r?void 0:r.rnLoaderOptions)){const r=n.asset.extras.rnLoaderOptions;if(null!=(null===(o=null==r?void 0:r.loaderExtension)||void 0===o?void 0:o.isNeededToUseThisMaterial)&&r.loaderExtension.isNeededToUseThisMaterial(n)){const e=null===(l=null===(s=n.asset.extras)||void 0===s?void 0:s.rnLoaderOptions)||void 0===l?void 0:l.loaderExtension;if(null!=(null==e?void 0:e.generateMaterial))return e.generateMaterial(a)}if(r.isImportVRM){const o=this.__setVRMMaterial(e,t,n,i,a,r);if(null!=o)return o}const c=r.defaultMaterialHelperName;if(null!=c)return E.Z[c](...r.defaultMaterialHelperArgumentArray)}let h=F.Z.maxMaterialInstanceForEachType;n.meshes.length>F.Z.maxMaterialInstanceForEachType&&(h=n.meshes.length+Math.floor(F.Z.maxMaterialInstanceForEachType/2));const d=this.__isMorphing(t,n),u=this.__isSkinning(t,n),m=this.__isLighting(n,a),x=S.F.fromGlTFString((null==a?void 0:a.alphaMode)||"OPAQUE"),f=null!=t.skin?`skin${null!==(c=t.skinIndex)&&void 0!==c?c:t.skinName}`:void 0;if(parseFloat(null===(_=n.asset)||void 0===_?void 0:_.version)>=2){const e=this.__useTangentAttribute(n,i),t=this.__useNormalTexture(n),a=this.__makeOutputSrgb(n);return E.Z.createPbrUberMaterial({isMorphing:d,isSkinning:u,isLighting:m,alphaMode:x,useTangentAttribute:e,useNormalTexture:t,additionalName:f,maxInstancesNumber:h,makeOutputSrgb:a})}return E.Z.createClassicUberMaterial({isSkinning:u,isLighting:m,alphaMode:x,additionalName:f,maxInstancesNumber:h})}__isLighting(e,t){var n,i,a,r;const o=null===(a=null===(i=null===(n=null==e?void 0:e.asset)||void 0===n?void 0:n.extras)||void 0===i?void 0:i.rnLoaderOptions)||void 0===a?void 0:a.defaultMaterialHelperArgumentArray[0];return null!=(null==o?void 0:o.isLighting)?o.isLighting:null==(null===(r=null==t?void 0:t.extensions)||void 0===r?void 0:r.KHR_materials_unlit)}__isSkinning(e,t){var n,i,a;const r=null===(a=null===(i=null===(n=null==t?void 0:t.asset)||void 0===n?void 0:n.extras)||void 0===i?void 0:i.rnLoaderOptions)||void 0===a?void 0:a.defaultMaterialHelperArgumentArray[0];return!1!==(null==r?void 0:r.isSkinning)&&null!=e.skin}__useTangentAttribute(e,t){var n,i,a;switch(null===(a=null===(i=null===(n=null==e?void 0:e.asset)||void 0===n?void 0:n.extras)||void 0===i?void 0:i.rnLoaderOptions)||void 0===a?void 0:a.tangentCalculationMode){case 0:return!1;case 1:break;case 2:return!0;case 3:return!1;case 4:return!0}for(const e in t.attributes)if("TANGENT"===e)return!0;return!1}__useNormalTexture(e){var t,n,i,a,r,o;const s=null===(i=null===(n=null===(t=null==e?void 0:e.asset)||void 0===t?void 0:t.extras)||void 0===n?void 0:n.rnLoaderOptions)||void 0===i?void 0:i.defaultMaterialHelperArgumentArray[0];return!1!==(null==s?void 0:s.useNormalTexture)&&0!==(null===(o=null===(r=null===(a=null==e?void 0:e.asset)||void 0===a?void 0:a.extras)||void 0===r?void 0:r.rnLoaderOptions)||void 0===o?void 0:o.tangentCalculationMode)}__makeOutputSrgb(e){var t,n,i;const a=null===(i=null===(n=null===(t=null==e?void 0:e.asset)||void 0===t?void 0:t.extras)||void 0===n?void 0:n.rnLoaderOptions)||void 0===i?void 0:i.defaultMaterialHelperArgumentArray[0];return null==a?void 0:a.makeOutputSrgb}__getMaterialHash(e,t,n,i){return n.materialIndex+"_isSkinning_"+this.__isSkinning(e,t)+"_isMorphing_"+this.__isMorphing(e,t)+"_isLighting_"+this.__isLighting(t,i)+"_useTangentAttribute_"+this.__useTangentAttribute(t,n)}__setupMaterial(e,t,n,i,a){var r,o,s,l,c,_,h,d,u,m,x;const f=this.__getMaterialHash(t,n,i,a);let A=null===(r=n.asset.extras)||void 0===r?void 0:r.rnMaterials[f];if(null!=A)return A;{const r=this.__generateAppropriateMaterial(e,t,n,i,a);n.asset.extras.rnMaterials[f]=r,A=r}if(!this.__needParameterInitialization(a,A.materialTypeName))return A;const p=n.asset.extras.rnLoaderOptions,g=a.pbrMetallicRoughness;if(null!=g){const e=g.baseColorFactor;null!=e&&A.setParameter(C.f.BaseColorFactor,new v.ZP(e));const t=g.baseColorTexture;if(null!=t){const e=U._createTexture(t,n,{autoDetectTransparency:null==p?void 0:p.autoDetectTextureTransparency});A.setTextureParameter(C.f.BaseColorTexture,e),null!=t.texCoord&&A.setParameter(z.Z.BaseColorTexcoordIndex,t.texCoord)}U._setupTextureTransform(t,A,z.Z.BaseColorTextureTransform,z.Z.BaseColorTextureRotation);const i=a.occlusionTexture;if(null!=i){const e=U._createTexture(i,n);A.setTextureParameter(C.f.OcclusionTexture,e),null!=i.texCoord&&A.setParameter(z.Z.OcclusionTexcoordIndex,i.texCoord),null!=i.strength&&A.setParameter(z.Z.OcclusionStrength,i.strength)}let r=g.metallicFactor;r=null!=r?r:1;let o=g.roughnessFactor;o=null!=o?o:1,A.setParameter(C.f.MetallicRoughnessFactor,w.ZP.fromCopyArray2([r,o]));const s=g.metallicRoughnessTexture;if(null!=s){const e=U._createTexture(s,n);A.setTextureParameter(C.f.MetallicRoughnessTexture,e),null!=s.texCoord&&A.setParameter(z.Z.MetallicRoughnessTexcoordIndex,s.texCoord)}U._setupTextureTransform(s,A,z.Z.MetallicRoughnessTextureTransform,z.Z.MetallicRoughnessTextureRotation)}else{let e=D.D.Phong.index;if(null===(o=a.extras)||void 0===o?void 0:o.technique){switch(a.extras.technique){case D.D.Constant.str:e=D.D.Constant.index;break;case D.D.Lambert.str:e=D.D.Lambert.index;break;case D.D.BlinnPhong.str:e=D.D.BlinnPhong.index;break;case D.D.Phong.str:e=D.D.Phong.index}A.setParameter(C.f.ShadingModel,H.ZP.fromCopyNumber(e))}}const y=a.emissiveTexture;if(null!=y){const e=U._createTexture(y,n);A.setTextureParameter(C.f.EmissiveTexture,e),parseFloat(null===(s=n.asset)||void 0===s?void 0:s.version)>=2&&null!=y.texCoord&&A.setParameter(z.Z.EmissiveTexcoordIndex,y.texCoord)}let I=a.alphaMode;(null==p?void 0:p.alphaMode)&&(I=p.alphaMode),null!=I&&(A.alphaMode=S.F.fromGlTFString(I),A.alphaMode!==S.F.Mask||(null===(c=null===(l=n.asset.extras)||void 0===l?void 0:l.rnLoaderOptions)||void 0===c?void 0:c.isImportVRM)||A.setParameter(C.f.AlphaCutoff,H.ZP.fromCopyNumber(null!==(_=a.alphaCutoff)&&void 0!==_?_:.5)));const b=a.doubleSided;null!=b&&(A.cullFace=!b);const T=a.diffuseColorTexture;if(null!=T){const e=U._createTexture(T,n,{autoDetectTransparency:null==p?void 0:p.autoDetectTextureTransparency});if(A.setTextureParameter(C.f.DiffuseColorTexture,e),this._checkRnGltfLoaderOptionsExist(n)&&(null===(d=null===(h=n.asset.extras)||void 0===h?void 0:h.rnLoaderOptions)||void 0===d?void 0:d.loaderExtension)){const e=n.asset.extras.rnLoaderOptions.loaderExtension;e.setUVTransformToTexture&&e.setUVTransformToTexture(A,T.texture.sampler)}}const E=a.diffuseColorFactor;null!=E&&A.setParameter(C.f.DiffuseColorFactor,new v.ZP(E));const N=a.normalTexture;if(null!=N){const e=U._createTexture(N,n);A.setTextureParameter(C.f.NormalTexture,e),parseFloat(null===(u=n.asset)||void 0===u?void 0:u.version)>=2&&(null!=N.texCoord&&A.setParameter(z.Z.NormalTexcoordIndex,N.texCoord),null!=N.scale&&A.setParameter(z.Z.NormalScale,N.scale))}if(U._setupTextureTransform(N,A,z.Z.NormalTextureTransform,z.Z.NormalTextureRotation),this._checkRnGltfLoaderOptionsExist(n)){const e=null===(x=null===(m=n.asset.extras)||void 0===m?void 0:m.rnLoaderOptions)||void 0===x?void 0:x.loaderExtension;null!=(null==e?void 0:e.setupMaterial)&&e.setupMaterial(n,a,A)}return A}static _createTexture(e,t,{autoDetectTransparency:n=!1}={}){var i,a,r,o,s,l,c,_,h,d,u;const m=null===(i=t.asset.extras)||void 0===i?void 0:i.rnLoaderOptions,x=new g.Z;x.autoDetectTransparency=n,x.autoResize=!0===(null==m?void 0:m.autoResizeTexture);const f=e.texture,A={magFilter:null!==(r=O.d.from(null===(a=f.sampler)||void 0===a?void 0:a.magFilter))&&void 0!==r?r:O.d.Linear,minFilter:null!==(s=O.d.from(null===(o=f.sampler)||void 0===o?void 0:o.minFilter))&&void 0!==s?s:O.d.Linear,wrapS:null!==(c=O.d.from(null===(l=f.sampler)||void 0===l?void 0:l.wrapS))&&void 0!==c?c:O.d.Repeat,wrapT:null!==(h=O.d.from(null===(_=f.sampler)||void 0===_?void 0:_.wrapT))&&void 0!==h?h:O.d.Repeat},p=f.image;if(p.image){const e=p.image;!(null===(d=G.Z.getWebGLResourceRepository().currentWebGLContextWrapper)||void 0===d?void 0:d.isWebGL2)&&!this.__sizeIsPowerOfTwo(e)&&this.__needResizeToPowerOfTwoOnWebGl1(A)&&(x.autoResize=!0),x.generateTextureFromImage(e,A)}else p.basis?x.generateTextureFromBasis(p.basis,A):p.ktx2&&x.generateTextureFromKTX2(p.ktx2,A);if(p.uri)x.name=p.uri;else{const e=null===(u=p.mimeType)||void 0===u?void 0:u.split("/")[1];x.name=p.name+`.${e}`}return x}static __needResizeToPowerOfTwoOnWebGl1(e){return e.wrapS!==O.d.ClampToEdge||e.wrapT!==O.d.ClampToEdge||e.minFilter!==O.d.Linear&&e.minFilter!==O.d.Nearest}static __sizeIsPowerOfTwo(e){const t=e.width,n=e.height;return 0==(t&t-1)&&0==(n&n-1)}__needParameterInitialization(e,t){return null!=e&&(null!=t.match(/PbrUber/)||null!=t.match(/ClassicUber/))}_checkRnGltfLoaderOptionsExist(e){var t;return!!(null===(t=e.asset.extras)||void 0===t?void 0:t.rnLoaderOptions)}__rewrapWithTypedArray(e,t,n,i){return new e(t.buffer,n+t.byteOffset,i)}_checkBytesPerComponent(e){let t=0;switch(e.componentType){case 5120:case 5121:t=1;break;case 5122:case 5123:t=2;break;case 5124:case 5125:case 5126:t=4}return t}_checkComponentNumber(e){let t=0;switch(e.type){case"SCALAR":t=1;break;case"VEC2":t=2;break;case"VEC3":t=3;break;case"VEC4":t=4;break;case"MAT4":t=16}return t}_checkDataViewMethod(e){let t="";switch(e.componentType){case 5120:t="getInt8";break;case 5121:t="getUint8";break;case 5122:t="getInt16";break;case 5123:t="getUint16";break;case 5124:t="getInt32";break;case 5125:t="getUint32";break;case 5126:t="getFloat32"}return t}static _isSystemLittleEndian(){return!!new Uint8Array(new Uint16Array([255]).buffer)[0]}_accessBinaryWithAccessor(e){var t,n,i;const a=e.bufferView,r=(null!==(t=a.byteOffset)&&void 0!==t?t:0)+(null!==(n=e.byteOffset)&&void 0!==n?n:0),o=a.buffer.buffer,s=this._checkComponentNumber(e),l=this._checkBytesPerComponent(e),c=this._checkDataViewMethod(e);Q.Is.not.exist(e.extras)&&(e.extras={attributeName:"",toGetAsTypedArray:!0,typedDataArray:new Float32Array,componentN:0,componentBytes:4,dataViewMethod:""}),e.extras.componentN=Q.Is.exist(null===(i=e.extras)||void 0===i?void 0:i.weightsArrayLength)?e.extras.weightsArrayLength:s,e.extras.componentBytes=l,e.extras.dataViewMethod=c;const _=l*s*e.count;let h=new Float32Array;const d=[];if(U._isSystemLittleEndian()){let e=new Float32Array;"getFloat32"===c?e=this.__rewrapWithTypedArray(Float32Array,o,r,_/l):"getInt8"===c?e=new Int8Array(o,r,_/l):"getUint8"===c?e=new Uint8Array(o,r,_/l):"getInt16"===c?e=this.__rewrapWithTypedArray(Int16Array,o,r,_/l):"getUint16"===c?e=this.__rewrapWithTypedArray(Uint16Array,o,r,_/l):"getInt32"===c?e=this.__rewrapWithTypedArray(Int32Array,o,r,_/l):"getUint32"===c&&(e=this.__rewrapWithTypedArray(Uint32Array,o,r,_/l)),h=this.__arrayToFloat32Array(c,e)}else{const t=new DataView(o.buffer,r+o.byteOffset,_),n=l*s,i=!0;for(let a=0;a<_;a+=n)switch(e.type){case"SCALAR":d.push(t[c](a,i));break;case"VEC2":d.push(t[c](a,i)),d.push(t[c](a+l,i));break;case"VEC3":d.push(t[c](a,i)),d.push(t[c](a+l,i)),d.push(t[c](a+2*l,i));break;case"VEC4":for(let e=0;e<4;e++)d.push(t[c](a+l*e,i));break;case"MAT4":for(let e=0;e<16;e++)d.push(t[c](a+l*e,i))}h=this.__arrayToFloat32Array(c,d)}return e.extras.typedDataArray=h,h}__arrayToFloat32Array(e,t){return"getInt8"===e?k.Z.normalizedInt8ArrayToFloat32Array(t):"getUint8"===e?k.Z.normalizedUint8ArrayToFloat32Array(t):"getInt16"===e?k.Z.normalizedInt16ArrayToFloat32Array(t):"getUint16"===e?k.Z.normalizedUint16ArrayToFloat32Array(t):"getInt32"===e||"getUint32"===e?(console.error("Not considered"),new Float32Array):"getFloat32"===e?new Float32Array(t):(console.error("Not considered"),new Float32Array)}__addOffsetToIndices(e){const t=e.mesh.getPrimitiveNumber();let n=0;for(let i=0;i<t;i++){const t=e.mesh.getPrimitiveAt(i).indicesAccessor;if(t){const e=t.elementCount;for(let i=0;i<e;i++){const e=t.getScalar(i,{});t.setScalar(i,e+n,{})}n+=e}}}__getRnAccessor(e,t){var n,i,a;const r=e.bufferView;return t.takeBufferViewWithByteOffset({byteLengthToNeed:r.byteLength,byteStride:null!==(n=r.byteStride)&&void 0!==n?n:0,byteOffset:null!==(i=r.byteOffset)&&void 0!==i?i:0}).takeAccessorWithByteOffset({compositionType:m.d.fromString(e.type),componentType:x.r.from(e.componentType),count:e.count,byteOffsetInBufferView:null!==(a=e.byteOffset)&&void 0!==a?a:0,byteStride:e.byteStride,max:e.max,min:e.min,normalized:e.normalized})}__copyRnAccessorAndBufferView(e){const t=3*e.elementCount*4,n=L.Z.getInstance().createOrGetBuffer(R.$.GPUVertexData).takeBufferView({byteLengthToNeed:t,byteStride:12}).takeAccessor({compositionType:m.d.Vec3,componentType:x.r.Float,count:e.elementCount,max:e.max,min:e.min,normalized:e.normalized});return n.copyBuffer(e),n}__createRnAccessor(e,t,n,i){var a;return i.takeBufferView({byteLengthToNeed:t*n*4,byteStride:0}).takeAccessorWithByteOffset({compositionType:m.d.fromString(e.type),componentType:x.r.from(e.componentType),count:t,byteStride:e.byteStride,byteOffsetInBufferView:null!==(a=e.byteOffset)&&void 0!==a?a:0,max:e.max,min:e.min,normalized:e.normalized})}__getRnBufferView(e,t){var n,i;return t.takeBufferViewWithByteOffset({byteLengthToNeed:e.byteLength,byteStride:null!==(n=e.byteStride)&&void 0!==n?n:0,byteOffset:null!==(i=e.byteOffset)&&void 0!==i?i:0})}__getGeometryFromDracoBuffer(e,t,n){const i=new e.DecoderBuffer;i.Init(new Int8Array(n),n.byteLength);const a=t.GetEncodedGeometryType(i);let r,o;if(a===e.TRIANGULAR_MESH)r=new e.Mesh,o=t.DecodeBufferToMesh(i,r);else if(a===e.POINT_CLOUD)r=new e.PointCloud,o=t.DecodeBufferToPointCloud(i,r);else{const e="Unknown geometry type.";console.error(e)}if(r.geometryType=a,!o.ok()||0===r.ptr){let n="Decoding failed: ";return n+=o.error_msg(),console.error(n),e.destroy(t),void e.destroy(r)}return e.destroy(i),r}__getIndicesFromDraco(e,t,n,i){if(n.geometryType!==e.TRIANGULAR_MESH)return;let a;if(i){const i=new e.DracoInt32Array;t.GetTriangleStripsFromMesh(n,i),a=new Uint32Array(i.size());for(let e=0;e<i.size();++e)a[e]=i.GetValue(e);e.destroy(i)}else{const i=n.num_faces();a=new Uint32Array(3*i);const r=new e.DracoInt32Array;for(let e=0;e<i;++e){t.GetFaceFromMesh(n,e,r);const i=3*e;a[i]=r.GetValue(0),a[i+1]=r.GetValue(1),a[i+2]=r.GetValue(2)}e.destroy(r)}return a}__decodeDraco(e,t,n,i){const a=n.bufferViews[e.extensions.KHR_draco_mesh_compression.bufferView],r=this.__getRnBufferView(a,t[a.bufferIndex]),o=new Uint8Array(r.getUint8Array()).buffer,s=new DracoDecoderModule,l=new s.Decoder,c=this.__getGeometryFromDracoBuffer(s,l,o);if(null==c)return s.destroy(c),void s.destroy(l);const _=c.num_points(),h=this.__createBufferForDecompressedData(e,_);let d=!1;u.T.from(e.mode)===u.T.TriangleStrip&&(d=!0);const x=this.__getIndicesFromDraco(s,l,c,d),A=this.__createRnAccessor(e.indices,x.length,1,h);for(let e=0;e<x.length;e++)A.setScalar(e,x[e],{});for(const n in e.attributes){const a=e.extensions.KHR_draco_mesh_compression.attributes[n],r=e.attributes[n];let o;if(null==a)o=this.__getRnAccessor(r,t[r.bufferView.bufferIndex]);else{const e=m.d.fromString(r.type).getNumberOfComponents();o=this.__createRnAccessor(r,_,e,h);const t=l.GetAttributeByUniqueId(c,a),n=new s.DracoFloat32Array;l.GetAttributeFloatForAllPoints(c,t,n);for(let t=0;t<_;t++)1===e?o.setScalar(t,n.GetValue(t*e),{}):2===e?o.setVec2(t,n.GetValue(t*e),n.GetValue(t*e+1),{}):3===e?o.setVec3(t,n.GetValue(t*e),n.GetValue(t*e+1),n.GetValue(t*e+2),{}):4===e&&o.setVec4(t,n.GetValue(t*e),n.GetValue(t*e+1),n.GetValue(t*e+2),n.GetValue(t*e+3),{});s.destroy(n)}r.sparse&&this.setSparseAccessor(r,o),i.set(f.T.fromString(r.extras.attributeName),o)}return s.destroy(c),s.destroy(l),A}static _setupTextureTransform(e,t,n,i){var a;if(null===(a=null==e?void 0:e.extensions)||void 0===a?void 0:a.KHR_texture_transform){const a=B.ZP.fromCopyArray([1,1,0,0]);let r=0;const o=e.extensions.KHR_texture_transform;null!=o.scale&&(a.x=o.scale[0],a.y=o.scale[1]),null!=o.offset&&(a.z=o.offset[0],a.w=o.offset[1]),null!=o.rotation&&(r=o.rotation),t.setParameter(n,a),t.setParameter(i,r)}}__createBufferForDecompressedData(e,t){let n=0;e.indices&&(n+=4*e.indices.count);const i=e.extensions.KHR_draco_mesh_compression.attributes;for(const a in e.attributes){if(null==i[a])continue;const r=e.attributes[a];n+=t*m.d.fromString(r.type).getNumberOfComponents()*4}return new d.Z({byteLength:n,buffer:new ArrayBuffer(n),name:"Draco",byteAlign:4})}}},4141:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var i=n(9002),a=n(7987),r=n(2651),o=n(2858),s=n(346),l=n(8182),c=n(4536),_=n(2471),h=n(3496),d=n(128),u=n(9286),m=n(752),x=n(7683),f=n(1226),A=n(8430),p=n(5324),g=n(2251);class v extends i.Z{constructor(e,t,{isMorphing:n=!1,isSkinning:i=!1,isLighting:r=!1}={},o,s){super(),this.__semantics=[],this.__vertexInputs=[],this.__pixelInputs=[],this.__vertexOutputs=[],this.__pixelOutputs=[],this.__defaultInputValues=new Map,this.__vertexInputConnections=[],this.__pixelInputConnections=[],this.isSingleOperation=!1,this.__definitions="",this.shaderType=p.H.VertexAndPixelShader,this.__shader=e,this.__shaderFunctionName=t,this.__materialNodeUid=++v.__invalidMaterialNodeCount,v.materialNodes[v.__invalidMaterialNodeCount]=this,this.__isMorphing=n,this.__isSkinning=i,this.__isLighting=r,v.__dummyBlackTexture.tryToSetUniqueName("dummyBlackTexture",!0),v.__dummyWhiteTexture.tryToSetUniqueName("dummyWhiteTexture",!0),v.__dummyBlueTexture.tryToSetUniqueName("dummyBlueTexture",!0),v.__dummyBlackCubeTexture.tryToSetUniqueName("dummyBlackCubeTexture",!0),v.__dummySRGBGrayTexture.tryToSetUniqueName("dummySRGBGrayTexture",!0),v.__dummyPbrKelemenSzirmayKalosBrdfLutTexture.tryToSetUniqueName("dummyPbrKelemenSzirmayKalosBrdfLutTexture",!0),this.__vertexShaderityObject=o,this.__pixelShaderityObject=s,this.__webglResourceRepository=a.Z.getWebGLResourceRepository(),this.__definitions+=`#define RN_MATERIAL_NODE_NAME ${t}\n`}get shaderFunctionName(){return this.__shaderFunctionName}get shader(){return this.__shader}get vertexShaderityObject(){return this.__vertexShaderityObject}get pixelShaderityObject(){return this.__pixelShaderityObject}get definitions(){return this.__definitions}static getMaterialNode(e){return v.materialNodes[e]}get materialNodeUid(){return this.__materialNodeUid}get _semanticsInfoArray(){return this.__semantics}get isSkinning(){return this.__isSkinning}get isMorphing(){return this.__isMorphing}get isLighting(){return this.__isLighting}setShaderSemanticsInfoArray(e){const t=[];for(const n of e)t.push(n);this.__semantics=t,v.__semanticsMap.has(this.shaderFunctionName)||v.__semanticsMap.set(this.shaderFunctionName,new Map);const n=v.__semanticsMap.get(this.shaderFunctionName);for(const e of this.__semantics)n.set(e.semantic.str,e)}getShaderSemanticInfoFromName(e){return v.__semanticsMap.get(this.shaderFunctionName).get(e)}addVertexInputConnection(e,t,n){this.__vertexInputConnections.push({materialNodeUid:e.materialNodeUid,outputNameOfPrev:t,inputNameOfThis:n})}addPixelInputConnection(e,t,n){this.__pixelInputConnections.push({materialNodeUid:e.materialNodeUid,outputNameOfPrev:t,inputNameOfThis:n})}get vertexInputConnections(){return this.__vertexInputConnections}get pixelInputConnections(){return this.__pixelInputConnections}getVertexInput(e){for(const t of this.__vertexInputs)if(t.name===e)return t}getVertexInputs(){return this.__vertexInputs}getVertexOutput(e){for(const t of this.__vertexOutputs)if(t.name===e)return t}getVertexOutputs(){return this.__vertexOutputs}getPixelInput(e){for(const t of this.__pixelInputs)if(t.name===e)return t}getPixelInputs(){return this.__pixelInputs}getPixelOutput(e){for(const t of this.__pixelOutputs)if(t.name===e)return t}getPixelOutputs(){return this.__pixelOutputs}static initDefaultTextures(){if(this.__dummyWhiteTexture.isTextureReady)return;this.__dummyWhiteTexture.generate1x1TextureFrom(),this.__dummyBlueTexture.generate1x1TextureFrom("rgba(127.5, 127.5, 255, 1)"),this.__dummyBlackTexture.generate1x1TextureFrom("rgba(0, 0, 0, 1)"),this.__dummyBlackCubeTexture.load1x1Texture("rgba(0, 0, 0, 1)"),this.__dummySRGBGrayTexture.generate1x1TextureFrom("rgba(186, 186, 186, 1)");const e=g.Z.getInstance().getModule("pbr");this.__dummyPbrKelemenSzirmayKalosBrdfLutTexture.generateTextureFromUri(e.pbrKelemenSzirmayKalosBrdfLutDataUrl)}static get dummyWhiteTexture(){return this.__dummyWhiteTexture}static get dummyBlackTexture(){return this.__dummyBlackTexture}static get dummyBlueTexture(){return this.__dummyBlueTexture}static get dummyBlackCubeTexture(){return this.__dummyWhiteTexture}static get dummyPbrKelemenSzirmayKalosBrdfLutTexture(){return this.__dummyPbrKelemenSzirmayKalosBrdfLutTexture}setWorldMatrix(e,t){e._gl.uniformMatrix4fv(e.worldMatrix,!1,t._v)}setNormalMatrix(e,t){e._gl.uniformMatrix3fv(e.normalMatrix,!1,t._v)}setViewInfo(e,t,n,i){let a,r;if(n){const e=g.Z.getInstance().getModule("xr"),t=e.WebXRSystem.getInstance();if(t.isWebXRMode)a=t._getViewMatrixAt(i),r=t._getCameraWorldPositionAt(i);else{const t=e.WebVRSystem.getInstance();a=t.getViewMatrixAt(i),r=t.getCameraWorldPosition()}}else t?(r=t.worldPosition,a=t.viewMatrix):(a=h.Z.identity(),r=_.ZP.fromCopyArray([0,0,10]));e._gl.uniformMatrix4fv(e.viewMatrix,!1,a._v),e._gl.uniform3fv(e.viewPosition,r._v)}setProjection(e,t,n,i){let a;if(n){const e=g.Z.getInstance().getModule("xr"),t=e.WebXRSystem.getInstance();a=t.isWebXRMode?t._getProjectMatrixAt(i):e.WebVRSystem.getInstance().getProjectMatrixAt(i)}else a=t?t.projectionMatrix:h.Z.identity();e._gl.uniformMatrix4fv(e.projectionMatrix,!1,a._v)}setSkinning(e,t,n){if(this.__isSkinning)if(t){if(n){if(s.Z.boneDataType===f.N.Mat44x1){const n=t.jointMatricesArray;e._gl.uniformMatrix4fv(e.boneMatrix,!1,n)}else if(s.Z.boneDataType===f.N.Vec4x2){const n=t.jointTranslatePackedQuat,i=t.jointScalePackedQuat;e._gl.uniform4fv(e.boneTranslatePackedQuat,n),e._gl.uniform4fv(e.boneScalePackedQuat,i)}else if(s.Z.boneDataType===f.N.Vec4x2Old){const n=t.jointQuaternionArray,i=t.jointTranslateScaleArray;e._gl.uniform4fv(e.boneQuaternion,n),e._gl.uniform4fv(e.boneTranslateScale,i)}else if(s.Z.boneDataType===f.N.Vec4x1){const n=t.jointCompressedChunk,i=t.jointCompressedInfo;e._gl.uniform4fv(e.boneCompressedChunk,n),e._gl.uniform4fv(e.boneCompressedInfo,i._v)}e._gl.uniform1i(e.skinningMode,t.componentSID)}}else n&&e._gl.uniform1i(e.skinningMode,-1)}setLightsInfo(e,t,n,i){if(this.__isLighting&&i){e._gl.uniform1i(e.lightNumber,t.length);const n=Math.min(t.length,s.Z.maxLightNumberInShader);v.__lightPositions.length!==4*n&&(v.__lightPositions=new Float32Array(4*n),v.__lightDirections=new Float32Array(4*n),v.__lightIntensities=new Float32Array(4*n));for(let n=0;n<t.length&&!(n>=s.Z.maxLightNumberInShader)&&null!=e.lightPosition;n++){const e=t[n],i=e.entity.getSceneGraph().worldPosition,a=e.direction,r=e.intensity;v.__lightPositions[4*n+0]=i.x,v.__lightPositions[4*n+1]=i.y,v.__lightPositions[4*n+2]=i.z,v.__lightPositions[4*n+3]=e.type.index,v.__lightDirections[4*n+0]=a.x,v.__lightDirections[4*n+1]=a.y,v.__lightDirections[4*n+2]=a.z,v.__lightDirections[4*n+3]=0,v.__lightIntensities[4*n+0]=r.x,v.__lightIntensities[4*n+1]=r.y,v.__lightIntensities[4*n+2]=r.z,v.__lightIntensities[4*n+3]=0}n>0&&(e._gl.uniform4fv(e.lightPosition,v.__lightPositions),e._gl.uniform4fv(e.lightDirection,v.__lightDirections),e._gl.uniform4fv(e.lightIntensity,v.__lightIntensities))}}setMorphInfo(e,t,n,i){if(!this.__isMorphing)return;if(0===i.targets.length)return void e._gl.uniform1i(e.morphTargetNumber,0);const a=u.Z.getInstance();e._gl.uniform1i(e.morphTargetNumber,i.targets.length);const r=i.targets.map((e=>{const t=e.get(d.T.Position);let n=0,i=0;return x.V.isFastestApproach(A.Z.currentProcessApproach)&&(n=s.Z.totalSizeOfGPUShaderDataStorageExceptMorphData,a.createOrGetBuffer(m.$.GPUInstanceData).takenSizeInByte),(n+t.byteOffsetInBuffer)/4/4}));let o;e._gl.uniform1iv(e.dataTextureMorphOffsetPosition,r),o=t.mesh.weights.length>0?t.mesh.weights:n.weights.length>0?n.weights:new Float32Array(i.targets.length),e._gl.uniform1fv(e.morphWeights,o)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){}setDefaultInputValue(e,t){this.__defaultInputValues.set(e,t)}}v.__semanticsMap=new Map,v.__invalidMaterialNodeUid=-1,v.__invalidMaterialNodeCount=-1,v.materialNodes=[],v.__dummyWhiteTexture=new r.Z,v.__dummyBlueTexture=new r.Z,v.__dummyBlackTexture=new r.Z,v.__dummyPbrKelemenSzirmayKalosBrdfLutTexture=new r.Z,v.__dummySRGBGrayTexture=new r.Z,v.__dummyBlackCubeTexture=new o.Z,v.__tmp_vector4=c.ZP.zero(),v.__tmp_vector2=l.ZP.zero(),v.__lightPositions=new Float32Array(0),v.__lightDirections=new Float32Array(0),v.__lightIntensities=new Float32Array(0)},7571:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var i=n(9002),a=n(5704),r=n(4587),o=n(810),s=n(8547),l=n(3999),c=n(7987),_=n(9286),h=n(752),d=n(346),u=n(5324),m=n(3449),x=n(7348),f=n(3648),A=n(7683),p=n(1226),g=n(1813),v=n(6773),y=n(4690);class I extends i.Z{constructor(e,t,n){super(),this.__materialNodes=[],this.__fields=new Map,this.__fieldsForNonSystem=new Map,this.__fieldsInfo=new Map,this._shaderProgramUid=c.Z.InvalidCGAPIResourceUid,this.__alphaMode=a.F.Opaque,this.__materialUid=-1,this.__materialSid=-1,this.__belongPrimitives=new Map,this.cullFace=!0,this.cullFrontFaceCCW=!0,this.__blendEquationMode=32774,this.__blendEquationModeAlpha=32774,this.__blendFuncSrcFactor=770,this.__blendFuncDstFactor=771,this.__blendFuncAlphaSrcFactor=1,this.__blendFuncAlphaDstFactor=1,this.__alphaToCoverage=!1,this.__materialNodes=n,this.__materialTid=e,this.__materialTypeName=t,this.initialize()}get materialTypeName(){return this.__materialTypeName}static getMaterialByMaterialUid(e){return this.__materialMap.get(e)}_addBelongPrimitive(e){this.__belongPrimitives.set(e.primitiveUid,e)}_belongPrimitives(){return Array.from(this.__belongPrimitives.values())}get materialTID(){return this.__materialTid}get fieldsInfoArray(){return Array.from(this.__fieldsInfo.values())}static createMaterial(e,t){let n=t;return n||(n=I.__materialTypes.get(e)),new I(I.__materialTids.get(e),e,n)}static isRegisteredMaterialType(e){return I.__materialTypes.has(e)}static _calcAlignedByteLength(e){const t=e.compositionType.getNumberOfComponents()*e.componentType.getSizeInBytes();let n=t;if(n%16!=0&&(n=t+16-t%16),o.d.isArray(e.compositionType)){const t=e.maxIndex;null!=t?n*=t:(console.error("semanticInfo has invalid maxIndex!"),n*=100)}return n}static __allocateBufferView(e,t){let n=0;const i=[];for(const a of t)for(const t of a._semanticsInfoArray){const a=I._calcAlignedByteLength(t);let r=1;t.soloDatum||(r=I.__maxInstances.get(e)),n+=a*r,i.push({alignedByte:a,semanticInfo:t})}this.__accessors.has(e)||this.__accessors.set(e,new Map);const a=_.Z.getInstance().createOrGetBuffer(h.$.GPUInstanceData);let r;this.__bufferViews.has(e)?r=this.__bufferViews.get(e):(r=a.takeBufferView({byteLengthToNeed:n,byteStride:0}),this.__bufferViews.set(e,r));for(let t=0;t<i.length;t++){const n=i[t].alignedByte,a=i[t].semanticInfo;let c=1;a.soloDatum||(c=I.__maxInstances.get(e));let _=a.maxIndex;o.d.isArray(a.compositionType)&&null==_&&(_=100);const h=r.takeAccessor({compositionType:a.compositionType,componentType:l.r.Float,count:c,byteStride:n,arrayLength:_}),d=this._getPropertyIndex(a);if(a.soloDatum){const t=h.takeOne();let n=this.__soloDatumFields.get(e);null==n&&(n=new Map,this.__soloDatumFields.set(e,n)),n.set(this._getPropertyIndex(a),{info:a,value:s.Z.initWithFloat32Array(a.initialValue,a.initialValue,t,a.compositionType)})}else this.__accessors.get(e).set(d,h)}return r}static registerMaterial(e,t,n=d.Z.maxMaterialInstanceForEachType){if(I.__materialTypes.has(e))return console.info(`${e} is already registered.`),!1;{I.__materialTypes.set(e,t);const i=++I.__materialTidCount;return I.__materialTids.set(e,i),I.__maxInstances.set(e,n),I.__allocateBufferView(e,t),I.__materialInstanceCountOfType.set(e,0),!0}}static forceRegisterMaterial(e,t,n=d.Z.maxMaterialInstanceForEachType){I.__materialTypes.set(e,t);const i=++I.__materialTidCount;return I.__materialTids.set(e,i),I.__maxInstances.set(e,n),I.__allocateBufferView(e,t),I.__materialInstanceCountOfType.set(e,0),!0}static getAllMaterials(){return Array.from(I.__materialMap.values())}setMaterialNodes(e){this.__materialNodes=e}get materialUID(){return this.__materialUid}get materialSID(){return this.__materialSid}get isSkinning(){return this.__materialNodes[0].isSkinning}get isMorphing(){return this.__materialNodes[0].isMorphing}get isLighting(){return this.__materialNodes[0].isLighting}static _getPropertyIndex(e){let t=e.semantic.index;return null!=e.index&&(t+=e.index,t*=-1),t}static _getPropertyIndex2(e,t){let n=e.index;return null!=t&&(n+=t,n*=-1),n}initialize(){this.__materialUid=++I.__materialUidCount,I.__materialMap.set(this.__materialUid,this),I.__instancesByTypes.set(this.__materialTypeName,this),this.tryToSetUniqueName(this.__materialTypeName,!0);let e=I.__materialInstanceCountOfType.get(this.__materialTypeName);this.__materialSid=e++;let t=I.__instances.get(this.__materialTypeName);y.Is.not.exist(t)&&(t=new Map,I.__instances.set(this.__materialTypeName,t)),t.set(this.__materialSid,this),I.__materialInstanceCountOfType.set(this.__materialTypeName,e),this.__materialNodes.forEach((e=>{const t=e._semanticsInfoArray,n=I.__accessors.get(this.__materialTypeName);t.forEach((e=>{const t=I._getPropertyIndex(e);if(this.__fieldsInfo.set(t,e),!e.soloDatum){const i=n.get(t).takeOne(),a={info:e,value:s.Z.initWithFloat32Array(e.initialValue,e.initialValue,i,e.compositionType)};this.__fields.set(t,a),e.isSystem||this.__fieldsForNonSystem.set(t,a)}}))}))}setParameterByUniformName(e,t,n){const i=this.__getTargetShaderSemantics(e);null!=i&&this.setParameter(i,t,n)}setTextureParameterByUniformName(e,t){const n=this.__getTargetShaderSemantics(e);null!=n&&this.setTextureParameter(n,t)}__getTargetShaderSemantics(e){const t=this.fieldsInfoArray.find((t=>(t.none_u_prefix?"":"u_")+t.semantic.str===e));if(null!=t)return t.semantic;console.error(`Material.__getTargetShaderSemantics: uniform ${e} is not found`)}setParameter(e,t,n){const i=I._getPropertyIndex2(e,n),a=this.__fieldsInfo.get(i);if(null!=a){let e;e=a.soloDatum?I.__soloDatumFields.get(this.__materialTypeName).get(i):this.__fields.get(i),s.Z._setForce(e.value,t)}}setTextureParameter(e,t){if(this.__fieldsInfo.has(e.index)){const n=this.__fields.get(e.index),i={value:[n.value[0],t],info:n.info};this.__fields.set(e.index,i),n.info.isSystem||this.__fieldsForNonSystem.set(e.index,i),e!==r.f.DiffuseColorTexture&&e!==r.f.BaseColorTexture||t.isTransparent&&(this.alphaMode=a.F.Translucent)}}getParameter(e){var t,n;const i=this.__fieldsInfo.get(e.index);if(null!=i)return i.soloDatum?null===(t=I.__soloDatumFields.get(this.__materialTypeName).get(e.index))||void 0===t?void 0:t.value:null===(n=this.__fields.get(e.index))||void 0===n?void 0:n.value}setUniformLocationsOfMaterialNodes(e){const t=c.Z.getWebGLResourceRepository();let n=[];this.__materialNodes.forEach((e=>{const t=e._semanticsInfoArray;n=n.concat(t)})),t.setupUniformLocations(this._shaderProgramUid,n,e)}isShaderProgramReady(){return this._shaderProgramUid!==c.Z.InvalidCGAPIResourceUid}_setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){this.__materialNodes.forEach((a=>{a.setParametersForGPU&&a.setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i})}));const a=c.Z.getWebGLResourceRepository();i.setUniform?this.__fieldsForNonSystem.forEach((e=>{const i=e.info;n||i.updateInterval!==g.a.FirstTimeOnly?a.setUniformValue(t,i.semantic.str,n,e.value,i.index):i.compositionType!==o.d.Texture2D&&i.compositionType!==o.d.TextureCube||a.bindTexture(i,e.value)})):this.__fieldsForNonSystem.forEach((e=>{const i=e.info;i.compositionType!==o.d.Texture2D&&i.compositionType!==o.d.TextureCube||(n||i.updateInterval!==g.a.FirstTimeOnly?a.setUniformValue(t,i.semantic.str,n,e.value,i.index):a.bindTexture(i,e.value))})),this.setSoloDatumParametersForGPU({shaderProgram:t,firstTime:n,args:i})}setSoloDatumParametersForGPU({shaderProgram:e,firstTime:t,args:n}){const i=c.Z.getWebGLResourceRepository(),a=this.__materialTypeName,r=I.__soloDatumFields.get(a);null!=r&&r.forEach(((a,r)=>{const s=a.info;(n.setUniform||s.compositionType===o.d.Texture2D||s.compositionType===o.d.TextureCube)&&(s.isSystem||(t||s.updateInterval!==g.a.FirstTimeOnly?i.setUniformValue(e,s.semantic.str,t,a.value,s.index):i.bindTexture(s,a.value)))}))}__setupGlobalShaderDefinition(){let e="";const t=c.Z.getWebGLResourceRepository().currentWebGLContextWrapper;return t.isWebGL2&&(e+="#version 300 es\n#define GLSL_ES3\n",d.Z.isUboEnabled&&(e+="#define RN_IS_UBO_ENABLED\n")),e+=`#define RN_MATERIAL_TYPE_NAME ${this.__materialTypeName}\n`,A.V.isFastestApproach(f.Z.getInstance().processApproach)?e+="#define RN_IS_FASTEST_MODE\n":e+="#define RN_IS_UNIFORM_MODE\n",t.webgl1ExtSTL&&(e+="#define WEBGL1_EXT_SHADER_TEXTURE_LOD\n"),t.webgl1ExtDRV&&(e+="#define WEBGL1_EXT_STANDARD_DERIVATIVES\n"),(t.isWebGL2||t.webgl1ExtDRV)&&(e+="#define RN_IS_SUPPORTING_STANDARD_DERIVATIVES\n"),d.Z.boneDataType===p.N.Mat44x1?e+="#define RN_BONE_DATA_TYPE_Mat44x1\n":d.Z.boneDataType===p.N.Vec4x2?e+="#define RN_BONE_DATA_TYPE_VEC4X2\n":d.Z.boneDataType===p.N.Vec4x2Old?e+="#define RN_BONE_DATA_TYPE_VEC4X2_OLD\n":d.Z.boneDataType===p.N.Vec4x1&&(e+="#define RN_BONE_DATA_TYPE_VEC4X1\n"),e}createProgramAsSingleOperation(e,t,n){const i=c.Z.getWebGLResourceRepository(),a=this.__materialNodes[0],r=a.shader,{vertexPropertiesStr:o,pixelPropertiesStr:s}=this._getProperties(t,n),l=a.definitions;let _=this.__setupGlobalShaderDefinition(),h=this.__setupGlobalShaderDefinition();const d=v.Z.fillTemplate(a.vertexShaderityObject,{getters:o,definitions:l,dataUBODefinition:i.getGlslDataUBODefinitionString(),dataUBOVec4Size:i.getGlslDataUBOVec4SizeString(),matricesGetters:e}),u=v.Z.transformWebGLVersion(d,n).code,m=v.Z.fillTemplate(a.pixelShaderityObject,{getters:s,definitions:l,dataUBODefinition:i.getGlslDataUBODefinitionString(),dataUBOVec4Size:i.getGlslDataUBOVec4SizeString()}),x=v.Z.transformWebGLVersion(m,n).code;_+=u.replace(/#version\s+(100|300\s+es)/,""),h+=x.replace(/#version\s+(100|300\s+es)/,"");const{attributeNames:f,attributeSemantics:A}=this.__getAttributeInfo(a,r);return _+=this.__outputVertexAttributeBindingInfo(f,A),this.__createShaderProgramWithCache(_,h,f,A)}createProgramAsSingleOperationByUpdatedSources(e){const t=this.__materialNodes[0],n=t.shader,{attributeNames:i,attributeSemantics:a}=this.__getAttributeInfo(t,n);return this.__createShaderProgramWithCache(e.vertex,e.pixel,i,a)}__createShaderProgramWithCache(e,t,n,i){const a=e+t;let r=I.__shaderStringMap.get(a);if(r)return this._shaderProgramUid=r,r;const o=m.Z.toCRC32(a);if(r=I.__shaderHashMap.get(o),r)return this._shaderProgramUid=r,this._shaderProgramUid;{const r=c.Z.getWebGLResourceRepository();return this._shaderProgramUid=r.createShaderProgram({material:this,vertexShaderStr:e,fragmentShaderStr:t,attributeNames:n,attributeSemantics:i}),I.__shaderStringMap.set(a,this._shaderProgramUid),I.__shaderHashMap.set(o,this._shaderProgramUid),this._shaderProgramUid}}__getAttributeInfo(e,t){let n,i;if(null!=e.vertexShaderityObject){const t=v.Z.getAttributeReflection(e.vertexShaderityObject);n=t.names,i=t.semantics}else n=t.attributeNames,i=t.attributeSemantics;return{attributeNames:n,attributeSemantics:i}}__outputVertexAttributeBindingInfo(e,t){let n="\n// Vertex Attributes Binding Info\n";for(let i=0;i<e.length;i++)n+=`// ${e[i]}: ${t[i].str} \n`;return n}_getProperties(e,t){let n="",i="";this.__fieldsInfo.forEach(((a,r)=>{const o=this.__fieldsInfo.get(r);o.stage!==u.H.VertexShader&&o.stage!==u.H.VertexAndPixelShader||(n+=e(this.__materialTypeName,o,r,!1,t)),o.stage!==u.H.PixelShader&&o.stage!==u.H.VertexAndPixelShader||(i+=e(this.__materialTypeName,o,r,!1,t))}));const a=x.Z.getInstance();return[n,i]=a.addPropertiesStr(n,i,e,t),{vertexPropertiesStr:n,pixelPropertiesStr:i}}createProgram(e,t,n){return this.createProgramAsSingleOperation(e,t,n)}createProgramByUpdatedSources(e){const t=this.createProgramAsSingleOperationByUpdatedSources(e);return t>0&&(this.__updatedShaderSources=e),t}isBlend(){return this.alphaMode===a.F.Translucent||this.alphaMode===a.F.Additive}static getLocationOffsetOfMemberOfMaterial(e,t){const n=I.__instancesByTypes.get(e);return n.__fieldsInfo.get(t).soloDatum?I.__soloDatumFields.get(n.__materialTypeName).get(t).value._v.byteOffset/4/4:this.__accessors.get(e).get(t).byteOffsetInBuffer/4/4}static getAccessorOfMemberOfMaterial(e,t){if(!I.__instancesByTypes.get(e).__fieldsInfo.get(t).soloDatum)return this.__accessors.get(e).get(t)}get alphaMode(){return this.__alphaMode}set alphaMode(e){this.__alphaMode=e}setBlendEquationMode(e,t){this.__blendEquationMode=e,this.__blendEquationModeAlpha=null!=t?t:e}setBlendFuncSeparateFactor(e,t,n,i){this.__blendFuncSrcFactor=e,this.__blendFuncDstFactor=t,this.__blendFuncAlphaSrcFactor=n,this.__blendFuncAlphaDstFactor=i}setBlendFuncFactor(e,t){this.__blendFuncSrcFactor=e,this.__blendFuncDstFactor=t,this.__blendFuncAlphaSrcFactor=e,this.__blendFuncAlphaDstFactor=t}get blendEquationMode(){return this.__blendEquationMode}get blendEquationModeAlpha(){return this.__blendEquationModeAlpha}get blendFuncSrcFactor(){return this.__blendFuncSrcFactor}get blendFuncDstFactor(){return this.__blendFuncDstFactor}get blendFuncAlphaSrcFactor(){return this.__blendFuncAlphaSrcFactor}get blendFuncAlphaDstFactor(){return this.__blendFuncAlphaDstFactor}isEmptyMaterial(){return 0===this.__materialNodes.length}getShaderSemanticInfoFromName(e){for(const t of this.__materialNodes)return t.getShaderSemanticInfoFromName(e)}setupAdditionalUniformLocations(e,t){return c.Z.getWebGLResourceRepository().setupUniformLocations(this._shaderProgramUid,e,t)}setupBasicUniformsLocations(){c.Z.getWebGLResourceRepository().setupBasicUniformLocations(this._shaderProgramUid)}set alphaToCoverage(e){e&&this.alphaMode===a.F.Translucent&&console.warn("If you set alphaToCoverage = true on a material whose AlphaMode is Translucent, you may get drawing problems."),this.__alphaToCoverage=e}get alphaToCoverage(){return this.__alphaToCoverage}}I.__soloDatumFields=new Map,I.__shaderHashMap=new Map,I.__shaderStringMap=new Map,I.__materialMap=new Map,I.__instances=new Map,I.__instancesByTypes=new Map,I.__materialTids=new Map,I.__materialInstanceCountOfType=new Map,I.__materialTidCount=-1,I.__materialUidCount=-1,I.__materialTypes=new Map,I.__maxInstances=new Map,I.__bufferViews=new Map,I.__accessors=new Map},6773:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var i=n(3034),a=n.n(i),r=n(3999),o=n(810),s=n(128),l=n(9286),c=n(4710),_=n(346),h=n(4587),d=n(1813),u=n(4141),m=n(8182),x=n(9190),f=n(4536),A=n(2566),p=n(3496),g=n(4267),v=n(1162),y=n(5324);class I{static fillTemplate(e,t){const n=Object.assign(t,{WellKnownComponentTIDs:c.z,widthOfDataTexture:`const int widthOfDataTexture = ${l.Z.bufferWidthLength};`,heightOfDataTexture:`const int heightOfDataTexture = ${l.Z.bufferHeightLength};`,Config:_.Z});return a().fillTemplate(e,n)}static transformWebGLVersion(e,t){return t?a().transformToGLSLES3(e):a().transformToGLSLES1(e,!0)}static getAttributeReflection(e){const t=a().createReflectionObject(e);return this.__setDefaultAttributeSemanticMap(t),t.reflect(),{names:t.attributesNames,semantics:t.attributesSemantics.map((e=>s.T.fromString(e))),compositions:t.attributesTypes.map((e=>o.d.fromGlslString(e))),components:t.attributesTypes.map((e=>r.r.fromGlslString(e)))}}static __setDefaultAttributeSemanticMap(e){const t=new Map;t.set("instanceid","INSTANCE"),t.set("barycentriccoord","BARY_CENTRIC_COORD"),e.addAttributeSemanticsMap(t)}static getShaderDataRefection(e,t){const n=this.__copyShaderityObject(e),i=e.code.split(/\r\n|\n/),a=[],r=[];for(const n of i){const i=/^(?![/])[\t ]*uniform[\t ]+(\w+)[\t ]+(\w+);[\t ]*(\/\/)*[\t ]*(.*)/,o=n.match(i);if(o){const i=o[1],s=o[2],l=o[4];if(this.__ignoreThisUniformDeclaration(l)){a.push(n);continue}const c=this.__createShaderSemanticsInfo(i,s,l,e.isFragmentShader,t);r.push(c)}else a.push(n)}return n.code=a.join("\n"),{shaderSemanticsInfoArray:r,shaderityObject:n}}static __copyShaderityObject(e){return{code:e.code,shaderStage:e.shaderStage,isFragmentShader:"fragment"===e.shaderStage}}static __ignoreThisUniformDeclaration(e){const t=e.match(/skipProcess[\t ]*=[\t ]*(\w+)[,\t ]*/);return"true"===(null==t?void 0:t[1])}static __createShaderSemanticsInfo(e,t,n,i,a){const s=r.r.fromGlslString(e),l=o.d.fromGlslString(e),c=i?y.H.PixelShader:y.H.VertexShader;let _=!0;const d=t.match(/u_(\w+)/);d&&(t=d[1],_=!1);let u=h.f.fromStringCaseSensitively(t);if(null==u){const e=null==a?void 0:a.get(t);u=null!=e?e.semantic:new h.w({str:t})}const m={semantic:u,compositionType:l,componentType:s,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!1,stage:c,none_u_prefix:_};return this.__setRhodoniteOriginalParametersTo(m,n),m}static __setRhodoniteOriginalParametersTo(e,t){var n;const i=t.match(/soloDatum[\t ]*=[\t ]*(\w+)[,\t ]*/);let a=!1;"true"===(null==i?void 0:i[1])&&(a=!0),e.soloDatum=a;const r=t.match(/isSystem[\t ]*=[\t ]*(\w+)[,\t ]*/);let o=!1;"true"===(null==r?void 0:r[1])&&(o=!0),e.isSystem=o;const s=t.match(/updateInterval[\t ]*=[\t ]*(\w+)[,\t ]*/);let l=d.a.FirstTimeOnly;"everytime"===(null===(n=null==s?void 0:s[1])||void 0===n?void 0:n.toLowerCase())&&(l=d.a.EveryTime),e.updateInterval=l;const c=t.match(/initialValue[\t ]*=[\t ]*(.+)[,\t ]*/);if(c){const t=c[1];e.initialValue=this.__getInitialValueFromText(e,t)}else e.initialValue=this.__getDefaultInitialValue(e)}static __getInitialValueFromText(e,t){const n=t.match(/\(([\d\w., ]+)\)/),i=t=>{e.compositionType!==t&&console.error("component number of initialValue is invalid!")};let a;if(n){const t=n[1].split(",");switch(t.length){case 2:if(e.compositionType===o.d.Texture2D){const e=t[1].charAt(0).toUpperCase()+t[1].slice(1);a=[parseInt(t[0]),u.Z[`dummy${e}Texture`]]}else if(e.compositionType===o.d.TextureCube){const e=t[1].charAt(0).toUpperCase()+t[1].slice(1);a=[parseInt(t[0]),u.Z[`dummy${e}CubeTexture`]]}else i(o.d.Vec2),a=m.ZP.fromCopyArray([parseFloat(t[0]),parseFloat(t[1])]);break;case 3:i(o.d.Vec3),a=x.ZP.fromCopyArray([parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2])]);break;case 4:i(o.d.Vec4),a=f.ZP.fromCopyArray([parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])]);break;case 9:i(o.d.Mat3),a=new A.Z(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]),parseFloat(t[5]),parseFloat(t[6]),parseFloat(t[7]),parseFloat(t[8]));break;case 16:i(o.d.Mat4),a=new p.Z(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4]),parseFloat(t[5]),parseFloat(t[6]),parseFloat(t[7]),parseFloat(t[8]),parseFloat(t[9]),parseFloat(t[10]),parseFloat(t[11]),parseFloat(t[12]),parseFloat(t[13]),parseFloat(t[14]),parseFloat(t[15]));break;default:console.error("Invalid format")}}else i(o.d.Scalar),a=new g.ZP(new Float32Array([parseFloat(t)]));return a}static __getDefaultInitialValue(e){return e.compositionType===o.d.Scalar?new g.ZP(new Float32Array([0])):e.compositionType===o.d.Vec2?m.ZP.zero():e.compositionType===o.d.Vec3?x.ZP.zero():e.compositionType===o.d.Vec4?f.ZP.zero():e.compositionType===o.d.Mat2?v.Z.identity():e.compositionType===o.d.Mat3?A.Z.identity():e.compositionType===o.d.Mat4?p.Z.identity():e.compositionType===o.d.Texture2D?[0,u.Z.dummyWhiteTexture]:e.compositionType===o.d.TextureCube?[0,u.Z.dummyBlackTexture]:void console.warn("initial value is not found")}}},3474:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(4141),a=n(1784),r=n(2404),o=n(3999),s=n(810),l=n(3616),c=n(4587),_=n(5324),h=n(1813),d=n(871),u=n(2471);const m={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin vec3 a_position;\nin vec3 a_normal;\nin float a_instanceID;\nin vec4 a_joint;\nin vec4 a_weight;\n\nout vec3 v_normal_inWorld;\nout vec4 v_position_inLocal;\nout vec4 v_position_inWorld;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main(){\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  // Skeletal\n  processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n  v_position_inLocal = gl_Position;\n\n// #ifdef RN_IS_POINTSPRITE\n\nvec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\nvec3 viewPosition = get_viewPosition(cameraSID, 0);\nfloat distanceFromCamera = length(position_inWorld.xyz - viewPosition);\nvec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\nfloat distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\nfloat maxPointSize = get_pointSize(materialSID, 0);\ngl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);\n\n// #endif\n\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},x={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec4 v_position_inLocal;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\nvec4 encodeDepthToRGBA(float depth){\n  float r = depth;\n  float g = fract(r * 255.0);\n  float b = fract(g * 255.0);\n  float a = fract(b * 255.0);\n  float coef = 1.0 / 255.0;\n  r -= g * coef;\n  g -= b * coef;\n  b -= a * coef;\n  return vec4(r, g, b, a);\n}\n\nvoid main (){\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n  float depth;\n  bool isPointLight = get_isPointLight(materialSID, 0);\n  if(isPointLight){\n    float zNear = get_zNearInner(materialSID, 0);\n    float zFar = get_zFarInner(materialSID, 0);\n    float normalizationCoefficient = 1.0 / (zFar - zNear);\n    depth = normalizationCoefficient * length(v_position_inLocal);\n  }else{\n    depth = gl_FragCoord.z;\n  }\n\n  float depthPow = get_depthPow(materialSID, 0);\n  float depthData = pow(depth, depthPow);\n  vec4 encodedDepth = encodeDepthToRGBA(depthData);\n\n  rt0 = encodedDepth;\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class f extends i.Z{constructor(e,{isSkinning:t}){super(null,"depthEncodeShading"+(t?"+skinning":""),{isMorphing:!1,isSkinning:t,isLighting:!1},m,x),this.__lastZNear=0,this.__lastZFar=0;const n=[{semantic:f.zNearInner,componentType:o.r.Float,compositionType:s.d.Scalar,stage:_.H.PixelShader,isSystem:!0,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:l.ZP.fromCopyNumber(.1),min:1e-4,max:Number.MAX_SAFE_INTEGER},{semantic:f.zFarInner,componentType:o.r.Float,compositionType:s.d.Scalar,stage:_.H.PixelShader,isSystem:!0,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:l.ZP.fromCopyNumber(1e4),min:1e-4,max:Number.MAX_SAFE_INTEGER},{semantic:f.isPointLight,componentType:o.r.Bool,compositionType:s.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:l.ZP.fromCopyNumber(1),min:0,max:1},{semantic:f.depthPow,componentType:o.r.Float,compositionType:s.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:l.ZP.fromCopyNumber(e),min:1,max:2},{semantic:c.f.PointSize,componentType:o.r.Float,compositionType:s.d.Scalar,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:l.ZP.fromCopyNumber(30),min:0,max:100},{semantic:c.f.PointDistanceAttenuation,componentType:o.r.Float,compositionType:s.d.Vec3,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:u.ZP.fromCopyArray([0,.1,.01]),min:0,max:1}];t&&(this.__definitions+="#define RN_IS_SKINNING"),this.setShaderSemanticsInfoArray(n)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){let o=i.renderPass.cameraComponent;null==o&&(o=r.Z.getInstance().getComponent(a.Z,a.Z.main)),i.setUniform?(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix),this.setViewInfo(t,o,i.isVr,i.displayIdx),this.setProjection(t,o,i.isVr,i.displayIdx),(n||this.__lastZNear!==o.zNearInner)&&(t._gl.uniform1f(t.zNearInner,o.zNearInner),this.__lastZNear=o.zNearInner),this.__lastZFar!==o.zFarInner&&(t._gl.uniform1f(t.zFarInner,o.zFarInner),this.__lastZFar=o.zFarInner)):(e.setParameter(f.zNearInner,o.zNearInner),e.setParameter(f.zFarInner,o.zFarInner));const s=i.entity.getComponent(d.Z);this.setSkinning(t,s,i.setUniform)}}f.zNearInner=new c.w({str:"zNearInner"}),f.zFarInner=new c.w({str:"zFarInner"}),f.isPointLight=new c.w({str:"isPointLight"}),f.depthPow=new c.w({str:"depthPow"})},2939:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var i=n(4587),a=n(810),r=n(3999),o=n(5324),s=n(1813),l=n(2404),c=n(1784),_=n(3616),h=n(4141);const d={code:"\nprecision highp float;\nprecision highp int;\n\n\nin float a_instanceID;\nin vec3 a_position;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},u={code:"\nprecision highp float;\nprecision highp int;\n\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float framebufferWidth = get_framebufferWidth(materialSID, 0);\n\tfloat tFrag = 1.0 / framebufferWidth;\n  vec2 offset = gl_FragCoord.st;\n  vec4 baseColor = texture2D(u_baseColorTexture, offset * tFrag);\n\n  float luminance = length(baseColor);\n\n  float luminanceCriterion = get_luminanceCriterion(materialSID, 0);\n  if(luminance < luminanceCriterion){\n    baseColor = vec4(0.0);\n  }else{\n    float luminanceReduce = get_luminanceReduce(materialSID, 0);\n    baseColor.rgb = pow(baseColor.rgb, vec3(luminanceReduce));\n  }\n\n  rt0 = baseColor;\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class m extends h.Z{constructor(e,t){super(null,"HighLuminanceDetectShading",{},d,u);const n=[{semantic:m.LuminanceCriterion,componentType:r.r.Float,compositionType:a.d.Scalar,stage:o.H.PixelShader,isSystem:!1,updateInterval:s.a.FirstTimeOnly,soloDatum:!1,initialValue:_.ZP.fromCopyNumber(2),min:0,max:Number.MAX_VALUE},{semantic:m.LuminanceReduce,componentType:r.r.Float,compositionType:a.d.Scalar,stage:o.H.PixelShader,isSystem:!1,updateInterval:s.a.FirstTimeOnly,soloDatum:!1,initialValue:_.ZP.fromCopyNumber(.25),min:0,max:1}];let l,c;const x=e.getFramebuffer();null!=x&&null!=x.colorAttachments[t]?(l=x.colorAttachments[t],c=x.width):(l=h.Z.__dummyBlackTexture,c=1,null!=x?console.warn("renderPass does not have framebuffer.colorAttachments["+t+"]"):console.warn("renderPass does not have framebuffer")),n.push({semantic:i.f.FramebufferWidth,componentType:r.r.Float,compositionType:a.d.Scalar,stage:o.H.PixelShader,isSystem:!1,updateInterval:s.a.EveryTime,soloDatum:!1,initialValue:_.ZP.fromCopyNumber(c),min:0,max:Number.MAX_VALUE},{semantic:i.f.BaseColorTexture,componentType:r.r.Int,compositionType:a.d.Texture2D,stage:o.H.PixelShader,isSystem:!1,updateInterval:s.a.EveryTime,initialValue:[0,l],min:0,max:Number.MAX_SAFE_INTEGER}),this.setShaderSemanticsInfoArray(n)}setParametersForGPU({material:e,shaderProgram:t,args:n}){n.setUniform&&this.setWorldMatrix(t,n.worldMatrix);let i=n.renderPass.cameraComponent;null==i&&(i=l.Z.getInstance().getComponent(c.Z,c.Z.main)),i&&(this.setViewInfo(t,i,n.isVr,n.displayIdx),this.setProjection(t,i,n.isVr,n.displayIdx))}}m.LuminanceCriterion=new i.w({str:"luminanceCriterion"}),m.LuminanceReduce=new i.w({str:"luminanceReduce"}),m.FramebufferWidth=new i.w({str:"framebufferWidth"})},6529:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i=n(4587),a=n(4141),r=n(810),o=n(3999),s=n(7192),l=n(5324),c=n(3616),_=n(2404),h=n(1784),d=n(1813);const u={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\n\nout vec2 v_texcoord_0;\nout vec3 v_color;\nout vec3 v_normal_inWorld;\nout vec3 v_position_inWorld;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n  v_normal_inWorld = normalMatrix * a_normal;\n\n  v_color = a_color;\n  v_position_inWorld = (worldMatrix * vec4(a_position, 1.0)).xyz;\n  v_texcoord_0 = a_texcoord_0;\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},m={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec2 v_texcoord_0;\nin vec3 v_color;\nin vec3 v_normal_inWorld;\nin vec3 v_position_inWorld;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\nvec3 srgbToLinear(vec3 srgbColor) {\n  return pow(srgbColor, vec3(2.2));\n}\n\nvoid main() {\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  // diffuseColor\n  vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  vec4 diffuseColorFactor = get_diffuseColorFactor(materialSID, 0);\n  if (v_color != diffuseColor && diffuseColorFactor.rgb != diffuseColor) {\n    diffuseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == diffuseColor) {\n    diffuseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == diffuseColor) {\n    diffuseColor = v_color;\n  } else {\n    diffuseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n  // diffuseColorTexture\n\n  // adapt OpenGL (RenderMan) CubeMap convention\n  float envRotation = get_envRotation(materialSID, 0);\n  float rot = envRotation + 3.1415;\n  mat3 rotEnvMatrix = mat3(cos(rot), 0.0, -sin(rot), 0.0, 1.0, 0.0, sin(rot), 0.0, cos(rot));\n  vec3 envNormal = normalize(rotEnvMatrix * v_position_inWorld);\n  envNormal.x *= -1.0;\n\n  vec4 diffuseTexel = textureCube(u_colorEnvTexture, envNormal);\n  vec3 textureColor;\n  int EnvHdriFormat = get_EnvHdriFormat(materialSID, 0);\n  if (EnvHdriFormat == 0) { // LDR_SRGB\n    textureColor = srgbToLinear(diffuseTexel.rgb);\n  } else if (EnvHdriFormat == 3) { // RGBE\n    textureColor = diffuseTexel.rgb * pow(2.0, diffuseTexel.a*255.0-128.0);\n  } else {\n    textureColor = diffuseTexel.rgb;\n  }\n  diffuseColor *= textureColor;\n\n  rt0 = vec4(diffuseColor, alpha);\n\nfloat makeOutputSrgb = float(get_makeOutputSrgb(materialSID, 0));\nrt0.rgb = mix(rt0.rgb, linearToSrgb(rt0.rgb), makeOutputSrgb);\n\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class x extends a.Z{constructor(e){super(null,"envConstantShading",{},u,m);const t=[{semantic:x.EnvHdriFormat,componentType:o.r.Int,compositionType:r.d.Scalar,stage:l.H.PixelShader,isSystem:!1,updateInterval:d.a.EveryTime,soloDatum:!1,initialValue:c.ZP.fromCopyNumber(0),min:0,max:5},{semantic:x.envRotation,componentType:o.r.Float,compositionType:r.d.Scalar,stage:l.H.PixelShader,isSystem:!1,updateInterval:d.a.EveryTime,soloDatum:!1,initialValue:c.ZP.fromCopyNumber(0),min:-Math.PI,max:Math.PI},{semantic:i.f.DiffuseColorFactor,componentType:o.r.Float,compositionType:r.d.Vec4,stage:l.H.PixelShader,isSystem:!1,updateInterval:d.a.EveryTime,soloDatum:!1,initialValue:s.ZP.fromCopyArray([1,1,1,1]),min:0,max:2},{semantic:i.f.ColorEnvTexture,componentType:o.r.Int,compositionType:r.d.TextureCube,stage:l.H.PixelShader,isSystem:!1,updateInterval:d.a.EveryTime,initialValue:[0,a.Z.__dummyBlackCubeTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:i.f.MakeOutputSrgb,compositionType:r.d.Scalar,componentType:o.r.Bool,stage:l.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:d.a.FirstTimeOnly,initialValue:c.ZP.fromCopyNumber(e?1:0)}];this.setShaderSemanticsInfoArray(t)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let a=i.renderPass.cameraComponent;null==a&&(a=_.Z.getInstance().getComponent(h.Z,h.Z.main)),a&&(this.setViewInfo(t,a,i.isVr,i.displayIdx),this.setProjection(t,a,i.isVr,i.displayIdx))}}x.envRotation=new i.w({str:"envRotation"}),x.EnvHdriFormat=new i.w({str:"EnvHdriFormat"})},9434:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i=n(3999),a=n(810),r=n(3616),o=n(4587),s=n(5324),l=n(1813),c=n(2390),_=n(4141),h=n(2404),d=n(1784);const u={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin float a_instanceID;\nin vec2 a_texcoord;\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\nin vec4 a_joint;\nin vec4 a_weight;\n\nout vec2 v_texcoord;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n  v_normal_inWorld = normalMatrix * a_normal;\n  v_position_inWorld = worldMatrix * vec4(a_position, 1.0);\n  v_texcoord = a_texcoord;\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},m={code:'\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec2 v_texcoord;\nin vec3 v_normal_inWorld;\nin vec4 v_position_inWorld;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n\n/* shaderity: @{getters} */\n\n#define MATH_PI 3.141592\n\n// These codes are referenced from https://github.com/knarkowicz/FurnaceTest\nfloat roughnessRemap(float userRoughness) {\n  return userRoughness * userRoughness;\n}\n\n// GGX NDF\nfloat d_ggx(float userRoughness, float NH) {\n  float alphaRoughness = userRoughness * userRoughness;\n  float roughnessSqr = alphaRoughness * alphaRoughness;\n  float f = (roughnessSqr - 1.0) * NH * NH + 1.0;\n  return roughnessSqr / (MATH_PI * f * f);\n}\n\n// this is from https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec3 envBRDFApprox( vec3 F0, float Roughness, float NoV ) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022 );\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04 );\n  vec4 r = Roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n  return F0 * AB.x + AB.y;\n}\n\nfloat specularIBL(float userRoughness, float NV, float f0) {\n  /// Use specular BRDF LUT\n  // vec3 brdf = texture2D(u_brdfLutTexture, vec2(NV, 1.0 - userRoughness)).rgb;\n  // float specular = 1.0 * (f0 * brdf.x + brdf.y);\n\n  /// Use specular BRDF Approx\n  float specular = envBRDFApprox(vec3(f0), userRoughness, NV).x;\n  return specular;\n}\n\n// The Schlick Approximation to Fresnel\nfloat fresnel(float f0, float VH) {\n  return f0 + (1.0 - f0) * pow(1.0 - VH, 5.0);\n}\n\nfloat smithG1(float roughness, float NoV)\n{\n\tfloat a = roughnessRemap( roughness );\n\tfloat a2 = a * a;\n\tfloat NoV2 = NoV * NoV;\n\tfloat lambda = (-1.0 + sqrt(1.0 + a2 * (1.0 - NoV2) / NoV2)) * 0.5;\n\treturn 1.0 / (1.0 + lambda);\n}\n\nfloat smithG(float roughness, float NoV, float NoL)\n{\n\tfloat a = roughnessRemap( roughness );\n\tfloat a2 = a * a;\n\tfloat NoV2 = NoV * NoV;\n\tfloat NoL2 = NoL * NoL;\n\tfloat lambdaV = (-1.0 + sqrt(1.0 + a2 * (1.0 - NoV2) / NoV2)) * 0.5;\n\tfloat lambdaL = (-1.0 + sqrt(1.0 + a2 * (1.0 - NoL2) / NoL2)) * 0.5;\n\treturn 1.0 / (1.0 + lambdaV + lambdaL);\n}\n\nfloat g_shieldingForWeak(float alphaRoughness, float NV, float NL) {\n  float r = alphaRoughness;\n\n  // Local Masking using "Schlick-Smith" Masking Function\n  float localMasking = 2.0 * NV / (NV + sqrt(r * r + (1.0 - r * r) * (NV * NV)));\n\n  return localMasking;\n}\n\n\nfloat g_shielding(float roughness, float NV, float NL) {\n  float a = roughnessRemap( roughness );\n  float r = a;\n\n  // Local Shadowing using "Schlick-Smith" Masking Function\n  float localShadowing = 2.0 * NL / (NL + sqrt(r * r + (1.0 - r * r) * (NL * NL)));\n\n  // Local Masking using "Schlick-Smith" Masking Function\n  float localMasking = 2.0 * NV / (NV + sqrt(r * r + (1.0 - r * r) * (NV * NV)));\n\n  return localShadowing * localMasking;\n}\n\nfloat v_SmithGGXCorrelatedForWeak(float roughness, float NV, float NL) {\n  float a = roughnessRemap( roughness );\n  float a2 = a * a;\n  float GGXV = NL * sqrt(NV * NV * (1.0 - a2) + a2);\n  return 0.5 / (GGXV);\n}\n\nfloat v_SmithGGXCorrelated(float roughness, float NV, float NL) {\n  float a = roughnessRemap( roughness );\n  float a2 = a * a;\n  float GGXV = NL * sqrt(NV * NV * (1.0 - a2) + a2);\n  float GGXL = NV * sqrt(NL * NL * (1.0 - a2) + a2);\n  return 0.5 / (GGXV + GGXL);\n}\n\nfloat vanDerCorpus(int n, int base)\n{\n    float invBase = 1.0 / float(base);\n    float denom   = 1.0;\n    float result  = 0.0;\n\n    for(int i = 0; i < 32; ++i)\n    {\n        if(n > 0)\n        {\n            denom   = mod(float(n), 2.0);\n            result += denom * invBase;\n            invBase = invBase / 2.0;\n            n       = int(float(n) / 2.0);\n        }\n    }\n\n    return result;\n}\n\n// this is from https://learnopengl.com/PBR/IBL/Specular-IBL\nvec2 hammersleyNoBitOps(int i, int N)\n{\n  return vec2(float(i)/float(N), vanDerCorpus(i, 2));\n}\n\nvec3 sampleHemisphereGGX(vec2 Xi, float roughness) {\n  float a = roughnessRemap(roughness);\n\tfloat a2 = a * a;\n\n  float phi = 2.0 * MATH_PI * Xi.x;\n  float cosPhi = cos(phi);\n  float sinPhi = sin(phi);\n  float cosTheta = sqrt((1.0 - Xi.y) / (1.0 + (a2 - 1.0) * Xi.y)); // GGX\n  float sinTheta = sqrt(1.0 - cosTheta * cosTheta);\n\n  return vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\n}\n\nfloat weakWhiteFurnaceTest(float roughness, float NoV, float f0, int g_type, int disable_fresnel)\n{\n\tfloat vx = sqrt(1.0 - NoV * NoV);\n\tfloat vy = 0.0;\n\tfloat vz = NoV;\n\n\tfloat integral = 0.0;\n\tconst int sampleNum = 2048;\n\tfor (int i = 0; i < sampleNum; ++i)\n\t{\n    vec2 Xi = hammersleyNoBitOps(i, sampleNum);\n\n    vec3 hvec = sampleHemisphereGGX(Xi, roughness);\n\n\t\tfloat VoHUnsat = vx * hvec.x + vy * hvec.y + vz * hvec.z;\n\n    float lz = 2.0 * VoHUnsat * hvec.z - vz;\n\n    float NoL = max(lz, 0.0);\n\t\tfloat NoH = max(hvec.z, 0.0);\n\t\tfloat VoH = max(VoHUnsat, 0.0);\n\n    float f = fresnel(f0, VoH);\n\n    float g1 = 0.0;\n    if (g_type == 0) {\n      g1 = smithG1(roughness, NoV);\n    } else if (g_type == 1) {\n      g1 = g_shieldingForWeak(roughness, NoV, NoL);\n    } else if (g_type == 2) {\n      g1 = v_SmithGGXCorrelatedForWeak(roughness, NoV, NoL) * 4.0 * NoV * NoL;\n    }\n\n    float pdf = 4.0 * VoH / NoH;\n    float integralValue = (g1 * pdf) / (4.0 * NoV);\n    if (disable_fresnel == 0) {\n      integralValue *= f;\n    }\n    // integralValue *= 0.5; // Set furnace color 0.5\n\n    integral += integralValue;\n\n\t}\n\tintegral /= float(sampleNum);\n\treturn clamp(integral, 0.0, 1.0);\n}\n\nfloat whiteFurnaceTest(float roughness, float NoV, float f0, int g_type, int disable_fresnel)\n{\n\tfloat vx = sqrt(1.0 - NoV * NoV);\n\tfloat vy = 0.0;\n\tfloat vz = NoV;\n\n\tfloat integral = 0.0;\n\tconst int sampleNum = 4096;\n\tfor (int i = 0; i < sampleNum; ++i)\n\t{\n\n    vec2 Xi = hammersleyNoBitOps(i, sampleNum);\n\n    vec3 hvec = sampleHemisphereGGX(Xi, roughness);\n\n\t\tfloat VoHUnsat = vx * hvec.x + vy * hvec.y + vz * hvec.z;\n\t\tfloat lx = 2.0 * VoHUnsat * hvec.x - vx;\n\t\tfloat ly = 2.0 * VoHUnsat * hvec.y - vy;\n\t\tfloat lz = 2.0 * VoHUnsat * hvec.z - vz;\n\n\t\tfloat NoL = max(lz, 0.0);\n\t\tfloat NoH = max(hvec.z, 0.0);\n    float VoH = max(VoHUnsat, 0.0);\n\n    float f = fresnel(f0, VoH);\n\n    float g = 0.0;\n    if (g_type == 0) {\n      g = smithG(roughness, NoV, NoL);\n    } else if (g_type == 1){\n      g = g_shielding(roughness, NoV, NoL);\n    } else if (g_type == 2){\n      g = v_SmithGGXCorrelated(roughness, NoV, NoL) * (4.0 * NoV * NoL);\n    } else if (g_type == 3) {\n      g = 0.0;\n    }\n\n    float pdf = 4.0 * VoH / NoH;\n    float integralValue = (g * pdf) / (4.0 * NoV);\n    if (disable_fresnel == 0 && g_type != 3) {\n      integralValue *= f;\n    }\n    // integralValue *= 0.5; // Set furnace color 0.5\n    integral += integralValue;\n\t}\n  integral /= float(sampleNum);\n  if (g_type == 3) {\n    integral = specularIBL(roughness, NoV, f0);\n  }\n\treturn clamp(integral, 0.0, 1.0);\n}\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  vec2 quadSizeInPixel = get_screenInfo(materialSID, 0);\n  float roughness = 0.0;\n  float NoV = 0.0; // normal dot view vector\n\n  // 2D mode\n  int mode = get_mode(materialSID, 0);\n  if (mode == 0) {\n    roughness = (gl_FragCoord.y) / quadSizeInPixel.y;\n    NoV = (gl_FragCoord.x) / quadSizeInPixel.x;\n  } else {\n    // object mode\n    // Roughness\n    const float c_MinRoughness = 0.04;\n    vec2 metallicRoughnessFactor = get_metallicRoughnessFactor(materialSID, 0);\n    float userRoughness = metallicRoughnessFactor.y;\n    float metallic = metallicRoughnessFactor.x;\n\n    vec4 ormTexel = texture2D(u_metallicRoughnessTexture, v_texcoord);\n    userRoughness = ormTexel.g * userRoughness;\n    userRoughness = clamp(userRoughness, c_MinRoughness, 1.0);\n    roughness = userRoughness;\n\n    // vec3 viewVector = normalize(vec3(0.0, 0.0, 10.0) - v_position_inWorld.xyz);\n    // vec3 viewVector = normalize(u_viewPosition - v_position_inWorld.xyz);\n    vec3 viewVector = vec3(0.0, 0.0, 1.0);\n    NoV = dot(v_normal_inWorld, viewVector);\n  }\n\n  int debugView = get_debugView(materialSID, 0);\n  float f0 = get_f0(materialSID, 0);\n  int g_type = get_g_type(materialSID, 0);\n  int disable_fresnel = get_disable_fresnel(materialSID, 0);\n\n  if (debugView == 0) {\n    float whiteFurnaceResult = whiteFurnaceTest(roughness, NoV, f0, g_type, disable_fresnel);\n    rt0 = vec4(whiteFurnaceResult, whiteFurnaceResult, whiteFurnaceResult, 1.0);\n\n  } else if (debugView == 1) {\n    float weakWhiteFurnaceResult = weakWhiteFurnaceTest(roughness, NoV, f0, g_type, disable_fresnel);\n    rt0 = vec4(weakWhiteFurnaceResult, weakWhiteFurnaceResult, weakWhiteFurnaceResult, 1.0);\n\n  } else if (debugView == 2){\n    float nn = NoV*0.5+0.5;\n    rt0 = vec4(nn, nn, nn, 1.0);\n\n  } else if (debugView == 3){\n    rt0 = vec4(v_normal_inWorld.xyz, 1.0);\n\n  } else if (debugView == 4){\n    float whiteFurnaceResult = whiteFurnaceTest(roughness, NoV, f0, g_type, disable_fresnel);\n    float weakWhiteFurnaceResult = weakWhiteFurnaceTest(roughness, NoV, f0, g_type, disable_fresnel);\n    rt0 = vec4(whiteFurnaceResult, weakWhiteFurnaceResult, 0.0, 1.0);\n\n  } else if (debugView == 5){\n    rt0 = vec4(roughness, NoV, 0.0, 1.0);\n\n  } else {\n    rt0 = vec4(1.0, 1.0, 1.0, 1.0);\n  }\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n',shaderStage:"fragment",isFragmentShader:!0};class x extends _.Z{constructor(){super(null,"FurnaceTestShading",{},u,m);const e=[{semantic:x.debugView,componentType:i.r.Int,compositionType:a.d.Scalar,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,soloDatum:!1,initialValue:r.ZP.fromCopyNumber(0),min:0,max:1},{semantic:x.disable_fresnel,componentType:i.r.Int,compositionType:a.d.Scalar,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,soloDatum:!1,initialValue:r.ZP.fromCopyNumber(0),min:0,max:1},{semantic:x.f0,componentType:i.r.Float,compositionType:a.d.Scalar,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,soloDatum:!1,initialValue:r.ZP.fromCopyNumber(1),min:0,max:1},{semantic:x.g_type,componentType:i.r.Int,compositionType:a.d.Scalar,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,soloDatum:!1,initialValue:r.ZP.fromCopyNumber(0),min:0,max:3},{semantic:x.mode,componentType:i.r.Int,compositionType:a.d.Scalar,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,soloDatum:!1,initialValue:r.ZP.fromCopyNumber(0),min:0,max:1},{semantic:o.f.ScreenInfo,componentType:i.r.Float,compositionType:a.d.Vec2,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,soloDatum:!1,initialValue:c.ZP.fromCopyArray2([0,0]),min:0,max:Number.MAX_SAFE_INTEGER},{semantic:o.f.MetallicRoughnessFactor,componentType:i.r.Float,compositionType:a.d.Vec2,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,soloDatum:!1,initialValue:c.ZP.fromCopyArray2([1,1]),min:0,max:2},{semantic:o.f.MetallicRoughnessTexture,componentType:i.r.Int,compositionType:a.d.Texture2D,stage:s.H.PixelShader,isSystem:!1,updateInterval:l.a.FirstTimeOnly,initialValue:[1,_.Z.__dummyWhiteTexture],min:0,max:Number.MAX_SAFE_INTEGER}];this.setShaderSemanticsInfoArray(e)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){if(i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix),n)){let n=i.renderPass.cameraComponent;null==n&&(n=h.Z.getInstance().getComponent(d.Z,d.Z.main)),this.setViewInfo(t,n,i.isVr,i.displayIdx),this.setProjection(t,n,i.isVr,i.displayIdx),this.setLightsInfo(t,i.lightComponents,e,i.setUniform)}}}x.mode=new o.w({str:"mode"}),x.debugView=new o.w({str:"debugView"}),x.g_type=new o.w({str:"g_type"}),x.disable_fresnel=new o.w({str:"disable_fresnel"}),x.f0=new o.w({str:"f0"})},4200:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i=n(1784),a=n(810),r=n(2404),o=n(3999),s=n(3616),l=n(4587),c=n(5324),_=n(1813),h=n(4141),d=n(4255);const u={code:"\nprecision highp float;\nprecision highp int;\n\n\nin float a_instanceID;\nin vec3 a_position;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},m={code:"\nprecision highp float;\nprecision highp int;\n\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\nfloat decodeRGBAToDepth(vec4 RGBA){\n  const float rMask = 1.0;\n  const float gMask = 1.0 / 255.0;\n  const float bMask = 1.0 / (255.0 * 255.0);\n  const float aMask = 1.0 / (255.0 * 255.0 * 255.0);\n  float depth = dot(RGBA, vec4(rMask, gMask, bMask, aMask));\n  return depth;\n}\n\nvec4 encodeDepthToRGBA(float depth){\n  float r = depth;\n  float g = fract(r * 255.0);\n  float b = fract(g * 255.0);\n  float a = fract(b * 255.0);\n  float coef = 1.0 / 255.0;\n  r -= g * coef;\n  g -= b * coef;\n  b -= a * coef;\n  return vec4(r, g, b, a);\n}\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float framebufferWidth = get_framebufferWidth(materialSID, 0);\n\tfloat tFrag = 1.0 / framebufferWidth;\n  vec2 offset = gl_FragCoord.st;\n\n  vec2 blurDirection;\n  bool isHorizontal = get_isHorizontal(materialSID, 0);\n  if(isHorizontal){\n    blurDirection = vec2(1.0,0.0);\n  }else{\n    blurDirection = vec2(0.0,1.0);\n  }\n\n  float depth = 0.0;\n  int gaussianKernelSize = get_gaussianKernelSize(materialSID, 0);\n  float minStrideLength = -float(gaussianKernelSize - 1) / 2.0;\n\n  for(int i=0; i < 30; i++) {\n    if(gaussianKernelSize == i) {\n      break;\n    }\n\n    float strideLength = minStrideLength + float(i);\n    vec2 stride = strideLength * blurDirection;\n    float depthData = decodeRGBAToDepth(texture2D(u_baseColorTexture, (offset + stride) * tFrag));\n    if(depthData > 1.0) depthData = 1.0;\n\n    float gaussianRatio = u_gaussianRatio[i];\n    depth +=  depthData * gaussianRatio;\n  }\n\n  rt0 = encodeDepthToRGBA(depth);\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class x extends h.Z{constructor(){super(null,"gaussianBlurForEncodedDepthShading",{},u,m),this.frameBufferWidth=0;const e=new Float32Array(30);e[0]=1;const t=[{semantic:x.IsHorizontal,componentType:o.r.Bool,compositionType:a.d.Scalar,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyNumber(1),min:0,max:1},{semantic:x.GaussianRatio,componentType:o.r.Float,compositionType:a.d.ScalarArray,maxIndex:30,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:new d.Z(e),min:0,max:1,needUniformInFastest:!0},{semantic:x.GaussianKernelSize,componentType:o.r.Int,compositionType:a.d.Scalar,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyNumber(1),min:1,max:30},{semantic:l.f.FramebufferWidth,componentType:o.r.Float,compositionType:a.d.Scalar,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyNumber(1),min:0,max:Number.MAX_SAFE_INTEGER},{semantic:l.f.BaseColorTexture,componentType:o.r.Int,compositionType:a.d.Texture2D,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.EveryTime,initialValue:[0,h.Z.__dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER}];this.setShaderSemanticsInfoArray(t)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:a}){const o=e.getParameter(l.f.BaseColorTexture)[1];o.width!==this.frameBufferWidth&&(e.setParameter(l.f.FramebufferWidth,o.width),this.frameBufferWidth=o.width),a.setUniform?this.setWorldMatrix(t,a.worldMatrix):t._gl.uniform1fv(t.gaussianRatio,e.getParameter(x.GaussianRatio)._v);let s=a.renderPass.cameraComponent;null==s&&(s=r.Z.getInstance().getComponent(i.Z,i.Z.main)),s&&(this.setViewInfo(t,s,a.isVr,a.displayIdx),this.setProjection(t,s,a.isVr,a.displayIdx))}}x.GaussianKernelSize=new l.w({str:"gaussianKernelSize"}),x.GaussianRatio=new l.w({str:"gaussianRatio"}),x.IsHorizontal=new l.w({str:"isHorizontal"})},7860:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i=n(1784),a=n(810),r=n(2404),o=n(3999),s=n(3616),l=n(4587),c=n(5324),_=n(1813),h=n(4141),d=n(4255);const u={code:"\nprecision highp float;\nprecision highp int;\n\n\nin float a_instanceID;\nin vec3 a_position;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},m={code:"\nprecision highp float;\nprecision highp int;\n\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float framebufferWidth = get_framebufferWidth(materialSID, 0);\n\tfloat tFrag = 1.0 / framebufferWidth;\n  vec2 offset = gl_FragCoord.st;\n\n  vec2 blurDirection;\n  bool isHorizontal = get_isHorizontal(materialSID, 0);\n  if(isHorizontal){\n    blurDirection = vec2(1.0,0.0);\n  }else{\n    blurDirection = vec2(0.0,1.0);\n  }\n\n  vec4 color = vec4(0.0);\n  int gaussianKernelSize = get_gaussianKernelSize(materialSID, 0);\n  float minStrideLength = -float(gaussianKernelSize - 1) / 2.0;\n\n  for(int i=0; i < 30; i++) {\n    if(gaussianKernelSize == i) {\n      break;\n    }\n\n    float strideLength = minStrideLength + float(i);\n    vec2 stride = strideLength * blurDirection;\n\n    float gaussianRatio = u_gaussianRatio[i];\n    color += texture2D(u_baseColorTexture, (offset + stride) * tFrag) * gaussianRatio;\n  }\n\n  rt0 = color;\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class x extends h.Z{constructor(){super(null,"GaussianBlurShading",{},u,m),this.frameBufferWidth=0;const e=new Float32Array(30);e[0]=1;const t=[{semantic:x.IsHorizontal,componentType:o.r.Bool,compositionType:a.d.Scalar,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyNumber(1),min:0,max:1},{semantic:x.GaussianRatio,componentType:o.r.Float,compositionType:a.d.ScalarArray,maxIndex:30,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:new d.Z(e),min:0,max:1,needUniformInFastest:!0},{semantic:x.GaussianKernelSize,componentType:o.r.Int,compositionType:a.d.Scalar,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyNumber(1),min:1,max:30},{semantic:l.f.FramebufferWidth,componentType:o.r.Float,compositionType:a.d.Scalar,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyNumber(1),min:0,max:Number.MAX_SAFE_INTEGER},{semantic:l.f.BaseColorTexture,componentType:o.r.Int,compositionType:a.d.Texture2D,stage:c.H.PixelShader,isSystem:!1,updateInterval:_.a.EveryTime,initialValue:[0,h.Z.__dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER}];this.setShaderSemanticsInfoArray(t)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:a}){const o=e.getParameter(l.f.BaseColorTexture)[1];o.width!==this.frameBufferWidth&&(e.setParameter(l.f.FramebufferWidth,o.width),this.frameBufferWidth=o.width),a.setUniform?this.setWorldMatrix(t,a.worldMatrix):t._gl.uniform1fv(t.gaussianRatio,e.getParameter(x.GaussianRatio)._v);let s=a.renderPass.cameraComponent;null==s&&(s=r.Z.getInstance().getComponent(i.Z,i.Z.main)),s&&(this.setViewInfo(t,s,a.isVr,a.displayIdx),this.setProjection(t,s,a.isVr,a.displayIdx))}}x.GaussianKernelSize=new l.w({str:"gaussianKernelSize"}),x.GaussianRatio=new l.w({str:"gaussianRatio"}),x.IsHorizontal=new l.w({str:"isHorizontal"})},5170:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var i=n(7290),a=n(1784),r=n(2404),o=n(3999),s=n(810),l=n(3616),c=n(871),_=n(4587),h=n(5324),d=n(1813),u=n(2651),m=n(5981),x=n(2471),f=n(4141);const A={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin float a_instanceID;\nin vec3 a_baryCentricCoord;\nin vec3 a_position;\nin vec3 a_normal;\nin vec4 a_joint;\nin vec4 a_weight;\n\nout vec3 v_baryCentricCoord;\nout vec3 v_normal_inView;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  bool isSkinning = false;\n  isSkinning = processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n  v_normal_inView = vec3(viewMatrix * vec4(normalMatrix * a_normal, 0.0));\n\n// #ifdef RN_IS_POINTSPRITE\n\nvec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\nvec3 viewPosition = get_viewPosition(cameraSID, 0);\nfloat distanceFromCamera = length(position_inWorld.xyz - viewPosition);\nvec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\nfloat distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\nfloat maxPointSize = get_pointSize(materialSID, 0);\ngl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);\n\n// #endif\n\n\n  v_baryCentricCoord = a_baryCentricCoord;\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},p={code:"\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\nin vec3 v_baryCentricCoord;\nin vec3 v_normal_inView;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3+vec3(1.0 - wireframeWidthInner)*d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  vec3 normal_inView = normalize(v_normal_inView);\n  normal_inView.y *= -1.0;\n  vec2 normalUVCordinate = normal_inView.xy * 0.5 + 0.5;\n  vec4 matCapColor = texture2D(u_matCapTexture, normalUVCordinate);\n  rt0 = matCapColor;\n\n  // Wireframe\n  float threshold = 0.001;\n  vec3 wireframe = get_wireframe(materialSID, 0);\n  float wireframeWidthInner = wireframe.z;\n  float wireframeWidthRelativeScale = 1.0;\n  if (wireframe.x > 0.5 && wireframe.y < 0.5) {\n    rt0.a = 0.0;\n  }\n  vec4 wireframeResult = rt0;\n  vec4 wireframeColor = vec4(0.2, 0.75, 0.0, 1.0);\n  float edgeRatio = edge_ratio(v_baryCentricCoord, wireframeWidthInner, wireframeWidthRelativeScale);\n  float edgeRatioModified = mix(step(threshold, edgeRatio), clamp(edgeRatio*4.0, 0.0, 1.0), wireframeWidthInner / wireframeWidthRelativeScale/4.0);\n  // if r0.a is 0.0, it is wireframe not on shaded\n  wireframeResult.rgb = wireframeColor.rgb * edgeRatioModified + rt0.rgb * (1.0 - edgeRatioModified);\n  wireframeResult.a = max(rt0.a, wireframeColor.a * mix(edgeRatioModified, pow(edgeRatioModified, 100.0), wireframeWidthInner / wireframeWidthRelativeScale/1.0));\n\n  if (wireframe.x > 0.5) {\n    rt0 = wireframeResult;\n    if (wireframe.y < 0.5 && rt0.a == 0.0) {\n      discard;\n    }\n  }\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class g extends f.Z{constructor(e,t,n){let a;super(null,"MatCapShading"+(e?"+skinning":""),{isSkinning:e},A,p),"string"==typeof t?(a=new u.Z,async function(e){await a.generateTextureFromUri(e,{minFilter:m.d.Nearest,magFilter:m.d.Nearest,wrapS:m.d.ClampToEdge,wrapT:m.d.ClampToEdge,type:o.r.UnsignedByte,anisotropy:!1})}(t)):n instanceof i.Z?a=n:(console.warn("no matcap texture"),a=f.Z.__dummyBlackTexture);const r=[];r.push({semantic:_.f.Wireframe,componentType:o.r.Float,compositionType:s.d.Vec3,stage:h.H.PixelShader,isSystem:!1,updateInterval:d.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyArray([0,0,1]),min:0,max:10}),r.push({semantic:_.f.PointSize,componentType:o.r.Float,compositionType:s.d.Scalar,stage:h.H.VertexShader,isSystem:!1,updateInterval:d.a.FirstTimeOnly,soloDatum:!0,initialValue:l.ZP.fromCopyNumber(30),min:0,max:100},{semantic:_.f.PointDistanceAttenuation,componentType:o.r.Float,compositionType:s.d.Vec3,stage:h.H.VertexShader,isSystem:!1,updateInterval:d.a.FirstTimeOnly,soloDatum:!0,initialValue:x.ZP.fromCopyArray([0,.1,.01]),min:0,max:1}),e&&(this.__definitions+="#define RN_IS_SKINNING\n"),r.push({semantic:g.MatCapTexture,componentType:o.r.Int,compositionType:s.d.Texture2D,stage:h.H.PixelShader,isSystem:!1,updateInterval:d.a.EveryTime,initialValue:[0,a],min:0,max:Number.MAX_SAFE_INTEGER}),this.setShaderSemanticsInfoArray(r)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:i}){i.setUniform&&(this.setWorldMatrix(t,i.worldMatrix),this.setNormalMatrix(t,i.normalMatrix));let o=i.renderPass.cameraComponent;null==o&&(o=r.Z.getInstance().getComponent(a.Z,a.Z.main)),this.setViewInfo(t,o,i.isVr,i.displayIdx),this.setProjection(t,o,i.isVr,i.displayIdx);const s=i.entity.getComponent(c.Z);this.setSkinning(t,s,i.setUniform)}}g.MatCapTexture=new _.w({str:"matCapTexture"})},1481:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var i=n(4587),a=n(4141),r=n(810),o=n(2390),s=n(3999),l=n(7192),c=n(2471),_=n(5324),h=n(1813),d=n(2404),u=n(1784),m=n(1986),x=n(3616),f=n(346),A=n(4255),p=n(6019),g=n(85),v=n(2992);const y={code:'\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec3 v_color;\nin vec3 v_normal_inWorld;\nin vec4 v_position_inWorld;\nin vec2 v_texcoord_0;\nin vec2 v_texcoord_1;\nin vec3 v_baryCentricCoord;\n\n#ifdef RN_USE_TANGENT_ATTRIBUTE\n  in vec3 v_tangent_inWorld;\n  in vec3 v_binormal_inWorld;\n#endif\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float M_PI = 3.141592653589793;\nconst float c_MinRoughness = 0.04;\n\nfloat angular_n_h(float NH) {\n  return acos(NH);\n}\n\nfloat sqr(float x) {\n  return x*x;\n}\n\nfloat d_phong(float NH, float c1) {\n  return pow(\n    cos(acos(NH))\n    , c1\n  );\n}\n\n// this is from https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec3 envBRDFApprox( vec3 F0, float Roughness, float NoV ) {\n  const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022 );\n  const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04 );\n  vec4 r = Roughness * c0 + c1;\n  float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n  vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n  return F0 * AB.x + AB.y;\n}\n\n// GGX NDF\nfloat d_ggx(float NH, float alphaRoughness) {\n  float roughnessSqr = alphaRoughness * alphaRoughness;\n  float f = (roughnessSqr - 1.0) * NH * NH + 1.0;\n  return roughnessSqr / (M_PI * f * f);\n}\n\nfloat d_torrance_reiz(float NH, float c3) {\n  float CosSquared = NH*NH;\n  float TanSquared = (1.0 - CosSquared)/CosSquared;\n  //return (1.0/M_PI) * sqr(c3/(CosSquared * (c3*c3 + TanSquared)));  // gamma = 2, aka GGX\n  return (1.0/sqrt(M_PI)) * (sqr(c3)/(CosSquared * (c3*c3 + TanSquared))); // gamma = 1, D_Berry\n}\n\nfloat d_beckmann(float NH, float m) {\n  float co = 1.0 / (4.0 * m * m * NH * NH * NH * NH);\n  float expx = exp((NH * NH - 1.0) / (m * m * NH * NH));\n  return co * expx;\n}\n\n// the same as glTF WebGL sample\n// https://github.com/KhronosGroup/glTF-WebGL-PBR/blob/88eda8c5358efe03128b72b6c5f5f6e5b6d023e1/shaders/pbr-frag.glsl#L188\n// That is, Unreal Engine based approach, but modified to use alphaRoughness (squared artist\'s roughness parameter),\n// and based on \'Separable Masking and Shadowing\' approximation (propesed by Christophe Schlick)\n// https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\nfloat g_shielding(float NL, float NV, float alphaRoughness) {\n  float r = alphaRoughness;\n\n  // Local Shadowing using "Schlick-Smith" Masking Function\n  float localShadowing = 2.0 * NL / (NL + sqrt(r * r + (1.0 - r * r) * (NL * NL)));\n\n  // Local Masking using "Schlick-Smith" Masking Function\n  float localMasking = 2.0 * NV / (NV + sqrt(r * r + (1.0 - r * r) * (NV * NV)));\n\n  return localShadowing * localMasking;\n}\n\n// The code from https://google.github.io/filament/Filament.html#listing_approximatedspecularv\n// The idea is from [Heitz14] Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs.\nfloat v_SmithGGXCorrelated(float NL, float NV, float alphaRoughness) {\n  float a2 = alphaRoughness * alphaRoughness;\n  float GGXV = NL * sqrt(NV * NV * (1.0 - a2) + a2);\n  float GGXL = NV * sqrt(NL * NL * (1.0 - a2) + a2);\n  return 0.5 / (GGXV + GGXL);\n}\n\nfloat v_SmithGGXCorrelatedFast(float NL, float NV, float alphaRoughness) {\n  float a = alphaRoughness;\n  float GGXV = NL * (NV * (1.0 - a) + a);\n  float GGXL = NV * (NL * (1.0 - a) + a);\n  return 0.5 / (GGXV + GGXL);\n}\n\n// The Schlick Approximation to Fresnel\nvec3 fresnel(vec3 f0, float VH) {\n  return vec3(f0) + (vec3(1.0) - f0) * pow(1.0 - VH, 5.0);\n}\n\nvec3 cook_torrance_specular_brdf(float NH, float NL, float NV, vec3 F, float alphaRoughness) {\n  float D = d_ggx(NH, alphaRoughness);\n  float V = v_SmithGGXCorrelated(NL, NV, alphaRoughness);\n  return vec3(D)*vec3(V)*F;\n//      float G = g_shielding(NL, NV, alphaRoughness);\n//      return vec3(D)*vec3(G)*F/vec3(4.0*NL*NV);\n\n}\n\nvec3 diffuse_brdf(vec3 albedo)\n{\n  return albedo / M_PI;\n}\n\nvec3 srgbToLinear(vec3 srgbColor) {\n  return pow(srgbColor, vec3(2.2));\n}\n\nfloat srgbToLinear(float value) {\n  return pow(value, 2.2);\n}\n\nvec3 linearToSrgb(vec3 linearColor) {\n  return pow(linearColor, vec3(1.0/2.2));\n}\n\nfloat linearToSrgb(float value) {\n  return pow(value, 1.0/2.2);\n}\n\nvec3 fresnelSchlickRoughness(vec3 F0, float cosTheta, float roughness)\n{\n  return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n}\n\nvec3 normalBlendingUDN(sampler2D baseMap, sampler2D detailMap, vec2 baseUv, vec2 detailUv) {\n  vec3 t = texture2D(baseMap,   baseUv).xyz * 2.0 - 1.0;\n  vec3 u = texture2D(detailMap, detailUv).xyz * 2.0 - 1.0;\n  vec3 r = normalize(vec3(t.xy + u.xy, t.z));\n  return r;\n}\n\nvec2 uvTransform(vec2 scale, vec2 offset, float rotation, vec2 uv) {\n  mat3 translationMat = mat3(1,0,0, 0,1,0, offset.x, offset.y, 1);\n  mat3 rotationMat = mat3(\n      cos(rotation), -sin(rotation), 0,\n      sin(rotation), cos(rotation), 0,\n                  0,             0, 1\n  );\n  mat3 scaleMat = mat3(scale.x,0,0, 0,scale.y,0, 0,0,1);\n\n  mat3 matrix = translationMat * rotationMat * scaleMat;\n  vec2 uvTransformed = ( matrix * vec3(uv.xy, 1) ).xy;\n\n  return uvTransformed;\n}\n\n\n/* shaderity: @{getters} */\n\nvec3 IBLContribution(float materialSID, vec3 normal_inWorld, float NV, vec3 viewDirection, vec3 albedo, vec3 F0, float userRoughness)\n{\n  vec4 iblParameter = get_iblParameter(materialSID, 0);\n  float rot = iblParameter.w + 3.1415;\n  mat3 rotEnvMatrix = mat3(cos(rot), 0.0, -sin(rot), 0.0, 1.0, 0.0, sin(rot), 0.0, cos(rot));\n  vec3 normal_forEnv = rotEnvMatrix * normal_inWorld;\n  normal_forEnv.x *= -1.0;\n  vec4 diffuseTexel = textureCube(u_diffuseEnvTexture, normal_forEnv);\n\n  vec3 diffuseLight;\n  ivec2 hdriFormat = get_hdriFormat(materialSID, 0);\n  if (hdriFormat.x == 0) {\n    // LDR_SRGB\n    diffuseLight = srgbToLinear(diffuseTexel.rgb);\n  }\n  else if (hdriFormat.x == 3) {\n    // RGBE\n    diffuseLight = diffuseTexel.rgb * pow(2.0, diffuseTexel.a*255.0-128.0);\n  }\n  else {\n    diffuseLight = diffuseTexel.rgb;\n  }\n\n  float mipCount = iblParameter.x;\n  float lod = (userRoughness * (mipCount - 1.0));\n\n  vec3 reflection = rotEnvMatrix * reflect(-viewDirection, normal_inWorld);\nreflection.x *= -1.0;\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n  vec4 specularTexel = textureCubeLodEXT(u_specularEnvTexture, reflection, lod);\n#elif defined(GLSL_ES3)\n  vec4 specularTexel = textureLod(u_specularEnvTexture, reflection, lod);\n#else\n  vec4 specularTexel = textureCube(u_specularEnvTexture, reflection);\n#endif\n\n\n  vec3 specularLight;\n  if (hdriFormat.y == 0) {\n    // LDR_SRGB\n    specularLight = srgbToLinear(specularTexel.rgb);\n  }\n  else if (hdriFormat.y == 3) {\n    // RGBE\n    specularLight = specularTexel.rgb * pow(2.0, specularTexel.a*255.0-128.0);\n  }\n  else {\n    specularLight = specularTexel.rgb;\n  }\n\n  vec3 kS = fresnelSchlickRoughness(F0, NV, userRoughness);\n  vec3 kD = 1.0 - kS;\n  vec3 diffuse = diffuseLight * albedo * kD;\n  // vec3 brdf = texture2D(u_brdfLutTexture, vec2(1.0 - NV, 1.0 - userRoughness)).rgb;\n  // vec3 specular = specularLight * (F0 * brdf.x + brdf.y);\n  vec3 specular = specularLight * envBRDFApprox(F0, userRoughness, NV);\n\n  float IBLDiffuseContribution = iblParameter.y;\n  float IBLSpecularContribution = iblParameter.z;\n  diffuse *= IBLDiffuseContribution;\n  specular *= IBLSpecularContribution;\n  return diffuse + specular;\n}\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3+vec3(1.0 - wireframeWidthInner)*d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\nvec2 getTexcoord(int texcoordIndex) {\n  vec2 texcoord;\n  if(texcoordIndex == 1){\n    texcoord = v_texcoord_1;\n  }else{\n    texcoord = v_texcoord_0;\n  }\n  return texcoord;\n}\n\n#ifdef RN_USE_TANGENT_ATTRIBUTE\n  vec3 perturb_normal(vec3 normal_inWorld, vec3 viewVector, vec2 texcoord, vec3 normalTex) {\n    vec3 tangent_inWorld = normalize(v_tangent_inWorld);\n    vec3 binormal_inWorld = normalize(v_binormal_inWorld);\n    mat3 tbnMat_tangent_to_world = mat3(tangent_inWorld, binormal_inWorld, normal_inWorld);\n\n    return normalize(tbnMat_tangent_to_world * normalTex);\n  }\n#else\n  #ifdef RN_IS_SUPPORTING_STANDARD_DERIVATIVES\n    // This is based on http://www.thetenthplanet.de/archives/1180\n    mat3 cotangent_frame(vec3 normal_inWorld, vec3 position, vec2 uv) {\n      uv = gl_FrontFacing ? uv : -uv;\n\n      // get edge vectors of the pixel triangle\n      vec3 dp1 = dFdx(position);\n      vec3 dp2 = dFdy(position);\n      vec2 duv1 = dFdx(uv);\n      vec2 duv2 = dFdy(uv);\n\n      // solve the linear system\n      vec3 dp2perp = cross(dp2, normal_inWorld);\n      vec3 dp1perp = cross(normal_inWorld, dp1);\n      vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n      vec3 bitangent = dp2perp * duv1.y + dp1perp * duv2.y;\n      bitangent *= -1.0;\n\n      // construct a scale-invariant frame\n      float invMat = inversesqrt(max(dot(tangent, tangent), dot(bitangent, bitangent)));\n      return mat3(tangent * invMat, bitangent * invMat, normal_inWorld);\n    }\n\n    vec3 perturb_normal(vec3 normal_inWorld, vec3 viewVector, vec2 texcoord, vec3 normalTex) {\n      mat3 tbnMat_tangent_to_world = cotangent_frame(normal_inWorld, -viewVector, texcoord);\n      return normalize(tbnMat_tangent_to_world * normalTex);\n    }\n  #else\n    vec3 perturb_normal(vec3 normal_inWorld, vec3 viewVector, vec2 texcoord, vec3 normalTex) {\n      return normal_inWorld;\n    }\n  #endif\n#endif\n\nvoid main ()\n{\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  // View vector\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  vec3 viewPosition = get_viewPosition(cameraSID, 0);\n  vec3 viewVector = viewPosition - v_position_inWorld.xyz;\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n  #ifdef RN_USE_NORMAL_TEXTURE\n    vec4 normalTextureTransform = get_normalTextureTransform(materialSID, 0);\n    float normalTextureRotation = get_normalTextureRotation(materialSID, 0);\n    int normalTexcoordIndex = get_normalTexcoordIndex(materialSID, 0);\n    vec2 normalTexcoord = getTexcoord(normalTexcoordIndex);\n    vec2 normalTexUv = uvTransform(normalTextureTransform.xy, normalTextureTransform.zw, normalTextureRotation, normalTexcoord);\n    vec3 normalTexValue = texture2D(u_normalTexture, normalTexUv).xyz;\n    if(normalTexValue.b >= 128.0 / 255.0) {\n      // normal texture is existence\n      vec3 normalTex = normalTexValue * 2.0 - 1.0;\n      float normalScale = get_normalScale(materialSID, 0);\n      vec3 scaledNormal = normalize(normalTex * vec3(normalScale, normalScale, 1.0));\n      normal_inWorld = perturb_normal(normal_inWorld, viewVector, normalTexUv, scaledNormal);\n    }\n  #endif\n\n  // BaseColorFactor\n  vec3 baseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n  vec4 baseColorFactor = get_baseColorFactor(materialSID, 0);\n  if (v_color != baseColor && baseColorFactor.rgb != baseColor) {\n    baseColor = v_color * baseColorFactor.rgb;\n    alpha = baseColorFactor.a;\n  } else if (v_color == baseColor) {\n    baseColor = baseColorFactor.rgb;\n    alpha = baseColorFactor.a;\n  } else if (baseColorFactor.rgb == baseColor) {\n    baseColor = v_color;\n  } else {\n    baseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n\n  // BaseColor (take account for BaseColorTexture)\n  vec4 baseColorTextureTransform = get_baseColorTextureTransform(materialSID, 0);\n  float baseColorTextureRotation = get_baseColorTextureRotation(materialSID, 0);\n  int baseColorTexcoordIndex = get_baseColorTexcoordIndex(materialSID, 0);\n  vec2 baseColorTexcoord = getTexcoord(baseColorTexcoordIndex);\n  vec2 baseColorTexUv = uvTransform(baseColorTextureTransform.xy, baseColorTextureTransform.zw, baseColorTextureRotation, baseColorTexcoord);\n  vec4 textureColor = texture2D(u_baseColorTexture, baseColorTexUv);\n  baseColor *= srgbToLinear(textureColor.rgb);\n  alpha *= textureColor.a;\n\n#ifdef RN_IS_ALPHAMODE_MASK\n  float alphaCutoff = get_alphaCutoff(materialSID, 0);\n  if (alpha < alphaCutoff) {\n    discard;\n  }\n#endif\n\n\n#ifdef RN_IS_LIGHTING\n  // Metallic & Roughness\n  vec2 metallicRoughnessFactor = get_metallicRoughnessFactor(materialSID, 0);\n  float userRoughness = metallicRoughnessFactor.y;\n  float metallic = metallicRoughnessFactor.x;\n\n  vec4 metallicRoughnessTextureTransform = get_metallicRoughnessTextureTransform(materialSID, 0);\n  float metallicRoughnessTextureRotation = get_metallicRoughnessTextureRotation(materialSID, 0);\n  int metallicRoughnessTexcoordIndex = get_metallicRoughnessTexcoordIndex(materialSID, 0);\n  vec2 metallicRoughnessTexcoord = getTexcoord(metallicRoughnessTexcoordIndex);\n  vec2 metallicRoughnessTexUv = uvTransform(metallicRoughnessTextureTransform.xy, metallicRoughnessTextureTransform.zw, metallicRoughnessTextureRotation, metallicRoughnessTexcoord);\n  vec4 ormTexel = texture2D(u_metallicRoughnessTexture, metallicRoughnessTexUv);\n  userRoughness = ormTexel.g * userRoughness;\n  metallic = ormTexel.b * metallic;\n\n  userRoughness = clamp(userRoughness, c_MinRoughness, 1.0);\n  metallic = clamp(metallic, 0.0, 1.0);\n  float alphaRoughness = userRoughness * userRoughness;\n\n  // F0\n  vec3 diffuseMatAverageF0 = vec3(0.04);\n  vec3 F0 = mix(diffuseMatAverageF0, baseColor.rgb, metallic);\n\n  // Albedo\n  vec3 albedo = baseColor.rgb * (vec3(1.0) - diffuseMatAverageF0);\n  albedo.rgb *= (1.0 - metallic);\n\n  // View direction\n  vec3 viewDirection = normalize(viewVector);\n\n  // NV\n  float NV = dot(normal_inWorld, viewDirection);\n  float satNV = saturateEpsilonToOne(NV);\n\n  rt0 = vec4(0.0, 0.0, 0.0, alpha);\n\n  // Lighting\n  vec3 diffuse = vec3(0.0, 0.0, 0.0);\n  for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */; i++) {\n    if (i >= lightNumber) {\n      break;\n    }\n\n    // Light\n    vec4 gotLightDirection = get_lightDirection(0.0, i);\n    vec4 gotLightPosition = get_lightPosition(0.0, i);\n    vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n    vec3 lightDirection = gotLightDirection.xyz;\n    vec3 lightIntensity = gotLightIntensity.xyz;\n    vec3 lightPosition = gotLightPosition.xyz;\n    float lightType = gotLightPosition.w;\n    float spotCosCutoff = gotLightDirection.w;\n    float spotExponent = gotLightIntensity.w;\n\n    if (0.75 < lightType) { // is pointlight or spotlight\n      lightDirection = normalize(lightPosition.xyz - v_position_inWorld.xyz);\n    }\n    float spotEffect = 1.0;\n    if (lightType > 1.75) { // is spotlight\n      spotEffect = dot(gotLightDirection.xyz, lightDirection);\n      if (spotEffect > spotCosCutoff) {\n        spotEffect = pow(spotEffect, spotExponent);\n      } else {\n        spotEffect = 0.0;\n      }\n    }\n    //diffuse += 1.0 * max(0.0, dot(normal_inWorld, lightDirection)) * spotEffect * lightIntensity.xyz;\n\n    // IncidentLight\n    vec3 incidentLight = spotEffect * lightIntensity.xyz;\n    incidentLight *= M_PI;\n\n    // Fresnel\n    vec3 halfVector = normalize(lightDirection + viewDirection);\n    float VH = dot(viewDirection, halfVector);\n    vec3 F = fresnel(F0, VH);\n\n    // Diffuse\n    vec3 diffuseContrib = (vec3(1.0) - F) * diffuse_brdf(albedo);\n\n    // Specular\n    float NH = dot(normal_inWorld, halfVector);\n    float satNH = saturateEpsilonToOne(NH);\n    float NL = dot(normal_inWorld, lightDirection);\n    float satNL = saturateEpsilonToOne(NL);\n\n    vec3 specularContrib = cook_torrance_specular_brdf(satNH, satNL, satNV, F, alphaRoughness);\n    vec3 diffuseAndSpecular = (diffuseContrib + specularContrib) * vec3(satNL) * incidentLight.rgb;\n\n    rt0.xyz += diffuseAndSpecular;\n//      rt0.xyz += specularContrib * vec3(NL) * incidentLight.rgb;\n//    rt0.xyz += diffuseContrib * vec3(NL) * incidentLight.rgb;\n//    rt0.xyz += (vec3(1.0) - F) * diffuse_brdf(albedo);//diffuseContrib;//vec3(NL) * incidentLight.rgb;\n  }\n\n  vec3 ibl = IBLContribution(materialSID, normal_inWorld, satNV, viewDirection, albedo, F0, userRoughness);\n\n  int occlusionTexcoordIndex = get_occlusionTexcoordIndex(materialSID, 0);\n  vec2 occlusionTexcoord = getTexcoord(occlusionTexcoordIndex);\n  float occlusion = texture2D(u_occlusionTexture, occlusionTexcoord).r;\n  float occlusionStrength = get_occlusionStrength(materialSID, 0);\n\n  // Occlution to Indirect Lights\n  rt0.xyz += mix(ibl, ibl * occlusion, occlusionStrength);\n#else\n  rt0 = vec4(baseColor, alpha);\n#endif\n\n  // Emissive\n  int emissiveTexcoordIndex = get_emissiveTexcoordIndex(materialSID, 0);\n  vec2 emissiveTexcoord = getTexcoord(emissiveTexcoordIndex);\n  vec3 emissive = srgbToLinear(texture2D(u_emissiveTexture, emissiveTexcoord).xyz);\n\n  rt0.xyz += emissive;\n\n  bool isOutputHDR = get_isOutputHDR(materialSID, 0);\n  if(isOutputHDR){\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n    return;\n  }\n\n#ifdef RN_IS_ALPHAMODE_OPAQUE\n  rt0.a = 1.0;\n#elif defined(RN_IS_ALPHAMODE_MASK)\n  rt0.a = 1.0;\n#endif\n\n\n  // Wireframe\n  float threshold = 0.001;\n  vec3 wireframe = get_wireframe(materialSID, 0);\n  float wireframeWidthInner = wireframe.z;\n  float wireframeWidthRelativeScale = 1.0;\n  if (wireframe.x > 0.5 && wireframe.y < 0.5) {\n    rt0.a = 0.0;\n  }\n  vec4 wireframeResult = rt0;\n  vec4 wireframeColor = vec4(0.2, 0.75, 0.0, 1.0);\n  float edgeRatio = edge_ratio(v_baryCentricCoord, wireframeWidthInner, wireframeWidthRelativeScale);\n  float edgeRatioModified = mix(step(threshold, edgeRatio), clamp(edgeRatio*4.0, 0.0, 1.0), wireframeWidthInner / wireframeWidthRelativeScale/4.0);\n  // if r0.a is 0.0, it is wireframe not on shaded\n  wireframeResult.rgb = wireframeColor.rgb * edgeRatioModified + rt0.rgb * (1.0 - edgeRatioModified);\n  wireframeResult.a = max(rt0.a, wireframeColor.a * mix(edgeRatioModified, pow(edgeRatioModified, 100.0), wireframeWidthInner / wireframeWidthRelativeScale/1.0));\n\n  if (wireframe.x > 0.5) {\n    rt0 = wireframeResult;\n    if (wireframe.y < 0.5 && rt0.a == 0.0) {\n      discard;\n    }\n  }\n\nfloat makeOutputSrgb = float(get_makeOutputSrgb(materialSID, 0));\nrt0.rgb = mix(rt0.rgb, linearToSrgb(rt0.rgb), makeOutputSrgb);\n\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n',shaderStage:"fragment",isFragmentShader:!0};var I=n(5704);class b extends a.Z{constructor({isMorphing:e,isSkinning:t,isLighting:n,useTangentAttribute:d,useNormalTexture:u,alphaMode:m,makeOutputSrgb:p}){super(null,"pbrShading"+(e?"+morphing":"")+(t?"+skinning":"")+(n?"":"-lighting")+(d?"+tangentAttribute":"")+" alpha_"+m.str.toLowerCase(),{isMorphing:e,isSkinning:t,isLighting:n},v.Z,y);const g=[{semantic:i.f.BaseColorFactor,compositionType:r.d.Vec4,componentType:s.r.Float,stage:_.H.PixelShader,min:0,max:2,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:l.ZP.fromCopyArray([1,1,1,1])},{semantic:i.f.BaseColorTexture,compositionType:r.d.Texture2D,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:[0,a.Z.__dummyWhiteTexture]},{semantic:i.f.MetallicRoughnessFactor,compositionType:r.d.Vec2,componentType:s.r.Float,stage:_.H.PixelShader,min:0,max:2,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:o.ZP.fromCopyArray2([1,1])},{semantic:i.f.MetallicRoughnessTexture,compositionType:r.d.Texture2D,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:[1,a.Z.__dummyWhiteTexture]},{semantic:i.f.OcclusionTexture,compositionType:r.d.Texture2D,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:[3,a.Z.__dummyWhiteTexture]},{semantic:i.f.EmissiveTexture,compositionType:r.d.Texture2D,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:[4,a.Z.__dummyBlackTexture]},{semantic:i.f.Wireframe,compositionType:r.d.Vec3,componentType:s.r.Float,stage:_.H.PixelShader,min:0,max:10,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:c.ZP.fromCopyArray([0,0,1])},{semantic:b.IsOutputHDR,compositionType:r.d.Scalar,componentType:s.r.Bool,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:i.f.MakeOutputSrgb,compositionType:r.d.Scalar,componentType:s.r.Bool,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(p?1:0)},{semantic:i.f.IBLParameter,compositionType:r.d.Vec4,componentType:s.r.Float,stage:_.H.PixelShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:h.a.FirstTimeOnly,initialValue:l.ZP.fromCopyArray([1,1,1,1])},{semantic:i.f.HDRIFormat,compositionType:r.d.Vec2,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:5,isSystem:!0,updateInterval:h.a.FirstTimeOnly,initialValue:o.ZP.fromCopyArray2([0,0])},{semantic:i.f.DiffuseEnvTexture,compositionType:r.d.TextureCube,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInterval:h.a.FirstTimeOnly,initialValue:[5,a.Z.__dummyWhiteTexture]},{semantic:i.f.SpecularEnvTexture,compositionType:r.d.TextureCube,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!0,updateInterval:h.a.FirstTimeOnly,initialValue:[6,a.Z.__dummyWhiteTexture]},{semantic:b.BaseColorTextureTransform,compositionType:r.d.Vec4,componentType:s.r.Float,stage:_.H.PixelShader,min:-10,max:10,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:l.ZP.fromCopyArray([1,1,0,0])},{semantic:b.BaseColorTextureRotation,compositionType:r.d.Scalar,componentType:s.r.Float,stage:_.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.MetallicRoughnessTextureTransform,compositionType:r.d.Vec4,componentType:s.r.Float,stage:_.H.PixelShader,min:-10,max:10,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:l.ZP.fromCopyArray([1,1,0,0])},{semantic:b.MetallicRoughnessTextureRotation,compositionType:r.d.Scalar,componentType:s.r.Float,stage:_.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.BaseColorTexcoordIndex,compositionType:r.d.Scalar,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.MetallicRoughnessTexcoordIndex,compositionType:r.d.Scalar,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.OcclusionTexcoordIndex,compositionType:r.d.Scalar,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.EmissiveTexcoordIndex,compositionType:r.d.Scalar,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.OcclusionStrength,compositionType:r.d.Scalar,componentType:s.r.Float,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(1)}];g.push({semantic:i.f.PointSize,componentType:s.r.Float,compositionType:r.d.Scalar,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:x.ZP.fromCopyNumber(30),min:0,max:100},{semantic:i.f.PointDistanceAttenuation,componentType:s.r.Float,compositionType:r.d.Vec3,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:c.ZP.fromCopyArray([0,.1,.01]),min:0,max:1}),n&&(this.__definitions+="#define RN_IS_LIGHTING\n"),t&&(this.__definitions+="#define RN_IS_SKINNING\n"),e&&(this.__definitions+="#define RN_IS_MORPHING\n",g.push({semantic:i.f.MorphTargetNumber,componentType:s.r.Int,compositionType:r.d.Scalar,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:x.ZP.fromCopyNumber(0),min:0,max:f.Z.maxVertexMorphNumberInShader,needUniformInFastest:!0},{semantic:i.f.DataTextureMorphOffsetPosition,componentType:s.r.Int,compositionType:r.d.ScalarArray,maxIndex:f.Z.maxVertexMorphNumberInShader,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new A.Z(new Int32Array(f.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0},{semantic:i.f.MorphWeights,componentType:s.r.Float,compositionType:r.d.ScalarArray,maxIndex:f.Z.maxVertexMorphNumberInShader,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new A.Z(new Float32Array(f.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0})),d&&(this.__definitions+="#define RN_USE_TANGENT_ATTRIBUTE\n"),u&&(this.__definitions+="#define RN_USE_NORMAL_TEXTURE\n",g.push({semantic:i.f.NormalTexture,compositionType:r.d.Texture2D,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:[2,a.Z.__dummyBlackTexture]},{semantic:b.NormalTextureTransform,compositionType:r.d.Vec4,componentType:s.r.Float,stage:_.H.PixelShader,min:-10,max:10,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:l.ZP.fromCopyArray([1,1,0,0])},{semantic:b.NormalTextureRotation,compositionType:r.d.Scalar,componentType:s.r.Float,stage:_.H.PixelShader,min:-Math.PI,max:Math.PI,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.NormalTexcoordIndex,compositionType:r.d.Scalar,componentType:s.r.Int,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(0)},{semantic:b.NormalScale,compositionType:r.d.Scalar,componentType:s.r.Float,stage:_.H.PixelShader,min:0,max:Number.MAX_SAFE_INTEGER,isSystem:!1,updateInterval:h.a.FirstTimeOnly,initialValue:x.ZP.fromCopyNumber(1)})),this.__definitions+="#define RN_IS_ALPHAMODE_"+m.str+"\n",m===I.F.Mask&&g.push({semantic:i.f.AlphaCutoff,componentType:s.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,min:0,max:1,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:x.ZP.fromCopyNumber(.01)}),this.setShaderSemanticsInfoArray(g)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:r}){if(r.setUniform){if(this.setWorldMatrix(t,r.worldMatrix),this.setNormalMatrix(t,r.normalMatrix),n||r.isVr){let e=r.renderPass.cameraComponent;null==e&&(e=d.Z.getInstance().getComponent(u.Z,u.Z.main)),this.setViewInfo(t,e,r.isVr,r.displayIdx),this.setProjection(t,e,r.isVr,r.displayIdx)}if(n){this.setLightsInfo(t,r.lightComponents,e,r.setUniform);const n=r.entity.getSkeletal();this.setSkinning(t,n,r.setUniform)}}if(r.diffuseCube&&r.diffuseCube.isTextureReady?this.__webglResourceRepository.setUniformValue(t,i.f.DiffuseEnvTexture.str,n,[5,r.diffuseCube]):this.__webglResourceRepository.setUniformValue(t,i.f.DiffuseEnvTexture.str,n,[5,a.Z.__dummyBlackCubeTexture]),r.specularCube&&r.specularCube.isTextureReady?this.__webglResourceRepository.setUniformValue(t,i.f.SpecularEnvTexture.str,n,[6,r.specularCube]):this.__webglResourceRepository.setUniformValue(t,i.f.SpecularEnvTexture.str,n,[6,a.Z.__dummyBlackCubeTexture]),r.setUniform){if(n){const{mipmapLevelNumber:e,meshRenderComponent:a,diffuseHdriType:o,specularHdriType:s}=this.setupHdriParameters(r);this.__webglResourceRepository.setUniformValue(t,i.f.IBLParameter.str,n,{x:e,y:a.diffuseCubeMapContribution,z:a.specularCubeMapContribution,w:a.rotationOfCubeMap}),this.__webglResourceRepository.setUniformValue(t,i.f.HDRIFormat.str,n,{x:o,y:s})}}else{const{mipmapLevelNumber:t,meshRenderComponent:n,diffuseHdriType:o,specularHdriType:s}=this.setupHdriParameters(r),l=a.Z.__tmp_vector4;l.x=t,l.y=n.diffuseCubeMapContribution,l.z=n.specularCubeMapContribution,l.w=n.rotationOfCubeMap,e.setParameter(i.f.IBLParameter,l);const c=a.Z.__tmp_vector2;c.x=o,c.y=s,e.setParameter(i.f.HDRIFormat,c)}this.setMorphInfo(t,r.entity.getComponent(p.Z),r.entity.getComponent(g.Z),r.primitive)}setupHdriParameters(e){let t=1;e.specularCube&&(t=e.specularCube.mipmapLevelNumber);const n=e.entity.getMeshRenderer();let i=m.c.LDR_SRGB.index,a=m.c.LDR_SRGB.index;return n.diffuseCubeMap&&(i=n.diffuseCubeMap.hdriFormat.index),n.specularCubeMap&&(a=n.specularCubeMap.hdriFormat.index),{mipmapLevelNumber:t,meshRenderComponent:n,diffuseHdriType:i,specularHdriType:a}}}b.IsOutputHDR=new i.w({str:"isOutputHDR"}),b.BaseColorTextureTransform=new i.w({str:"baseColorTextureTransform"}),b.BaseColorTextureRotation=new i.w({str:"baseColorTextureRotation"}),b.NormalTextureTransform=new i.w({str:"normalTextureTransform"}),b.NormalTextureRotation=new i.w({str:"normalTextureRotation"}),b.MetallicRoughnessTextureTransform=new i.w({str:"metallicRoughnessTextureTransform"}),b.MetallicRoughnessTextureRotation=new i.w({str:"metallicRoughnessTextureRotation"}),b.NormalTexcoordIndex=new i.w({str:"normalTexcoordIndex"}),b.BaseColorTexcoordIndex=new i.w({str:"baseColorTexcoordIndex"}),b.MetallicRoughnessTexcoordIndex=new i.w({str:"metallicRoughnessTexcoordIndex"}),b.OcclusionTexcoordIndex=new i.w({str:"occlusionTexcoordIndex"}),b.EmissiveTexcoordIndex=new i.w({str:"emissiveTexcoordIndex"}),b.NormalScale=new i.w({str:"normalScale"}),b.OcclusionStrength=new i.w({str:"occlusionStrength"})},8346:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(4587),a=n(4141),r=n(810),o=n(3999),s=n(7192),l=n(2471),c=n(9840),_=n(5324),h=n(1813),d=n(2404),u=n(1784),m=n(4255),x=n(3616),f=n(346),A=n(871),p=n(7987),g=n(3496),v=n(6019),y=n(85);const I={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec2 a_texcoord_1;\nin vec4 a_joint;\nin vec4 a_weight;\nout vec3 v_color;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\nout vec2 v_texcoord_0;\nout vec4 v_texcoord_1;\nout vec4 v_projPosition_from_light;\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main(){\n\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n\n  // Skeletal\n  processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n// #ifdef RN_IS_POINTSPRITE\n\nvec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\nvec3 viewPosition = get_viewPosition(cameraSID, 0);\nfloat distanceFromCamera = length(position_inWorld.xyz - viewPosition);\nvec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\nfloat distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\nfloat maxPointSize = get_pointSize(materialSID, 0);\ngl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);\n\n// #endif\n\n\n  // Shadow mapping\n  mat4 lightViewProjectionMatrix = get_lightViewProjectionMatrix(materialSID, 0);\n  v_projPosition_from_light = lightViewProjectionMatrix * v_position_inWorld;\n\n  // Following tMatrix is based on https://wgld.org/d/webgl/w051.html\n  mat4 tMatrix = mat4(\n    0.5, 0.0, 0.0, 0.0,\n    0.0, 0.5, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.5, 0.5, 0.0, 1.0\n  );\n  v_texcoord_1 = tMatrix * v_projPosition_from_light;\n\n  v_color = a_color;\n  v_normal_inWorld = normalMatrix * a_normal;\n  v_texcoord_0 = a_texcoord_0;\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},b={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec3 v_color;\nin vec3 v_normal_inWorld;\nin vec4 v_position_inWorld;\nin vec2 v_texcoord_0;\nin vec4 v_texcoord_1;\nin vec4 v_projPosition_from_light;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\nfloat decodeRGBAToDepth(vec4 RGBA){\n  const float rMask = 1.0;\n  const float gMask = 1.0 / 255.0;\n  const float bMask = 1.0 / (255.0 * 255.0);\n  const float aMask = 1.0 / (255.0 * 255.0 * 255.0);\n  float depth = dot(RGBA, vec4(rMask, gMask, bMask, aMask));\n  return depth;\n}\n\nvoid main (){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n\n  // diffuseColor\n  vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n\n  vec4 diffuseColorFactor = get_diffuseColorFactor(materialSID, 0);\n  if (v_color != diffuseColor && diffuseColorFactor.rgb != diffuseColor) {\n    diffuseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == diffuseColor) {\n    diffuseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == diffuseColor) {\n    diffuseColor = v_color;\n  } else {\n    diffuseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n  // diffuseColorTexture\n  vec4 textureColor = texture(u_diffuseColorTexture, v_texcoord_0);\n  if (textureColor.r > 0.05) {\n    diffuseColor *= textureColor.rgb;\n    alpha *= textureColor.a;\n  }\n\n  // shadow mapping\n  if(v_projPosition_from_light.w > 0.0){\n    float zNear = get_zNearInner(materialSID, 0);\n    float zFar = get_zFarInner(materialSID, 0);\n    float normalizationCoefficient = 1.0 / (zFar - zNear);\n\n    vec2 shadowMapUV = v_texcoord_1.xy / v_texcoord_1.w;\n\n    #ifdef RN_IS_DEBUGGING\n      bool inShadowMap = (shadowMapUV.x >= 0.0 && shadowMapUV.x <= 1.0) && (shadowMapUV.y >= 0.0 && shadowMapUV.y <= 1.0);\n      if(inShadowMap == false){\n        rt0 = get_debugColorFactor(materialSID, 0);\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n        return;\n      }\n    #endif\n\n    float measureDepth = normalizationCoefficient * length(v_projPosition_from_light);\n    float textureDepth = decodeRGBAToDepth(texture(u_depthTexture, shadowMapUV));\n    float allowableDepthError = get_allowableDepthError(materialSID, 0);\n\n    if(measureDepth > textureDepth + allowableDepthError){\n      // case of shadow\n      vec4 shadowColorFactor = get_shadowColorFactor(materialSID, 0);\n      diffuseColor = shadowColorFactor.rgb;\n      alpha = shadowColorFactor.a;\n    }\n  }\n\n  // Lighting\n  vec3 shadingColor = vec3(0.0, 0.0, 0.0);\n  int shadingModel = get_shadingModel(materialSID, 0);\n  if (shadingModel > 0) {\n\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 specular = vec3(0.0, 0.0, 0.0);\n    int lightNumber = get_lightNumber(materialSID, 0);\n    for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n      float lightType = gotLightPosition.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(gotLightDirection.xyz, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n\n      vec3 incidentLight = spotEffect * lightIntensity.xyz;\n//      incidentLight *= M_PI;\n\n      diffuse += diffuseColor * max(0.0, dot(normal_inWorld, lightDirection)) * incidentLight;\n\n      float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n      vec3 viewPosition = get_viewPosition(cameraSID, 0);\n      float shininess = get_shininess(materialSID, 0);\n      if (shadingModel == 2) {// BLINN\n        // ViewDirection\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 halfVector = normalize(lightDirection + viewDirection);\n        specular += pow(max(0.0, dot(halfVector, normal_inWorld)), shininess);\n      } else if (shadingModel == 3) { // PHONG\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 R = reflect(lightDirection, normal_inWorld);\n        specular += pow(max(0.0, dot(R, viewDirection)), shininess);\n      }\n\n    }\n\n    shadingColor = diffuse + specular;\n  } else {\n    shadingColor = diffuseColor;\n  }\n\n  rt0 = vec4(shadingColor, alpha);\n  //rt0 = vec4(u_lightNumber, 0.0, 0.0, 1.0);\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class T extends a.Z{constructor({isMorphing:e,isSkinning:t,isLighting:n,isDebugging:d,colorAttachmentsNumber:u},A){super(null,"ShadowMapDecodeClassicShading"+(t?"+skinning":"")+(n?"":"-lighting"),{isMorphing:e,isSkinning:t,isLighting:n},I,b),this.__encodedDepthRenderPass=A;const p=A.getFramebuffer();if(null==p)return void console.error("encodedDepthRenderPass does not have framebuffer");const v=p.colorAttachments[u],y=A.getViewport();y.setComponents(1,1,y.z-1,y.w-1),A.setViewport(y);const S=[{semantic:i.f.LightViewProjectionMatrix,compositionType:r.d.Mat4,componentType:o.r.Float,stage:_.H.VertexShader,isSystem:!0,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:g.Z.zero(),min:-Number.MAX_VALUE,max:Number.MAX_VALUE},{semantic:i.f.ShadingModel,compositionType:r.d.Scalar,componentType:o.r.Int,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(c.D.Constant.index),min:0,max:3},{semantic:i.f.Shininess,compositionType:r.d.Scalar,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(5),min:0,max:Number.MAX_VALUE},{semantic:T.AllowableDepthError,compositionType:r.d.Scalar,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(1e-4),min:0,max:1},{semantic:T.ShadowColorFactor,compositionType:r.d.Vec4,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyArray([.5,.5,.5,1]),min:0,max:1},{semantic:i.f.DiffuseColorFactor,compositionType:r.d.Vec4,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyArray([1,1,1,1]),min:0,max:2},{semantic:T.IsPointLight,componentType:o.r.Bool,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(1),min:0,max:1},{semantic:i.f.Wireframe,componentType:o.r.Float,compositionType:r.d.Vec3,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:l.ZP.fromCopyArray([0,0,1]),min:0,max:10},{semantic:i.f.NormalTexture,compositionType:r.d.Texture2D,componentType:o.r.Int,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:[0,a.Z.__dummyBlueTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:i.f.DepthTexture,compositionType:r.d.Texture2D,componentType:o.r.Int,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:[0,v],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:i.f.DiffuseColorTexture,compositionType:r.d.Texture2D,componentType:o.r.Int,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:[1,a.Z.__dummyWhiteTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:T.zNearInner,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!0,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(.1),min:1e-4,max:Number.MAX_SAFE_INTEGER},{semantic:T.zFarInner,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!0,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(1e4),min:1e-4,max:Number.MAX_SAFE_INTEGER}];S.push({semantic:i.f.PointSize,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:x.ZP.fromCopyNumber(30),min:0,max:100},{semantic:i.f.PointDistanceAttenuation,componentType:o.r.Float,compositionType:r.d.Vec3,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:l.ZP.fromCopyArray([0,.1,.01]),min:0,max:1}),t&&(this.__definitions+="#define RN_IS_SKINNING\n"),n&&(this.__definitions+="#define RN_IS_LIGHTING\n"),e&&(this.__definitions+="#define RN_IS_MORPHING\n",S.push({semantic:i.f.MorphTargetNumber,componentType:o.r.Int,compositionType:r.d.Scalar,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:x.ZP.fromCopyNumber(0),min:0,max:f.Z.maxVertexMorphNumberInShader,needUniformInFastest:!0},{semantic:i.f.DataTextureMorphOffsetPosition,componentType:o.r.Int,compositionType:r.d.ScalarArray,maxIndex:f.Z.maxVertexMorphNumberInShader,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new m.Z(new Int32Array(f.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0},{semantic:i.f.MorphWeights,componentType:o.r.Float,compositionType:r.d.ScalarArray,maxIndex:f.Z.maxVertexMorphNumberInShader,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new m.Z(new Float32Array(f.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0})),d&&(this.__definitions+="#define RN_IS_DEBUGGING\n",S.push({semantic:T.DebugColorFactor,compositionType:r.d.Vec4,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyArray([1,0,0,1]),min:0,max:2})),this.setShaderSemanticsInfoArray(S)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:a}){let r=a.renderPass.cameraComponent;null==r&&(r=d.Z.getInstance().getComponent(u.Z,u.Z.main));const o=this.__encodedDepthRenderPass.cameraComponent;a.setUniform?(this.setWorldMatrix(t,a.worldMatrix),this.setNormalMatrix(t,a.normalMatrix),this.setViewInfo(t,r,a.isVr,a.displayIdx),this.setProjection(t,r,a.isVr,a.displayIdx),T.__lastZNear!==o.zNearInner&&(t._gl.uniform1f(t.zNearInner,o.zNearInner),T.__lastZNear=o.zNearInner),T.__lastZFar!==o.zFarInner&&(t._gl.uniform1f(t.zFarInner,o.zFarInner),T.__lastZFar=o.zFarInner),p.Z.getWebGLResourceRepository().setUniformValue(t,i.f.LightViewProjectionMatrix.str,!0,this.__encodedDepthRenderPass.cameraComponent.viewProjectionMatrix)):(e.setParameter(T.zNearInner,o.zNearInner),e.setParameter(T.zFarInner,o.zFarInner),e.setParameter(i.f.LightViewProjectionMatrix,this.__encodedDepthRenderPass.cameraComponent.viewProjectionMatrix));const s=a.entity.getComponent(A.Z);this.setSkinning(t,s,a.setUniform),this.setLightsInfo(t,a.lightComponents,e,a.setUniform),this.setMorphInfo(t,a.entity.getComponent(v.Z),a.entity.getComponent(y.Z),a.primitive)}}T.ShadowColorFactor=new i.w({str:"shadowColorFactor"}),T.ShadowAlpha=new i.w({str:"shadowAlpha"}),T.NonShadowAlpha=new i.w({str:"nonShadowAlpha"}),T.AllowableDepthError=new i.w({str:"allowableDepthError"}),T.zNearInner=new i.w({str:"zNearInner"}),T.zFarInner=new i.w({str:"zFarInner"}),T.DebugColorFactor=new i.w({str:"debugColorFactor"}),T.DepthTexture=new i.w({str:"depthTexture"}),T.IsPointLight=new i.w({str:"isPointLight"}),T.__lastZNear=0,T.__lastZFar=0},4722:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i=n(1784),a=n(2404),r=n(3999),o=n(810),s=n(4587),l=n(5324),c=n(1813),_=n(4141),h=n(4255),d=n(3616);const u={code:"\nprecision highp float;\nprecision highp int;\n\n\nin float a_instanceID;\nin vec3 a_baryCentricCoord;\nin vec3 a_position;\n\nout vec3 v_baryCentricCoord;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\nfloat cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\nmat4 worldMatrix = get_worldMatrix(a_instanceID);\nmat4 viewMatrix = get_viewMatrix(cameraSID, 0);\nmat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\ngl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n\n\n  v_baryCentricCoord = a_baryCentricCoord;\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},m={code:"\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\nin vec3 v_baryCentricCoord;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3 + vec3(1.0 - wireframeWidthInner) * d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  float framebufferWidth = get_framebufferWidth(materialSID, 0);\n  float tFrag = 1.0 / framebufferWidth;\n  vec2 offset = gl_FragCoord.st;\n\n  float synthesizeCoefficient0 = u_synthesizeCoefficient[0];\n  vec3 color = synthesizeCoefficient0 * texture2D(u_synthesizeTexture0, offset * tFrag).rgb;\n\n  vec4 targetTextureColor = texture2D(u_targetRegionTexture, offset * tFrag);\n  if (targetTextureColor != vec4(1.0, 1.0, 1.0, 1.0)) {\n    float synthesizeCoefficient1 = u_synthesizeCoefficient[1];\n    float synthesizeCoefficient2 = u_synthesizeCoefficient[2];\n    float synthesizeCoefficient3 = u_synthesizeCoefficient[3];\n    float synthesizeCoefficient4 = u_synthesizeCoefficient[4];\n    float synthesizeCoefficient5 = u_synthesizeCoefficient[5];\n\n    color += synthesizeCoefficient1 * texture2D(u_synthesizeTexture1, offset * tFrag).rgb;\n    color += synthesizeCoefficient2 * texture2D(u_synthesizeTexture2, offset * tFrag).rgb;\n    color += synthesizeCoefficient3 * texture2D(u_synthesizeTexture3, offset * tFrag).rgb;\n    color += synthesizeCoefficient4 * texture2D(u_synthesizeTexture4, offset * tFrag).rgb;\n    color += synthesizeCoefficient5 * texture2D(u_synthesizeTexture5, offset * tFrag).rgb;\n  }\n\n  rt0 = vec4(color, 1.0);\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n\n",shaderStage:"fragment",isFragmentShader:!0};class x extends _.Z{constructor(e,t=_.Z.dummyBlackTexture){var n,i,a,f,A,p;super(null,"synthesizeHDRTextureShading",{},u,m),this.existTargetRegion=null!=t,this.textureNumber=e.length;const g=[{semantic:s.f.FramebufferWidth,componentType:r.r.Float,compositionType:o.d.Scalar,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,soloDatum:!1,initialValue:d.ZP.fromCopyNumber(e[0].width),min:0,max:Number.MAX_SAFE_INTEGER},{semantic:x.SynthesizeCoefficient,componentType:r.r.Float,compositionType:o.d.ScalarArray,maxIndex:6,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,soloDatum:!1,initialValue:new h.Z(new Float32Array(6)),min:0,max:1,needUniformInFastest:!0},{semantic:x.SynthesizeTexture0,componentType:r.r.Int,compositionType:o.d.Texture2D,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,initialValue:[0,null!==(n=e[0])&&void 0!==n?n:_.Z.dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:x.SynthesizeTexture1,componentType:r.r.Int,compositionType:o.d.Texture2D,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,initialValue:[1,null!==(i=e[1])&&void 0!==i?i:_.Z.dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:x.SynthesizeTexture2,componentType:r.r.Int,compositionType:o.d.Texture2D,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,initialValue:[2,null!==(a=e[2])&&void 0!==a?a:_.Z.dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:x.SynthesizeTexture3,componentType:r.r.Int,compositionType:o.d.Texture2D,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,initialValue:[3,null!==(f=e[3])&&void 0!==f?f:_.Z.dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:x.SynthesizeTexture4,componentType:r.r.Int,compositionType:o.d.Texture2D,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,initialValue:[4,null!==(A=e[4])&&void 0!==A?A:_.Z.dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:x.SynthesizeTexture5,componentType:r.r.Int,compositionType:o.d.Texture2D,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,initialValue:[5,null!==(p=e[5])&&void 0!==p?p:_.Z.dummyBlackTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:x.TargetRegionTexture,componentType:r.r.Int,compositionType:o.d.Texture2D,stage:l.H.PixelShader,isSystem:!1,updateInterval:c.a.EveryTime,initialValue:[6,t],min:0,max:Number.MAX_SAFE_INTEGER}];this.setShaderSemanticsInfoArray(g)}setParametersForGPU({material:e,shaderProgram:t,args:n}){n.setUniform?this.setWorldMatrix(t,n.worldMatrix):t._gl.uniform1fv(t.synthesizeCoefficient,e.getParameter(x.SynthesizeCoefficient)._v);let r=n.renderPass.cameraComponent;null==r&&(r=a.Z.getInstance().getComponent(i.Z,i.Z.main)),r&&(this.setViewInfo(t,r,n.isVr,n.displayIdx),this.setProjection(t,r,n.isVr,n.displayIdx))}get existTargetRegionTexture(){return this.existTargetRegion}get synthesizeTextureNumber(){return this.textureNumber}}x.SynthesizeCoefficient=new s.w({str:"synthesizeCoefficient"}),x.TargetRegionTexture=new s.w({str:"targetRegionTexture"}),x.SynthesizeTexture0=new s.w({str:"synthesizeTexture0"}),x.SynthesizeTexture1=new s.w({str:"synthesizeTexture1"}),x.SynthesizeTexture2=new s.w({str:"synthesizeTexture2"}),x.SynthesizeTexture3=new s.w({str:"synthesizeTexture3"}),x.SynthesizeTexture4=new s.w({str:"synthesizeTexture4"}),x.SynthesizeTexture5=new s.w({str:"synthesizeTexture5"})},8985:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var i=n(4587),a=n(4141),r=n(810),o=n(3999),s=n(7192),l=n(2471),c=n(9840),_=n(5324),h=n(1813),d=n(2404),u=n(1784),m=n(4255),x=n(3616),f=n(346),A=n(871),p=n(7987),g=n(3496),v=n(6019),y=n(85);const I={code:"\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nin vec3 a_position;\nin vec3 a_color;\nin vec3 a_normal;\nin float a_instanceID;\nin vec2 a_texcoord_0;\nin vec4 a_joint;\nin vec4 a_weight;\nin vec4 a_baryCentricCoord;\nout vec3 v_color;\nout vec3 v_normal_inWorld;\nout vec4 v_position_inWorld;\nout vec2 v_texcoord_0;\nout vec4 v_texcoord_1;\nout vec4 v_projPosition_from_light;\nout vec3 v_baryCentricCoord;\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\n/* shaderity: @{getters} */\n\n/* shaderity: @{matricesGetters} */\n\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}\n\n\n\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n  return skinMat;\n}\n#endif\n\n\n\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}\n\n\nvoid main(){\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  mat3 normalMatrix = get_normalMatrix(a_instanceID);\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n\n  bool isSkinning = false;\n  isSkinning = processGeometryWithMorphingAndSkinning(\n    skeletalComponentSID,\n    worldMatrix,\n    normalMatrix,\n    normalMatrix,\n    a_position,\n    v_position_inWorld,\n    a_normal,\n    v_normal_inWorld\n  );\n\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID} */];\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  gl_Position = projectionMatrix * viewMatrix * v_position_inWorld;\n\n// #ifdef RN_IS_POINTSPRITE\n\nvec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\nvec3 viewPosition = get_viewPosition(cameraSID, 0);\nfloat distanceFromCamera = length(position_inWorld.xyz - viewPosition);\nvec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\nfloat distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\nfloat maxPointSize = get_pointSize(materialSID, 0);\ngl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);\n\n// #endif\n\n\n  v_baryCentricCoord = a_baryCentricCoord.xyz;\n  v_color = a_color;\n  v_texcoord_0 = a_texcoord_0;\n\n  // Shadow mapping\n  mat4 lightViewProjectionMatrix = get_lightViewProjectionMatrix(materialSID, 0);\n  v_projPosition_from_light = lightViewProjectionMatrix * v_position_inWorld;\n\n  // Following tMatrix is based on https://wgld.org/d/webgl/w051.html\n  mat4 tMatrix = mat4(\n    0.5, 0.0, 0.0, 0.0,\n    0.0, 0.5, 0.0, 0.0,\n    0.0, 0.0, 1.0, 0.0,\n    0.5, 0.5, 0.0, 1.0\n  );\n  v_texcoord_1 = tMatrix * v_projPosition_from_light;\n\n}\n",shaderStage:"vertex",isFragmentShader:!1},b={code:"\n#ifdef WEBGL1_EXT_SHADER_TEXTURE_LOD\n#extension GL_EXT_shader_texture_lod : require\n#endif\n\n#ifdef WEBGL1_EXT_STANDARD_DERIVATIVES\n#extension GL_OES_standard_derivatives : require\n#endif\n\nprecision highp float;\nprecision highp int;\n\n\n/* shaderity: @{definitions} */\n\nconst float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n\n\nin vec3 v_color;\nin vec3 v_normal_inWorld;\nin vec4 v_position_inWorld;\nin vec2 v_texcoord_0;\nin vec4 v_texcoord_1;\nin vec4 v_projPosition_from_light;\nin vec3 v_baryCentricCoord;\n\n#ifdef GLSL_ES3\n  layout(location = 0) out vec4 rt0;\n#else\n  vec4 rt0;\n#endif\n\n\n/* shaderity: @{getters} */\n\nfloat edge_ratio(vec3 bary3, float wireframeWidthInner, float wireframeWidthRelativeScale) {\n  vec3 d = fwidth(bary3);\n  vec3 x = bary3+vec3(1.0 - wireframeWidthInner)*d;\n  vec3 a3 = smoothstep(vec3(0.0), d, x);\n  float factor = min(min(a3.x, a3.y), a3.z);\n\n  return clamp((1.0 - factor), 0.0, 1.0);\n}\n\nfloat decodeRGBAToDepth(vec4 RGBA){\n  const float rMask = 1.0;\n  const float gMask = 1.0 / 255.0;\n  const float bMask = 1.0 / (255.0 * 255.0);\n  const float aMask = 1.0 / (255.0 * 255.0 * 255.0);\n  float depth = dot(RGBA, vec4(rMask, gMask, bMask, aMask));\n  return depth;\n}\n\nfloat linstep(float min,float max,float v){\n  return clamp((v-min)/(max-min),0.0,1.0);\n}\n\nfloat reduceLightBleeding(float p_max, float parameter){\n  return linstep(parameter,1.0,p_max);\n}\n\nfloat chebyshevUpperBound(float materialSID){\n  float textureDepth = decodeRGBAToDepth(texture2DProj(u_depthTexture, v_texcoord_1));\n  float textureSquareDepth = decodeRGBAToDepth(texture2DProj(u_squareDepthTexture, v_texcoord_1));\n  if(textureDepth == 1.0 || textureSquareDepth == 1.0){\n    return 1.0;\n  }\n\n  float nonShadowProb = 1.0;\n\n  if(v_projPosition_from_light.w > 0.0){\n    float measureDepth;\n    bool isPointLight = get_isPointLight(materialSID, 0);\n    if(isPointLight){\n      float zNear = get_zNearInner(materialSID, 0);\n      float zFar = get_zFarInner(materialSID, 0);\n      float normalizationCoefficient = 1.0 / (zFar - zNear);\n      measureDepth = normalizationCoefficient * length(v_projPosition_from_light);\n    }else{\n      measureDepth = (v_projPosition_from_light / v_projPosition_from_light.w).z;\n    }\n\n    float depthAdjustment = get_depthAdjustment(materialSID, 0);\n    measureDepth += depthAdjustment;\n\n    float textureDepthAdjustment = get_textureDepthAdjustment(materialSID, 0);\n    textureDepth += textureDepthAdjustment;\n\n    float d = measureDepth - textureDepth;\n    if(d < 0.0) return 1.0;\n\n    float variance = textureSquareDepth - textureDepth * textureDepth;\n    float minimumVariance = get_minimumVariance(materialSID, 0);\n    variance = max(variance, minimumVariance);\n\n    nonShadowProb = variance / (variance + d * d);\n\n\n    float lightBleedingParameter = get_lightBleedingParameter(materialSID, 0);\n    nonShadowProb = reduceLightBleeding(nonShadowProb, lightBleedingParameter);\n  }\n  return nonShadowProb;\n}\n\nvoid main ()\n{\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n\n\n  // Normal\n  vec3 normal_inWorld = normalize(v_normal_inWorld);\n\n  // diffuseColor\n  vec3 diffuseColor = vec3(0.0, 0.0, 0.0);\n  float alpha = 1.0;\n\n  vec4 diffuseColorFactor = get_diffuseColorFactor(materialSID, 0);\n  if (v_color != diffuseColor && diffuseColorFactor.rgb != diffuseColor) {\n    diffuseColor = v_color * diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (v_color == diffuseColor) {\n    diffuseColor = diffuseColorFactor.rgb;\n    alpha = diffuseColorFactor.a;\n  } else if (diffuseColorFactor.rgb == diffuseColor) {\n    diffuseColor = v_color;\n  } else {\n    diffuseColor = vec3(1.0, 1.0, 1.0);\n  }\n\n  // diffuseColorTexture\n  vec4 textureColor = texture2D(u_diffuseColorTexture, v_texcoord_0);\n  if (textureColor.r > 0.05) {\n    diffuseColor *= textureColor.rgb;\n    alpha *= textureColor.a;\n  }\n\n  // shadow mapping\n  vec4 shadowColor = get_shadowColor(materialSID, 0);\n\n  float nonShadowProb = chebyshevUpperBound(materialSID);\n  diffuseColor = nonShadowProb * diffuseColor + (1.0 - nonShadowProb) * shadowColor.rgb;\n  alpha = nonShadowProb * alpha + (1.0 - nonShadowProb) * shadowColor.a;\n\n  // Lighting\n  vec3 shadingColor = vec3(0.0, 0.0, 0.0);\n\n  int shadingModel = get_shadingModel(materialSID, 0);\n  if (shadingModel > 0) {\n    vec3 diffuse = vec3(0.0, 0.0, 0.0);\n    vec3 specular = vec3(0.0, 0.0, 0.0);\n    int lightNumber = get_lightNumber(materialSID, 0);\n    for (int i = 0; i < /* shaderity: @{Config.maxLightNumberInShader} */ ; i++) {\n      if (i >= lightNumber) {\n        break;\n      }\n\n      vec4 gotLightDirection = get_lightDirection(0.0, i);\n      vec4 gotLightIntensity = get_lightIntensity(0.0, i);\n      vec4 gotLightPosition = get_lightPosition(0.0, i);\n\n      vec3 lightDirection = gotLightDirection.xyz;\n      vec3 lightIntensity = gotLightIntensity.xyz;\n      vec3 lightPosition = gotLightPosition.xyz;\n      float spotCosCutoff = gotLightDirection.w;\n      float spotExponent = gotLightIntensity.w;\n      float lightType = gotLightPosition.w;\n\n      if (0.75 < lightType) { // is pointlight or spotlight\n        lightDirection = normalize(lightPosition.xyz - v_position_inWorld.xyz);\n      }\n      float spotEffect = 1.0;\n      if (lightType > 1.75) { // is spotlight\n        spotEffect = dot(lightDirection.xyz, lightDirection);\n        if (spotEffect > spotCosCutoff) {\n          spotEffect = pow(spotEffect, spotExponent);\n        } else {\n          spotEffect = 0.0;\n        }\n      }\n\n      vec3 incidentLight = spotEffect * lightIntensity.xyz;\n//      incidentLight *= M_PI;\n\n      diffuse += diffuseColor * max(0.0, dot(normal_inWorld, lightDirection)) * incidentLight;\n\n      vec3 viewPosition = get_viewPosition(materialSID, 0);\n      float shininess = get_shininess(materialSID, 0);\n      if (shadingModel == 2) {// BLINN\n        // ViewDirection\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 halfVector = normalize(lightDirection + viewDirection);\n        specular += pow(max(0.0, dot(halfVector, normal_inWorld)), shininess);\n      } else if (shadingModel == 3) { // PHONG\n        vec3 viewDirection = normalize(viewPosition - v_position_inWorld.xyz);\n        vec3 R = reflect(lightDirection, normal_inWorld);\n        specular += pow(max(0.0, dot(R, viewDirection)), shininess);\n      }\n\n    }\n\n    shadingColor = diffuse + specular;\n  } else {\n    shadingColor = diffuseColor;\n  }\n\n  rt0 = vec4(shadingColor, alpha);\n\n  // Wireframe\n  float threshold = 0.001;\n  vec3 wireframe = get_wireframe(materialSID, 0);\n  float wireframeWidthInner = wireframe.z;\n  float wireframeWidthRelativeScale = 1.0;\n  if (wireframe.x > 0.5 && wireframe.y < 0.5) {\n    rt0.a = 0.0;\n  }\n  vec4 wireframeResult = rt0;\n  vec4 wireframeColor = vec4(0.2, 0.75, 0.0, 1.0);\n  float edgeRatio = edge_ratio(v_baryCentricCoord, wireframeWidthInner, wireframeWidthRelativeScale);\n  float edgeRatioModified = mix(step(threshold, edgeRatio), clamp(edgeRatio*4.0, 0.0, 1.0), wireframeWidthInner / wireframeWidthRelativeScale/4.0);\n  // if r0.a is 0.0, it is wireframe not on shaded\n  wireframeResult.rgb = wireframeColor.rgb * edgeRatioModified + rt0.rgb * (1.0 - edgeRatioModified);\n  wireframeResult.a = max(rt0.a, wireframeColor.a * mix(edgeRatioModified, pow(edgeRatioModified, 100.0), wireframeWidthInner / wireframeWidthRelativeScale/1.0));\n\n  if (wireframe.x > 0.5) {\n    rt0 = wireframeResult;\n    if (wireframe.y < 0.5 && rt0.a == 0.0) {\n      discard;\n    }\n  }\n\n#ifdef GLSL_ES3\n\n#else\n  gl_FragColor = rt0;\n#endif\n\n}\n",shaderStage:"fragment",isFragmentShader:!0};class T extends a.Z{constructor({isMorphing:e,isSkinning:t,isLighting:n,isDebugging:d,colorAttachmentsNumberDepth:u,colorAttachmentsNumberSquareDepth:A,depthCameraComponent:p},v){super(null,"varianceShadowMapDecodeShading"+(e?"+morphing":"")+(t?"+skinning":"")+(n?"":"-lighting")+(d?"":"+debugging"),{isMorphing:e,isSkinning:t,isLighting:n},I,b),2!==v.length&&console.error("invalid length of renderPasses"),null==p?console.warn("need to set depth camera component"):this.__depthCameraComponent=p;for(const e of v){const t=e.getViewport();t.setComponents(1,1,t.z-1,t.w-1),e.setViewport(t)}let y;const S=v[0].getFramebuffer();let E;S?y=S.colorAttachments[u]:(console.warn("renderPass of depth does not have framebuffer"),y=a.Z.__dummyBlackTexture);const C=v[1].getFramebuffer();C?E=C.colorAttachments[A]:(console.warn("renderPass of square depth does not have framebuffer"),E=a.Z.__dummyBlackTexture);const w=[{semantic:i.f.LightViewProjectionMatrix,compositionType:r.d.Mat4,componentType:o.r.Float,stage:_.H.VertexShader,isSystem:!0,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:g.Z.zero(),min:-Number.MAX_VALUE,max:Number.MAX_VALUE},{semantic:i.f.ShadingModel,compositionType:r.d.Scalar,componentType:o.r.Int,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(c.D.Constant.index),min:0,max:3},{semantic:i.f.Shininess,compositionType:r.d.Scalar,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(5),min:0,max:Number.MAX_VALUE},{semantic:T.AllowableDepthError,compositionType:r.d.Scalar,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(1e-4),min:0,max:1},{semantic:T.ShadowColor,compositionType:r.d.Vec4,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyArray([.5,.5,.5,1]),min:0,max:1},{semantic:i.f.DiffuseColorFactor,compositionType:r.d.Vec4,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyArray([1,1,1,1]),min:0,max:2},{semantic:T.zNearInner,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!0,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(.1),min:1e-4,max:Number.MAX_SAFE_INTEGER},{semantic:T.zFarInner,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!0,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(1e4),min:1e-4,max:Number.MAX_SAFE_INTEGER},{semantic:T.IsPointLight,componentType:o.r.Bool,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(1),min:0,max:1},{semantic:i.f.Wireframe,componentType:o.r.Float,compositionType:r.d.Vec3,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:l.ZP.fromCopyArray([0,0,1]),min:0,max:10},{semantic:T.DepthAdjustment,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(0),min:0,max:1},{semantic:T.LightBleedingParameter,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(0),min:0,max:1},{semantic:T.MinimumVariance,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(1e-7),min:0,max:Number.MAX_SAFE_INTEGER},{semantic:T.TextureDepthAdjustment,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,soloDatum:!1,initialValue:x.ZP.fromCopyNumber(0),min:0,max:1},{semantic:i.f.NormalTexture,compositionType:r.d.Texture2D,componentType:o.r.Int,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:[0,a.Z.__dummyBlueTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:i.f.DiffuseColorTexture,compositionType:r.d.Texture2D,componentType:o.r.Int,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:[1,a.Z.__dummyWhiteTexture],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:T.DepthTexture,componentType:o.r.Int,compositionType:r.d.Texture2D,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:[2,y],min:0,max:Number.MAX_SAFE_INTEGER},{semantic:T.SquareDepthTexture,componentType:o.r.Int,compositionType:r.d.Texture2D,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.EveryTime,initialValue:[3,E],min:0,max:Number.MAX_SAFE_INTEGER}];w.push({semantic:i.f.PointSize,componentType:o.r.Float,compositionType:r.d.Scalar,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:x.ZP.fromCopyNumber(30),min:0,max:100},{semantic:i.f.PointDistanceAttenuation,componentType:o.r.Float,compositionType:r.d.Vec3,stage:_.H.VertexShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!0,initialValue:l.ZP.fromCopyArray([0,.1,.01]),min:0,max:1}),t&&(this.__definitions+="#define RN_IS_SKINNING\n"),n&&(this.__definitions+="#define RN_IS_LIGHTING\n"),e&&(this.__definitions+="#define RN_IS_MORPHING\n",w.push({semantic:i.f.MorphTargetNumber,componentType:o.r.Int,compositionType:r.d.Scalar,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:x.ZP.fromCopyNumber(0),min:0,max:f.Z.maxVertexMorphNumberInShader,needUniformInFastest:!0},{semantic:i.f.DataTextureMorphOffsetPosition,componentType:o.r.Int,compositionType:r.d.ScalarArray,maxIndex:f.Z.maxVertexMorphNumberInShader,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new m.Z(new Int32Array(f.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0},{semantic:i.f.MorphWeights,componentType:o.r.Float,compositionType:r.d.ScalarArray,maxIndex:f.Z.maxVertexMorphNumberInShader,stage:_.H.VertexShader,isSystem:!0,soloDatum:!0,initialValue:new m.Z(new Float32Array(f.Z.maxVertexMorphNumberInShader)),min:-Number.MAX_VALUE,max:Number.MAX_VALUE,needUniformInFastest:!0})),d&&(this.__definitions+="#define RN_IS_DEBUGGING\n",w.push({semantic:T.DebugColorFactor,compositionType:r.d.Vec4,componentType:o.r.Float,stage:_.H.PixelShader,isSystem:!1,updateInterval:h.a.FirstTimeOnly,soloDatum:!1,initialValue:s.ZP.fromCopyArray([1,0,0,1]),min:0,max:2})),this.setShaderSemanticsInfoArray(w)}setParametersForGPU({material:e,shaderProgram:t,firstTime:n,args:a}){var r;let o=a.renderPass.cameraComponent;null==o&&(o=d.Z.getInstance().getComponent(u.Z,u.Z.main));const s=null!==(r=this.__depthCameraComponent)&&void 0!==r?r:a.renderPass.cameraComponent;a.setUniform?(this.setWorldMatrix(t,a.worldMatrix),this.setNormalMatrix(t,a.normalMatrix),this.setViewInfo(t,o,a.isVr,a.displayIdx),this.setProjection(t,o,a.isVr,a.displayIdx),T.__lastZNear!==s.zNearInner&&(t._gl.uniform1f(t.zNearInner,s.zNearInner),T.__lastZNear=s.zNearInner),T.__lastZFar!==s.zFarInner&&(t._gl.uniform1f(t.zFarInner,s.zFarInner),T.__lastZFar=s.zFarInner),p.Z.getWebGLResourceRepository().setUniformValue(t,i.f.LightViewProjectionMatrix.str,!0,s.viewProjectionMatrix)):(e.setParameter(T.zNearInner,s.zNearInner),e.setParameter(T.zFarInner,s.zFarInner),e.setParameter(i.f.LightViewProjectionMatrix,s.viewProjectionMatrix));const l=a.entity.getComponent(A.Z);this.setSkinning(t,l,a.setUniform),this.setLightsInfo(t,a.lightComponents,e,a.setUniform),this.setMorphInfo(t,a.entity.getComponent(v.Z),a.entity.getComponent(y.Z),a.primitive),p.Z.getWebGLResourceRepository().setUniformValue(t,i.f.LightViewProjectionMatrix.str,!0,s.viewProjectionMatrix)}set depthCameraComponent(e){this.__depthCameraComponent=e}}T.IsPointLight=new i.w({str:"isPointLight"}),T.DepthTexture=new i.w({str:"depthTexture"}),T.SquareDepthTexture=new i.w({str:"squareDepthTexture"}),T.DepthAdjustment=new i.w({str:"depthAdjustment"}),T.TextureDepthAdjustment=new i.w({str:"textureDepthAdjustment"}),T.MinimumVariance=new i.w({str:"minimumVariance"}),T.LightBleedingParameter=new i.w({str:"lightBleedingParameter"}),T.ShadowColor=new i.w({str:"shadowColor"}),T.AllowableDepthError=new i.w({str:"allowableDepthError"}),T.zNearInner=new i.w({str:"zNearInner"}),T.zFarInner=new i.w({str:"zFarInner"}),T.DebugColorFactor=new i.w({str:"debugColorFactor"}),T.__lastZNear=0,T.__lastZFar=0},2477:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var i=n(2471),a=n(9190),r=n(3032);class o{constructor(){this.__min=a.ZP.fromCopyArray([Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE]),this.__max=a.ZP.fromCopyArray([-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]),this.__centerPoint=a.ZP.zero(),this.__lengthCenterToCorner=0,this.__isCenterPointDirty=!1,this.__isLengthCenterToCornerDirty=!1}clone(){const e=new o;return e.__max=this.__max.clone(),e.__min=this.__min.clone(),e.__centerPoint=this.__centerPoint.clone(),e.__lengthCenterToCorner=this.__lengthCenterToCorner,e.__isCenterPointDirty=this.__isCenterPointDirty,e.__isLengthCenterToCornerDirty=this.__isLengthCenterToCornerDirty,e}copyComponents(e){return this.__max.copyComponents(e.__max),this.__min.copyComponents(e.__min),this.__centerPoint.copyComponents(e.__centerPoint),this.__lengthCenterToCorner=e.__lengthCenterToCorner,this.__isCenterPointDirty=e.__isCenterPointDirty,this.__isLengthCenterToCornerDirty=e.__isLengthCenterToCornerDirty,this}initialize(){this.__min.setComponents(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.__max.setComponents(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.__centerPoint.zero(),this.__lengthCenterToCorner=0,this.__isCenterPointDirty=!1,this.__isLengthCenterToCornerDirty=!1}set minPoint(e){this.__min.copyComponents(e),this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0}get minPoint(){return this.__min}set maxPoint(e){this.__max.copyComponents(e),this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0}get maxPoint(){return this.__max}isVanilla(){return this.__min.x>=Number.MAX_VALUE&&this.__min.y>=Number.MAX_VALUE&&this.__min.z>=Number.MAX_VALUE&&this.__max.x<=-Number.MAX_VALUE&&this.__max.y<=-Number.MAX_VALUE&&this.__max.z<=-Number.MAX_VALUE}addPosition(e){return this.__min.x=e.x<this.__min.x?e.x:this.__min.x,this.__min.y=e.y<this.__min.y?e.y:this.__min.y,this.__min.z=e.z<this.__min.z?e.z:this.__min.z,this.__max.x=this.__max.x<e.x?e.x:this.__max.x,this.__max.y=this.__max.y<e.y?e.y:this.__max.y,this.__max.z=this.__max.z<e.z?e.z:this.__max.z,this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0,e}addPositionWithArray(e,t){return this.__min.x=e[t+0]<this.__min.x?e[t+0]:this.__min.x,this.__min.y=e[t+1]<this.__min.y?e[t+1]:this.__min.y,this.__min.z=e[t+2]<this.__min.z?e[t+2]:this.__min.z,this.__max.x=this.__max.x<e[t+0]?e[t+0]:this.__max.x,this.__max.y=this.__max.y<e[t+1]?e[t+1]:this.__max.y,this.__max.z=this.__max.z<e[t+2]?e[t+2]:this.__max.z,this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0,e}mergeAABB(e){let t=!1;return e.isVanilla()?t:(this.__isCenterPointDirty=!0,this.__isLengthCenterToCornerDirty=!0,this.isVanilla()?(this.__min.copyComponents(e.minPoint),this.__max.copyComponents(e.maxPoint),t=!0,t):(e.minPoint.x<this.__min.x&&(this.__min.x=e.minPoint.x,t=!0),e.minPoint.y<this.__min.y&&(this.__min.y=e.minPoint.y,t=!0),e.minPoint.z<this.__min.z&&(this.__min.z=e.minPoint.z,t=!0),this.__max.x<e.maxPoint.x&&(this.__max.x=e.maxPoint.x,t=!0),this.__max.y<e.maxPoint.y&&(this.__max.y=e.maxPoint.y,t=!0),this.__max.z<e.maxPoint.z&&(this.__max.z=e.maxPoint.z,t=!0),t))}get centerPoint(){return this.__isCenterPointDirty&&(a.ZP.addTo(this.__min,this.__max,this.__centerPoint).divide(2),this.__isCenterPointDirty=!1),this.__centerPoint}get lengthCenterToCorner(){return this.__isLengthCenterToCornerDirty&&(this.__lengthCenterToCorner=i.ZP.lengthBtw(this.centerPoint,this.maxPoint),this.__isLengthCenterToCornerDirty=!1),this.__lengthCenterToCorner}get sizeX(){return this.__max.x-this.__min.x}get sizeY(){return this.__max.y-this.__min.y}get sizeZ(){return this.__max.z-this.__min.z}static multiplyMatrix(e,t){if(t.isVanilla())return t.clone();const n=new o;return o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__min.z,n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__min.z,n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__min.z,n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__max.z,n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__max.z,n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__max.z,n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__min.z,n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__max.z,n.addPosition(o.__tmpVector3),n}static multiplyMatrixTo(e,t,n){return t.isVanilla()?n.copyComponents(t):(n.initialize(),o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__min.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__min.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__min.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__max.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__min.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__max.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__min.y,o.__tmpVector3.z=t.__max.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__min.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),o.__tmpVector3.x=t.__max.x,o.__tmpVector3.y=t.__max.y,o.__tmpVector3.z=t.__max.z,e.multiplyVector3To(o.__tmpVector3,o.__tmpVector3),n.addPosition(o.__tmpVector3),n)}toString(){return"AABB_min: "+this.__min+"\nAABB_max: "+this.__max+"\ncenterPoint: "+this.__centerPoint+"\nlengthCenterToCorner: "+this.__lengthCenterToCorner}toStringApproximately(){return"AABB_max: "+this.__max.toStringApproximately()+"\nAABB_min: "+this.__min.toStringApproximately()+"\ncenterPoint: "+this.__centerPoint.toStringApproximately()+"\nlengthCenterToCorner: "+r.k.financial(this.__lengthCenterToCorner)}}o.__tmpVector3=a.ZP.zero()},8775:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{constructor(){this._v=new Float32Array}at(e,t){throw new Error("Method not implemented.")}toString(){throw new Error("Method not implemented.")}toStringApproximately(){throw new Error("Method not implemented.")}flattenAsArray(){throw new Error("Method not implemented.")}isDummy(){return 0===this._v.length}v(e){return this._v[e]}determinant(){throw new Error("Method not implemented.")}get className(){return this.constructor.name}get isIdentityMatrixClass(){return!1}isTheSourceSame(e){return this._v.buffer===e}}},3343:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{constructor(){this._v=new Float32Array}get glslStrAsFloat(){throw new Error("Method not implemented.")}get glslStrAsInt(){throw new Error("Method not implemented.")}isEqual(e,t){throw new Error("Method not implemented.")}isStrictEqual(e){throw new Error("Method not implemented.")}length(){throw new Error("Method not implemented.")}lengthSquared(){throw new Error("Method not implemented.")}lengthTo(e){throw new Error("Method not implemented.")}dot(e){throw new Error("Method not implemented.")}at(e){return this._v[e]}toString(){throw new Error("Method not implemented.")}toStringApproximately(){throw new Error("Method not implemented.")}flattenAsArray(){throw new Error("Method not implemented.")}isDummy(){return 0===this._v.length}v(e){return this._v[e]}isTheSourceSame(e){return this._v.buffer===e}get className(){return this.constructor.name}}},8547:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var i=n(2390),a=n(2471),r=n(7192),o=n(4388),s=n(1447),l=n(916),c=n(810),_=n(3496),h=n(2566),d=n(4536),u=n(9190),m=n(8182),x=n(3616),f=n(963),A=n(4267),p=n(4255);class g{constructor(){}static arrayToVector(e){return Array.isArray(e)?void 0!==e[3]?r.ZP.fromCopyArray([e[0],e[1],e[2],e[3]]):void 0!==e[2]?a.ZP.fromCopyArray([e[0],e[1],e[2]]):i.ZP.fromCopyArray2([e[0],e[1]]):e}static arrayToVectorOrMatrix(e){return Array.isArray(e)?void 0!==e[15]?new l.Z(e):void 0!==e[8]?new s.Z(e):void 0!==e[3]?r.ZP.fromCopyArray([e[0],e[1],e[2],e[3]]):void 0!==e[2]?a.ZP.fromCopyArray([e[0],e[1],e[2]]):i.ZP.fromCopyArray2([e[0],e[1]]):e}static getImmutableValueClass(e){return e===c.d.Vec2?i.ZP:e===c.d.Vec3?a.ZP:e===c.d.Vec4?r.ZP:e===c.d.Mat3?s.Z:e===c.d.Mat4?l.Z:void 0}static getMutableValueClass(e){return e===c.d.Vec2?m.ZP:e===c.d.Vec3?u.ZP:e===c.d.Vec4?d.ZP:e===c.d.Mat3?h.Z:e===c.d.Mat4?_.Z:void 0}static cloneOfMathObjects(e){return e instanceof l.Z||e instanceof s.Z||e instanceof r.ZP||e instanceof a.ZP||e instanceof i.ZP?e.clone():e}static isAcceptableArrayForQuaternion(e){return!(!Array.isArray(e)||void 0===e[3])}static arrayToQuaternion(e){return new o.Z(e[0],e[1],e[2],e[3])}static makeSubArray(e,t){return 4===t?[e[0],e[1],e[2],e[3]]:3===t?[e[0],e[1],e[2]]:2===t?[e[0],e[1]]:e[0]}static vectorToArray(e){return e instanceof i.ZP?[e.x,e.y]:e instanceof a.ZP?[e.x,e.y,e.z]:e instanceof r.ZP||e instanceof o.Z?[e.x,e.y,e.z,e.w]:e}static componentNumberOfVector(e){return e instanceof i.ZP?2:e instanceof a.ZP?3:e instanceof r.ZP||e instanceof o.Z?4:Array.isArray(e)?e.length:0}static packNormalizedVec4ToVec2(e,t,n,i,a){let r=0,o=0;return e=(e+1)/2,t=(t+1)/2,n=(n+1)/2,i=(i+1)/2,r=(Math.floor(e*(a-1))*a+Math.floor(t*(a-1)))/a,o=(Math.floor(n*(a-1))*a+Math.floor(i*(a-1)))/a,[r,o]}static unProjectTo(e,t,n,i,a,r){const o=this.__tmpVector4_0.setComponents((e-a.x)/a.z*2-1,(t-a.y)/a.w*2-1,2*n-1,1),s=i.multiplyVectorTo(o,this.__tmpVector4_1);return 0===s.w&&console.error("0 division occurred!"),u.ZP.multiplyTo(s,1/s.w,r)}static add(e,t){if(isFinite(e))return e+t;if(e instanceof i.ZP)return i.ZP.add(e,t);if(e instanceof a.ZP)return a.ZP.add(e,t);if(e instanceof r.ZP)return r.ZP.add(e,t);if(e instanceof o.Z)return o.Z.add(e,t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]+t[i];return n}console.error("Non supported type!")}static subtract(e,t){if(isFinite(e))return e-t;if(e instanceof i.ZP)return i.ZP.subtract(e,t);if(e instanceof a.ZP)return a.ZP.subtract(e,t);if(e instanceof r.ZP)return r.ZP.subtract(e,t);if(e instanceof o.Z)return o.Z.subtract(e,t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]-t[i];return n}console.error("Non supported type!")}static multiplyNumber(e,t){if(isFinite(e))return e*t;if(e instanceof i.ZP)return i.ZP.multiply(e,t);if(e instanceof a.ZP)return a.ZP.multiply(e,t);if(e instanceof r.ZP)return r.ZP.multiply(e,t);if(e instanceof o.Z)return o.Z.multiplyNumber(e,t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]*t;return n}console.error("Non supported type!")}static divideNumber(e,t){if(isFinite(e))return e/t;if(e instanceof i.ZP)return i.ZP.multiply(e,1/t);if(e instanceof a.ZP)return a.ZP.multiply(e,1/t);if(e instanceof r.ZP)return r.ZP.multiply(e,1/t);if(e instanceof o.Z)return o.Z.multiplyNumber(e,1/t);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=e[i]/t;return n}console.error("Non supported type!")}static initWithScalar(e,t){if(isFinite(e))return t;if(e instanceof i.ZP)return i.ZP.fromCopyArray2([t,t]);if(e instanceof a.ZP)return a.ZP.fromCopyArray([t,t,t]);if(e instanceof r.ZP)return r.ZP.fromCopyArray([t,t,t,t]);if(e instanceof o.Z)return new o.Z(0,0,0,1);if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;i++)n[i]=t;return n}console.error("Non supported type!")}static initWithFloat32Array(e,t,n,c){let g;if(isFinite(e)){const e=new Float32Array(n);return n._v=void 0,e[0]=t,new x.ZP(e)}if(e instanceof x.ZP||e instanceof A.ZP)n[0]=t.x,g=new A.ZP(n);else if(e instanceof i.ZP||e instanceof m.ZP)n[0]=t.x,n[1]=t.y,g=new m.ZP(n);else if(e instanceof a.ZP||e instanceof u.ZP)n[0]=t.x,n[1]=t.y,n[2]=t.z,g=u.ZP.fromFloat32Array(n);else if(e instanceof r.ZP||e instanceof d.ZP)n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w,g=new d.ZP(n);else if(e instanceof o.Z||e instanceof f.Z)n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w,g=new f.Z(n);else if(e instanceof s.Z||e instanceof h.Z)g=null==g?new h.Z(n,!1,!0):g,g.m00=t.m00,g.m01=t.m01,g.m02=t.m02,g.m10=t.m10,g.m11=t.m11,g.m12=t.m12,g.m20=t.m20,g.m21=t.m21,g.m22=t.m22;else if(e instanceof l.Z||e instanceof _.Z)g=new _.Z(n,!1,!0),g.m00=t.m00,g.m01=t.m01,g.m02=t.m02,g.m03=t.m03,g.m10=t.m10,g.m11=t.m11,g.m12=t.m12,g.m13=t.m13,g.m20=t.m20,g.m21=t.m21,g.m22=t.m22,g.m23=t.m23,g.m30=t.m30,g.m31=t.m31,g.m32=t.m32,g.m33=t.m33;else{if(!(e instanceof p.Z)){if(null==e){let e;switch(n.length){case 4:e=r.ZP.fromCopyFloat32Array(n);break;case 3:e=a.ZP.fromCopyFloat32Array(n);break;case 2:e=new i.ZP(n);break;case 1:e=new x.ZP(n)}return n._v=void 0,e}return Array.isArray(e)||ArrayBuffer.isView(e)||ArrayBuffer.isView(e._v)?e:void console.error("Non supported type!")}for(let e=0;e<t._v.length;e++)n[e]=t._v[e];g=new p.Z(n)}return n._v=void 0,g}static _setForce(e,t){if(e instanceof r.ZP||e instanceof d.ZP)e._v[0]=t._v[0],e._v[1]=t._v[1],e._v[2]=t._v[2],e._v[3]=t._v[3];else if(e instanceof a.ZP||e instanceof u.ZP)e._v[0]=t._v[0],e._v[1]=t._v[1],e._v[2]=t._v[2];else if(e instanceof i.ZP||e instanceof m.ZP)e._v[0]=t._v[0],e._v[1]=t._v[1];else if(e instanceof x.ZP||e instanceof A.ZP)void 0===t._v?e._v[0]=t:e._v[0]=t._v[0];else if(e instanceof s.Z||e instanceof h.Z)e._v[0]=t._v[0],e._v[1]=t._v[1],e._v[2]=t._v[2],e._v[3]=t._v[3],e._v[4]=t._v[4],e._v[5]=t._v[5],e._v[6]=t._v[6],e._v[7]=t._v[7],e._v[8]=t._v[8];else if(e instanceof l.Z||e instanceof _.Z)e._v[0]=t._v[0],e._v[1]=t._v[1],e._v[2]=t._v[2],e._v[3]=t._v[3],e._v[4]=t._v[4],e._v[5]=t._v[5],e._v[6]=t._v[6],e._v[7]=t._v[7],e._v[8]=t._v[8],e._v[9]=t._v[9],e._v[10]=t._v[10],e._v[11]=t._v[11],e._v[12]=t._v[12],e._v[13]=t._v[13],e._v[14]=t._v[14],e._v[15]=t._v[15];else if(e instanceof o.Z||e instanceof f.Z)e._v[0]=t._v[0],e._v[1]=t._v[1],e._v[2]=t._v[2],e._v[3]=t._v[3];else if(e instanceof p.Z){let n;n=t instanceof p.Z?t._v:t;for(let t=0;t<n.length;t++)e._v[t]=n[t]}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=t._v[n];else if(isNaN(e._v.length))console.warn("Unknown type _setForce");else for(let n=0;n<e._v.length;n++)Array.isArray(t)?e._v[n]=t[n]:e._v[n]=t._v[n]}}g.__tmpVector4_0=d.ZP.zero(),g.__tmpVector4_1=d.ZP.zero()},3032:(e,t,n)=>{"use strict";function i(e){return 0==(e&e-1)}n.d(t,{k:()=>a});const a=Object.freeze({radianToDegree:function(e){return 180*e/Math.PI},degreeToRadian:function(e){return e*Math.PI/180},toHalfFloat:()=>function(e){const t=new Float32Array(1),n=new Int32Array(t.buffer);t[0]=e;const i=n[0];let a=i>>16&32768,r=i>>12&2047;const o=i>>23&255;return o<103?a:o>142?(a|=31744,a|=(255==o?0:1)&&8388607&i,a):o<113?(r|=2048,a|=(r>>114-o)+(r>>113-o&1),a):(a|=o-112<<10|r>>1,a+=1&r,a)},isPowerOfTwo:i,isPowerOfTwoTexture:function(e,t){return i(e)&&i(t)},packNormalizedVec4ToVec2:function(e,t,n,i,a){return e=(e+1)/2,t=(t+1)/2,n=(n+1)/2,i=(i+1)/2,[(Math.floor(e*(a-1))*a+Math.floor(t*(a-1)))/a,(Math.floor(n*(a-1))*a+Math.floor(i*(a-1)))/a]},convertToStringAsGLSLFloat:function(e){return Number.isInteger(e)?`${e}.0`:""+e},nearZeroToZero:function(e){return Math.abs(e)<1e-5?e=0:.99999<e&&e<1.00001?e=1:-1.00001<e&&e<-.99999&&(e=-1),e},gaussianCdf:function(e,t,n){return.5*(1+function(e){let t=1;e<0&&(t=-1);const n=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*n-1.453152027)*n+1.421413741)*n-.284496736)*n+.254829592)*n*Math.exp(-e*e))}((e-t)/(n*Math.sqrt(2))))},invGaussianCdf:function(e,t,n){return n*Math.sqrt(2)*function(e){let t,n=0;return t=-Math.log((1-e)*(1+e)),t<5?(t-=2.5,n=2.81022636e-8,n=3.43273939e-7+n*t,n=n*t-35233877e-13,n=n*t-439150654e-14,n=.00021858087+n*t,n=n*t-.00125372503,n=n*t-.00417768164,n=.246640727+n*t,n=1.50140941+n*t):(t=Math.sqrt(t)-3,n=-.000200214257,n=.000100950558+n*t,n=.00134934322+n*t,n=n*t-.00367342844,n=.00573950773+n*t,n=n*t-.0076224613,n=.00943887047+n*t,n=1.00167406+n*t,n=2.83297682+n*t),n*e}(2*e-1)+t},computeEigenValuesAndVectors:function(e,t,n){let i=0,a=0,r=0,o=0,s=0,l=0,c=0,_=0,h=0,d=0;for(let e=0;e<3;e++){t.setAt(e,e,1);for(let n=0;n<e;n++)t.setAt(e,n,0),t.setAt(n,e,0)}for(let t=0;t<3;t++)n.setAt(t,e.at(t,t));i=0;for(let e=0;e<3;e++)i+=Math.abs(n.at(e));i*=i;for(let i=0;i<50;i++){a=0;for(let t=0;t<3;t++)for(let n=t+1;n<3;n++)a+=Math.abs(e.at(t,n));if(0==a)return 0;d=i<4?.2*a/9:0;for(let a=0;a<3;a++)for(let u=a+1;u<3;u++)if(l=100*Math.abs(e.at(a,u)),i>4&&Math.abs(n.at(a))+l==Math.abs(n.at(a))&&Math.abs(n.at(u))+l==Math.abs(n.at(u)))e.setAt(a,u,0);else if(Math.abs(e.at(a,u))>d){c=n.at(u)-n.at(a),Math.abs(c)+l==Math.abs(c)?s=e.at(a,u)/c:(h=.5*c/e.at(a,u),s=h<0?-1/(Math.sqrt(1+h*h)-h):1/(Math.sqrt(1+h*h)+h)),o=1/Math.sqrt(1+s*s),r=s*o,_=s*e.at(a,u),e.setAt(a,u,0),n.setAt(a,n.at(a)-_),n.setAt(u,n.at(u)+_);for(let t=0;t<a;t++)s=e.at(t,a),e.setAt(t,a,o*s-r*e.at(t,u)),e.setAt(t,u,r*s+o*e.at(t,u));for(let t=a+1;t<u;t++)s=e.at(a,t),e.setAt(a,t,o*s-r*e.at(t,u)),e.setAt(t,u,r*s+o*e.at(t,u));for(let t=u+1;t<3;t++)s=e.at(a,t),e.setAt(a,t,o*s-r*e.at(u,t)),e.setAt(u,t,r*s+o*e.at(u,t));for(let e=0;e<3;e++)s=t.at(e,a),t.setAt(e,a,o*s-r*t.at(e,u)),t.setAt(e,u,r*s+o*t.at(e,u))}}return-1},computeGaussianDistributionRatioWhoseSumIsOne:function({kernelSize:e,variance:t,mean:n=0,effectiveDigit:i=4}){const a=Math.ceil(e/2),r=new Array(a);let o=0;for(let e=0;e<a;e++)r[e]=Math.exp(-((e-n)**2)/(2*t)),o+=r[e];o*=2,e/2%2!=0&&(o-=r[0]);const s=new Array(e);let l=0;const c=Math.pow(10,i);for(let t=0;t<a-1;t++){let n=r[a-1-t]/o;n*=c,n=Math.round(n),n/=c,s[t]=n,s[e-1-t]=n,l+=2*n}if(e%2==0){const e=(1-l)/2;s[a-1]=e,s[a]=e}else{const e=1-l;s[a-1]=e}return s},roundAsFloat:function(e){return Math.round(1e7*e)/1e7},financial:function(e){const t=Number.parseFloat(e).toFixed(7);return e>=0?" "+t:t}})},18:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(810),a=n(2390),r=n(3032),o=n(8775);class s extends o.Z{constructor(e,t,n,i,a=!1,r=!1){var o;super();const s=5===arguments.length?a:t,l=6===arguments.length?r:n,c=e;if(null!=c)if(4<=arguments.length&&arguments.length<=5&&null!=i)if(this._v=new Float32Array(4),!0===s){const e=arguments;this._v[0]=e[0],this._v[2]=e[2],this._v[1]=e[1],this._v[3]=e[3]}else{const e=arguments;this._v[0]=e[0],this._v[2]=e[1],this._v[1]=e[2],this._v[3]=e[3]}else Array.isArray(c)?(this._v=new Float32Array(4),!0===s?(this._v[0]=c[0],this._v[2]=c[2],this._v[1]=c[1],this._v[3]=c[3]):(this._v[0]=c[0],this._v[2]=c[1],this._v[1]=c[2],this._v[3]=c[3])):c instanceof Float32Array?l?this._v=c:(this._v=new Float32Array(4),!0===s?(this._v[0]=c[0],this._v[2]=c[2],this._v[1]=c[1],this._v[3]=c[3]):(this._v[0]=c[0],this._v[2]=c[1],this._v[1]=c[2],this._v[3]=c[3])):c&&null!=(null===(o=c._v)||void 0===o?void 0:o[3])?l?this._v=c._v:(this._v=new Float32Array(4),!0===s?(c._v,this._v[0]=c[0],this._v[2]=c[2],this._v[1]=c[1],this._v[3]=c[3]):(c._v,this._v[0]=c[0],this._v[2]=c[1],this._v[1]=c[2],this._v[3]=c[3])):(this._v=new Float32Array(4),this._v[0]=1,this._v[2]=0,this._v[1]=0,this._v[3]=1);else this._v=new Float32Array(0)}get m00(){return this._v[0]}get m10(){return this._v[1]}get m01(){return this._v[2]}get m11(){return this._v[3]}get className(){return"Matrix22"}static get compositionType(){return i.d.Mat2}static zero(){return new this(0,0,0,0)}static identity(){return new this(1,0,0,1)}static dummy(){return new this(null)}static transpose(e){return new this(e._v[0],e._v[1],e._v[2],e._v[3])}static invert(e){const t=e.determinant();return 0===t&&console.error("the determinant is 0!"),new this(e._v[3]/t,e._v[2]/t*-1,e._v[1]/t*-1,e._v[0]/t)}static invertTo(e,t){const n=e.determinant();0===n&&console.error("the determinant is 0!");const i=e._v[3]/n,a=e._v[2]/n*-1,r=e._v[1]/n*-1,o=e._v[0]/n;return t.setComponents(i,a,r,o)}static rotate(e){const t=Math.cos(e),n=Math.sin(e);return new this(t,-n,n,t)}static scale(e){return new this(e._v[0],0,0,e._v[1])}static multiply(e,t){const n=e._v[0]*t._v[0]+e._v[2]*t._v[1],i=e._v[1]*t._v[0]+e._v[3]*t._v[1];return new this(n,e._v[0]*t._v[2]+e._v[2]*t._v[3],i,e._v[1]*t._v[2]+e._v[3]*t._v[3])}static multiplyTo(e,t,n){const i=e._v[0]*t._v[0]+e._v[2]*t._v[1],a=e._v[1]*t._v[0]+e._v[3]*t._v[1],r=e._v[0]*t._v[2]+e._v[2]*t._v[3],o=e._v[1]*t._v[2]+e._v[3]*t._v[3];return n.setComponents(i,r,a,o)}toString(){return this._v[0]+" "+this._v[2]+"\n"+this._v[1]+" "+this._v[3]+" \n"}toStringApproximately(){return r.k.financial(this._v[0])+" "+r.k.financial(this._v[2])+"\n"+r.k.financial(this._v[1])+" "+r.k.financial(this._v[3])+" \n"}flattenAsArray(){return[this._v[0],this._v[1],this._v[2],this._v[3]]}isDummy(){return 0===this._v.length}isEqual(e,t=Number.EPSILON){return Math.abs(e._v[0]-this._v[0])<t&&Math.abs(e._v[1]-this._v[1])<t&&Math.abs(e._v[2]-this._v[2])<t&&Math.abs(e._v[3]-this._v[3])<t}isStrictEqual(e){return e._v[0]===this._v[0]&&e._v[1]===this._v[1]&&e._v[2]===this._v[2]&&e._v[3]===this._v[3]}at(e,t){return this._v[e+2*t]}determinant(){return this._v[0]*this._v[3]-this._v[1]*this._v[2]}multiplyVector(e){const t=this._v[0]*e._v[0]+this._v[2]*e._v[1],n=this._v[1]*e._v[0]+this._v[3]*e._v[1];return a.ZP.fromCopyArray2([t,n])}multiplyVectorTo(e,t){const n=this._v[0]*e._v[0]+this._v[2]*e._v[1],i=this._v[1]*e._v[0]+this._v[3]*e._v[1];return t._v[0]=n,t._v[1]=i,t}getScale(){return a.ZP.fromCopyArray2([Math.hypot(this.m00,this.m01),Math.hypot(this.m10,this.m11)])}getScaleTo(e){return e._v[0]=Math.hypot(this._v[0],this._v[2]),e._v[1]=Math.hypot(this._v[1],this._v[3]),e}clone(){return new this.constructor(this._v[0],this._v[2],this._v[1],this._v[3])}}},1447:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var i=n(2471),a=n(810),r=n(3032),o=n(8775);class s extends o.Z{constructor(){super(),this._v=s.__v}toString(){return"1 0 0\n0 1 0\n0 0 1\n"}toStringApproximately(){return this.toString()}flattenAsArray(){return[1,0,0,0,1,0,0,0,1]}isDummy(){return!1}isEqual(e,t=Number.EPSILON){return Math.abs(e.m00-1)<t&&Math.abs(e.m10)<t&&Math.abs(e.m20)<t&&Math.abs(e.m01)<t&&Math.abs(e.m11-1)<t&&Math.abs(e.m21)<t&&Math.abs(e.m02)<t&&Math.abs(e.m12)<t&&Math.abs(e.m22-1)<t}isStrictEqual(e){const t=e._v;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&0===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&0===t[15]}at(e,t){return e===t?1:0}determinant(){return 1}multiplyVector(e){return e}multiplyVectorTo(e,t){const n=e._v;return t._v[0]=n[0],t._v[1]=n[1],t._v[2]=n[2],t._v[3]=n[3],t}getScale(){return i.ZP.fromCopyArray([1,1,1])}getScaleTo(e){const t=e._v;return t[0]=1,t[1]=1,t[2]=1,e}clone(){return new s}getRotate(){return new s}get m00(){return 1}get m10(){return 0}get m20(){return 0}get m30(){return 0}get m01(){return 0}get m11(){return 1}get m21(){return 0}get m31(){return 0}get m02(){return 0}get m12(){return 0}get m22(){return 1}get m32(){return 0}get m03(){return 0}get m13(){return 0}get m23(){return 0}get m33(){return 1}get className(){return"IdentityMatrix33"}static get compositionType(){return a.d.Mat3}get isIdentityMatrixClass(){return!0}}s.__v=new Float32Array([1,0,0,0,1,0,0,0,1]);class l extends o.Z{constructor(e,t,n,i,a,r,o,s,l,c=!1,_=!1){var h;super();const d=10===arguments.length?c:t,u=3===arguments.length?_:n,m=e;if(null!=m)if(9<=arguments.length&&arguments.length<=10&&null!=l)if(this._v=new Float32Array(9),!0===d){const e=arguments;this._v[0]=e[0],this._v[3]=e[3],this._v[6]=e[6],this._v[1]=e[1],this._v[4]=e[4],this._v[7]=e[7],this._v[2]=e[2],this._v[5]=e[5],this._v[8]=e[8]}else{const e=arguments;this._v[0]=e[0],this._v[3]=e[1],this._v[6]=e[2],this._v[1]=e[3],this._v[4]=e[4],this._v[7]=e[5],this._v[2]=e[6],this._v[5]=e[7],this._v[8]=e[8]}else if(Array.isArray(m))this._v=new Float32Array(9),!0===d?(this._v[0]=m[0],this._v[3]=m[3],this._v[6]=m[6],this._v[1]=m[1],this._v[4]=m[4],this._v[7]=m[7],this._v[2]=m[2],this._v[5]=m[5],this._v[8]=m[8]):(this._v[0]=m[0],this._v[3]=m[1],this._v[6]=m[2],this._v[1]=m[3],this._v[4]=m[4],this._v[7]=m[5],this._v[2]=m[6],this._v[5]=m[7],this._v[8]=m[8]);else if(m instanceof Float32Array)u?this._v=m:(this._v=new Float32Array(9),!0===d?(this._v[0]=m[0],this._v[3]=m[3],this._v[6]=m[6],this._v[1]=m[1],this._v[4]=m[4],this._v[7]=m[7],this._v[2]=m[2],this._v[5]=m[5],this._v[8]=m[8]):(this._v[0]=m[0],this._v[3]=m[1],this._v[6]=m[2],this._v[1]=m[3],this._v[4]=m[4],this._v[7]=m[5],this._v[2]=m[6],this._v[5]=m[7],this._v[8]=m[8]));else if(m&&null!=(null===(h=m._v)||void 0===h?void 0:h[8]))if(u)this._v=m._v;else{this._v=new Float32Array(9);const e=m._v;this._v[0]=e[0],this._v[3]=e[3],this._v[6]=e[6],this._v[1]=e[1],this._v[4]=e[4],this._v[7]=e[7],this._v[2]=e[2],this._v[5]=e[5],this._v[8]=e[8]}else if(m&&void 0!==m.className&&-1!==m.className.indexOf("Quaternion")){this._v=new Float32Array(9);const e=m,t=e._v[0]*e._v[0],n=e._v[1]*e._v[1],i=e._v[2]*e._v[2],a=e._v[1]*e._v[2],r=e._v[0]*e._v[2],o=e._v[0]*e._v[1],s=e._v[3]*e._v[0],l=e._v[3]*e._v[1],c=e._v[3]*e._v[2];this._v[0]=1-2*(n+i),this._v[3]=2*(o-c),this._v[6]=2*(r+l),this._v[1]=2*(o+c),this._v[4]=1-2*(t+i),this._v[7]=2*(a-s),this._v[2]=2*(r-l),this._v[5]=2*(a+s),this._v[8]=1-2*(t+n)}else this._v=new Float32Array(9),this._v[0]=1,this._v[3]=0,this._v[6]=0,this._v[1]=0,this._v[4]=1,this._v[7]=0,this._v[2]=0,this._v[5]=0,this._v[8]=1;else this._v=new Float32Array(0)}get m00(){return this._v[0]}get m10(){return this._v[1]}get m20(){return this._v[2]}get m01(){return this._v[3]}get m11(){return this._v[4]}get m21(){return this._v[5]}get m02(){return this._v[6]}get m12(){return this._v[7]}get m22(){return this._v[8]}get className(){return"Matrix33"}static get compositionType(){return a.d.Mat3}static zero(){return new this(0,0,0,0,0,0,0,0,0)}static identity(){return new s}static dummy(){return new this(null)}static transpose(e){return e.isIdentityMatrixClass?e:new this(e._v[0],e._v[1],e._v[2],e._v[3],e._v[4],e._v[5],e._v[6],e._v[7],e._v[8])}static invert(e){if(e.isIdentityMatrixClass)return e;const t=e.determinant();return 0===t&&console.error("the determinant is 0!"),new this((e._v[4]*e._v[8]-e._v[7]*e._v[5])/t,(e._v[6]*e._v[5]-e._v[3]*e._v[8])/t,(e._v[3]*e._v[7]-e._v[6]*e._v[4])/t,(e._v[7]*e._v[2]-e._v[1]*e._v[8])/t,(e._v[0]*e._v[8]-e._v[6]*e._v[2])/t,(e._v[6]*e._v[1]-e._v[0]*e._v[7])/t,(e._v[1]*e._v[5]-e._v[4]*e._v[2])/t,(e._v[3]*e._v[2]-e._v[0]*e._v[5])/t,(e._v[0]*e._v[4]-e._v[3]*e._v[1])/t)}static invertTo(e,t){if(e.isIdentityMatrixClass)return t.copyComponents(e);const n=e.determinant();0===n&&console.error("the determinant is 0!");const i=(e._v[4]*e._v[8]-e._v[7]*e._v[5])/n,a=(e._v[6]*e._v[5]-e._v[3]*e._v[8])/n,r=(e._v[3]*e._v[7]-e._v[6]*e._v[4])/n,o=(e._v[7]*e._v[2]-e._v[1]*e._v[8])/n,s=(e._v[0]*e._v[8]-e._v[6]*e._v[2])/n,l=(e._v[6]*e._v[1]-e._v[0]*e._v[7])/n,c=(e._v[1]*e._v[5]-e._v[4]*e._v[2])/n,_=(e._v[3]*e._v[2]-e._v[0]*e._v[5])/n,h=(e._v[0]*e._v[4]-e._v[3]*e._v[1])/n;return t.setComponents(i,a,r,o,s,l,c,_,h)}static rotateX(e){const t=Math.cos(e),n=Math.sin(e);return new this(1,0,0,0,t,-n,0,n,t)}static rotateY(e){const t=Math.cos(e),n=Math.sin(e);return new this(t,0,n,0,1,0,-n,0,t)}static rotateZ(e){const t=Math.cos(e),n=Math.sin(e);return new this(t,-n,0,n,t,0,0,0,1)}static rotateXYZ(e,t,n){const i=Math.cos(e),a=Math.sin(e),r=Math.cos(t),o=Math.sin(t),s=Math.cos(n),l=Math.sin(n),c=-a,_=-l,h=o*a,d=o*i;return new this(s*r,s*h+_*i,s*d+_*c,l*r,l*h+s*i,l*d+s*c,-o,r*a,r*i)}static rotate(e){return this.rotateXYZ(e._v[0],e._v[1],e._v[2])}static scale(e){return new this(e._v[0],0,0,0,e._v[1],0,0,0,e._v[2])}static multiply(e,t){if(e.isIdentityMatrixClass)return t;if(t.isIdentityMatrixClass)return e;const n=e._v[0]*t._v[0]+e._v[3]*t._v[1]+e._v[6]*t._v[2],i=e._v[1]*t._v[0]+e._v[4]*t._v[1]+e._v[7]*t._v[2],a=e._v[2]*t._v[0]+e._v[5]*t._v[1]+e._v[8]*t._v[2],r=e._v[0]*t._v[3]+e._v[3]*t._v[4]+e._v[6]*t._v[5],o=e._v[1]*t._v[3]+e._v[4]*t._v[4]+e._v[7]*t._v[5],s=e._v[2]*t._v[3]+e._v[5]*t._v[4]+e._v[8]*t._v[5];return new this(n,r,e._v[0]*t._v[6]+e._v[3]*t._v[7]+e._v[6]*t._v[8],i,o,e._v[1]*t._v[6]+e._v[4]*t._v[7]+e._v[7]*t._v[8],a,s,e._v[2]*t._v[6]+e._v[5]*t._v[7]+e._v[8]*t._v[8])}static multiplyTo(e,t,n){if(e.isIdentityMatrixClass)return n.copyComponents(t);if(t.isIdentityMatrixClass)return n.copyComponents(e);const i=e._v[0]*t._v[0]+e._v[3]*t._v[1]+e._v[6]*t._v[2],a=e._v[1]*t._v[0]+e._v[4]*t._v[1]+e._v[7]*t._v[2],r=e._v[2]*t._v[0]+e._v[5]*t._v[1]+e._v[8]*t._v[2],o=e._v[0]*t._v[3]+e._v[3]*t._v[4]+e._v[6]*t._v[5],s=e._v[1]*t._v[3]+e._v[4]*t._v[4]+e._v[7]*t._v[5],l=e._v[2]*t._v[3]+e._v[5]*t._v[4]+e._v[8]*t._v[5],c=e._v[0]*t._v[6]+e._v[3]*t._v[7]+e._v[6]*t._v[8],_=e._v[1]*t._v[6]+e._v[4]*t._v[7]+e._v[7]*t._v[8],h=e._v[2]*t._v[6]+e._v[5]*t._v[7]+e._v[8]*t._v[8];return n.setComponents(i,o,c,a,s,_,r,l,h)}toString(){return this._v[0]+" "+this._v[3]+" "+this._v[6]+"\n"+this._v[1]+" "+this._v[4]+" "+this._v[7]+"\n"+this._v[2]+" "+this._v[5]+" "+this._v[8]+"\n"}toStringApproximately(){return r.k.financial(this._v[0])+" "+r.k.financial(this._v[3])+" "+r.k.financial(this._v[6])+"\n"+r.k.financial(this._v[1])+" "+r.k.financial(this._v[4])+" "+r.k.financial(this._v[7])+" \n"+r.k.financial(this._v[2])+" "+r.k.financial(this._v[5])+" "+r.k.financial(this._v[8])+"\n"}flattenAsArray(){return[this._v[0],this._v[1],this._v[2],this._v[3],this._v[4],this._v[5],this._v[6],this._v[7],this._v[8]]}isDummy(){return 0===this._v.length}isEqual(e,t=Number.EPSILON){return Math.abs(e._v[0]-this._v[0])<t&&Math.abs(e._v[1]-this._v[1])<t&&Math.abs(e._v[2]-this._v[2])<t&&Math.abs(e._v[3]-this._v[3])<t&&Math.abs(e._v[4]-this._v[4])<t&&Math.abs(e._v[5]-this._v[5])<t&&Math.abs(e._v[6]-this._v[6])<t&&Math.abs(e._v[7]-this._v[7])<t&&Math.abs(e._v[8]-this._v[8])<t}isStrictEqual(e){return e._v[0]===this._v[0]&&e._v[1]===this._v[1]&&e._v[2]===this._v[2]&&e._v[3]===this._v[3]&&e._v[4]===this._v[4]&&e._v[5]===this._v[5]&&e._v[6]===this._v[6]&&e._v[7]===this._v[7]&&e._v[8]===this._v[8]}at(e,t){return this._v[e+3*t]}v(e){return this._v[e]}determinant(){return this._v[0]*this._v[4]*this._v[8]+this._v[1]*this._v[5]*this._v[6]+this._v[2]*this._v[3]*this._v[7]-this._v[0]*this._v[5]*this._v[7]-this._v[2]*this._v[4]*this._v[6]-this._v[1]*this._v[3]*this._v[8]}multiplyVector(e){const t=this._v[0]*e._v[0]+this._v[3]*e._v[1]+this._v[6]*e._v[2],n=this._v[1]*e._v[0]+this._v[4]*e._v[1]+this._v[7]*e._v[2],i=this._v[2]*e._v[0]+this._v[5]*e._v[1]+this._v[8]*e._v[2];return new e.constructor(new Float32Array([t,n,i]))}multiplyVectorTo(e,t){const n=this._v[0]*e._v[0]+this._v[3]*e._v[1]+this._v[6]*e._v[2],i=this._v[1]*e._v[0]+this._v[4]*e._v[1]+this._v[7]*e._v[2],a=this._v[2]*e._v[0]+this._v[5]*e._v[1]+this._v[8]*e._v[2];return t._v[0]=n,t._v[1]=i,t._v[2]=a,t}getScale(){return i.ZP.fromCopyArray([Math.hypot(this._v[0],this._v[3],this._v[6]),Math.hypot(this._v[1],this._v[4],this._v[7]),Math.hypot(this._v[2],this._v[5],this._v[8])])}getScaleTo(e){return e._v[0]=Math.hypot(this._v[0],this._v[3],this._v[6]),e._v[1]=Math.hypot(this._v[1],this._v[4],this._v[7]),e._v[2]=Math.hypot(this._v[2],this._v[5],this._v[8]),e}clone(){return new this.constructor(this._v[0],this._v[3],this._v[6],this._v[1],this._v[4],this._v[7],this._v[2],this._v[5],this._v[8])}}},916:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var i=n(2471),a=n(4388),r=n(7192),o=n(810),s=n(3032),l=n(8775);class c extends l.Z{constructor(){super(),this._v=c.__v}toString(){return"1 0 0 0\n0 1 0 0\n0 0 1 0\n0 0 0 1\n"}toStringApproximately(){return this.toString()}flattenAsArray(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}isDummy(){return!1}isEqual(e,t=Number.EPSILON){return Math.abs(e.m00-1)<t&&Math.abs(e.m10)<t&&Math.abs(e.m20)<t&&Math.abs(e.m30)<t&&Math.abs(e.m01)<t&&Math.abs(e.m11-1)<t&&Math.abs(e.m21)<t&&Math.abs(e.m31)<t&&Math.abs(e.m02)<t&&Math.abs(e.m12)<t&&Math.abs(e.m22-1)<t&&Math.abs(e.m32)<t&&Math.abs(e.m03)<t&&Math.abs(e.m13)<t&&Math.abs(e.m23)<t&&Math.abs(e.m33-1)<t}isStrictEqual(e){const t=e._v;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]}at(e,t){return e===t?1:0}v(e){return e%5==0?1:0}determinant(){return 1}multiplyVector(e){return e}multiplyVectorTo(e,t){const n=e._v;return t._v[0]=n[0],t._v[1]=n[1],t._v[2]=n[2],t._v[3]=n[3],t}getScale(){return i.ZP.one()}getScaleTo(e){const t=e._v;return t[0]=1,t[1]=1,t[2]=1,e}clone(){return new c}getRotate(){return new c}getTranslate(){return i.ZP.zero()}get m00(){return 1}get m10(){return 0}get m20(){return 0}get m30(){return 0}get m01(){return 0}get m11(){return 1}get m21(){return 0}get m31(){return 0}get m02(){return 0}get m12(){return 0}get m22(){return 1}get m32(){return 0}get m03(){return 0}get m13(){return 0}get m23(){return 0}get m33(){return 1}get translateX(){return 0}get translateY(){return 0}get translateZ(){return 0}get className(){return"IdentityMatrix44"}static get compositionType(){return o.d.Mat4}get isIdentityMatrixClass(){return!0}}c.__v=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);const _=Float32Array;class h extends l.Z{constructor(e,t,n,i,a,r,o,s,l,c,h,d,u,m,x,f,A=!1,p=!1){super();const g=arguments.length>=16?A:t,v=arguments.length>=16?p:n,y=e;if(null!=y)if(arguments.length>=16&&null!=arguments[3]){this._v=new _(16);const e=arguments;!0===g?(this._v[0]=e[0],this._v[4]=e[4],this._v[8]=e[8],this._v[12]=e[12],this._v[1]=e[1],this._v[5]=e[5],this._v[9]=e[9],this._v[13]=e[13],this._v[2]=e[2],this._v[6]=e[6],this._v[10]=e[10],this._v[14]=e[14],this._v[3]=e[3],this._v[7]=e[7],this._v[11]=e[11],this._v[15]=e[15]):(this._v[0]=e[0],this._v[4]=e[1],this._v[8]=e[2],this._v[12]=e[3],this._v[1]=e[4],this._v[5]=e[5],this._v[9]=e[6],this._v[13]=e[7],this._v[2]=e[8],this._v[6]=e[9],this._v[10]=e[10],this._v[14]=e[11],this._v[3]=e[12],this._v[7]=e[13],this._v[11]=e[14],this._v[15]=e[15])}else if(Array.isArray(y))this._v=new _(16),!0===g?(this._v[0]=y[0],this._v[4]=y[4],this._v[8]=y[8],this._v[12]=y[12],this._v[1]=y[1],this._v[5]=y[5],this._v[9]=y[9],this._v[13]=y[13],this._v[2]=y[2],this._v[6]=y[6],this._v[10]=y[10],this._v[14]=y[14],this._v[3]=y[3],this._v[7]=y[7],this._v[11]=y[11],this._v[15]=y[15]):(this._v[0]=y[0],this._v[4]=y[1],this._v[8]=y[2],this._v[12]=y[3],this._v[1]=y[4],this._v[5]=y[5],this._v[9]=y[6],this._v[13]=y[7],this._v[2]=y[8],this._v[6]=y[9],this._v[10]=y[10],this._v[14]=y[11],this._v[3]=y[12],this._v[7]=y[13],this._v[11]=y[14],this._v[15]=y[15]);else if(y instanceof _)v?this._v=y:(this._v=new _(16),!0===g?(this._v[0]=y[0],this._v[4]=y[4],this._v[8]=y[8],this._v[12]=y[12],this._v[1]=y[1],this._v[5]=y[5],this._v[9]=y[9],this._v[13]=y[13],this._v[2]=y[2],this._v[6]=y[6],this._v[10]=y[10],this._v[14]=y[14],this._v[3]=y[3],this._v[7]=y[7],this._v[11]=y[11],this._v[15]=y[15]):(this._v[0]=y[0],this._v[4]=y[1],this._v[8]=y[2],this._v[12]=y[3],this._v[1]=y[4],this._v[5]=y[5],this._v[9]=y[6],this._v[13]=y[7],this._v[2]=y[8],this._v[6]=y[9],this._v[10]=y[10],this._v[14]=y[11],this._v[3]=y[12],this._v[7]=y[13],this._v[11]=y[14],this._v[15]=y[15]));else if(y&&void 0!==y._v[15]&&void 0!==y._v[10])if(v)this._v=y._v;else{this._v=new _(16);const e=y._v;this._v[0]=e[0],this._v[4]=e[4],this._v[8]=e[8],this._v[12]=e[12],this._v[1]=e[1],this._v[5]=e[5],this._v[9]=e[9],this._v[13]=e[13],this._v[2]=e[2],this._v[6]=e[6],this._v[10]=e[10],this._v[14]=e[14],this._v[3]=e[3],this._v[7]=e[7],this._v[11]=e[11],this._v[15]=e[15]}else if(y&&void 0===y._v[15]&&void 0!==y._v[10])if(v)this._v=y._v;else{this._v=new _(16);const e=y._v;this._v[0]=e[0],this._v[4]=e[3],this._v[8]=e[6],this._v[12]=0,this._v[1]=e[1],this._v[5]=e[4],this._v[9]=e[7],this._v[13]=0,this._v[2]=e[2],this._v[6]=e[5],this._v[10]=e[8],this._v[14]=0,this._v[3]=0,this._v[7]=0,this._v[11]=0,this._v[15]=1}else if(y&&void 0!==y.className&&-1!==y.className.indexOf("Quaternion")){this._v=new _(16);const e=y._v[0]*y._v[0],t=y._v[1]*y._v[1],n=y._v[2]*y._v[2],i=y._v[1]*y._v[2],a=y._v[0]*y._v[2],r=y._v[0]*y._v[1],o=y._v[3]*y._v[0],s=y._v[3]*y._v[1],l=y._v[3]*y._v[2];this._v[0]=1-2*(t+n),this._v[4]=2*(r-l),this._v[8]=2*(a+s),this._v[12]=0,this._v[1]=2*(r+l),this._v[5]=1-2*(e+n),this._v[9]=2*(i-o),this._v[13]=0,this._v[2]=2*(a-s),this._v[6]=2*(i+o),this._v[10]=1-2*(e+t),this._v[14]=0,this._v[3]=0,this._v[7]=0,this._v[11]=0,this._v[15]=1}else this._v=new _(16),this._v[0]=1,this._v[4]=0,this._v[8]=0,this._v[12]=0,this._v[1]=0,this._v[5]=1,this._v[9]=0,this._v[13]=0,this._v[2]=0,this._v[6]=0,this._v[10]=1,this._v[14]=0,this._v[3]=0,this._v[7]=0,this._v[11]=0,this._v[15]=1;else this._v=new _(0)}get m00(){return this._v[0]}get m10(){return this._v[1]}get m20(){return this._v[2]}get m30(){return this._v[3]}get m01(){return this._v[4]}get m11(){return this._v[5]}get m21(){return this._v[6]}get m31(){return this._v[7]}get m02(){return this._v[8]}get m12(){return this._v[9]}get m22(){return this._v[10]}get m32(){return this._v[11]}get m03(){return this._v[12]}get m13(){return this._v[13]}get m23(){return this._v[14]}get m33(){return this._v[15]}get translateX(){return this._v[12]}get translateY(){return this._v[13]}get translateZ(){return this._v[14]}static get compositionType(){return o.d.Mat4}static zero(){return new this(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}static identity(){return new c}static dummy(){return new this(null)}static transpose(e){return e.isIdentityMatrixClass?e:new this(e._v[0],e._v[1],e._v[2],e._v[3],e._v[4],e._v[5],e._v[6],e._v[7],e._v[8],e._v[9],e._v[10],e._v[11],e._v[12],e._v[13],e._v[14],e._v[15])}static invert(e){if(e.isIdentityMatrixClass)return e;const t=e._v[0]*e._v[5]-e._v[4]*e._v[1],n=e._v[0]*e._v[9]-e._v[8]*e._v[1],i=e._v[0]*e._v[13]-e._v[12]*e._v[1],a=e._v[4]*e._v[9]-e._v[8]*e._v[5],r=e._v[4]*e._v[13]-e._v[12]*e._v[5],o=e._v[8]*e._v[13]-e._v[12]*e._v[9],s=e._v[2]*e._v[7]-e._v[6]*e._v[3],l=e._v[2]*e._v[11]-e._v[10]*e._v[3],c=e._v[2]*e._v[15]-e._v[14]*e._v[3],_=e._v[6]*e._v[11]-e._v[10]*e._v[7],h=e._v[6]*e._v[15]-e._v[14]*e._v[7],d=e._v[10]*e._v[15]-e._v[14]*e._v[11],u=t*d-n*h+i*_+a*c-r*l+o*s;return 0===u&&console.error("the determinant is 0!"),new this((e._v[5]*d-e._v[9]*h+e._v[13]*_)/u,(e._v[8]*h-e._v[4]*d-e._v[12]*_)/u,(e._v[7]*o-e._v[11]*r+e._v[15]*a)/u,(e._v[10]*r-e._v[6]*o-e._v[14]*a)/u,(e._v[9]*c-e._v[1]*d-e._v[13]*l)/u,(e._v[0]*d-e._v[8]*c+e._v[12]*l)/u,(e._v[11]*i-e._v[3]*o-e._v[15]*n)/u,(e._v[2]*o-e._v[10]*i+e._v[14]*n)/u,(e._v[1]*h-e._v[5]*c+e._v[13]*s)/u,(e._v[4]*c-e._v[0]*h-e._v[12]*s)/u,(e._v[3]*r-e._v[7]*i+e._v[15]*t)/u,(e._v[6]*i-e._v[2]*r-e._v[14]*t)/u,(e._v[5]*l-e._v[1]*_-e._v[9]*s)/u,(e._v[0]*_-e._v[4]*l+e._v[8]*s)/u,(e._v[7]*n-e._v[3]*a-e._v[11]*t)/u,(e._v[2]*a-e._v[6]*n+e._v[10]*t)/u)}static invertTo(e,t){if(e.isIdentityMatrixClass)return t.copyComponents(e);const n=e._v[0]*e._v[5]-e._v[4]*e._v[1],i=e._v[0]*e._v[9]-e._v[8]*e._v[1],a=e._v[0]*e._v[13]-e._v[12]*e._v[1],r=e._v[4]*e._v[9]-e._v[8]*e._v[5],o=e._v[4]*e._v[13]-e._v[12]*e._v[5],s=e._v[8]*e._v[13]-e._v[12]*e._v[9],l=e._v[2]*e._v[7]-e._v[6]*e._v[3],c=e._v[2]*e._v[11]-e._v[10]*e._v[3],_=e._v[2]*e._v[15]-e._v[14]*e._v[3],h=e._v[6]*e._v[11]-e._v[10]*e._v[7],d=e._v[6]*e._v[15]-e._v[14]*e._v[7],u=e._v[10]*e._v[15]-e._v[14]*e._v[11],m=n*u-i*d+a*h+r*_-o*c+s*l;0===m&&console.error("the determinant is 0!");const x=(e._v[5]*u-e._v[9]*d+e._v[13]*h)/m,f=(e._v[8]*d-e._v[4]*u-e._v[12]*h)/m,A=(e._v[7]*s-e._v[11]*o+e._v[15]*r)/m,p=(e._v[10]*o-e._v[6]*s-e._v[14]*r)/m,g=(e._v[9]*_-e._v[1]*u-e._v[13]*c)/m,v=(e._v[0]*u-e._v[8]*_+e._v[12]*c)/m,y=(e._v[11]*a-e._v[3]*s-e._v[15]*i)/m,I=(e._v[2]*s-e._v[10]*a+e._v[14]*i)/m,b=(e._v[1]*d-e._v[5]*_+e._v[13]*l)/m,T=(e._v[4]*_-e._v[0]*d-e._v[12]*l)/m,S=(e._v[3]*o-e._v[7]*a+e._v[15]*n)/m,E=(e._v[6]*a-e._v[2]*o-e._v[14]*n)/m,C=(e._v[5]*c-e._v[1]*h-e._v[9]*l)/m,w=(e._v[0]*h-e._v[4]*c+e._v[8]*l)/m,D=(e._v[7]*i-e._v[3]*r-e._v[11]*n)/m,N=(e._v[2]*r-e._v[6]*i+e._v[10]*n)/m;return t.setComponents(x,f,A,p,g,v,y,I,b,T,S,E,C,w,D,N)}static translate(e){return new this(1,0,0,e._v[0],0,1,0,e._v[1],0,0,1,e._v[2],0,0,0,1)}static rotateX(e){const t=Math.cos(e),n=Math.sin(e);return new this(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1)}static rotateY(e){const t=Math.cos(e),n=Math.sin(e);return new this(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}static rotateZ(e){const t=Math.cos(e),n=Math.sin(e);return new this(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1)}static rotateXYZ(e,t,n){const i=Math.cos(e),a=Math.sin(e),r=Math.cos(t),o=Math.sin(t),s=Math.cos(n),l=Math.sin(n),c=-a,_=-l,h=o*a,d=o*i;return new this(s*r,s*h+_*i,s*d+_*c,0,l*r,l*h+s*i,l*d+s*c,0,-o,r*a,r*i,0,0,0,0,1)}static rotate(e){return this.rotateXYZ(e._v[0],e._v[1],e._v[2])}static scale(e){return new this(e._v[0],0,0,0,0,e._v[1],0,0,0,0,e._v[2],0,0,0,0,1)}static multiply(e,t){if(e.isIdentityMatrixClass)return t;if(t.isIdentityMatrixClass)return e;const n=e._v,i=t._v,a=n[0]*i[0]+n[4]*i[1]+n[8]*i[2]+n[12]*i[3],r=n[1]*i[0]+n[5]*i[1]+n[9]*i[2]+n[13]*i[3],o=n[2]*i[0]+n[6]*i[1]+n[10]*i[2]+n[14]*i[3],s=n[3]*i[0]+n[7]*i[1]+n[11]*i[2]+n[15]*i[3],l=n[0]*i[4]+n[4]*i[5]+n[8]*i[6]+n[12]*i[7],c=n[1]*i[4]+n[5]*i[5]+n[9]*i[6]+n[13]*i[7],_=n[2]*i[4]+n[6]*i[5]+n[10]*i[6]+n[14]*i[7],h=n[3]*i[4]+n[7]*i[5]+n[11]*i[6]+n[15]*i[7],d=n[0]*i[8]+n[4]*i[9]+n[8]*i[10]+n[12]*i[11],u=n[1]*i[8]+n[5]*i[9]+n[9]*i[10]+n[13]*i[11],m=n[2]*i[8]+n[6]*i[9]+n[10]*i[10]+n[14]*i[11],x=n[3]*i[8]+n[7]*i[9]+n[11]*i[10]+n[15]*i[11];return new this(a,l,d,n[0]*i[12]+n[4]*i[13]+n[8]*i[14]+n[12]*i[15],r,c,u,n[1]*i[12]+n[5]*i[13]+n[9]*i[14]+n[13]*i[15],o,_,m,n[2]*i[12]+n[6]*i[13]+n[10]*i[14]+n[14]*i[15],s,h,x,n[3]*i[12]+n[7]*i[13]+n[11]*i[14]+n[15]*i[15])}static multiplyTo(e,t,n){if(e.isIdentityMatrixClass)return n.copyComponents(t);if(t.isIdentityMatrixClass)return n.copyComponents(e);const i=e._v,a=t._v,r=i[0]*a[0]+i[4]*a[1]+i[8]*a[2]+i[12]*a[3],o=i[1]*a[0]+i[5]*a[1]+i[9]*a[2]+i[13]*a[3],s=i[2]*a[0]+i[6]*a[1]+i[10]*a[2]+i[14]*a[3],l=i[3]*a[0]+i[7]*a[1]+i[11]*a[2]+i[15]*a[3],c=i[0]*a[4]+i[4]*a[5]+i[8]*a[6]+i[12]*a[7],_=i[1]*a[4]+i[5]*a[5]+i[9]*a[6]+i[13]*a[7],h=i[2]*a[4]+i[6]*a[5]+i[10]*a[6]+i[14]*a[7],d=i[3]*a[4]+i[7]*a[5]+i[11]*a[6]+i[15]*a[7],u=i[0]*a[8]+i[4]*a[9]+i[8]*a[10]+i[12]*a[11],m=i[1]*a[8]+i[5]*a[9]+i[9]*a[10]+i[13]*a[11],x=i[2]*a[8]+i[6]*a[9]+i[10]*a[10]+i[14]*a[11],f=i[3]*a[8]+i[7]*a[9]+i[11]*a[10]+i[15]*a[11],A=i[0]*a[12]+i[4]*a[13]+i[8]*a[14]+i[12]*a[15],p=i[1]*a[12]+i[5]*a[13]+i[9]*a[14]+i[13]*a[15],g=i[2]*a[12]+i[6]*a[13]+i[10]*a[14]+i[14]*a[15],v=i[3]*a[12]+i[7]*a[13]+i[11]*a[14]+i[15]*a[15];return n.setComponents(r,c,u,A,o,_,m,p,s,h,x,g,l,d,f,v)}static fromQuaternionTo(e,t){const n=e._v[0]*e._v[0],i=e._v[1]*e._v[1],a=e._v[2]*e._v[2],r=e._v[1]*e._v[2],o=e._v[0]*e._v[2],s=e._v[0]*e._v[1],l=e._v[3]*e._v[0],c=e._v[3]*e._v[1],_=e._v[3]*e._v[2],h=1-2*(i+a),d=2*(s-_),u=2*(o+c),m=2*(s+_),x=1-2*(n+a),f=2*(r-l),A=2*(o-c),p=2*(r+l),g=1-2*(n+i);return t.setComponents(h,d,u,0,m,x,f,0,A,p,g,0,0,0,0,1)}toString(){return this._v[0]+" "+this._v[4]+" "+this._v[8]+" "+this._v[12]+" \n"+this._v[1]+" "+this._v[5]+" "+this._v[9]+" "+this._v[13]+" \n"+this._v[2]+" "+this._v[6]+" "+this._v[10]+" "+this._v[14]+" \n"+this._v[3]+" "+this._v[7]+" "+this._v[11]+" "+this._v[15]+" \n"}toStringApproximately(){return s.k.financial(this._v[0])+" "+s.k.financial(this._v[4])+" "+s.k.financial(this._v[8])+" "+s.k.financial(this._v[12])+" \n"+s.k.financial(this._v[1])+" "+s.k.financial(this._v[5])+" "+s.k.financial(this._v[9])+" "+s.k.financial(this._v[13])+" \n"+s.k.financial(this._v[2])+" "+s.k.financial(this._v[6])+" "+s.k.financial(this._v[10])+" "+s.k.financial(this._v[14])+" \n"+s.k.financial(this._v[3])+" "+s.k.financial(this._v[7])+" "+s.k.financial(this._v[11])+" "+s.k.financial(this._v[15])+" \n"}flattenAsArray(){return[this._v[0],this._v[1],this._v[2],this._v[3],this._v[4],this._v[5],this._v[6],this._v[7],this._v[8],this._v[9],this._v[10],this._v[11],this._v[12],this._v[13],this._v[14],this._v[15]]}isDummy(){return 0===this._v.length}isEqual(e,t=Number.EPSILON){const n=e._v;return Math.abs(n[0]-this._v[0])<t&&Math.abs(n[1]-this._v[1])<t&&Math.abs(n[2]-this._v[2])<t&&Math.abs(n[3]-this._v[3])<t&&Math.abs(n[4]-this._v[4])<t&&Math.abs(n[5]-this._v[5])<t&&Math.abs(n[6]-this._v[6])<t&&Math.abs(n[7]-this._v[7])<t&&Math.abs(n[8]-this._v[8])<t&&Math.abs(n[9]-this._v[9])<t&&Math.abs(n[10]-this._v[10])<t&&Math.abs(n[11]-this._v[11])<t&&Math.abs(n[12]-this._v[12])<t&&Math.abs(n[13]-this._v[13])<t&&Math.abs(n[14]-this._v[14])<t&&Math.abs(n[15]-this._v[15])<t}isStrictEqual(e){return e._v[0]===this._v[0]&&e._v[1]===this._v[1]&&e._v[2]===this._v[2]&&e._v[3]===this._v[3]&&e._v[4]===this._v[4]&&e._v[5]===this._v[5]&&e._v[6]===this._v[6]&&e._v[7]===this._v[7]&&e._v[8]===this._v[8]&&e._v[9]===this._v[9]&&e._v[10]===this._v[10]&&e._v[11]===this._v[11]&&e._v[12]===this._v[12]&&e._v[13]===this._v[13]&&e._v[14]===this._v[14]&&e._v[15]===this._v[15]}at(e,t){return this._v[e+4*t]}determinant(){return this._v[0]*this._v[5]*this._v[10]*this._v[15]+this._v[0]*this._v[9]*this._v[14]*this._v[7]+this._v[0]*this._v[13]*this._v[6]*this._v[11]+this._v[4]*this._v[1]*this._v[14]*this._v[11]+this._v[4]*this._v[9]*this._v[2]*this._v[15]+this._v[4]*this._v[13]*this._v[10]*this._v[3]+this._v[8]*this._v[1]*this._v[6]*this._v[15]+this._v[8]*this._v[5]*this._v[14]*this._v[3]+this._v[8]*this._v[13]*this._v[2]*this._v[7]+this._v[12]*this._v[1]*this._v[10]*this._v[7]+this._v[12]*this._v[5]*this._v[2]*this._v[11]+this._v[12]*this._v[9]*this._v[6]*this._v[3]-this._v[0]*this._v[5]*this._v[14]*this._v[11]-this._v[0]*this._v[9]*this._v[6]*this._v[15]-this._v[0]*this._v[13]*this._v[10]*this._v[7]-this._v[4]*this._v[1]*this._v[10]*this._v[15]-this._v[4]*this._v[9]*this._v[14]*this._v[3]-this._v[4]*this._v[13]*this._v[2]*this._v[11]-this._v[8]*this._v[1]*this._v[14]*this._v[7]-this._v[8]*this._v[5]*this._v[2]*this._v[15]-this._v[8]*this._v[13]*this._v[6]*this._v[3]-this._v[12]*this._v[1]*this._v[6]*this._v[11]-this._v[12]*this._v[5]*this._v[10]*this._v[3]-this._v[12]*this._v[9]*this._v[2]*this._v[7]}multiplyVector(e){const t=this._v[0]*e._v[0]+this._v[4]*e._v[1]+this._v[8]*e._v[2]+this._v[12]*e._v[3],n=this._v[1]*e._v[0]+this._v[5]*e._v[1]+this._v[9]*e._v[2]+this._v[13]*e._v[3],i=this._v[2]*e._v[0]+this._v[6]*e._v[1]+this._v[10]*e._v[2]+this._v[14]*e._v[3],a=this._v[3]*e._v[0]+this._v[7]*e._v[1]+this._v[11]*e._v[2]+this._v[15]*e._v[3];return r.ZP.fromCopyArray([t,n,i,a])}multiplyVectorTo(e,t){const n=this._v[0]*e._v[0]+this._v[4]*e._v[1]+this._v[8]*e._v[2]+this._v[12]*e._v[3],i=this._v[1]*e._v[0]+this._v[5]*e._v[1]+this._v[9]*e._v[2]+this._v[13]*e._v[3],a=this._v[2]*e._v[0]+this._v[6]*e._v[1]+this._v[10]*e._v[2]+this._v[14]*e._v[3],r=this._v[3]*e._v[0]+this._v[7]*e._v[1]+this._v[11]*e._v[2]+this._v[15]*e._v[3];return t._v[0]=n,t._v[1]=i,t._v[2]=a,t._v[3]=r,t}multiplyVectorToVec3(e,t){const n=this._v[0]*e._v[0]+this._v[4]*e._v[1]+this._v[8]*e._v[2]+this._v[12]*e._v[3],i=this._v[1]*e._v[0]+this._v[5]*e._v[1]+this._v[9]*e._v[2]+this._v[13]*e._v[3],a=this._v[2]*e._v[0]+this._v[6]*e._v[1]+this._v[10]*e._v[2]+this._v[14]*e._v[3];return t._v[0]=n,t._v[1]=i,t._v[2]=a,t}multiplyVector3(e){const t=this._v[0]*e._v[0]+this._v[4]*e._v[1]+this._v[8]*e._v[2]+this._v[12],n=this._v[1]*e._v[0]+this._v[5]*e._v[1]+this._v[9]*e._v[2]+this._v[13],a=this._v[2]*e._v[0]+this._v[6]*e._v[1]+this._v[10]*e._v[2]+this._v[14];return i.ZP.fromCopyArray([t,n,a])}multiplyVector3To(e,t){const n=this._v[0]*e._v[0]+this._v[4]*e._v[1]+this._v[8]*e._v[2]+this._v[12],i=this._v[1]*e._v[0]+this._v[5]*e._v[1]+this._v[9]*e._v[2]+this._v[13],a=this._v[2]*e._v[0]+this._v[6]*e._v[1]+this._v[10]*e._v[2]+this._v[14];return t._v[0]=n,t._v[1]=i,t._v[2]=a,t}getTranslate(){return i.ZP.fromCopyArray([this._v[12],this._v[13],this._v[14]])}getTranslateTo(e){return e._v[0]=this._v[12],e._v[1]=this._v[13],e._v[2]=this._v[14],e}getScale(){return i.ZP.fromCopyArray([Math.hypot(this._v[0],this._v[4],this._v[8]),Math.hypot(this._v[1],this._v[5],this._v[9]),Math.hypot(this._v[2],this._v[6],this._v[10])])}getScaleTo(e){return e._v[0]=Math.hypot(this._v[0],this._v[4],this._v[8]),e._v[1]=Math.hypot(this._v[1],this._v[5],this._v[9]),e._v[2]=Math.hypot(this._v[2],this._v[6],this._v[10]),e}toEulerAngles(){let e=null;if(1!=Math.abs(this._v[2])){const t=-Math.asin(this._v[2]),n=Math.atan2(this._v[6]/Math.cos(t),this._v[10]/Math.cos(t)),a=Math.atan2(this._v[1]/Math.cos(t),this._v[0]/Math.cos(t));e=i.ZP.fromCopyArray([n,t,a])}else e=-1===this._v[2]?i.ZP.fromCopyArray([Math.atan2(this._v[4],this._v[8]),Math.PI/2,0]):i.ZP.fromCopyArray([Math.atan2(-this._v[4],-this._v[8]),-Math.PI/2,0]);return e}toEulerAnglesTo(e){if(1!=Math.abs(this._v[2])){const t=-Math.asin(this._v[2]),n=Math.atan2(this._v[6]/Math.cos(t),this._v[10]/Math.cos(t)),i=Math.atan2(this._v[1]/Math.cos(t),this._v[0]/Math.cos(t));e._v[0]=n,e._v[1]=t,e._v[2]=i}else-1===this._v[2]?(e._v[0]=Math.atan2(this._v[4],this._v[8]),e._v[1]=Math.PI/2,e._v[2]=0):(e._v[0]=Math.atan2(-this._v[4],-this._v[8]),e._v[1]=-Math.PI/2,e._v[2]=0);return e}clone(){return new this.constructor(this._v[0],this._v[4],this._v[8],this._v[12],this._v[1],this._v[5],this._v[9],this._v[13],this._v[2],this._v[6],this._v[10],this._v[14],this._v[3],this._v[7],this._v[11],this._v[15])}getRotate(){const e=a.Z.fromMatrix(this);return new this.constructor(e)}}},1162:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(18);class a extends i.Z{constructor(e,t,n,i,a=!1,r=!1){super(e,t,n,i,a)}set m00(e){this._v[0]=e}get m00(){return this._v[0]}set m10(e){this._v[1]=e}get m10(){return this._v[1]}set m01(e){this._v[2]=e}get m01(){return this._v[2]}set m11(e){this._v[3]=e}get m11(){return this._v[3]}get className(){return"MutableMatrix22"}static zero(){return super.zero()}static identity(){return super.identity()}static dummy(){return super.dummy()}static transpose(e){return super.transpose(e)}static invert(e){return super.invert(e)}static rotate(e){return super.rotate(e)}static scale(e){return super.scale(e)}static multiply(e,t){return super.multiply(e,t)}clone(){return super.clone()}raw(){return this._v}setAt(e,t,n){return this._v[e+2*t]=n,this}setComponents(e,t,n,i){return this._v[0]=e,this._v[2]=t,this._v[1]=n,this._v[3]=i,this}copyComponents(e){return this._v[0]=e.m00,this._v[2]=e.m01,this._v[1]=e.m10,this._v[3]=e.m11,this}zero(){return this.setComponents(0,0,0,0)}identity(){return this.setComponents(1,0,0,1)}_swap(e,t){this._v[t]=[this._v[e],this._v[e]=this._v[t]][0]}transpose(){return this._swap(1,2),this}invert(){const e=this.determinant();0===e&&console.error("the determinant is 0!");const t=this._v[3]/e,n=this._v[2]/e*-1,i=this._v[1]/e*-1,a=this._v[0]/e;return this.setComponents(t,n,i,a)}rotate(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,-n,n,t)}scale(e){return this.setComponents(e._v[0],0,0,e._v[1])}multiplyScale(e){return this._v[0]*=e._v[0],this._v[2]*=e._v[0],this._v[1]*=e._v[1],this._v[3]*=e._v[1],this}multiply(e){const t=this._v[0]*e._v[0]+this._v[2]*e._v[1],n=this._v[0]*e._v[2]+this._v[2]*e._v[3],i=this._v[1]*e._v[0]+this._v[3]*e._v[1],a=this._v[1]*e._v[2]+this._v[3]*e._v[3];return this.setComponents(t,n,i,a)}multiplyByLeft(e){const t=e._v[0]*this._v[0]+e._v[2]*this._v[1],n=e._v[0]*this._v[2]+e._v[2]*this._v[3],i=e._v[1]*this._v[0]+e._v[3]*this._v[1],a=e._v[1]*this._v[2]+e._v[3]*this._v[3];return this.setComponents(t,n,i,a)}}},2566:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(1447);class a extends i.Z{constructor(e,t,n,i,a,r,o,s,l,c=!1,_=!1){super(e,t,n,i,a,r,o,s,l,c)}set m00(e){this._v[0]=e}get m00(){return this._v[0]}set m10(e){this._v[1]=e}get m10(){return this._v[1]}set m20(e){this._v[2]=e}get m20(){return this._v[2]}set m01(e){this._v[3]=e}get m01(){return this._v[3]}set m11(e){this._v[4]=e}get m11(){return this._v[4]}set m21(e){this._v[5]=e}get m21(){return this._v[5]}set m02(e){this._v[6]=e}get m02(){return this._v[6]}set m12(e){this._v[7]=e}get m12(){return this._v[7]}set m22(e){this._v[8]=e}get m22(){return this._v[8]}get className(){return"MutableMatrix33"}static zero(){return super.zero()}static identity(){return new a(1,0,0,0,1,0,0,0,1)}static dummy(){return super.dummy()}static transpose(e){return super.transpose(e)}static invert(e){return super.invert(e)}static rotateX(e){return super.rotateX(e)}static rotateY(e){return super.rotateY(e)}static rotateZ(e){return super.rotateZ(e)}static rotateXYZ(e,t,n){return super.rotateXYZ(e,t,n)}static rotate(e){return super.rotateXYZ(e._v[0],e._v[1],e._v[2])}static scale(e){return super.scale(e)}static multiply(e,t){return super.multiply(e,t)}clone(){return super.clone()}raw(){return this._v}setAt(e,t,n){return this._v[e+3*t]=n,this}setComponents(e,t,n,i,a,r,o,s,l){return this._v[0]=e,this._v[3]=t,this._v[6]=n,this._v[1]=i,this._v[4]=a,this._v[7]=r,this._v[2]=o,this._v[5]=s,this._v[8]=l,this}copyComponents(e){return this._v[0]=e.m00,this._v[3]=e.m01,this._v[6]=e.m02,this._v[1]=e.m10,this._v[4]=e.m11,this._v[7]=e.m12,this._v[2]=e.m20,this._v[5]=e.m21,this._v[8]=e.m22,this}zero(){return this.setComponents(0,0,0,0,0,0,0,0,0)}identity(){return this.setComponents(1,0,0,0,1,0,0,0,1)}_swap(e,t){this._v[t]=[this._v[e],this._v[e]=this._v[t]][0]}transpose(){return this._swap(1,3),this._swap(2,6),this._swap(5,8),this}invert(){const e=this.determinant();0===e&&console.error("the determinant is 0!");const t=(this._v[4]*this._v[8]-this._v[7]*this._v[5])/e,n=(this._v[6]*this._v[5]-this._v[3]*this._v[8])/e,i=(this._v[3]*this._v[7]-this._v[6]*this._v[4])/e,a=(this._v[7]*this._v[2]-this._v[1]*this._v[8])/e,r=(this._v[0]*this._v[8]-this._v[6]*this._v[2])/e,o=(this._v[6]*this._v[1]-this._v[0]*this._v[7])/e,s=(this._v[1]*this._v[5]-this._v[4]*this._v[2])/e,l=(this._v[3]*this._v[2]-this._v[0]*this._v[5])/e,c=(this._v[0]*this._v[4]-this._v[3]*this._v[1])/e;return this.setComponents(t,n,i,a,r,o,s,l,c)}rotateX(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(1,0,0,0,t,-n,0,n,t)}rotateY(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,0,n,0,1,0,-n,0,t)}rotateZ(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,-n,0,n,t,0,0,0,1)}rotateXYZ(e,t,n){const i=Math.cos(e),a=Math.sin(e),r=Math.cos(t),o=Math.sin(t),s=Math.cos(n),l=Math.sin(n),c=-a,_=-l,h=o*a,d=o*i,u=s*r,m=s*h+_*i,x=s*d+_*c,f=l*r,A=l*h+s*i,p=l*d+s*c,g=-o,v=r*a,y=r*i;return this.setComponents(u,m,x,f,A,p,g,v,y)}rotate(e){return this.rotateXYZ(e._v[0],e._v[1],e._v[2])}scale(e){return this.setComponents(e._v[0],0,0,0,e._v[1],0,0,0,e._v[2])}multiplyScale(e){return this._v[0]*=e._v[0],this._v[3]*=e._v[0],this._v[6]*=e._v[0],this._v[1]*=e._v[1],this._v[4]*=e._v[1],this._v[7]*=e._v[1],this._v[2]*=e._v[2],this._v[5]*=e._v[2],this._v[8]*=e._v[2],this}multiply(e){if(e.isIdentityMatrixClass)return this;const t=this._v[0]*e._v[0]+this._v[3]*e._v[1]+this._v[6]*e._v[2],n=this._v[0]*e._v[3]+this._v[3]*e._v[4]+this._v[6]*e._v[5],i=this._v[0]*e._v[6]+this._v[3]*e._v[7]+this._v[6]*e._v[8],a=this._v[1]*e._v[0]+this._v[4]*e._v[1]+this._v[7]*e._v[2],r=this._v[1]*e._v[3]+this._v[4]*e._v[4]+this._v[7]*e._v[5],o=this._v[1]*e._v[6]+this._v[4]*e._v[7]+this._v[7]*e._v[8],s=this._v[2]*e._v[0]+this._v[5]*e._v[1]+this._v[8]*e._v[2],l=this._v[2]*e._v[3]+this._v[5]*e._v[4]+this._v[8]*e._v[5],c=this._v[2]*e._v[6]+this._v[5]*e._v[7]+this._v[8]*e._v[8];return this.setComponents(t,n,i,a,r,o,s,l,c)}multiplyByLeft(e){if(e.isIdentityMatrixClass)return this;const t=e._v[0]*this._v[0]+e._v[3]*this._v[1]+e._v[6]*this._v[2],n=e._v[0]*this._v[3]+e._v[3]*this._v[4]+e._v[6]*this._v[5],i=e._v[0]*this._v[6]+e._v[3]*this._v[7]+e._v[6]*this._v[8],a=e._v[1]*this._v[0]+e._v[4]*this._v[1]+e._v[7]*this._v[2],r=e._v[1]*this._v[3]+e._v[4]*this._v[4]+e._v[7]*this._v[5],o=e._v[1]*this._v[6]+e._v[4]*this._v[7]+e._v[7]*this._v[8],s=e._v[2]*this._v[0]+e._v[5]*this._v[1]+e._v[8]*this._v[2],l=e._v[2]*this._v[3]+e._v[5]*this._v[4]+e._v[8]*this._v[5],c=e._v[2]*this._v[6]+e._v[5]*this._v[7]+e._v[8]*this._v[8];return this.setComponents(t,n,i,a,r,o,s,l,c)}}},3496:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(916);Float32Array;class a extends i.Z{constructor(e,t,n,i,a,r,o,s,l,c,_,h,d,u,m,x,f=!1,A=!1){const p=arguments.length>=16?f:t,g=arguments.length>=16?A:n;arguments.length>=16?super(e,t,n,i,a,r,o,s,l,c,_,h,d,u,m,x,p,g):super(e,p,g)}set m00(e){this._v[0]=e}get m00(){return this._v[0]}set m10(e){this._v[1]=e}get m10(){return this._v[1]}set m20(e){this._v[2]=e}get m20(){return this._v[2]}set m30(e){this._v[3]=e}get m30(){return this._v[3]}set m01(e){this._v[4]=e}get m01(){return this._v[4]}set m11(e){this._v[5]=e}get m11(){return this._v[5]}set m21(e){this._v[6]=e}get m21(){return this._v[6]}set m31(e){this._v[7]=e}get m31(){return this._v[7]}set m02(e){this._v[8]=e}get m02(){return this._v[8]}set m12(e){this._v[9]=e}get m12(){return this._v[9]}set m22(e){this._v[10]=e}get m22(){return this._v[10]}set m32(e){this._v[11]=e}get m32(){return this._v[11]}set m03(e){this._v[12]=e}get m03(){return this._v[12]}set m13(e){this._v[13]=e}get m13(){return this._v[13]}set m23(e){this._v[14]=e}get m23(){return this._v[14]}set m33(e){this._v[15]=e}get m33(){return this._v[15]}get translateX(){return this._v[12]}set translateX(e){this._v[12]=e}get translateY(){return this._v[13]}set translateY(e){this._v[13]=e}get translateZ(){return this._v[14]}set translateZ(e){this._v[14]=e}get className(){return"MutableMatrix44"}static zero(){return super.zero()}static identity(){return new a(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}static dummy(){return super.dummy()}static transpose(e){return super.transpose(e)}static invert(e){return super.invert(e)}static translate(e){return super.translate(e)}static rotateX(e){return super.rotateX(e)}static rotateY(e){return super.rotateY(e)}static rotateZ(e){return super.rotateZ(e)}static rotateXYZ(e,t,n){return super.rotateXYZ(e,t,n)}static rotate(e){return super.rotateXYZ(e._v[0],e._v[1],e._v[2])}static scale(e){return super.scale(e)}static multiply(e,t){return super.multiply(e,t)}clone(){return super.clone()}getRotate(){return super.getRotate()}getTranslate(){return super.getTranslate()}getScale(){return super.getScale()}raw(){return this._v}setAt(e,t,n){return this._v[e+4*t]=n,this}setComponents(e,t,n,i,a,r,o,s,l,c,_,h,d,u,m,x){return this._v[0]=e,this._v[4]=t,this._v[8]=n,this._v[12]=i,this._v[1]=a,this._v[5]=r,this._v[9]=o,this._v[13]=s,this._v[2]=l,this._v[6]=c,this._v[10]=_,this._v[14]=h,this._v[3]=d,this._v[7]=u,this._v[11]=m,this._v[15]=x,this}copyComponents(e){return this._v[0]=e._v[0],this._v[4]=e._v[4],this._v[8]=e._v[8],this._v[12]=e._v[12],this._v[1]=e._v[1],this._v[5]=e._v[5],this._v[9]=e._v[9],this._v[13]=e._v[13],this._v[2]=e._v[2],this._v[6]=e._v[6],this._v[10]=e._v[10],this._v[14]=e._v[14],this._v[3]=e._v[3],this._v[7]=e._v[7],this._v[11]=e._v[11],this._v[15]=e._v[15],this}zero(){return this.setComponents(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}identity(){return this.setComponents(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}_swap(e,t){this._v[t]=[this._v[e],this._v[e]=this._v[t]][0]}transpose(){return this._swap(1,4),this._swap(2,8),this._swap(3,12),this._swap(6,9),this._swap(7,13),this._swap(11,14),this}invert(){const e=this._v[0]*this._v[5]-this._v[4]*this._v[1],t=this._v[0]*this._v[9]-this._v[8]*this._v[1],n=this._v[0]*this._v[13]-this._v[12]*this._v[1],i=this._v[4]*this._v[9]-this._v[8]*this._v[5],a=this._v[4]*this._v[13]-this._v[12]*this._v[5],r=this._v[8]*this._v[13]-this._v[12]*this._v[9],o=this._v[2]*this._v[7]-this._v[6]*this._v[3],s=this._v[2]*this._v[11]-this._v[10]*this._v[3],l=this._v[2]*this._v[15]-this._v[14]*this._v[3],c=this._v[6]*this._v[11]-this._v[10]*this._v[7],_=this._v[6]*this._v[15]-this._v[14]*this._v[7],h=this._v[10]*this._v[15]-this._v[14]*this._v[11],d=e*h-t*_+n*c+i*l-a*s+r*o;0===d&&console.error("the determinant is 0!");const u=(this._v[5]*h-this._v[9]*_+this._v[13]*c)/d,m=(this._v[8]*_-this._v[4]*h-this._v[12]*c)/d,x=(this._v[7]*r-this._v[11]*a+this._v[15]*i)/d,f=(this._v[10]*a-this._v[6]*r-this._v[14]*i)/d,A=(this._v[9]*l-this._v[1]*h-this._v[13]*s)/d,p=(this._v[0]*h-this._v[8]*l+this._v[12]*s)/d,g=(this._v[11]*n-this._v[3]*r-this._v[15]*t)/d,v=(this._v[2]*r-this._v[10]*n+this._v[14]*t)/d,y=(this._v[1]*_-this._v[5]*l+this._v[13]*o)/d,I=(this._v[4]*l-this._v[0]*_-this._v[12]*o)/d,b=(this._v[3]*a-this._v[7]*n+this._v[15]*e)/d,T=(this._v[6]*n-this._v[2]*a-this._v[14]*e)/d,S=(this._v[5]*s-this._v[1]*c-this._v[9]*o)/d,E=(this._v[0]*c-this._v[4]*s+this._v[8]*o)/d,C=(this._v[7]*t-this._v[3]*i-this._v[11]*e)/d,w=(this._v[2]*i-this._v[6]*t+this._v[10]*e)/d;return this.setComponents(u,m,x,f,A,p,g,v,y,I,b,T,S,E,C,w)}translate(e){return this.setComponents(1,0,0,e._v[0],0,1,0,e._v[1],0,0,1,e._v[2],0,0,0,1)}putTranslate(e){return this._v[12]=e._v[0],this._v[13]=e._v[1],this._v[14]=e._v[2],this}addTranslate(e){return this._v[12]+=e._v[0],this._v[13]+=e._v[1],this._v[14]+=e._v[2],this}rotateX(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1)}rotateY(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1)}rotateZ(e){const t=Math.cos(e),n=Math.sin(e);return this.setComponents(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1)}rotateXYZ(e,t,n){const i=Math.cos(e),a=Math.sin(e),r=Math.cos(t),o=Math.sin(t),s=Math.cos(n),l=Math.sin(n),c=-a,_=-l,h=o*a,d=o*i,u=s*r,m=s*h+_*i,x=s*d+_*c,f=l*r,A=l*h+s*i,p=l*d+s*c,g=-o,v=r*a,y=r*i;return this.setComponents(u,m,x,0,f,A,p,0,g,v,y,0,0,0,0,1)}rotate(e){return this.rotateXYZ(e._v[0],e._v[1],e._v[2])}scale(e){return this.setComponents(e._v[0],0,0,0,0,e._v[1],0,0,0,0,e._v[2],0,0,0,0,1)}multiplyScale(e){return this._v[0]*=e._v[0],this._v[4]*=e._v[0],this._v[8]*=e._v[0],this._v[12]*=e._v[0],this._v[1]*=e._v[1],this._v[5]*=e._v[1],this._v[9]*=e._v[1],this._v[13]*=e._v[1],this._v[2]*=e._v[2],this._v[6]*=e._v[2],this._v[10]*=e._v[2],this._v[14]*=e._v[2],this}multiply(e){if(e.isIdentityMatrixClass)return this;const t=this._v[0]*e._v[0]+this._v[4]*e._v[1]+this._v[8]*e._v[2]+this._v[12]*e._v[3],n=this._v[0]*e._v[4]+this._v[4]*e._v[5]+this._v[8]*e._v[6]+this._v[12]*e._v[7],i=this._v[0]*e._v[8]+this._v[4]*e._v[9]+this._v[8]*e._v[10]+this._v[12]*e._v[11],a=this._v[0]*e._v[12]+this._v[4]*e._v[13]+this._v[8]*e._v[14]+this._v[12]*e._v[15],r=this._v[1]*e._v[0]+this._v[5]*e._v[1]+this._v[9]*e._v[2]+this._v[13]*e._v[3],o=this._v[1]*e._v[4]+this._v[5]*e._v[5]+this._v[9]*e._v[6]+this._v[13]*e._v[7],s=this._v[1]*e._v[8]+this._v[5]*e._v[9]+this._v[9]*e._v[10]+this._v[13]*e._v[11],l=this._v[1]*e._v[12]+this._v[5]*e._v[13]+this._v[9]*e._v[14]+this._v[13]*e._v[15],c=this._v[2]*e._v[0]+this._v[6]*e._v[1]+this._v[10]*e._v[2]+this._v[14]*e._v[3],_=this._v[2]*e._v[4]+this._v[6]*e._v[5]+this._v[10]*e._v[6]+this._v[14]*e._v[7],h=this._v[2]*e._v[8]+this._v[6]*e._v[9]+this._v[10]*e._v[10]+this._v[14]*e._v[11],d=this._v[2]*e._v[12]+this._v[6]*e._v[13]+this._v[10]*e._v[14]+this._v[14]*e._v[15],u=this._v[3]*e._v[0]+this._v[7]*e._v[1]+this._v[11]*e._v[2]+this._v[15]*e._v[3],m=this._v[3]*e._v[4]+this._v[7]*e._v[5]+this._v[11]*e._v[6]+this._v[15]*e._v[7],x=this._v[3]*e._v[8]+this._v[7]*e._v[9]+this._v[11]*e._v[10]+this._v[15]*e._v[11],f=this._v[3]*e._v[12]+this._v[7]*e._v[13]+this._v[11]*e._v[14]+this._v[15]*e._v[15];return this.setComponents(t,n,i,a,r,o,s,l,c,_,h,d,u,m,x,f)}multiplyByLeft(e){if(e.isIdentityMatrixClass)return this;const t=e._v[0]*this._v[0]+e._v[4]*this._v[1]+e._v[8]*this._v[2]+e._v[12]*this._v[3],n=e._v[0]*this._v[4]+e._v[4]*this._v[5]+e._v[8]*this._v[6]+e._v[12]*this._v[7],i=e._v[0]*this._v[8]+e._v[4]*this._v[9]+e._v[8]*this._v[10]+e._v[12]*this._v[11],a=e._v[0]*this._v[12]+e._v[4]*this._v[13]+e._v[8]*this._v[14]+e._v[12]*this._v[15],r=e._v[1]*this._v[0]+e._v[5]*this._v[1]+e._v[9]*this._v[2]+e._v[13]*this._v[3],o=e._v[1]*this._v[4]+e._v[5]*this._v[5]+e._v[9]*this._v[6]+e._v[13]*this._v[7],s=e._v[1]*this._v[8]+e._v[5]*this._v[9]+e._v[9]*this._v[10]+e._v[13]*this._v[11],l=e._v[1]*this._v[12]+e._v[5]*this._v[13]+e._v[9]*this._v[14]+e._v[13]*this._v[15],c=e._v[2]*this._v[0]+e._v[6]*this._v[1]+e._v[10]*this._v[2]+e._v[14]*this._v[3],_=e._v[2]*this._v[4]+e._v[6]*this._v[5]+e._v[10]*this._v[6]+e._v[14]*this._v[7],h=e._v[2]*this._v[8]+e._v[6]*this._v[9]+e._v[10]*this._v[10]+e._v[14]*this._v[11],d=e._v[2]*this._v[12]+e._v[6]*this._v[13]+e._v[10]*this._v[14]+e._v[14]*this._v[15],u=e._v[3]*this._v[0]+e._v[7]*this._v[1]+e._v[11]*this._v[2]+e._v[15]*this._v[3],m=e._v[3]*this._v[4]+e._v[7]*this._v[5]+e._v[11]*this._v[6]+e._v[15]*this._v[7],x=e._v[3]*this._v[8]+e._v[7]*this._v[9]+e._v[11]*this._v[10]+e._v[15]*this._v[11],f=e._v[3]*this._v[12]+e._v[7]*this._v[13]+e._v[11]*this._v[14]+e._v[15]*this._v[15];return this.setComponents(t,n,i,a,r,o,s,l,c,_,h,d,u,m,x,f)}fromQuaternion(e){const t=e._v[0]*e._v[0],n=e._v[1]*e._v[1],i=e._v[2]*e._v[2],a=e._v[1]*e._v[2],r=e._v[0]*e._v[2],o=e._v[0]*e._v[1],s=e._v[3]*e._v[0],l=e._v[3]*e._v[1],c=e._v[3]*e._v[2],_=1-2*(n+i),h=2*(o-c),d=2*(r+l),u=2*(o+c),m=1-2*(t+i),x=2*(a-s),f=2*(r-l),A=2*(a+s),p=1-2*(t+n);return this.setComponents(_,h,d,0,u,m,x,0,f,A,p,0,0,0,0,1)}}},963:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(4388);class a extends i.Z{constructor(e,t,n,i){super(e,t,n,i)}set x(e){this._v[0]=e}get x(){return this._v[0]}set y(e){this._v[1]=e}get y(){return this._v[1]}set z(e){this._v[2]=e}get z(){return this._v[2]}set w(e){this._v[3]=e}get w(){return this._v[3]}get className(){return"MutableQuaternion"}static identity(){return super.identity()}static dummy(){return super.dummy()}static invert(e){return super.invert(e)}static qlerp(e,t,n){return super.qlerp(e,t,n)}static lerp(e,t,n){return super.lerp(e,t,n)}static axisAngle(e,t){return super.axisAngle(e,t)}static fromMatrix(e){return super.fromMatrix(e)}static fromPosition(e){return super.fromPosition(e)}static add(e,t){return super.add(e,t)}static subtract(e,t){return super.subtract(e,t)}static multiply(e,t){return super.multiply(e,t)}static multiplyNumber(e,t){return super.multiplyNumber(e,t)}static divideNumber(e,t){return super.divideNumber(e,t)}raw(){return this._v}setAt(e,t){return this._v[e]=t,this}setComponents(e,t,n,i){return this._v[0]=e,this._v[1]=t,this._v[2]=n,this._v[3]=i,this}copyComponents(e){return this.setComponents(e._v[0],e._v[1],e._v[2],e._v[3])}identity(){return this.setComponents(0,0,0,1)}normalize(){const e=this.length();return this.divideNumber(e)}invert(){const e=this.length();return 0===e||(this._v[0]=-this._v[0]/e,this._v[1]=-this._v[1]/e,this._v[2]=-this._v[2]/e,this._v[3]=this._v[3]/e),this}qlerp(e,t,n){let i=e._v[3]*t._v[3]+e._v[0]*t._v[0]+e._v[1]*t._v[1]+e._v[2]*t._v[2];if(0==1-i*i)return this.copyComponents(e);{i>1?i=.999:i<-1&&(i=-.999);let a,r=Math.acos(i);i<0&&r>Math.PI/2?(i=-e._v[3]*t._v[3]-e._v[0]*t._v[0]-e._v[1]*t._v[1]-e._v[2]*t._v[2],r=Math.acos(i),a=-1*Math.sin(r*n)/Math.sin(r)):a=Math.sin(r*n)/Math.sin(r);const o=Math.sin(r*(1-n))/Math.sin(r);this._v[0]=e._v[0]*o+t._v[0]*a,this._v[1]=e._v[1]*o+t._v[1]*a,this._v[2]=e._v[2]*o+t._v[2]*a,this._v[3]=e._v[3]*o+t._v[3]*a}return this}lerp(e,t,n){return this._v[0]=e._v[0]*(1-n)+t._v[0]*n,this._v[1]=e._v[1]*(1-n)+t._v[1]*n,this._v[2]=e._v[2]*(1-n)+t._v[2]*n,this._v[3]=e._v[3]*(1-n)+t._v[3]*n,this}axisAngle(e,t){const n=.5*t,i=Math.sin(n),a=e.length();return 0===a&&console.error("0 division occurred!"),this._v[3]=Math.cos(n),this._v[0]=i*e._v[0]/a,this._v[1]=i*e._v[1]/a,this._v[2]=i*e._v[2]/a,this}fromMatrix(e){const t=e.m00+e.m11+e.m22;if(t>0){const n=.5/Math.sqrt(t+1);this._v[0]=(e.m21-e.m12)*n,this._v[1]=(e.m02-e.m20)*n,this._v[2]=(e.m10-e.m01)*n,this._v[3]=.25/n}else if(e.m00>e.m11&&e.m00>e.m22){const t=2*Math.sqrt(1+e.m00-e.m11-e.m22);this._v[0]=.25*t,this._v[1]=(e.m01+e.m10)/t,this._v[2]=(e.m02+e.m20)/t,this._v[3]=(e.m21-e.m12)/t}else if(e.m11>e.m22){const t=2*Math.sqrt(1+e.m11-e.m00-e.m22);this._v[0]=(e.m01+e.m10)/t,this._v[1]=.25*t,this._v[2]=(e.m12+e.m21)/t,this._v[3]=(e.m02-e.m20)/t}else{const t=2*Math.sqrt(1+e.m22-e.m00-e.m11);this._v[0]=(e.m02+e.m20)/t,this._v[1]=(e.m12+e.m21)/t,this._v[2]=.25*t,this._v[3]=(e.m10-e.m01)/t}return this}fromPosition(e){return this.setComponents(e._v[0],e._v[1],e._v[2],0)}add(e){return this._v[0]+=e._v[0],this._v[1]+=e._v[1],this._v[2]+=e._v[2],this._v[3]+=e._v[3],this}subtract(e){return this._v[0]-=e._v[0],this._v[1]-=e._v[1],this._v[2]-=e._v[2],this._v[3]-=e._v[3],this}multiply(e){const t=e._v[3]*this._v[0]+e._v[2]*this._v[1]+e._v[1]*this._v[2]-e._v[0]*this._v[3],n=-e._v[2]*this._v[0]+e._v[3]*this._v[1]+e._v[0]*this._v[2]-e._v[1]*this._v[3],i=e._v[1]*this._v[0]+e._v[0]*this._v[1]+e._v[3]*this._v[2]-e._v[2]*this._v[3],a=-e._v[0]*this._v[0]-e._v[1]*this._v[1]-e._v[2]*this._v[2]-e._v[3]*this._v[3];return this.setComponents(t,n,i,a)}multiplyNumber(e){return this._v[0]*=e,this._v[1]*=e,this._v[2]*=e,this._v[3]*=e,this}divideNumber(e){return 0!==e?(this._v[0]/=e,this._v[1]/=e,this._v[2]/=e,this._v[3]/=e):(console.error("0 division occurred!"),this._v[0]=1/0,this._v[1]=1/0,this._v[2]=1/0,this._v[3]=1/0),this}clone(){return super.clone()}}},4267:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r});var i=n(3616);class a extends i.ap{constructor(e,{type:t}){super(e,{type:t})}copyComponents(e){this._v[0]=e._v[0]}get x(){return this._v[0]}set x(e){this._v[0]=e}get y(){return 0}get z(){return 0}get w(){return 1}toString(){return"("+this._v[0]+")"}setValue(e){return this.x=e,this}}class r extends a{constructor(e){super(e,{type:Float32Array})}clone(){return new r(new Float32Array([this.x]))}static one(){return new r(new Float32Array([1]))}static dummy(){return new r(new Float32Array([]))}static zero(){return new r(new Float32Array([0]))}get className(){return"MutableScalar"}}},8182:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r});var i=n(2390);class a extends i.pV{constructor(e,{type:t}){super(e,{type:t})}set x(e){this._v[0]=e}get x(){return this._v[0]}set y(e){this._v[1]=e}get y(){return this._v[1]}get z(){return 0}get w(){return 1}raw(){return this._v}setAt(e,t){return this._v[e]=t,this}setComponents(e,t){return this._v[0]=e,this._v[1]=t,this}copyComponents(e){return this.setComponents(e._v[0],e._v[1])}zero(){return this.setComponents(0,0)}one(){return this.setComponents(1,1)}normalize(){const e=this.length();return this.divide(e),this}add(e){return this._v[0]+=e._v[0],this._v[1]+=e._v[1],this}subtract(e){return this._v[0]-=e._v[0],this._v[1]-=e._v[1],this}multiply(e){return this._v[0]*=e,this._v[1]*=e,this}multiplyVector(e){return this._v[0]*=e._v[0],this._v[1]*=e._v[1],this}divide(e){return 0!==e?(this._v[0]/=e,this._v[1]/=e):(console.error("0 division occurred!"),this._v[0]=1/0,this._v[1]=1/0),this}divideVector(e){return 0!==e._v[0]&&0!==e._v[1]?(this._v[0]/=e._v[0],this._v[1]/=e._v[1]):(console.error("0 division occurred!"),this._v[0]=0===e._v[0]?1/0:this._v[0]/e._v[0],this._v[1]=0===e._v[1]?1/0:this._v[1]/e._v[1]),this}}class r extends a{constructor(e){super(e,{type:Float32Array})}static fromCopyArray2(e){return new r(new Float32Array(e))}static fromCopyArray(e){return new r(new Float32Array(e.slice(0,2)))}static fromFloat32Array(e){return new r(e)}static fromCopyFloat32Array(e){return new r(new Float32Array(e.buffer.slice(0)))}static zero(){return super._zero(Float32Array)}static one(){return super._one(Float32Array)}static dummy(){return super._dummy(Float32Array)}static normalize(e){return super._normalize(e,Float32Array)}static add(e,t){return super._add(e,t,Float32Array)}static subtract(e,t){return super._subtract(e,t,Float32Array)}static multiply(e,t){return super._multiply(e,t,Float32Array)}static multiplyVector(e,t){return super._multiplyVector(e,t,Float32Array)}static divide(e,t){return super._divide(e,t,Float32Array)}static divideVector(e,t){return super._divideVector(e,t,Float32Array)}get className(){return"MutableVector2"}clone(){return super.clone()}}},9190:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r});var i=n(2471);class a extends i.pg{constructor(e,{type:t}){super(e,{type:t})}set x(e){this._v[0]=e}get x(){return this._v[0]}set y(e){this._v[1]=e}get y(){return this._v[1]}set z(e){this._v[2]=e}get z(){return this._v[2]}get w(){return 1}raw(){return this._v}setAt(e,t){return this._v[e]=t,this}setComponents(e,t,n){return this._v[0]=e,this._v[1]=t,this._v[2]=n,this}copyComponents(e){return this.setComponents(e._v[0],e._v[1],e._v[2])}zero(){return this.setComponents(0,0,0)}one(){return this.setComponents(1,1,1)}normalize(){const e=this.length();return this.divide(e),this}add(e){return this._v[0]+=e._v[0],this._v[1]+=e._v[1],this._v[2]+=e._v[2],this}subtract(e){return this._v[0]-=e._v[0],this._v[1]-=e._v[1],this._v[2]-=e._v[2],this}multiply(e){return this._v[0]*=e,this._v[1]*=e,this._v[2]*=e,this}multiplyVector(e){return this._v[0]*=e._v[0],this._v[1]*=e._v[1],this._v[2]*=e._v[2],this}divide(e){return 0!==e?(this._v[0]/=e,this._v[1]/=e,this._v[2]/=e):(console.error("0 division occurred!"),this._v[0]=1/0,this._v[1]=1/0,this._v[2]=1/0),this}divideVector(e){return 0!==e._v[0]&&0!==e._v[1]&&0!==e._v[2]?(this._v[0]/=e._v[0],this._v[1]/=e._v[1],this._v[2]/=e._v[2]):(console.error("0 division occurred!"),this._v[0]=0===e._v[0]?1/0:this._v[0]/e._v[0],this._v[1]=0===e._v[1]?1/0:this._v[1]/e._v[1],this._v[2]=0===e._v[2]?1/0:this._v[2]/e._v[2]),this}cross(e){const t=this._v[1]*e._v[2]-this._v[2]*e._v[1],n=this._v[2]*e._v[0]-this._v[0]*e._v[2],i=this._v[0]*e._v[1]-this._v[1]*e._v[0];return this.setComponents(t,n,i)}multiplyQuaternion(e){const t=2*e._v[0],n=2*e._v[1],i=2*e._v[2],a=e._v[0]*t,r=e._v[1]*n,o=e._v[2]*i,s=e._v[0]*n,l=e._v[0]*i,c=e._v[1]*i,_=e._v[3]*t,h=e._v[3]*n,d=e._v[3]*i,u=(1-(r+o))*this._v[0]+(s-d)*this._v[1]+(l+h)*this._v[2],m=(s+d)*this._v[0]+(1-(a+o))*this._v[1]+(c-_)*this._v[2],x=(l-h)*this._v[0]+(c+_)*this._v[1]+(1-(a+r))*this._v[2];return this.setComponents(u,m,x)}}class r extends a{constructor(e){super(e,{type:Float32Array})}static zero(){return super._zero(Float32Array)}static one(){return super._one(Float32Array)}static dummy(){return super._dummy(Float32Array)}static normalize(e){return super._normalize(e,Float32Array)}static add(e,t){return super._add(e,t,Float32Array)}static subtract(e,t){return super._subtract(e,t,Float32Array)}static multiply(e,t){return super._multiply(e,t,Float32Array)}static multiplyVector(e,t){return super._multiplyVector(e,t,Float32Array)}static divide(e,t){return super._divide(e,t,Float32Array)}static divideVector(e,t){return super._divideVector(e,t,Float32Array)}static cross(e,t){return super._cross(e,t,Float32Array)}static multiplyQuaternion(e,t){return super._multiplyQuaternion(e,t,Float32Array)}get className(){return"MutableVector3"}static fromCopyArray3(e){return new r(new Float32Array(e))}static fromCopyArray(e){return new r(new Float32Array(e.slice(0,3)))}static fromFloat32Array(e){return new r(e)}static fromCopyFloat32Array(e){return new r(new Float32Array(e.buffer.slice(0)))}clone(){return super.clone()}}},4536:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r});var i=n(7192);class a extends i.rE{constructor(e,{type:t}){super(e,{type:t}),this.__updateCount=0}set x(e){this._v[0]=e,this.__updateCount++}get x(){return this._v[0]}set y(e){this._v[1]=e,this.__updateCount++}get y(){return this._v[1]}set z(e){this._v[2]=e,this.__updateCount++}get z(){return this._v[2]}set w(e){this._v[3]=e,this.__updateCount++}get w(){return this._v[3]}raw(){return this._v}setAt(e,t){return this._v[e]=t,this.__updateCount++,this}setComponents(e,t,n,i){return this._v[0]=e,this._v[1]=t,this._v[2]=n,this._v[3]=i,this.__updateCount++,this}copyComponents(e){return this.setComponents(e._v[0],e._v[1],e._v[2],e._v[3])}zero(){return this.setComponents(0,0,0,0)}one(){return this.setComponents(1,1,1,1)}normalize(){const e=this.length();return this.divide(e),this}normalize3(){const e=Math.hypot(this._v[0],this._v[1],this._v[2]);return this.divide(e),this}add(e){return this._v[0]+=e._v[0],this._v[1]+=e._v[1],this._v[2]+=e._v[2],this._v[3]+=e._v[3],this}subtract(e){return this._v[0]-=e._v[0],this._v[1]-=e._v[1],this._v[2]-=e._v[2],this._v[3]-=e._v[3],this}multiply(e){return this._v[0]*=e,this._v[1]*=e,this._v[2]*=e,this._v[3]*=e,this}multiplyVector(e){return this._v[0]*=e._v[0],this._v[1]*=e._v[1],this._v[2]*=e._v[2],this._v[3]*=e._v[3],this}divide(e){return 0!==e?(this._v[0]/=e,this._v[1]/=e,this._v[2]/=e,this._v[3]/=e):(console.error("0 division occurred!"),this._v[0]=1/0,this._v[1]=1/0,this._v[2]=1/0,this._v[3]=1/0),this}divideVector(e){return 0!==e._v[0]&&0!==e._v[1]&&0!==e._v[2]&&0!==e._v[3]?(this._v[0]/=e._v[0],this._v[1]/=e._v[1],this._v[2]/=e._v[2],this._v[3]/=e._v[3]):(console.error("0 division occurred!"),this._v[0]=0===e._v[0]?1/0:this._v[0]/e._v[0],this._v[1]=0===e._v[1]?1/0:this._v[1]/e._v[1],this._v[2]=0===e._v[2]?1/0:this._v[2]/e._v[2],this._v[3]=0===e._v[3]?1/0:this._v[3]/e._v[3]),this}get _updateCount(){return this.__updateCount}}class r extends a{constructor(e){super(e,{type:Float32Array})}static fromCopyArray(e){return new r(new Float32Array(e).slice(0,4))}static fromCopyArray4(e){return new r(new Float32Array(e))}static zero(){return super._zero(Float32Array)}static one(){return super._one(Float32Array)}static dummy(){return super._dummy(Float32Array)}static normalize(e){return super._normalize(e,Float32Array)}static add(e,t){return super._add(e,t,Float32Array)}static subtract(e,t){return super._subtract(e,t,Float32Array)}static multiply(e,t){return super._multiply(e,t,Float32Array)}static multiplyVector(e,t){return super._multiplyVector(e,t,Float32Array)}static divide(e,t){return super._divide(e,t,Float32Array)}static divideVector(e,t){return super._divideVector(e,t,Float32Array)}get className(){return"MutableVector4"}clone(){return new this.constructor(new this._v.constructor([this._v[0],this._v[1],this._v[2],this._v[3]]))}}},4388:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});var i=n(3032),a=n(810);class r extends class{constructor(){this._v=new Float32Array}get className(){return this.constructor.name}get x(){return this._v[0]}get y(){return this._v[1]}get z(){return this._v[2]}get w(){return this._v[3]}at(e){return this._v[e]}length(){return Math.hypot(this._v[0],this._v[1],this._v[2],this._v[3])}lengthSquared(){return this._v[0]**2+this._v[1]**2+this._v[2]**2+this._v[3]**2}toString(){throw new Error("Method not implemented.")}toStringApproximately(){throw new Error("Method not implemented.")}flattenAsArray(){throw new Error("Method not implemented.")}isDummy(){throw new Error("Method not implemented.")}isEqual(e,t){throw new Error("Method not implemented.")}isStrictEqual(e){throw new Error("Method not implemented.")}toEulerAnglesTo(e){throw new Error("Method not implemented.")}dot(e){return this._v[0]*e._v[0]+this._v[1]*e._v[1]+this._v[2]*e._v[2]+this._v[3]*e._v[3]}clone(){throw new Error("Method not implemented.")}}{constructor(e,t,n,i){if(super(),ArrayBuffer.isView(e))this._v=e;else if(null!=e)if(this._v=new Float32Array(4),Array.isArray(e))this._v[0]=e[0],this._v[1]=e[1],this._v[2]=e[2],this._v[3]=e[3];else if("number"==typeof e)this._v[0]=e,this._v[1]=t,this._v[2]=n,this._v[3]=i;else if(e instanceof class{constructor(e,t,n){if(ArrayBuffer.isView(e))this._v=e;else if(null!=e)if(this._v=new Float32Array(3),e instanceof r){const t=Math.acos(e.w),n=Math.sin(t);this._v[0]=e.x*(t/n),this._v[1]=e.y*(t/n),this._v[2]=e.z*(t/n)}else Array.isArray(e)?(this._v[0]=e[0],this._v[1]=e[1],this._v[2]=e[2]):"number"==typeof e?(this._v[0]=e,this._v[1]=t,this._v[2]=n):(this._v[0]=e._v[0],this._v[1]=e._v[1],this._v[2]=e._v[2]);else this._v=new Float32Array(0)}get x(){return this._v[0]}get y(){return this._v[1]}get z(){return this._v[2]}get w(){return 1}get className(){return"LogQuaternion"}}){const t=e._v[0]*e._v[0]+e._v[1]*e._v[1]+e._v[2]*e._v[2],n=Math.sin(t);this._v[0]=e._v[0]*(n/t),this._v[1]=e._v[1]*(n/t),this._v[2]=e._v[2]*(n/t),this._v[3]=Math.cos(t)}else void 0===e._v[2]?(this._v[0]=e._v[0],this._v[1]=e._v[1],this._v[2]=0,this._v[3]=1):void 0===e._v[3]?(this._v[0]=e._v[0],this._v[1]=e._v[1],this._v[2]=e._v[2],this._v[3]=1):(this._v[0]=e._v[0],this._v[1]=e._v[1],this._v[2]=e._v[2],this._v[3]=e._v[3]);else this._v=new Float32Array(0)}get className(){return"Quaternion"}static get compositionType(){return a.d.Vec4}static identity(){return new this(0,0,0,1)}static dummy(){return new this(null)}static invert(e){const t=e.length();return 0===t?new this(0,0,0,0):new this(-e._v[0]/t,-e._v[1]/t,-e._v[2]/t,e._v[3]/t)}static invertTo(e,t){const n=e.length();return 0===n?t.setComponents(0,0,0,0):(t._v[0]=-e._v[0]/n,t._v[1]=-e._v[1]/n,t._v[2]=-e._v[2]/n,t._v[3]=e._v[3]/n,t)}static qlerp(e,t,n){let i=e._v[0]*t._v[0]+e._v[1]*t._v[1]+e._v[2]*t._v[2]+e._v[3]*t._v[3];if(0==1-i*i)return e.clone();{i>1?i=.999:i<-1&&(i=-.999);let a=Math.acos(i);const r=Math.sin(a);let o;i<0?(i*=-1,a=Math.acos(i),o=-1*Math.sin(a*n)/r):o=Math.sin(a*n)/r;const s=Math.sin(a*(1-n))/r;let l=e._v[0]*s+t._v[0]*o,c=e._v[1]*s+t._v[1]*o,_=e._v[2]*s+t._v[2]*o,h=e._v[3]*s+t._v[3]*o;const d=Math.hypot(l,c,_,h);return l/=d,c/=d,_/=d,h/=d,new this(l,c,_,h)}}static qlerpTo(e,t,n,i){let a=e._v[0]*t._v[0]+e._v[1]*t._v[1]+e._v[2]*t._v[2]+e._v[3]*t._v[3];if(0==1-a*a)return i.copyComponents(e);{a>1?a=.999:a<-1&&(a=-.999);let r=Math.acos(a);const o=Math.sin(r);let s;a<0?(a*=-1,r=Math.acos(a),s=-1*Math.sin(r*n)/o):s=Math.sin(r*n)/o;const l=Math.sin(r*(1-n))/o;i._v[0]=e._v[0]*l+t._v[0]*s,i._v[1]=e._v[1]*l+t._v[1]*s,i._v[2]=e._v[2]*l+t._v[2]*s,i._v[3]=e._v[3]*l+t._v[3]*s}return i.normalize()}static lerp(e,t,n){return new this(e._v[0]*(1-n)+t._v[0]*n,e._v[1]*(1-n)+t._v[1]*n,e._v[2]*(1-n)+t._v[2]*n,e._v[3]*(1-n)+t._v[3]*n)}static lerpTo(e,t,n,i){return i._v[0]=e._v[0]*(1-n)+t._v[0]*n,i._v[1]=e._v[1]*(1-n)+t._v[1]*n,i._v[2]=e._v[2]*(1-n)+t._v[2]*n,i._v[3]=e._v[3]*(1-n)+t._v[3]*n,i}static axisAngle(e,t){const n=.5*t,i=Math.sin(n),a=e.length();return 0===a&&console.error("0 division occurred!"),new this(i*e._v[0]/a,i*e._v[1]/a,i*e._v[2]/a,Math.cos(n))}static fromMatrix(e){const t=new this(0,0,0,1),n=e.m00+e.m11+e.m22;if(n>0){const i=.5/Math.sqrt(n+1);t._v[3]=.25/i,t._v[0]=(e.m21-e.m12)*i,t._v[1]=(e.m02-e.m20)*i,t._v[2]=(e.m10-e.m01)*i}else if(e.m00>e.m11&&e.m00>e.m22){const n=2*Math.sqrt(1+e.m00-e.m11-e.m22);t._v[3]=(e.m21-e.m12)/n,t._v[0]=.25*n,t._v[1]=(e.m01+e.m10)/n,t._v[2]=(e.m02+e.m20)/n}else if(e.m11>e.m22){const n=2*Math.sqrt(1+e.m11-e.m00-e.m22);t._v[3]=(e.m02-e.m20)/n,t._v[0]=(e.m01+e.m10)/n,t._v[1]=.25*n,t._v[2]=(e.m12+e.m21)/n}else{const n=2*Math.sqrt(1+e.m22-e.m00-e.m11);t._v[3]=(e.m10-e.m01)/n,t._v[0]=(e.m02+e.m20)/n,t._v[1]=(e.m12+e.m21)/n,t._v[2]=.25*n}return t}static fromMatrixTo(e,t){const n=e.m00+e.m11+e.m22;if(n>0){const i=.5/Math.sqrt(n+1);t._v[3]=.25/i,t._v[0]=(e.m21-e.m12)*i,t._v[1]=(e.m02-e.m20)*i,t._v[2]=(e.m10-e.m01)*i}else if(e.m00>e.m11&&e.m00>e.m22){const n=2*Math.sqrt(1+e.m00-e.m11-e.m22);t._v[3]=(e.m21-e.m12)/n,t._v[0]=.25*n,t._v[1]=(e.m01+e.m10)/n,t._v[2]=(e.m02+e.m20)/n}else if(e.m11>e.m22){const n=2*Math.sqrt(1+e.m11-e.m00-e.m22);t._v[3]=(e.m02-e.m20)/n,t._v[0]=(e.m01+e.m10)/n,t._v[1]=.25*n,t._v[2]=(e.m12+e.m21)/n}else{const n=2*Math.sqrt(1+e.m22-e.m00-e.m11);t._v[3]=(e.m10-e.m01)/n,t._v[0]=(e.m02+e.m20)/n,t._v[1]=(e.m12+e.m21)/n,t._v[2]=.25*n}return t}static lookFromTo(e,t){return e.isEqual(t)?new this(0,0,0,1):this.qlerp(this.lookForward(e),this.lookForward(t),1)}static lookForward(e){return null==r.__tmp_upVec&&(r.__tmp_upVec=new e.constructor(0,1,0)),this.lookForwardAccordingToThisUp(e,r.__tmp_upVec)}static lookForwardAccordingToThisUp(e,t){const n=e.length();0===n&&console.error("0 division occurred!");const i=e._v[0]/n,a=e._v[1]/n,r=e._v[2]/n,o=t.length();0===o&&console.error("0 division occurred!");const s=t._v[0]/o,l=t._v[1]/o,c=t._v[2]/o;let _=t._v[1]*e._v[2]-t._v[2]*e._v[1],h=t._v[2]*e._v[0]-t._v[0]*e._v[2],d=t._v[0]*e._v[1]-t._v[1]*e._v[0];const u=Math.hypot(_,h,d);0===u&&console.error("0 division occurred!"),_/=u,h/=u,d/=u;const m=_,x=h,f=d,A=s,p=l,g=c,v=i,y=a,I=r,b=m+p+I;if(b>0){const e=Math.sqrt(b+1),t=.5/e;return new this((g-y)*t,(v-f)*t,(x-A)*t,.5*e)}if(m>=p&&m>=I){const e=Math.sqrt(1+m-p-I),t=.5/e;return new this(.5*e,(x+A)*t,(f+v)*t,(g-y)*t)}if(p>I){const e=Math.sqrt(1+p-m-I),t=.5/e;return new this((A+x)*t,.5*e,(y+g)*t,(v-f)*t)}{const e=Math.sqrt(1+I-m-p),t=.5/e;return new this((v+f)*t,(y+g)*t,.5*e,(x-A)*t)}}static fromPosition(e){return new this(e._v[0],e._v[1],e._v[2],0)}static add(e,t){return new this(e._v[0]+t._v[0],e._v[1]+t._v[1],e._v[2]+t._v[2],e._v[3]+t._v[3])}static addTo(e,t,n){return n._v[0]=e._v[0]+t._v[0],n._v[1]=e._v[1]+t._v[1],n._v[2]=e._v[2]+t._v[2],n._v[3]=e._v[3]+t._v[3],n}static subtract(e,t){return new this(e._v[0]-t._v[0],e._v[1]-t._v[1],e._v[2]-t._v[2],e._v[3]-t._v[3])}static subtractTo(e,t,n){return n._v[0]=e._v[0]-t._v[0],n._v[1]=e._v[1]-t._v[1],n._v[2]=e._v[2]-t._v[2],n._v[3]=e._v[3]-t._v[3],n}static multiply(e,t){return new this(t._v[3]*e._v[0]+t._v[2]*e._v[1]-t._v[1]*e._v[2]+t._v[0]*e._v[3],-t._v[2]*e._v[0]+t._v[3]*e._v[1]+t._v[0]*e._v[2]+t._v[1]*e._v[3],t._v[1]*e._v[0]-t._v[0]*e._v[1]+t._v[3]*e._v[2]+t._v[2]*e._v[3],-t._v[0]*e._v[0]-t._v[1]*e._v[1]-t._v[2]*e._v[2]+t._v[3]*e._v[3])}static multiplyTo(e,t,n){const i=t._v[3]*e._v[0]+t._v[2]*e._v[1]-t._v[1]*e._v[2]+t._v[0]*e._v[3],a=-t._v[2]*e._v[0]+t._v[3]*e._v[1]+t._v[0]*e._v[2]+t._v[1]*e._v[3],r=t._v[1]*e._v[0]-t._v[0]*e._v[1]+t._v[3]*e._v[2]+t._v[2]*e._v[3],o=-t._v[0]*e._v[0]-t._v[1]*e._v[1]-t._v[2]*e._v[2]+t._v[3]*e._v[3];return n.setComponents(i,a,r,o)}static multiplyNumber(e,t){return new this(e._v[0]*t,e._v[1]*t,e._v[2]*t,e._v[3]*t)}static multiplyNumberTo(e,t,n){return n._v[0]=e._v[0]*t,n._v[1]=e._v[1]*t,n._v[2]=e._v[2]*t,n._v[3]=e._v[3]*t,n}static divideNumber(e,t){return 0===t&&console.error("0 division occurred!"),new this(e._v[0]/t,e._v[1]/t,e._v[2]/t,e._v[3]/t)}static divideNumberTo(e,t,n){return 0===t&&console.error("0 division occurred!"),n._v[0]=e._v[0]/t,n._v[1]=e._v[1]/t,n._v[2]=e._v[2]/t,n._v[3]=e._v[3]/t,n}toString(){return"("+this._v[0]+", "+this._v[1]+", "+this._v[2]+", "+this._v[3]+")"}toStringApproximately(){return i.k.financial(this._v[0])+" "+i.k.financial(this._v[1])+" "+i.k.financial(this._v[2])+" "+i.k.financial(this._v[3])+"\n"}flattenAsArray(){return[this._v[0],this._v[1],this._v[2],this._v[3]]}isDummy(){return 0===this._v.length}isEqual(e,t=Number.EPSILON){return Math.abs(e._v[0]-this._v[0])<t&&Math.abs(e._v[1]-this._v[1])<t&&Math.abs(e._v[2]-this._v[2])<t&&Math.abs(e._v[3]-this._v[3])<t}isStrictEqual(e){return this._v[0]===e._v[0]&&this._v[1]===e._v[1]&&this._v[2]===e._v[2]&&this._v[3]===e._v[3]}toEulerAnglesTo(e){const t=2*(this._v[3]*this._v[0]+this._v[1]*this._v[2]),n=1-2*(this._v[0]*this._v[0]+this._v[1]*this._v[1]);e._v[0]=Math.atan2(t,n);const i=2*(this._v[3]*this._v[1]-this._v[2]*this._v[0]);Math.abs(i)>=1?e._v[1]=Math.PI/2*Math.sign(i):e._v[1]=Math.asin(i);const a=2*(this._v[3]*this._v[2]+this._v[0]*this._v[1]),r=1-2*(this._v[1]*this._v[1]+this._v[2]*this._v[2]);return e._v[2]=Math.atan2(a,r),e}clone(){return new this.constructor(this._v[0],this._v[1],this._v[2],this._v[3])}static fromCopyArray4(e){return new r(new Float32Array(e),0,0,0)}static fromCopyXYZW(e,t,n,i){return new r(new Float32Array([e,t,n,i]),0,0,0)}}r.__tmp_upVec=void 0},3616:(e,t,n)=>{"use strict";n.d(t,{ap:()=>r,ZP:()=>o});var i=n(3032),a=n(3343);class r extends a.Z{constructor(e,{type:t}){super(),this._v=e}getValue(){return this._v[0]}getValueInArray(){return[this._v[0]]}get x(){return this._v[0]}get raw(){return this._v}isStrictEqual(e){return this.x===e.x}isEqual(e,t=Number.EPSILON){return Math.abs(e.x-this.x)<t}get glslStrAsFloat(){return`${i.k.convertToStringAsGLSLFloat(this.x)}`}get glslStrAsInt(){return`${Math.floor(this.x)}`}static _fromCopyNumber(e,t){return new this(new t([e]),{type:t})}static _dummy(e){return new this(new e,{type:e})}}class o extends r{constructor(e){super(e,{type:Float32Array})}static fromCopyNumber(e){return super._fromCopyNumber(e,Float32Array)}static zero(){return o.fromCopyNumber(0)}static one(){return o.fromCopyNumber(1)}static dummy(){return super._dummy(Float32Array)}get className(){return"Scalar"}toString(){return"("+this._v[0]+")"}clone(){return new o(this._v)}}},2390:(e,t,n)=>{"use strict";n.d(t,{pV:()=>o,ZP:()=>s});var i=n(3032),a=n(810),r=n(3343);class o extends r.Z{constructor(e,{type:t}){super(),this._v=e}get x(){return this._v[0]}get y(){return this._v[1]}get glslStrAsFloat(){return`vec2(${i.k.convertToStringAsGLSLFloat(this._v[0])}, ${i.k.convertToStringAsGLSLFloat(this._v[1])})`}get glslStrAsInt(){return`ivec2(${Math.floor(this._v[0])}, ${Math.floor(this._v[1])})`}static get compositionType(){return a.d.Vec2}static lengthSquared(e){return e.lengthSquared()}static lengthBtw(e,t){return e.lengthTo(t)}static angleOfVectors(e,t){const n=e.length()*t.length();0===n&&console.error("length of a vector is 0!");const i=e.dot(t)/n;return Math.acos(i)}static _zero(e){return this._fromCopyArray2([0,0],e)}static _one(e){return this._fromCopyArray2([1,1],e)}static _dummy(e){return new this(new e,{type:e})}static _normalize(e,t){const n=e.length();return this._divide(e,n,t)}static _add(e,t,n){const i=e._v[0]+t._v[0],a=e._v[1]+t._v[1];return this._fromCopyArray2([i,a],n)}static addTo(e,t,n){return n._v[0]=e._v[0]+t._v[0],n._v[1]=e._v[1]+t._v[1],n}static _subtract(e,t,n){const i=e._v[0]-t._v[0],a=e._v[1]-t._v[1];return this._fromCopyArray2([i,a],n)}static subtractTo(e,t,n){return n._v[0]=e._v[0]-t._v[0],n._v[1]=e._v[1]-t._v[1],n}static _multiply(e,t,n){const i=e._v[0]*t,a=e._v[1]*t;return this._fromCopyArray2([i,a],n)}static multiplyTo(e,t,n){return n._v[0]=e._v[0]*t,n._v[1]=e._v[1]*t,n}static _multiplyVector(e,t,n){const i=e._v[0]*t._v[0],a=e._v[1]*t._v[1];return this._fromCopyArray2([i,a],n)}static multiplyVectorTo(e,t,n){return n._v[0]=e._v[0]*t._v[0],n._v[1]=e._v[1]*t._v[1],n}static _divide(e,t,n){let i,a;return 0!==t?(i=e._v[0]/t,a=e._v[1]/t):(console.error("0 division occurred!"),i=1/0,a=1/0),this._fromCopyArray2([i,a],n)}static divideTo(e,t,n){return 0!==t?(n._v[0]=e._v[0]/t,n._v[1]=e._v[1]/t):(console.error("0 division occurred!"),n._v[0]=1/0,n._v[1]=1/0),n}static _divideVector(e,t,n){let i,a;return 0!==t._v[0]&&0!==t._v[1]?(i=e._v[0]/t._v[0],a=e._v[1]/t._v[1]):(console.error("0 division occurred!"),i=0===t._v[0]?1/0:e._v[0]/t._v[0],a=0===t._v[1]?1/0:e._v[1]/t._v[1]),this._fromCopyArray2([i,a],n)}static divideVectorTo(e,t,n){return 0!==t._v[0]&&0!==t._v[1]?(n._v[0]=e._v[0]/t._v[0],n._v[1]=e._v[1]/t._v[1]):(console.error("0 division occurred!"),n._v[0]=0===t._v[0]?1/0:e._v[0]/t._v[0],n._v[1]=0===t._v[1]?1/0:e._v[1]/t._v[1]),n}static dot(e,t){return e.dot(t)}toString(){return"("+this._v[0]+", "+this._v[1]+")"}toStringApproximately(){return i.k.financial(this._v[0])+" "+i.k.financial(this._v[1])+"\n"}flattenAsArray(){return[this._v[0],this._v[1]]}isDummy(){return 0===this._v.length}isEqual(e,t=Number.EPSILON){return Math.abs(e._v[0]-this._v[0])<t&&Math.abs(e._v[1]-this._v[1])<t}isStrictEqual(e){return this._v[0]===e._v[0]&&this._v[1]===e._v[1]}at(e){return this._v[e]}length(){return Math.hypot(this._v[0],this._v[1])}lengthSquared(){return this._v[0]**2+this._v[1]**2}lengthTo(e){const t=this._v[0]-e._v[0],n=this._v[1]-e._v[1];return Math.hypot(t,n)}dot(e){return this._v[0]*e._v[0]+this._v[1]*e._v[1]}clone(){return new this.constructor(new this._v.constructor([this._v[0],this._v[1]]))}static _fromCopyArray2(e,t){return new this(new t(e),{type:t})}static _fromCopyArray(e,t){return new this(new t(e.slice(0,2)),{type:t})}static _fromVector2(e,t){return new this(new t(e._v),{type:t})}static _fromCopyVector2(e,t){return new this(new t([e._v[0],e._v[1]]),{type:t})}static _fromCopyVector3(e,t){return new this(new t([e._v[0],e._v[1],e._v[2]]),{type:t})}static _fromCopyVector4(e,t){return new this(new t([e._v[0],e._v[1],e._v[2]]),{type:t})}}class s extends o{constructor(e){super(e,{type:Float32Array})}static fromCopyArray2(e){return super._fromCopyArray2(e,Float32Array)}static fromCopyArray(e){return super._fromCopyArray(e,Float32Array)}static fromCopyVector2(e){return super._fromCopyVector2(e,Float32Array)}static fromCopyVector4(e){return super._fromCopyVector4(e,Float32Array)}static zero(){return super._zero(Float32Array)}static one(){return super._one(Float32Array)}static dummy(){return super._dummy(Float32Array)}static normalize(e){return super._normalize(e,Float32Array)}static add(e,t){return super._add(e,t,Float32Array)}static subtract(e,t){return super._subtract(e,t,Float32Array)}static multiply(e,t){return super._multiply(e,t,Float32Array)}static multiplyVector(e,t){return super._multiplyVector(e,t,Float32Array)}static divide(e,t){return super._divide(e,t,Float32Array)}static divideVector(e,t){return super._divideVector(e,t,Float32Array)}get className(){return"Vector2"}clone(){return super.clone()}}},2471:(e,t,n)=>{"use strict";n.d(t,{pg:()=>o,ZP:()=>s});var i=n(3032),a=n(810),r=n(3343);class o extends r.Z{constructor(e,{type:t}){super(),this._v=e}get x(){return this._v[0]}get y(){return this._v[1]}get z(){return this._v[2]}get w(){return 1}get glslStrAsFloat(){return`vec3(${i.k.convertToStringAsGLSLFloat(this._v[0])}, ${i.k.convertToStringAsGLSLFloat(this._v[1])}, ${i.k.convertToStringAsGLSLFloat(this._v[2])})`}get glslStrAsInt(){return`ivec3(${Math.floor(this._v[0])}, ${Math.floor(this._v[1])}, ${Math.floor(this._v[2])})`}static get compositionType(){return a.d.Vec3}static lengthSquared(e){return e.lengthSquared()}static lengthBtw(e,t){return e.lengthTo(t)}static angleOfVectors(e,t){const n=e.length()*t.length();0===n&&console.error("length of a vector is 0!");const i=e.dot(t)/n;return Math.acos(i)}static _zero(e){return this._fromCopyArray([0,0,0],e)}static _one(e){return this._fromCopyArray([1,1,1],e)}static _dummy(e){return new this(new e([]),{type:e})}static _normalize(e,t){const n=e.length();return this._divide(e,n,t)}static _add(e,t,n){const i=e._v[0]+t._v[0],a=e._v[1]+t._v[1],r=e._v[2]+t._v[2];return this._fromCopyArray([i,a,r],n)}static addTo(e,t,n){return n._v[0]=e._v[0]+t._v[0],n._v[1]=e._v[1]+t._v[1],n._v[2]=e._v[2]+t._v[2],n}static _subtract(e,t,n){const i=e._v[0]-t._v[0],a=e._v[1]-t._v[1],r=e._v[2]-t._v[2];return this._fromCopyArray([i,a,r],n)}static subtractTo(e,t,n){return n._v[0]=e._v[0]-t._v[0],n._v[1]=e._v[1]-t._v[1],n._v[2]=e._v[2]-t._v[2],n}static _multiply(e,t,n){const i=e._v[0]*t,a=e._v[1]*t,r=e._v[2]*t;return this._fromCopyArray([i,a,r],n)}static multiplyTo(e,t,n){return n._v[0]=e._v[0]*t,n._v[1]=e._v[1]*t,n._v[2]=e._v[2]*t,n}static _multiplyVector(e,t,n){const i=e._v[0]*t._v[0],a=e._v[1]*t._v[1],r=e._v[2]*t._v[2];return this._fromCopyArray([i,a,r],n)}static multiplyVectorTo(e,t,n){return n._v[0]=e._v[0]*t._v[0],n._v[1]=e._v[1]*t._v[1],n._v[2]=e._v[2]*t._v[2],n}static _divide(e,t,n){let i,a,r;return 0!==t?(i=e._v[0]/t,a=e._v[1]/t,r=e._v[2]/t):(console.error("0 division occurred!"),i=1/0,a=1/0,r=1/0),this._fromCopyArray([i,a,r],n)}static divideTo(e,t,n){return 0!==t?(n._v[0]=e._v[0]/t,n._v[1]=e._v[1]/t,n._v[2]=e._v[2]/t):(console.error("0 division occurred!"),n._v[0]=1/0,n._v[1]=1/0,n._v[2]=1/0),n}static _divideVector(e,t,n){let i,a,r;return 0!==t._v[0]&&0!==t._v[1]&&0!==t._v[2]?(i=e._v[0]/t._v[0],a=e._v[1]/t._v[1],r=e._v[2]/t._v[2]):(console.error("0 division occurred!"),i=0===t._v[0]?1/0:e._v[0]/t._v[0],a=0===t._v[1]?1/0:e._v[1]/t._v[1],r=0===t._v[2]?1/0:e._v[2]/t._v[2]),this._fromCopyArray([i,a,r],n)}static divideVectorTo(e,t,n){return 0!==t._v[0]&&0!==t._v[1]&&0!==t._v[2]?(n._v[0]=e._v[0]/t._v[0],n._v[1]=e._v[1]/t._v[1],n._v[2]=e._v[2]/t._v[2]):(console.error("0 division occurred!"),n._v[0]=0===t._v[0]?1/0:e._v[0]/t._v[0],n._v[1]=0===t._v[1]?1/0:e._v[1]/t._v[1],n._v[2]=0===t._v[2]?1/0:e._v[2]/t._v[2]),n}static dot(e,t){return e.dot(t)}static _cross(e,t,n){const i=e._v[1]*t._v[2]-e._v[2]*t._v[1],a=e._v[2]*t._v[0]-e._v[0]*t._v[2],r=e._v[0]*t._v[1]-e._v[1]*t._v[0];return this._fromCopyArray([i,a,r],n)}static crossTo(e,t,n){const i=e._v[1]*t._v[2]-e._v[2]*t._v[1],a=e._v[2]*t._v[0]-e._v[0]*t._v[2],r=e._v[0]*t._v[1]-e._v[1]*t._v[0];return n.setComponents(i,a,r)}static _multiplyQuaternion(e,t,n){const i=2*e._v[0],a=2*e._v[1],r=2*e._v[2],o=e._v[0]*i,s=e._v[1]*a,l=e._v[2]*r,c=e._v[0]*a,_=e._v[0]*r,h=e._v[1]*r,d=e._v[3]*i,u=e._v[3]*a,m=e._v[3]*r,x=(1-(s+l))*t._v[0]+(c-m)*t._v[1]+(_+u)*t._v[2],f=(c+m)*t._v[0]+(1-(o+l))*t._v[1]+(h-d)*t._v[2],A=(_-u)*t._v[0]+(h+d)*t._v[1]+(1-(o+s))*t._v[2];return this._fromCopyArray([x,f,A],n)}static multiplyQuaternionTo(e,t,n){const i=2*e._v[0],a=2*e._v[1],r=2*e._v[2],o=e._v[0]*i,s=e._v[1]*a,l=e._v[2]*r,c=e._v[0]*a,_=e._v[0]*r,h=e._v[1]*r,d=e._v[3]*i,u=e._v[3]*a,m=e._v[3]*r,x=(1-(s+l))*t._v[0]+(c-m)*t._v[1]+(_+u)*t._v[2],f=(c+m)*t._v[0]+(1-(o+l))*t._v[1]+(h-d)*t._v[2],A=(_-u)*t._v[0]+(h+d)*t._v[1]+(1-(o+s))*t._v[2];return n.setComponents(x,f,A)}toString(){return"("+this._v[0]+", "+this._v[1]+", "+this._v[2]+")"}toStringApproximately(){return i.k.financial(this._v[0])+" "+i.k.financial(this._v[1])+" "+i.k.financial(this._v[2])+"\n"}flattenAsArray(){return[this._v[0],this._v[1],this._v[2]]}isDummy(){return 0===this._v.length}isEqual(e,t=Number.EPSILON){return Math.abs(e._v[0]-this._v[0])<t&&Math.abs(e._v[1]-this._v[1])<t&&Math.abs(e._v[2]-this._v[2])<t}isStrictEqual(e){return this._v[0]===e._v[0]&&this._v[1]===e._v[1]&&this._v[2]===e._v[2]}at(e){return this._v[e]}length(){return Math.hypot(this._v[0],this._v[1],this._v[2])}lengthSquared(){return this._v[0]**2+this._v[1]**2+this._v[2]**2}lengthTo(e){const t=this._v[0]-e._v[0],n=this._v[1]-e._v[1],i=this._v[2]-e._v[2];return Math.hypot(t,n,i)}dot(e){return this._v[0]*e._v[0]+this._v[1]*e._v[1]+this._v[2]*e._v[2]}get className(){return"Vector3"}clone(){return new this.constructor(new this._v.constructor([this._v[0],this._v[1],this._v[2]],0,0))}static _lerp(e,t,n,i){return new this(new i([e._v[0]*n+t._v[0]*(1-n),e._v[1]*n+t._v[1]*(1-n),e._v[2]*n+t._v[2]*(1-n)]),{type:i})}static _fromCopyArray3(e,t){return new this(new t(e),{type:t})}static _fromCopyArray(e,t){return new this(new t(e.slice(0,3)),{type:t})}static _fromCopyVector3(e,t){return new this(new t([e._v[0],e._v[1],e._v[2]]),{type:t})}static _fromCopyVector4(e,t){return new this(new t([e._v[0],e._v[1],e._v[2]]),{type:t})}static _fromVector2(e,t){return new this(new t([e._v[0],e._v[1],0]),{type:t})}}class s extends o{constructor(e){super(e,{type:Float32Array})}static fromCopyArray3(e){return super._fromCopyArray3(e,Float32Array)}static fromCopyArray(e){return super._fromCopyArray(e,Float32Array)}static fromCopyVector3(e){return super._fromCopyVector3(e,Float32Array)}static fromCopyVector4(e){return super._fromCopyVector4(e,Float32Array)}static fromArrayBuffer(e){return new s(new Float32Array(e))}static fromFloat32Array(e){return new s(e)}static fromCopyFloat32Array(e){return new s(e.slice(0))}static zero(){return super._zero(Float32Array)}static one(){return super._one(Float32Array)}static dummy(){return super._dummy(Float32Array)}static normalize(e){return super._normalize(e,Float32Array)}static add(e,t){return super._add(e,t,Float32Array)}static subtract(e,t){return super._subtract(e,t,Float32Array)}static multiply(e,t){return super._multiply(e,t,Float32Array)}static multiplyVector(e,t){return super._multiplyVector(e,t,Float32Array)}static divide(e,t){return super._divide(e,t,Float32Array)}static divideVector(e,t){return super._divideVector(e,t,Float32Array)}static cross(e,t){return super._cross(e,t,Float32Array)}static multiplyQuaternion(e,t){return super._multiplyQuaternion(e,t,Float32Array)}static lerp(e,t,n){return super._lerp(e,t,n,Float32Array)}}},7192:(e,t,n)=>{"use strict";n.d(t,{rE:()=>o,ZP:()=>s});var i=n(3032),a=n(810),r=n(3343);class o extends r.Z{constructor(e,{type:t}){super(),this._v=e}get x(){return this._v[0]}get y(){return this._v[1]}get z(){return this._v[2]}get w(){return this._v[3]}get glslStrAsFloat(){return`vec4(${i.k.convertToStringAsGLSLFloat(this._v[0])}, ${i.k.convertToStringAsGLSLFloat(this._v[1])}, ${i.k.convertToStringAsGLSLFloat(this._v[2])}, ${i.k.convertToStringAsGLSLFloat(this._v[3])})`}get glslStrAsInt(){return`ivec4(${Math.floor(this._v[0])}, ${Math.floor(this._v[1])}, ${Math.floor(this._v[2])}, ${Math.floor(this._v[3])})`}static _fromCopyArray4(e,t){return new this(new t(e),{type:t})}static _fromCopyArray(e,t){return new this(new t(e.slice(0,4)),{type:t})}static _fromCopyVector4(e,t){return new this(new t([e._v[0],e._v[1],e._v[2],e._v[3]]),{type:t})}static _fromCopyVector3(e,t){return new this(new t([e._v[0],e._v[1],e._v[2],1]),{type:t})}static _fromVector2(e,t){return new this(new t([e._v[0],e._v[1],0,1]),{type:t})}static get compositionType(){return a.d.Vec4}static lengthSquared(e){return e.lengthSquared()}static lengthBtw(e,t){return e.lengthTo(t)}static _zero(e){return new this(new e([0,0,0,0]),{type:e})}static _one(e){return new this(new e([1,1,1,1]),{type:e})}static _dummy(e){return new this(new e([]),{type:e})}static _normalize(e,t){const n=e.length();return this._divide(e,n,t)}static _add(e,t,n){return new this(new n([e._v[0]+t._v[0],e._v[1]+t._v[1],e._v[2]+t._v[2],e._v[3]+t._v[3]]),{type:n})}static addTo(e,t,n){return n._v[0]=e._v[0]+t._v[0],n._v[1]=e._v[1]+t._v[1],n._v[2]=e._v[2]+t._v[2],n._v[3]=e._v[3]+t._v[3],n}static _subtract(e,t,n){return new this(new n([e._v[0]-t._v[0],e._v[1]-t._v[1],e._v[2]-t._v[2],e._v[3]-t._v[3]]),{type:n})}static subtractTo(e,t,n){return n._v[0]=e._v[0]-t._v[0],n._v[1]=e._v[1]-t._v[1],n._v[2]=e._v[2]-t._v[2],n._v[3]=e._v[3]-t._v[3],n}static _multiply(e,t,n){return new this(new n([e._v[0]*t,e._v[1]*t,e._v[2]*t,e._v[3]*t]),{type:n})}static multiplyTo(e,t,n){return n._v[0]=e._v[0]*t,n._v[1]=e._v[1]*t,n._v[2]=e._v[2]*t,n._v[3]=e._v[3]*t,n}static _multiplyVector(e,t,n){return new this(new n([e._v[0]*t._v[0],e._v[1]*t._v[1],e._v[2]*t._v[2],e._v[3]*t._v[3]]),{type:n})}static multiplyVectorTo(e,t,n){return n._v[0]=e._v[0]*t._v[0],n._v[1]=e._v[1]*t._v[1],n._v[2]=e._v[2]*t._v[2],n._v[3]=e._v[3]*t._v[3],n}static _divide(e,t,n){let i,a,r,o;return 0!==t?(i=e._v[0]/t,a=e._v[1]/t,r=e._v[2]/t,o=e._v[3]/t):(console.error("0 division occurred!"),i=1/0,a=1/0,r=1/0,o=1/0),new this(new n([i,a,r,o]),{type:n})}static divideTo(e,t,n){return 0!==t?(n._v[0]=e._v[0]/t,n._v[1]=e._v[1]/t,n._v[2]=e._v[2]/t,n._v[3]=e._v[3]/t):(console.error("0 division occurred!"),n._v[0]=1/0,n._v[1]=1/0,n._v[2]=1/0,n._v[3]=1/0),n}static _divideVector(e,t,n){let i,a,r,o;return 0!==t._v[0]&&0!==t._v[1]&&0!==t._v[2]&&0!==t._v[3]?(i=e._v[0]/t._v[0],a=e._v[1]/t._v[1],r=e._v[2]/t._v[2],o=e._v[3]/t._v[3]):(console.error("0 division occurred!"),i=0===t._v[0]?1/0:e._v[0]/t._v[0],a=0===t._v[1]?1/0:e._v[1]/t._v[1],r=0===t._v[2]?1/0:e._v[2]/t._v[2],o=0===t._v[3]?1/0:e._v[3]/t._v[3]),new this(new n([i,a,r,o]),{type:n})}static divideVectorTo(e,t,n){return 0!==t._v[0]&&0!==t._v[1]&&0!==t._v[2]&&0!==t._v[3]?(n._v[0]=e._v[0]/t._v[0],n._v[1]=e._v[1]/t._v[1],n._v[2]=e._v[2]/t._v[2],n._v[3]=e._v[3]/t._v[3]):(console.error("0 division occurred!"),n._v[0]=0===t._v[0]?1/0:e._v[0]/t._v[0],n._v[1]=0===t._v[1]?1/0:e._v[1]/t._v[1],n._v[2]=0===t._v[2]?1/0:e._v[2]/t._v[2],n._v[3]=0===t._v[3]?1/0:e._v[3]/t._v[3]),n}static dot(e,t){return e.dot(t)}toString(){return"("+this._v[0]+", "+this._v[1]+", "+this._v[2]+", "+this._v[3]+")"}toStringApproximately(){return i.k.financial(this._v[0])+" "+i.k.financial(this._v[1])+" "+i.k.financial(this._v[2])+" "+i.k.financial(this._v[3])+"\n"}flattenAsArray(){return[this._v[0],this._v[1],this._v[2],this._v[3]]}isDummy(){return 0===this._v.length}isEqual(e,t=Number.EPSILON){return Math.abs(e._v[0]-this._v[0])<t&&Math.abs(e._v[1]-this._v[1])<t&&Math.abs(e._v[2]-this._v[2])<t&&Math.abs(e._v[3]-this._v[3])<t}isStrictEqual(e){return this._v[0]===e._v[0]&&this._v[1]===e._v[1]&&this._v[2]===e._v[2]&&this._v[3]===e._v[3]}at(e){return this._v[e]}length(){return Math.hypot(this._v[0],this._v[1],this._v[2],this._v[3])}lengthSquared(){return this._v[0]**2+this._v[1]**2+this._v[2]**2+this._v[3]**2}lengthTo(e){const t=this._v[0]-e._v[0],n=this._v[1]-e._v[1],i=this._v[2]-e._v[2],a=this._v[3]-e._v[3];return Math.hypot(t,n,i,a)}dot(e){return this._v[0]*e._v[0]+this._v[1]*e._v[1]+this._v[2]*e._v[2]+this._v[3]*e._v[3]}get className(){return"Vector4"}clone(){return new this.constructor(new this._v.constructor([this._v[0],this._v[1],this._v[2],this._v[3]]))}}class s extends o{constructor(e){super(e,{type:Float32Array})}static fromCopyArray(e){return super._fromCopyArray(e,Float32Array)}static fromCopyArray4(e){return super._fromCopyArray4(e,Float32Array)}static fromCopyVector3(e){return super._fromCopyVector3(e,Float32Array)}static fromCopyVector4(e){return super._fromCopyVector4(e,Float32Array)}static fromArrayBuffer(e){return new s(new Float32Array(e))}static fromFloat32Array(e){return new s(e)}static fromCopyFloat32Array(e){return new s(e.slice(0))}static zero(){return super._zero(Float32Array)}static one(){return super._one(Float32Array)}static dummy(){return super._dummy(Float32Array)}static normalize(e){return super._normalize(e,Float32Array)}static add(e,t){return super._add(e,t,Float32Array)}static subtract(e,t){return super._subtract(e,t,Float32Array)}static multiply(e,t){return super._multiply(e,t,Float32Array)}static multiplyVector(e,t){return super._multiplyVector(e,t,Float32Array)}static divide(e,t){return super._divide(e,t,Float32Array)}static divideVector(e,t){return super._divideVector(e,t,Float32Array)}clone(){return super.clone()}}s.fromCopyArray([1,1,1,1]),s.fromCopyArray([0,0,0,1]),s.fromCopyArray([0,0,0,0])},4255:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{constructor(e){this._v=e}}},3395:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var i=n(3999),a=n(810),r=n(2390),o=n(2471),s=n(7192),l=n(8182),c=n(9190),_=n(4536),h=n(1447),d=n(3496);class u{constructor({bufferView:e,byteOffsetInBufferView:t,compositionType:n,componentType:r,byteStride:o,count:s,raw:l,max:c,min:h,arrayLength:d,normalized:u}){this.__compositionType=a.d.Unknown,this.__componentType=i.r.Unknown,this.__count=0,this.__takenCount=0,this.__byteStride=0,this.__max=_.ZP.fromCopyArray([-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]),this.__min=_.ZP.fromCopyArray([Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE]),this.__arrayLength=1,this.__normalized=!1,this.__isMinMixDirty=!0,this.__bufferView=e,this.__byteOffsetInRawArrayBufferOfBuffer=e.byteOffsetInRawArrayBufferOfBuffer+t,this.__compositionType=n,this.__componentType=r,this.__count=s,this.__arrayLength=d,c&&this.__max.setComponents(c[0]||-Number.MAX_VALUE,c[1]||-Number.MAX_VALUE,c[2]||-Number.MAX_VALUE,c[3]||-Number.MAX_VALUE),h&&this.__min.setComponents(h[0]||Number.MAX_VALUE,h[1]||Number.MAX_VALUE,h[2]||Number.MAX_VALUE,h[3]||Number.MAX_VALUE),this.__raw=l,this.__normalized=u,this.__byteStride=o,0===this.__byteStride&&(this.__byteStride=this.__compositionType.getNumberOfComponents()*this.__componentType.getSizeInBytes()*this.__arrayLength);const m=this.getTypedArrayClass(this.__componentType);this.__typedArrayClass=m;const x=this.__byteStride-this.__compositionType.getNumberOfComponents()*this.__componentType.getSizeInBytes(),f=this.__raw.byteLength-this.__byteOffsetInRawArrayBufferOfBuffer,A=this.byteStride*this.__count-x;f<A&&console.error(`Requesting a data size that exceeds the remaining capacity of the buffer: ${this.bufferView.buffer.name}.\n        Exceeded Size: ${A-f}\n        this.__raw.byteLength: ${this.__raw.byteLength}\n        this.__byteOffsetInRawArrayBufferOfBuffer: ${this.byteOffsetInRawArrayBufferOfBuffer}\n        this.byteStride: ${this.byteStride}\n        this.__count: ${this.__count}\n        this.__raw.byteLength - this.__byteOffsetInRawArrayBufferOfBuffer: ${this.__raw.byteLength-this.__byteOffsetInRawArrayBufferOfBuffer}\n        this.byteStride * this.__count: ${this.byteStride*this.__count}\n        maxExceededSizeOnAoS: ${x}\n        `),this.__dataView=new DataView(this.__raw,this.__byteOffsetInRawArrayBufferOfBuffer,Math.min(this.__byteStride*this.__count,this.__raw.byteLength-this.__byteOffsetInRawArrayBufferOfBuffer)),this.__byteOffsetInRawArrayBufferOfBuffer%this.__componentType.getSizeInBytes()==0&&(this.__typedArray=new m(this.__raw,this.__byteOffsetInRawArrayBufferOfBuffer,this.__compositionType.getNumberOfComponents()*this.__count)),this.__dataViewGetter=this.__dataView[this.getDataViewGetter(this.__componentType)].bind(this.__dataView),this.__dataViewSetter=this.__dataView[this.getDataViewSetter(this.__componentType)].bind(this.__dataView)}getTypedArrayClass(e){switch(e){case i.r.Byte:return Int8Array;case i.r.UnsignedByte:return Uint8Array;case i.r.Short:return Int16Array;case i.r.UnsignedShort:return Uint16Array;case i.r.Int:return Int32Array;case i.r.UnsignedInt:return Uint32Array;case i.r.Float:return Float32Array;case i.r.Double:return Float64Array;default:return void console.error("Unexpected ComponentType!")}}getDataViewGetter(e){switch(e){case i.r.Byte:return"getInt8";case i.r.UnsignedByte:return"getUint8";case i.r.Short:return"getInt16";case i.r.UnsignedShort:return"getUint16";case i.r.Int:return"getInt32";case i.r.UnsignedInt:return"getUint32";case i.r.Float:return"getFloat32";case i.r.Double:return"getFloat64";default:return console.error("Unexpected ComponentType!"),"unknown"}}getDataViewSetter(e){switch(e){case i.r.Byte:return"setInt8";case i.r.UnsignedByte:return"setUint8";case i.r.Short:return"setInt16";case i.r.UnsignedShort:return"setUint16";case i.r.Int:return"setInt32";case i.r.UnsignedInt:return"setUint32";case i.r.Float:return"setFloat32";case i.r.Double:return"setFloat64";default:console.error("Unexpected ComponentType!")}}takeOne(){const e=this.__raw;this.__takenCount>=this.__count&&console.error("You are trying to allocate more than you have secured.");const t=new this.__typedArrayClass(e,this.__byteOffsetInRawArrayBufferOfBuffer+this.__byteStride*this.__takenCount,this.__compositionType.getNumberOfComponents()*this.__arrayLength);return this.__takenCount+=1,t._accessor=this,t._idx_of_accessor=this.__takenCount,t}get takenCount(){return this.takenCount}get numberOfComponents(){return this.__compositionType.getNumberOfComponents()}get componentSizeInBytes(){return this.__componentType.getSizeInBytes()}get elementSizeInBytes(){return this.numberOfComponents*this.componentSizeInBytes}get elementCount(){return this.__count}get byteLength(){return this.__byteStride*this.__count}get componentType(){return this.__componentType}get compositionType(){return this.__compositionType}getTypedArray(){return this.__bufferView.isAoS&&console.warn("Be careful. this reference bufferView is AoS(Array on Structure), it means Interleaved Data. So you can not access your data properly by this TypedArray."),this.__typedArray}get isAoS(){return!this.isSoA}get isSoA(){return this.byteStride===this.__compositionType.getNumberOfComponents()*this.__componentType.getSizeInBytes()}get byteStride(){return this.__byteStride}getScalar(e,{indicesAccessor:t,endian:n=!0}){let i=e;return t&&(i=t.getScalar(e,{})),this.__dataViewGetter(this.__byteStride*i,n)}getScalarAt(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;return n&&(a=n.getScalar(e,{})),this.__dataViewGetter(this.__byteStride*a+t,i)}getVec2AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n)]}getVec3AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n)]}getVec4AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n),this.__dataViewGetter(this.__byteStride*i+3*a,n)]}getMat3AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n),this.__dataViewGetter(this.__byteStride*i+3*a,n),this.__dataViewGetter(this.__byteStride*i+4*a,n),this.__dataViewGetter(this.__byteStride*i+5*a,n),this.__dataViewGetter(this.__byteStride*i+6*a,n),this.__dataViewGetter(this.__byteStride*i+7*a,n),this.__dataViewGetter(this.__byteStride*i+8*a,n)]}getMat4AsArray(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return[this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n),this.__dataViewGetter(this.__byteStride*i+3*a,n),this.__dataViewGetter(this.__byteStride*i+4*a,n),this.__dataViewGetter(this.__byteStride*i+5*a,n),this.__dataViewGetter(this.__byteStride*i+6*a,n),this.__dataViewGetter(this.__byteStride*i+7*a,n),this.__dataViewGetter(this.__byteStride*i+8*a,n),this.__dataViewGetter(this.__byteStride*i+9*a,n),this.__dataViewGetter(this.__byteStride*i+10*a,n),this.__dataViewGetter(this.__byteStride*i+11*a,n),this.__dataViewGetter(this.__byteStride*i+12*a,n),this.__dataViewGetter(this.__byteStride*i+13*a,n),this.__dataViewGetter(this.__byteStride*i+14*a,n),this.__dataViewGetter(this.__byteStride*i+15*a,n)]}getVec2(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return r.ZP.fromCopyArray2([this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n)])}getVec3(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return o.ZP.fromCopyArray([this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n)])}getVec4(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return s.ZP.fromCopyArray([this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n),this.__dataViewGetter(this.__byteStride*i+3*a,n)])}getMat3(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return new h.Z(this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n),this.__dataViewGetter(this.__byteStride*i+3*a,n),this.__dataViewGetter(this.__byteStride*i+4*a,n),this.__dataViewGetter(this.__byteStride*i+5*a,n),this.__dataViewGetter(this.__byteStride*i+6*a,n),this.__dataViewGetter(this.__byteStride*i+7*a,n),this.__dataViewGetter(this.__byteStride*i+8*a,n))}getMat4(e,{indicesAccessor:t,endian:n=!0}){let i=e;t&&(i=t.getScalar(e,{}));const a=this.componentSizeInBytes;return new d.Z(this.__dataViewGetter(this.__byteStride*i,n),this.__dataViewGetter(this.__byteStride*i+1*a,n),this.__dataViewGetter(this.__byteStride*i+2*a,n),this.__dataViewGetter(this.__byteStride*i+3*a,n),this.__dataViewGetter(this.__byteStride*i+4*a,n),this.__dataViewGetter(this.__byteStride*i+5*a,n),this.__dataViewGetter(this.__byteStride*i+6*a,n),this.__dataViewGetter(this.__byteStride*i+7*a,n),this.__dataViewGetter(this.__byteStride*i+8*a,n),this.__dataViewGetter(this.__byteStride*i+9*a,n),this.__dataViewGetter(this.__byteStride*i+10*a,n),this.__dataViewGetter(this.__byteStride*i+11*a,n),this.__dataViewGetter(this.__byteStride*i+12*a,n),this.__dataViewGetter(this.__byteStride*i+13*a,n),this.__dataViewGetter(this.__byteStride*i+14*a,n),this.__dataViewGetter(this.__byteStride*i+15*a,n))}getVec2To(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;return t.setComponents(this.__dataViewGetter(this.__byteStride*a,i),this.__dataViewGetter(this.__byteStride*a+1*r,i))}getVec3To(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;return t.setComponents(this.__dataViewGetter(this.__byteStride*a,i),this.__dataViewGetter(this.__byteStride*a+1*r,i),this.__dataViewGetter(this.__byteStride*a+2*r,i))}getVec4To(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;return t.setComponents(this.__dataViewGetter(this.__byteStride*a,i),this.__dataViewGetter(this.__byteStride*a+1*r,i),this.__dataViewGetter(this.__byteStride*a+2*r,i),this.__dataViewGetter(this.__byteStride*a+3*r,i))}getMat3To(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;return t.setComponents(this.__dataViewGetter(this.__byteStride*a,i),this.__dataViewGetter(this.__byteStride*a+1*r,i),this.__dataViewGetter(this.__byteStride*a+2*r,i),this.__dataViewGetter(this.__byteStride*a+3*r,i),this.__dataViewGetter(this.__byteStride*a+4*r,i),this.__dataViewGetter(this.__byteStride*a+5*r,i),this.__dataViewGetter(this.__byteStride*a+6*r,i),this.__dataViewGetter(this.__byteStride*a+7*r,i),this.__dataViewGetter(this.__byteStride*a+8*r,i))}getMat4To(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;return t.setComponents(this.__dataViewGetter(this.__byteStride*a,i),this.__dataViewGetter(this.__byteStride*a+1*r,i),this.__dataViewGetter(this.__byteStride*a+2*r,i),this.__dataViewGetter(this.__byteStride*a+3*r,i),this.__dataViewGetter(this.__byteStride*a+4*r,i),this.__dataViewGetter(this.__byteStride*a+5*r,i),this.__dataViewGetter(this.__byteStride*a+6*r,i),this.__dataViewGetter(this.__byteStride*a+7*r,i),this.__dataViewGetter(this.__byteStride*a+8*r,i),this.__dataViewGetter(this.__byteStride*a+9*r,i),this.__dataViewGetter(this.__byteStride*a+10*r,i),this.__dataViewGetter(this.__byteStride*a+11*r,i),this.__dataViewGetter(this.__byteStride*a+12*r,i),this.__dataViewGetter(this.__byteStride*a+13*r,i),this.__dataViewGetter(this.__byteStride*a+14*r,i),this.__dataViewGetter(this.__byteStride*a+15*r,i))}setScalar(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{})),this.__dataViewSetter(this.__byteStride*a,t,i),this.__isMinMixDirty=!0}setVec2(e,t,n,{indicesAccessor:i,endian:a=!0}){let r=e;i&&(r=i.getScalar(e,{}));const o=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*r,t,a),this.__dataViewSetter(this.__byteStride*r+1*o,n,a),this.__isMinMixDirty=!0}setVec3(e,t,n,i,{indicesAccessor:a,endian:r=!0}){let o=e;a&&(o=a.getScalar(e,{}));const s=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*o,t,r),this.__dataViewSetter(this.__byteStride*o+1*s,n,r),this.__dataViewSetter(this.__byteStride*o+2*s,i,r),this.__isMinMixDirty=!0}setVec4(e,t,n,i,a,{indicesAccessor:r,endian:o=!0}){let s=e;r&&(s=r.getScalar(e,{}));const l=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*s,t,o),this.__dataViewSetter(this.__byteStride*s+1*l,n,o),this.__dataViewSetter(this.__byteStride*s+2*l,i,o),this.__dataViewSetter(this.__byteStride*s+3*l,a,o),this.__isMinMixDirty=!0}setVec2AsVector(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*a,t.x,i),this.__dataViewSetter(this.__byteStride*a+1*r,t.y,i),this.__isMinMixDirty=!0}setVec3AsVector(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*a,t.x,i),this.__dataViewSetter(this.__byteStride*a+1*r,t.y,i),this.__dataViewSetter(this.__byteStride*a+2*r,t.z,i),this.__isMinMixDirty=!0}setVec4AsVector(e,t,{indicesAccessor:n,endian:i=!0}){let a=e;n&&(a=n.getScalar(e,{}));const r=this.componentSizeInBytes;this.__dataViewSetter(this.__byteStride*a,t.x,i),this.__dataViewSetter(this.__byteStride*a+1*r,t.y,i),this.__dataViewSetter(this.__byteStride*a+2*r,t.z,i),this.__dataViewSetter(this.__byteStride*a+3*r,t.w,i),this.__isMinMixDirty=!0}copyFromTypedArray(e){const t=this.numberOfComponents;for(let n=0;n<e.byteLength/this.componentSizeInBytes;n++){const i=Math.floor(n/t),a=i*t;switch(t){case 1:this.setScalar(i,e[a+0],{});break;case 2:this.setVec2(i,e[a+0],e[a+1],{});break;case 3:this.setVec3(i,e[a+0],e[a+1],e[a+2],{});break;case 4:this.setVec4(i,e[a+0],e[a+1],e[a+2],e[a+3],{});break;default:throw new Error("Other than vectors are currently not supported.")}}}setScalarAt(e,t,n,{indicesAccessor:i,endian:a=!0}){let r=e;i&&(r=i.getScalar(e,{})),this.__dataViewSetter(this.__byteStride*r+t,n,a),this.__isMinMixDirty=!0}setElementFromSameCompositionAccessor(e,t,n){const i=null!=n?n:e;1===this.compositionType.getNumberOfComponents()?this.setScalar(e,t.getScalar(i,{}),{}):2===this.compositionType.getNumberOfComponents()?this.setVec2AsVector(e,t.getVec2(i,{}),{}):3===this.compositionType.getNumberOfComponents()?this.setVec3AsVector(e,t.getVec3(i,{}),{}):4===this.compositionType.getNumberOfComponents()&&this.setVec4AsVector(e,t.getVec4(i,{}),{})}copyBuffer(e){new Uint8Array(this.__raw).set(new Uint8Array(e.__raw,e.__byteOffsetInRawArrayBufferOfBuffer),this.__byteOffsetInRawArrayBufferOfBuffer),this.__isMinMixDirty=!0}setElementFromAccessor(e,t,n){const i=null!=n?n:e;if(1===this.compositionType.getNumberOfComponents())1===t.compositionType.getNumberOfComponents()?this.setScalar(e,t.getScalar(i,{}),{}):2===t.compositionType.getNumberOfComponents()?this.setScalar(e,t.getVec2(i,{}).x,{}):3===t.compositionType.getNumberOfComponents()?this.setScalar(e,t.getVec3(i,{}).x,{}):4===t.compositionType.getNumberOfComponents()&&this.setScalar(e,t.getVec4(i,{}).x,{});else if(2===this.compositionType.getNumberOfComponents()){if(1===t.compositionType.getNumberOfComponents()){const n=t.getScalar(i,{});this.setVec2(e,n,0,{})}else if(2===t.compositionType.getNumberOfComponents())this.setVec2AsVector(e,t.getVec2(i,{}),{});else if(3===t.compositionType.getNumberOfComponents()){const n=t.getVec3(i,{});this.setVec2(e,n.x,n.y,{})}else if(4===t.compositionType.getNumberOfComponents()){const n=t.getVec4(i,{});this.setVec2(e,n.x,n.y,{})}}else if(3===this.compositionType.getNumberOfComponents()){if(1===t.compositionType.getNumberOfComponents()){const n=t.getScalar(i,{});this.setVec3(e,n,0,0,{})}else if(2===t.compositionType.getNumberOfComponents()){const n=t.getVec2(i,{});this.setVec3(e,n.x,n.y,0,{})}else if(3===t.compositionType.getNumberOfComponents()){const n=t.getVec3(i,{});this.setVec3AsVector(e,n,{})}else if(4===t.compositionType.getNumberOfComponents()){const n=t.getVec4(i,{});this.setVec3(e,n.x,n.y,n.z,{})}}else if(4===this.compositionType.getNumberOfComponents())if(1===t.compositionType.getNumberOfComponents()){const n=t.getScalar(i,{});this.setVec4(e,n,0,0,0,{})}else if(2===t.compositionType.getNumberOfComponents()){const n=t.getVec2(i,{});this.setVec4(e,n.x,n.y,0,0,{})}else if(3===t.compositionType.getNumberOfComponents()){const n=t.getVec3(i,{});this.setVec4(e,n.x,n.y,n.z,0,{})}else if(4===t.compositionType.getNumberOfComponents()){const n=t.getVec4(i,{});this.setVec4AsVector(e,n,{})}}addElementFromSameCompositionAccessor(e,t,n,i){const a=null!=i?i:e;1===this.compositionType.getNumberOfComponents()?this.setScalar(e,this.getScalar(e,{})+n*t.getScalar(a,{}),{}):2===this.compositionType.getNumberOfComponents()?this.setVec2AsVector(e,r.ZP.add(this.getVec2(e,{}),r.ZP.multiply(t.getVec2(a,{}),n)),{}):3===this.compositionType.getNumberOfComponents()?this.setVec3AsVector(e,o.ZP.add(this.getVec3(e,{}),o.ZP.multiply(t.getVec3(a,{}),n)),{}):4===this.compositionType.getNumberOfComponents()&&this.setVec4AsVector(e,s.ZP.add(this.getVec4(e,{}),s.ZP.multiply(t.getVec4(a,{}),n)),{})}get arrayBufferOfBufferView(){return this.__raw}get dataViewOfBufferView(){return this.__dataView}get byteOffsetInBufferView(){return this.__byteOffsetInRawArrayBufferOfBuffer-this.__bufferView.byteOffsetInRawArrayBufferOfBuffer}get byteOffsetInBuffer(){return this.__byteOffsetInRawArrayBufferOfBuffer-this.__bufferView.buffer.byteOffsetInRawArrayBuffer}get byteOffsetInRawArrayBufferOfBuffer(){return this.__byteOffsetInRawArrayBufferOfBuffer}get bufferView(){return this.__bufferView}get min(){const e=this.compositionType.getNumberOfComponents();return 4===e?[this.__min._v[0],this.__min._v[1],this.__min._v[2],this.__min._v[3]]:3===e?[this.__min._v[0],this.__min._v[1],this.__min._v[2]]:2===e?[this.__min._v[0],this.__min._v[1]]:[this.__min._v[0]]}get max(){const e=this.compositionType.getNumberOfComponents();return 4===e?[this.__max._v[0],this.__max._v[1],this.__max._v[2],this.__max._v[3]]:3===e?[this.__max._v[0],this.__max._v[1],this.__max._v[2]]:2===e?[this.__max._v[0],this.__max._v[1]]:[this.__max._v[0]]}get normalized(){return this.__normalized}calcMinMax(){const e=this.compositionType.getNumberOfComponents();if(4===e){this.__max.setComponents(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.__min.setComponents(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);const e=u.__tmpVector4_0;for(let t=0;t<this.elementCount;t++){this.getVec4To(t,e,{});for(let t=0;t<4;t++)this.__max._v[t]<e._v[t]&&(this.__max._v[t]=e._v[t]),e._v[t]<this.__min._v[t]&&(this.__min._v[t]=e._v[t])}}else if(3===e){this.__max.setComponents(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.__min.setComponents(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);const e=u.__tmpVector3_0;for(let t=0;t<this.elementCount;t++){this.getVec3To(t,e,{});for(let t=0;t<3;t++)this.__max._v[t]<e._v[t]&&(this.__max._v[t]=e._v[t]),e._v[t]<this.__min._v[t]&&(this.__min._v[t]=e._v[t])}}else if(2===e){this.__max.setComponents(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.__min.setComponents(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);const e=u.__tmpVector2_0;for(let t=0;t<this.elementCount;t++){this.getVec2To(t,e,{});for(let t=0;t<2;t++)this.__max._v[t]<e._v[t]&&(this.__max._v[t]=e._v[t]),e._v[t]<this.__min._v[t]&&(this.__min._v[t]=e._v[t])}}else if(1===e){this.__max.setComponents(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),this.__min.setComponents(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let e=0;e<this.elementCount;e++){const t=this.getScalar(e,{});this.__max._v[0]<t&&(this.__max._v[0]=t),t<this.__min._v[0]&&(this.__min._v[0]=t)}}this.__isMinMixDirty=!1}get isMinMaxDirty(){return this.__isMinMixDirty}get actualByteStride(){return 0===this.__byteStride?this.__compositionType.getNumberOfComponents()*this.__componentType.getSizeInBytes()*this.__arrayLength:this.__byteStride}}u.__tmpVector4_0=_.ZP.zero(),u.__tmpVector3_0=c.ZP.zero(),u.__tmpVector2_0=l.ZP.zero();class m{constructor({buffer:e,byteOffsetInBuffer:t,defaultByteStride:n,byteLength:i,raw:a}){this.__defaultByteStride=0,this.__takenByte=0,this.__takenAccessorCount=0,this.__accessors=[],this.__totalBytesUpToLastAccessor=0,this.__buffer=e,this.__byteOffsetInBuffer=t,this.__byteOffsetInRawArrayBufferOfBuffer=e.byteOffsetInRawArrayBuffer+t,this.__byteLength=i,this.__defaultByteStride=n,this.__raw=a}get defaultByteStride(){return this.__defaultByteStride}get byteLength(){return this.__byteLength}get byteOffsetInBuffer(){return this.__byteOffsetInRawArrayBufferOfBuffer-this.__buffer.byteOffsetInRawArrayBuffer}get byteOffsetInRawArrayBufferOfBuffer(){return this.__byteOffsetInRawArrayBufferOfBuffer}get buffer(){return this.__buffer}get isSoA(){return!this.isAoS}get isAoS(){for(const e of this.__accessors)if(e.isAoS)return!0;return!1}getUint8Array(){return new Uint8Array(this.__raw,this.__byteOffsetInRawArrayBufferOfBuffer,this.__byteLength)}takeAccessor({compositionType:e,componentType:t,count:n,byteStride:i=this.defaultByteStride,max:a,min:r,arrayLength:o=1,normalized:s=!1}){return this.__takeAccessorInner({compositionType:e,componentType:t,count:n,byteStride:i,max:a,min:r,normalized:s,arrayLength:o})}takeAccessorWithByteOffset({compositionType:e,componentType:t,count:n,byteOffsetInBufferView:i,byteStride:a=this.defaultByteStride,max:r,min:o,normalized:s=!1}){return this.__takeAccessorInnerWithByteOffset({compositionType:e,componentType:t,count:n,byteStride:a,byteOffsetInBufferView:i,max:r,min:o,normalized:s})}__takeAccessorInner({compositionType:e,componentType:t,count:n,byteStride:i,max:a,min:r,arrayLength:o,normalized:s}){const l=this.__takenByte;let c=i;0===c&&(c=e.getNumberOfComponents()*t.getSizeInBytes()*o);const _=new u({bufferView:this,byteOffsetInBufferView:l,compositionType:e,componentType:t,byteStride:i,count:n,raw:this.__raw,max:a,min:r,arrayLength:o,normalized:s});return this.__accessors.push(_),this.__takenByte+=c*n,this.__totalBytesUpToLastAccessor=this.__takenByte,_}__takeAccessorInnerWithByteOffset({compositionType:e,componentType:t,count:n,byteStride:i,byteOffsetInBufferView:a,max:r,min:o,normalized:s}){const l=new u({bufferView:this,byteOffsetInBufferView:a,compositionType:e,componentType:t,byteStride:i,count:n,raw:this.__raw,max:r,min:o,arrayLength:1,normalized:s});return this.__accessors.push(l),l}}var x=n(3449);class f{constructor({byteLength:e,buffer:t,name:n,byteAlign:i}){this.__byteLength=0,this.__byteOffset=0,this.__name="",this.__takenBytesIndex=0,this.__bufferViews=[],this.__name=n,this.__byteLength=e,this.__byteAlign=i,t instanceof Uint8Array?(this.__raw=t.buffer,this.__byteOffset=t.byteOffset):this.__raw=t}set name(e){this.__name=e}get name(){return this.__name}getArrayBuffer(){return this.__raw}__padding(e,t){const n=x.Z.calcPaddingBytes(e,t);return n>0&&console.info("Padding bytes added to takenBytesIndex."),n}takeBufferView({byteLengthToNeed:e,byteStride:t}){const n=this.__byteAlign,i=this.__padding(e,n),a=new m({buffer:this,byteOffsetInBuffer:this.__takenBytesIndex,defaultByteStride:t,byteLength:e+i,raw:this.__raw});return this.__takenBytesIndex+=e+i,this.__bufferViews.push(a),a}takeBufferViewWithByteOffset({byteLengthToNeed:e,byteStride:t,byteOffset:n}){const i=new m({buffer:this,byteOffsetInBuffer:n,defaultByteStride:t,byteLength:e,raw:this.__raw}),a=Uint8Array.BYTES_PER_ELEMENT*e+n;return this.__takenBytesIndex<a&&(this.__takenBytesIndex=a),this.__bufferViews.push(i),i}_addTakenByteIndex(e){this.__takenBytesIndex+=e}get byteLength(){return this.__byteLength}get takenSizeInByte(){return this.__takenBytesIndex}get byteOffsetInRawArrayBuffer(){return this.__byteOffset}getTypedArray(e,t,n,r=100){let o;const s=i.r.toTypedArray(n);return void 0===s&&console.warn("componentType is Invalid"),o=a.d.isArray(t)?new s(this.__raw,this.__byteOffset+4*e,r):new s(this.__raw,this.__byteOffset+4*e,1),o}}},3449:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{static isNode(){return void 0===window&&"undefined"!=typeof process&&!0}static btoa(e){if(i.isNode()){let t;return t=Buffer.isBuffer(e)?e:new Buffer(e.toString(),"binary"),t.toString("base64")}return btoa(e)}static atob(e){return i.isNode()?new Buffer(e,"base64").toString("binary"):atob(e)}static dataUriToArrayBuffer(e){const t=e.split(","),n=i.atob(t[1]),a=n.length,r=new ArrayBuffer(a),o=new Uint8Array(r);for(let e=0;e<a;e++)o[e]=n.charCodeAt(e);return r}static arrayBufferToString(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);{const t=new Uint8Array(e);return this.uint8ArrayToStringInner(t)}}static uint8ArrayToString(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):this.uint8ArrayToStringInner(e)}static stringToBase64(e){let t=null;return t=i.btoa(e),t}static base64ToArrayBuffer(e){const t=window.atob(e),n=t.length,i=new Uint8Array(n);for(let e=0;e<n;e++)i[e]=t.charCodeAt(e);return i.buffer}static UInt8ArrayToDataURL(e,t,n){const i=document.createElement("canvas");i.width=t,i.height=n;const a=i.getContext("2d"),r=a.createImageData(t,n);for(let i=0;i<r.data.length;i+=4)r.data[i+0]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+0],r.data[i+1]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+1],r.data[i+2]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+2],r.data[i+3]=e[(n-Math.floor(i/(4*t)))*(4*t)+i%(4*t)+3];return a.putImageData(r,0,0),i.remove(),i.toDataURL("image/png")}static loadResourceAsync(e,t,n,a){return new Promise(((r,o)=>{if(i.isNode());else{const i=new XMLHttpRequest;t?(i.onload=e=>{let a=null;a=t?i.response:i.responseText,n(r,a)},i.open("GET",e,!0),i.responseType="arraybuffer"):(i.onreadystatechange=()=>{if(4!==i.readyState||2!==Math.floor(i.status/100)&&0!==i.status)a&&a(o,i.status);else{let e=null;e=t?i.response:i.responseText,n(r,e)}},i.open("GET",e,!0)),i.send(null)}}))}static toCRC32(e){let t=0,n=0,a=0;const r=i.crc32table;t^=-1;for(let i=0,o=e.length;i<o;++i)a=255&(t^e.charCodeAt(i)),n="0x"+r[a],t=t>>>8^n;return(-1^t)>>>0}static accessBinaryAsImage(e,t,n,i){const a=this.takeBufferViewAsUint8Array(t,e,n);return this.accessArrayBufferAsImage(a,i)}static createBlobImageUriFromUint8Array(e,t){const n=new Blob([e],{type:t});return URL.createObjectURL(n)}static takeBufferViewAsUint8Array(e,t,n){var i;const a=e.bufferViews[t];let r=null!==(i=a.byteOffset)&&void 0!==i?i:0;const o=a.byteLength;let s=n;return n instanceof Uint8Array&&(s=n.buffer,r+=n.byteOffset),new Uint8Array(s,r,o)}static accessArrayBufferAsImage(e,t){const n=this.uint8ArrayToStringInner(new Uint8Array(e));return this.getImageType(t)+i.btoa(n)}static uint8ArrayToStringInner(e){const t=new Array(e.byteLength);for(let n=0;n<e.byteLength;n++)t[n]=e[n];const n=1024,i=Math.ceil(t.length/n);let a="";for(let e=0;e<i;e++)a+=String.fromCharCode.apply(this,t.slice(e*n,(e+1)*n));return a}static getImageType(e){let t=null;return t="image/jpeg"===e||"jpg"===e.toLowerCase()||"jpeg"===e.toLowerCase()?"data:image/jpeg;base64,":"image/png"==e||"png"===e.toLowerCase()?"data:image/png;base64,":"image/gif"==e||"gif"===e.toLowerCase()?"data:image/gif;base64,":"image/bmp"==e||"bmp"===e.toLowerCase()?"data:image/bmp;base64,":"data:image/unknown;base64,",t}static getMimeTypeFromExtension(e){let t=null;return t="jpg"===e.toLowerCase()||"jpeg"===e.toLowerCase()?"image/jpeg":"png"===e.toLowerCase()?"image/png":"gif"===e.toLowerCase()?"image/gif":"bmp"===e.toLowerCase()?"image/bmp":"image/unknown",t}static getExtension(e){const t=e.split(".");return t[t.length-1]}static createUint8ArrayFromBufferViewInfo(e,t,n){var i;const a=e.bufferViews[t];let r=null!==(i=a.byteOffset)&&void 0!==i?i:0;const o=a.byteLength;let s=n;return n instanceof Uint8Array&&(s=n.buffer,r+=n.byteOffset),new Uint8Array(s,r,o)}static createImageFromUri(e,t){return new Promise((n=>{const a=new Image;if(a.crossOrigin="Anonymous",e.match(/^blob:/)||e.match(/^data:/))a.onload=()=>{n(a)},a.src=e;else{const r=(e,a)=>{const r=new Uint8Array(a),o=i.createBlobImageUriFromUint8Array(r,t);e.onload=()=>{n(e)},e.src=o};(()=>{const t=new XMLHttpRequest;var n;t.onreadystatechange=(n=a,function(){4==t.readyState&&200==t.status&&r(n,t.response)}),t.open("GET",e),t.responseType="arraybuffer",t.send()})()}}))}static createDefaultGltfOptions(){return{files:{},loaderExtension:void 0,defaultMaterialHelperName:void 0,defaultMaterialHelperArgumentArray:[],statesOfElements:[{targets:[],states:{enable:[],functions:{}},isTransparent:!0,opacity:1,isTextureImageToLoadPreMultipliedAlpha:!1}],tangentCalculationMode:1,isPreComputeForRayCastPickingEnable:!1,extendedJson:void 0}}static fetchArrayBuffer(e){return new Promise((t=>{fetch(e,{mode:"cors"}).then((e=>{e.arrayBuffer().then((e=>{t(e)}))})).catch((e=>{throw new Error("import error: "+e)}))}))}static getResizedCanvas(e,t){const n=document.createElement("canvas"),i=this.getNearestPowerOfTwo(e.width),a=this.getNearestPowerOfTwo(e.height),r=a/i;let o=0,s=0;return i>a?(o=Math.min(i,t),s=o*r):(s=Math.min(a,t),o=s/r),n.width=o,n.height=s,n.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,o,s),[n,o,s]}static detectTransparentPixelExistence(e,t=1){const n=e.width,i=e.height;let a,r;e instanceof ImageData?r=e:e instanceof HTMLImageElement?(a=document.createElement("canvas").getContext("2d"),a.drawImage(e,0,0),r=a.getImageData(0,0,n,i)):(a=e.getContext("2d"),a.drawImage(e,0,0),r=a.getImageData(0,0,n,i));for(let e=0;e<i;e++)for(let i=0;i<n;i++)if(r.data[4*(i+e*n)+3]<t)return!0;return!1}static getNearestPowerOfTwo(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))}static calcPaddingBytes(e,t){return e%t!=0?t-e%t:0}static normalizedInt8ArrayToFloat32Array(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;n++)t[n]=Math.max(e[n]/127,-1);return t}static normalizedUint8ArrayToFloat32Array(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n]/255;return t}static normalizedInt16ArrayToFloat32Array(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;n++)t[n]=Math.max(e[n]/32767,-1);return t}static normalizedUint16ArrayToFloat32Array(e){const t=new Float32Array(e.length);for(let n=0;n<e.length;n++)t[n]=e[n]/65535;return t}}i.crc32table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ")},2343:(e,t,n)=>{"use strict";n.d(t,{Jx:()=>i,li:()=>a,cu:()=>r,bm:()=>o});class i{constructor({index:e,str:t,noCheckStrUnique:n}){if(null==i.__indices.get(this.constructor)&&i.__indices.set(this.constructor,[]),null==i.__strings.get(this.constructor)&&i.__strings.set(this.constructor,[]),-1!==i.__indices.get(this.constructor).indexOf(e))throw new Error("Dont use duplicate index.");if(!0!==n&&-1!==i.__strings.get(this.constructor).indexOf(t))throw new Error("Dont use duplicate str.");this.index=e,this.str=t,this.symbol=Symbol(t),i.__indices.get(this.constructor).push(e),i.__strings.get(this.constructor).push(t)}toString(){return this.str}toJSON(){return this.index}}function a({typeList:e,index:t}){const n=e.find((e=>e.index===t));if(n)return n}function r({typeList:e,str:t}){const n=e.find((e=>e.str.toLowerCase()===t.toLowerCase()));if(n)return n}function o({typeList:e,str:t}){const n=e.find((e=>e.str===t));if(n)return n}i.__indices=new Map,i.__strings=new Map},4690:(e,t,n)=>{"use strict";n.d(t,{Is:()=>o});const i={not:e=>function(){return e.apply(null,[...arguments])},all:e=>function(){return Array.isArray(arguments[0])?arguments[0].every(e):[...arguments].every(e)},any:e=>function(){return Array.isArray(arguments[0])?arguments[0].some(e):[...arguments].some(e)}},a={defined:(e,...t)=>void 0!==e,undefined:(e,...t)=>void 0===e,null:(e,...t)=>null===e,exist:(e,...t)=>null!=e,function:(e,...t)=>"function"==typeof e,true:(e,...t)=>!0===e,false:(e,...t)=>!1===e},r={defined:(e,...t)=>void 0===e,undefined:(e,...t)=>void 0!==e,null:(e,...t)=>null!==e,exist:(e,...t)=>null==e,function:(e,...t)=>"function"!=typeof e,true:(e,...t)=>!0!==e,false:(e,...t)=>!1!==e};for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)){a[e]={};for(const t in a)Object.prototype.hasOwnProperty.call(a,t)&&(a[e][t]="not"===e?i[e](r[t]):i[e](a[t]))}const o=a},6098:(e,t,n)=>{"use strict";n.d(t,{kS:()=>r,wv:()=>o,vV:()=>s,tS:()=>l,Qj:()=>c,Kf:()=>_});const i=function(){const e=["iPod","iPad","iPhone","Android"];for(let t=0;t<e.length;t++)if(navigator.userAgent.indexOf(e[t])>0)return!0;return a()},a=function(){return navigator.userAgent.indexOf("Macintosh")>-1&&"ontouchend"in document},r=({value:e,defaultValue:t})=>null==e?t:e,o=({value:e,compensation:t})=>null==e?t():e,s=e=>null==e?[]:e,l=(e,t)=>e>t?{result:!0,greater:e,less:t}:{result:!1,greater:t,less:e},c=(e,t)=>e<t?{result:!0,greater:t,less:e}:{result:!1,greater:e,less:t},_=Object.freeze({isMobile:i,isIOS:function(){const e=["iPod","iPad","iPhone"];for(let t=0;t<e.length;t++)if(navigator.userAgent.indexOf(e[t])>0)return!0;return a()},preventDefaultForDesktopOnly:function(e){i()||e.preventDefault()},isObject:function(e){return e instanceof Object&&!(e instanceof Array)},fillTemplate:function(e,t){return new Function("return `"+e+"`;").call(t)},isNode:function(){return"undefined"!=typeof process&&!0},concatArrayBuffers:function(e,t,n,i){let a,r=0;for(let e=0;e<t.length;++e)r+=t[e];a=null!=i?new Uint8Array(i):new Uint8Array(r);const o=e=>null!=i&&s+e>i?s+e-i:0;let s=0;const l=(t,i)=>{const r=o(t);return r?(a.set(new Uint8Array(e[i],n[i],r),s),s+=r,!0):(a.set(new Uint8Array(e[i],n[i],t),s),s+=t,!1)},c=e=>{const t=o(e);return t?(a.set(new Uint8Array(t),s),s+=t,!0):(a.set(new Uint8Array(e),s),s+=e,!1)};for(let i=0;i<e.length;++i){const r=t[i]+n[i]-e[i].byteLength,o=r>0?r:0;if(l(t[i]-o,i))return a.buffer;if(o>0&&c(o))return a.buffer}return null!=i&&s<i&&a.set(new Uint8Array(i-s),s),a.buffer},concatArrayBuffers2:({finalSize:e,srcs:t,srcsOffset:n,srcsCopySize:i})=>{const a=new Uint8Array(new ArrayBuffer(e));let r=0;for(const e in t){const o=t[e],s=new Uint8Array(o,n[e],i[e]);a.set(s,r),r+=i[e]}return a.buffer},addLineNumberToCode:e=>{const t=e.split(/\r\n|\r|\n/);let n="";for(let e=0;e<t.length;e++){const i=e+1;let a=" : ";i<10?a="  : ":i>=100&&(a=": "),n+=i+a+t[e]+"\n"}return n}})},4252:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{constructor(e,t){this.name="",this.__callbackObj={promiseAllNum:0,resolvedNum:0,rejectedNum:0,pendingNum:0,processedPromises:[]},this.__promise=e instanceof Promise?e:new Promise(e),this.__callback=t}static resolve(e){if(e instanceof Promise)return new i(e);if(e instanceof i)return e;if(null!=e.then){const t=new i(((t,n)=>{t(e)}));return t.then=e.then,t}return new i(((t,n)=>{t(e)}))}static all(e){return new i(Promise.all(e))}static allWithProgressCallback(e,t){const n=[],a={promiseAllNum:e.length,resolvedNum:0,rejectedNum:0,pendingNum:e.length,processedPromises:[]};for(const r of e){const e=i.resolve(r);e.__callback=t,e.__callbackObj=a,n.push(e)}return new i(Promise.all(e))}static race(e){return new i(Promise.race(e))}then(e,t){return new i(this.__promise.then((t=>{0!==this.__callbackObj.promiseAllNum&&-1===this.__callbackObj.processedPromises.indexOf(this)&&(this.__callbackObj.pendingNum--,this.__callbackObj.resolvedNum++,this.__callbackObj.processedPromises.push(this)),this.__callback&&this.__callback(this.__callbackObj),e&&e(t)}),t))}catch(e){return new i(this.__promise.catch(e))}finally(e){this.__promise.finally(e)}static reject(e){return new i(Promise.reject(e))}}},3581:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{static _processBegin(){0===i.__currentProcessBeginTime&&(i.__systemStartTime=performance.now()),i.__currentProcessBeginTime=performance.now()}static _processEnd(){i.__lastProcessEndTime=performance.now(),i.__lastTickTimeInterval=i.__lastProcessEndTime-i.__currentProcessBeginTime}static get timeFromSystemStart(){return i.__systemStartTime-performance.now()/1e3}static get lastTickTimeInterval(){return i.__lastTickTimeInterval/1e3}}i.__currentProcessBeginTime=0,i.__lastProcessEndTime=0,i.__lastTickTimeInterval=0,i.__systemStartTime=0},7987:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(2251);class a{static getWebGLResourceRepository(){return i.Z.getInstance().getModule("webgl").WebGLResourceRepository.getInstance()}}a.InvalidCGAPIResourceUid=-1},2251:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{constructor(){this.__modules=new Map}async loadModule(e,t){let i;return"webgl"===e.toLowerCase()?i=await Promise.resolve().then(n.bind(n,8511)):"effekseer"===e.toLowerCase()?(i=await Promise.resolve().then(n.bind(n,792)),i.default.EffekseerComponent.wasmModuleUri=null==t?void 0:t.wasm):"sparkgear"===e.toLowerCase()?i=await Promise.resolve().then(n.bind(n,4098)):"pbr"===e.toLowerCase()?i=await Promise.resolve().then(n.bind(n,5649)):"xr"===e.toLowerCase()&&(i=await Promise.resolve().then(n.bind(n,9227))),this.__modules.set(e,i),null==i?void 0:i.default}getModule(e){var t;return null===(t=this.__modules.get(e))||void 0===t?void 0:t.default}static getInstance(){return this.__instance||(this.__instance=new i),this.__instance}}},3648:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var i=n(4507),a=n(2404),r=n(7683),o=n(2251),s=n(7987),l=n(9721),c=n(5850),_=n(1350),h=n(1784),d=n(9286),u=n(7348),m=n(657),x=n(5333),f=n(2471),A=n(9646),p=n(3581),g=n(8430),v=n(6098),y=n(4690);class I{constructor(){this.__componentRepository=a.Z.getInstance(),this.__entityRepository=_.Z.getInstance(),this.__processApproach=r.V.None,this.__webglResourceRepository=s.Z.getWebGLResourceRepository(),this.__renderPassTickCount=0,this.__animationFrameId=-1,this.__args=[]}startRenderLoop(e,...t){this.__renderLoopFunc=e,this.__args=t;const n=this.__getAnimationFrameObject();this.__animationFrameId=n.requestAnimationFrame(((n,i)=>{const a=o.Z.getInstance().getModule("xr"),r=null==a?void 0:a.WebXRSystem.getInstance();if(y.Is.exist(a)){let e;r.isReadyForWebXR?r._preRender(n,i):(e=a.WebVRSystem.getInstance(),e.isReadyForWebVR&&e.preRender())}if(e.apply(e,[n,...t]),y.Is.exist(a))if(r.isReadyForWebXR)r._postRender();else{const e=a.WebVRSystem.getInstance();e.isReadyForWebVR&&e.postRender()}this.startRenderLoop(e,...t)}))}__getAnimationFrameObject(){let e=window;const t=o.Z.getInstance().getModule("xr");if(y.Is.exist(t)){const n=t.WebVRSystem.getInstance(),i=t.WebXRSystem.getInstance();if(i.requestedToEnterWebXR?e=i.xrSession:n.isWebVRMode&&(e=n.vrDisplay),y.Is.not.exist(e))return window}return e}stopRenderLoop(){this.__getAnimationFrameObject().cancelAnimationFrame(this.__animationFrameId),this.__animationFrameId=-1}restartRenderLoop(){null!=this.__renderLoopFunc&&this.startRenderLoop(this.__renderLoopFunc,0,this.__args)}process(e){if(this.__processApproach===r.V.None)throw new Error("Choose a process approach first.");if(p.Z._processBegin(),h.Z.main===l.Z.InvalidObjectUID){const e=this.__entityRepository.createEntity([m.Z,x.Z,h.Z]);e.getTransform().translate=f.ZP.fromCopyArray([0,0,1]),e.getCamera().type=A.i.Orthographic,e.getCamera().zNear=.1,e.getCamera().zFar=1e4;const t=this.__webglResourceRepository.currentWebGLContextWrapper;e.getCamera().xMag=t.width/t.height,e.getCamera().yMag=1}const t=s.Z.getWebGLResourceRepository(),n=o.Z.getInstance().getModule("xr"),_=null==n?void 0:n.WebXRSystem.getInstance();for(const n of l.Z._processStages){const r="common_"+n.methodName,o=this.__componentRepository.getComponentTIDs();for(const s of o)if(n===i.I.Render)for(const o of e){let e=1;s===c.Z.componentTID&&(e=o.renderPasses.length);for(let l=0;l<e;l++){const e=o.renderPasses[l];if(e.doPreRender(),t.switchDepthTest(e.isDepthTest),s===c.Z.componentTID&&n===i.I.Render){if((null==_?void 0:_.isWebXRMode)&&e.isOutputForVr){const e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();null==e||e.bindFramebuffer(e.FRAMEBUFFER,_.framebuffer)}else this.__webglResourceRepository.bindFramebuffer(e.getFramebuffer()),this.__webglResourceRepository.setDrawTargets(e.getFramebuffer());(null==_?void 0:_.isWebXRMode)&&e.isVrRendering||this.__webglResourceRepository.setViewport(e.getViewport()),this.__webglResourceRepository.clearFrameBuffer(e)}const h=a.Z.getComponentClass(s);h.updateComponentsOfEachProcessStage(h,n,this.__componentRepository,e);const d=h[r];d&&d({processApproach:this.__processApproach,renderPass:e,processStage:n,renderPassTickCount:this.__renderPassTickCount}),h.process({componentType:h,processStage:n,processApproach:this.__processApproach,componentRepository:this.__componentRepository,strategy:this.__webglStrategy,renderPass:e,renderPassTickCount:this.__renderPassTickCount}),this.__renderPassTickCount++,n===i.I.Render&&e.getResolveFramebuffer()&&e.copyFramebufferToResolveFramebuffer()}}else{const e=a.Z.getComponentClass(s);e.updateComponentsOfEachProcessStage(e,n,this.__componentRepository);const t=e[r];t&&t({processApproach:this.__processApproach,renderPass:void 0,processStage:n,renderPassTickCount:this.__renderPassTickCount}),e.process({componentType:e,processStage:n,processApproach:this.__processApproach,componentRepository:this.__componentRepository,strategy:this.__webglStrategy,renderPass:void 0,renderPassTickCount:this.__renderPassTickCount})}}p.Z._processEnd()}setProcessApproachAndCanvas(e,t,n=1,i={},a=!0,o=!0){const l=s.Z.getWebGLResourceRepository();d.Z.createInstanceIfNotCreated(.125*n,.0625*n,.9375*n),u.Z.getInstance().initialize(e);const c=l.generateWebGLContext(t,i,e.webGLVersion,!0,a,o);return l.switchDepthTest(!0),this.__processApproach=e,g.Z.currentProcessApproach=e,a&&v.Kf.isMobile()&&r.V.isUniformApproach(e)&&alert("Use the FastestWebGL1/FastestWebGL2 as the argument of setProcessApproachAndCanvas method for this device."),t.addEventListener("webglcontextlost",(e=>{e.preventDefault(),this.stopRenderLoop(),console.error("WebGL context lost occurred.")}).bind(this)),t.addEventListener("webglcontextrestored",(()=>{console.error("WebGL context restored."),this.restartRenderLoop()})),c}get processApproach(){return this.__processApproach}static getInstance(){return this.__instance||(this.__instance=new I),this.__instance}}},8430:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={currentProcessApproach:n(7683).V.None}},7290:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var i=n(9002),a=n(9216),r=n(3999),o=n(5981),s=n(9849),l=n(810),c=n(4690);class _ extends i.Z{constructor(){super(),this.__width=0,this.__height=0,this.__level=0,this.__internalFormat=a.V.RGBA,this.__format=a.V.RGBA,this.__type=r.r.UnsignedByte,this.__magFilter=o.d.Linear,this.__minFilter=o.d.Linear,this.__wrapS=o.d.ClampToEdge,this.__wrapT=o.d.ClampToEdge,this.__hasTransparentPixels=!1,this.cgApiResourceUid=-1,this.__isTextureReady=!1,this.__startedToLoad=!1,this.__name="untitled",this.__textureUid=++_.__textureUidCount}get textureUID(){return this.__textureUid}get width(){return this.__width}set width(e){this.__width=e}get height(){return this.__height}set height(e){this.__height=e}get isTextureReady(){return this.__isTextureReady}get startedToLoad(){return this.__startedToLoad}get htmlImageElement(){return this.__htmlImageElement}get htmlCanvasElement(){const e=document.createElement("canvas"),t=null==e?void 0:e.getContext("2d");return this.__htmlCanvasElement=e,c.Is.exist(t)&&c.Is.exist(this.__htmlImageElement)&&(e.width=this.__htmlImageElement.width,e.height=this.__htmlImageElement.height,t.drawImage(this.__htmlImageElement,0,0,this.__htmlImageElement.width,this.__htmlImageElement.height)),this.__htmlCanvasElement}get uri(){return this.__uri}static getRhodoniteTexture(e){return this.__textureMap.get(e)}set name(e){this.__name=e}get name(){return this.__name}getImageData(e,t,n,i){return void 0===this.__canvasContext&&this.createInternalCanvasContext(),this.__canvasContext.getImageData(e,t,n,i)}getPixelAs(e,t,n){const i=this.getImageData(e,t,1,1).data;return n.compositionType===l.d.Vec4?new n(new Float32Array([i[0],i[1],i[2],i[3]])):new n(new Float32Array([i[0],i[1],i[2]]))}getPixelAsArray(e,t){return this.getImageData(e,t,1,1).data}setPixel(e,t,n){const i=this.getImageData(e,t,1,1),a=i.data,r=n.constructor.compositionType.getNumberOfComponents();for(let e=0;e<r;e++)a[e]=n.at(e);this.__canvasContext.putImageData(i,e,t)}setPixelAtChannel(e,t,n,i){const a=this.getImageData(e,t,1,1);a.data[n]=i,this.__canvasContext.putImageData(a,e,t)}get isTransparent(){return this.__hasTransparentPixels}createInternalCanvasContext(){let e;null!=this.__htmlCanvasElement?e=this.__htmlCanvasElement:(e=document.createElement("canvas"),e.width=this.width,e.height=this.height),this.__htmlCanvasElement=e,this.__canvasContext=e.getContext("2d")}getTextureDataFloat(e){const t=this.getImageData(0,0,this.width,this.height),n=new s.Z(this.width,this.height,e),i=t.data;for(let t=0;t<this.height;t++)for(let a=0;a<this.width;a++)for(let r=0;r<e;r++)n.setPixelAtChannel(a,t,r,i[t*this.width*4+4*a+r]/255);return n}}_.InvalidTextureUid=-1,_.__textureUidCount=_.InvalidTextureUid,_.__textureMap=new Map},2858:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var i=n(7290),a=n(1986),r=n(7987),o=n(5981);class s extends i.Z{constructor(){super(),this.mipmapLevelNumber=1,this.hdriFormat=a.c.LDR_SRGB,this.isNamePosNeg=!1}async loadTextureImages(){this.__startedToLoad=!0;const e=r.Z.getWebGLResourceRepository();this.cgApiResourceUid=await e.createCubeTextureFromFiles(this.baseUriToLoad,this.mipmapLevelNumber,this.isNamePosNeg,this.hdriFormat),this.__isTextureReady=!0}loadTextureImagesAsync(){this.__startedToLoad=!0,r.Z.getWebGLResourceRepository().createCubeTextureFromFiles(this.baseUriToLoad,this.mipmapLevelNumber,this.isNamePosNeg,this.hdriFormat).then((e=>{this.cgApiResourceUid=e})).then((()=>{this.__isTextureReady=!0}))}loadTextureImagesFromBasis(e,{magFilter:t=o.d.Linear,minFilter:n=o.d.LinearMipmapLinear,wrapS:i=o.d.Repeat,wrapT:a=o.d.Repeat}={}){this.__startedToLoad=!0,"undefined"==typeof BASIS&&console.error("Failed to call BASIS() function. Please check to import basis_transcoder.js."),BASIS().then((o=>{const{initializeBasis:s}=o;s();const l=new(0,o.BasisFile)(e);if(!l.startTranscoding())return console.error("failed to start transcoding."),l.close(),void l.delete();const c=r.Z.getWebGLResourceRepository().createCubeTextureFromBasis(l,{magFilter:t,minFilter:n,wrapS:i,wrapT:a});this.cgApiResourceUid=c,this.__isTextureReady=!0,l.close(),l.delete()}))}load1x1Texture(e="rgba(0,0,0,1)"){const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,1,1);const i=r.Z.getWebGLResourceRepository();this.cgApiResourceUid=i.createCubeTexture(1,[{posX:t,negX:t,posY:t,negY:t,posZ:t,negZ:t}],1,1),this.__isTextureReady=!0}generateTextureFromTypedArrays(e,t,n){const a=r.Z.getWebGLResourceRepository();this.cgApiResourceUid=a.createCubeTexture(e.length,e,t,n),this.__isTextureReady=!0,this.__startedToLoad=!0,i.Z.__textureMap.set(this.cgApiResourceUid,this)}importWebGLTextureDirectly(e,t=0,n=0){this.__width=t,this.__height=n;const a=r.Z.getWebGLResourceRepository().setWebGLTextureDirectly(e);this.cgApiResourceUid=a,this.__startedToLoad=!0,this.__isTextureReady=!0,i.Z.__textureMap.set(a,this)}}},4392:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var i=n(7290),a=n(5981),r=n(9216),o=n(3999),s=n(7987),l=n(7192);class c extends i.Z{constructor(){super()}create({width:e,height:t,level:n=0,internalFormat:i=r.V.RGBA,format:s=r.V.RGBA,type:l=o.r.UnsignedByte,magFilter:c=a.d.Linear,minFilter:_=a.d.Linear,wrapS:h=a.d.ClampToEdge,wrapT:d=a.d.ClampToEdge}){this.__width=e,this.__height=t,this.__level=n,this.__internalFormat=i,this.__format=s,this.__type=l,this.__magFilter=c,this.__minFilter=_,this.__wrapS=h,this.__wrapT=d,this.__createRenderTargetTexture()}set _fbo(e){this.__fbo=e}get fbo(){return this.__fbo}__createRenderTargetTexture(){const e=s.Z.getWebGLResourceRepository().createRenderTargetTexture({width:this.__width,height:this.__height,level:this.__level,internalFormat:this.__internalFormat,format:this.__format,type:this.__type,magFilter:this.__magFilter,minFilter:this.__minFilter,wrapS:this.__wrapS,wrapT:this.__wrapT});this.cgApiResourceUid=e,i.Z.__textureMap.set(e,this)}resize(e,t){this.destroy3DAPIResources(),this.__width=e,this.__height=t,this.__createRenderTargetTexture()}destroy3DAPIResources(){return i.Z.__textureMap.delete(this.cgApiResourceUid),s.Z.getWebGLResourceRepository().deleteTexture(this.cgApiResourceUid),this.cgApiResourceUid=s.Z.InvalidCGAPIResourceUid,!0}getTexturePixelData(){const e=s.Z.getWebGLResourceRepository(),t=e.currentWebGLContextWrapper.getRawContext(),n=e.getWebGLResource(this.__fbo.framebufferUID);t.bindFramebuffer(t.FRAMEBUFFER,n);const i=new Uint8Array(this.width*this.height*4);return null!=t.readBuffer&&t.readBuffer(36064+this.__fbo.whichColorAttachment(this)),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,i),t.bindFramebuffer(t.FRAMEBUFFER,null),i}getPixelValueAt(e,t,n){let i=n;return i||(i=this.getTexturePixelData()),l.ZP.fromCopyArray([i[4*(t*this.width+e)+0],i[4*(t*this.width+e)+1],i[4*(t*this.width+e)+2],i[4*(t*this.width+e)+3]])}}},2651:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var i=n(9216),a=n(3999),r=n(5981),o=n(7290),s=n(7987),l=n(346),c=n(3449);new Uint8Array([0]);const _=[171,75,84,88,32,50,48,187,13,10,26,10];var h,d,u,m,x,f,A,p,g;(g=h||(h={}))[g.NONE=0]="NONE",g[g.BASISLZ=1]="BASISLZ",g[g.ZSTD=2]="ZSTD",g[g.ZLIB=3]="ZLIB",function(e){e[e.BASICFORMAT=0]="BASICFORMAT"}(d||(d={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.ETC1S=163]="ETC1S",e[e.UASTC=166]="UASTC"}(u||(u={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.SRGB=1]="SRGB"}(m||(m={})),function(e){e[e.UNSPECIFIED=0]="UNSPECIFIED",e[e.LINEAR=1]="LINEAR",e[e.SRGB=2]="SRGB",e[e.ITU=3]="ITU",e[e.NTSC=4]="NTSC",e[e.SLOG=5]="SLOG",e[e.SLOG2=6]="SLOG2"}(x||(x={})),function(e){e[e.ALPHA_STRAIGHT=0]="ALPHA_STRAIGHT",e[e.ALPHA_PREMULTIPLIED=1]="ALPHA_PREMULTIPLIED"}(f||(f={})),function(e){e[e.RGB=0]="RGB",e[e.RRR=3]="RRR",e[e.GGG=4]="GGG",e[e.AAA=15]="AAA"}(A||(A={})),function(e){e[e.RGB=0]="RGB",e[e.RGBA=3]="RGBA",e[e.RRR=4]="RRR",e[e.RRRG=5]="RRRG"}(p||(p={}));class v{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=h.NONE,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:d.BASICFORMAT,versionNumber:2,descriptorBlockSize:40,colorModel:u.UNSPECIFIED,colorPrimaries:m.SRGB,transferFunction:m.SRGB,flags:f.ALPHA_STRAIGHT,texelBlockDimension:{x:4,y:4,z:1,w:1},bytesPlane:[],samples:[]}],this.keyValue={},this.globalData=null}}class y{constructor(e,t,n,i){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=i,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,i)}}function I(e){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(e):Buffer.from(e).toString("utf8")}var b=n(1715);let T,S,E;const C={env:{emscripten_notify_memory_growth:function(e){E=new Uint8Array(S.exports.memory.buffer)}}};class w{init(){return T||(T="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+D).then((e=>e.arrayBuffer())).then((e=>WebAssembly.instantiate(e,C))).then(this._init):WebAssembly.instantiate(Buffer.from(D,"base64"),C).then(this._init),T)}_init(e){S=e.instance,C.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!S)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,i=S.exports.malloc(n);E.set(e,i),t=t||Number(S.exports.ZSTD_findDecompressedSize(i,n));const a=S.exports.malloc(t),r=S.exports.ZSTD_decompress(a,t,i,n),o=E.slice(a,a+r);return S.exports.free(i),S.exports.free(a),o}}const D="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQh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ASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY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wOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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",N="ETC1_RGB";class B{constructor(){"undefined"==typeof MSC_TRANSCODER&&console.error("Failed to call MSC_TRANSCODER() function. Please check to import msc_basis_transcoder.js."),this.__mscTranscoderPromise=this.__loadMSCTranscoder()}static getInstance(){return this.__instance||(this.__instance=new B),this.__instance}transcode(e){const t=this.__parse(e);if(t.pixelDepth>0)throw new Error("Only 2D textures are currently supported");if(t.layerCount>1)throw new Error("Array textures are not currently supported");if(t.faceCount>1)throw new Error("Cube textures are not currently supported");return t.supercompressionScheme===h.ZSTD?(null==B.__zstdDecoder&&(B.__zstdDecoder=new w),B.__zstdDecoder.init().then((()=>this.__mscTranscoderPromise.then((()=>this.__transcodeData(t)))))):this.__mscTranscoderPromise.then((()=>this.__transcodeData(t)))}__loadMSCTranscoder(){return new Promise((e=>{B.__mscTranscoderModule&&e(),MSC_TRANSCODER().then((t=>{t.initTranscoders(),B.__mscTranscoderModule=t,e()}))}))}__getDeviceDependentParameters(e){const t=s.Z.getWebGLResourceRepository().currentWebGLContextWrapper,n=t.webgl2ExtCTAstc||t.webgl1ExtCTAstc,i=t.webgl2ExtCTBptc||t.webgl1ExtCTBptc,a=t.webgl2ExtCTS3tc||t.webgl1ExtCTS3tc,r=t.webgl2ExtCTPvrtc||t.webgl1ExtCTPvrtc,o=t.webgl2ExtCTEtc||t.webgl1ExtCTEtc,l=t.webgl2ExtCTEtc1||t.webgl1ExtCTEtc1;let c,_;return n?(c="ASTC_4x4_RGBA",_=b.b.ASTC_RGBA_4x4):i?(c="BC7_RGBA",_=b.b.BPTC_RGBA):a?e?(c="BC3_RGBA",_=b.b.S3TC_RGBA_DXT5):(c="BC1_RGB",_=b.b.S3TC_RGB_DXT1):r?e?(c="PVRTC1_4_RGBA",_=b.b.PVRTC_RGBA_4BPPV1):(c="PVRTC1_4_RGB",_=b.b.PVRTC_RGB_4BPPV1):o?e?(c="ETC2_RGBA",_=b.b.ETC2_RGBA8_EAC):(c=N,_=b.b.ETC2_RGB8):l?(c=N,_=b.b.ETC1_RGB):(c="RGBA32",_=b.b.RGBA8_EXT),{transcodeTargetStr:c,compressionTextureType:_}}__parse(e){return function(e){const t=new Uint8Array(e.buffer,e.byteOffset,_.length);if(t[0]!==_[0]||t[1]!==_[1]||t[2]!==_[2]||t[3]!==_[3]||t[4]!==_[4]||t[5]!==_[5]||t[6]!==_[6]||t[7]!==_[7]||t[8]!==_[8]||t[9]!==_[9]||t[10]!==_[10]||t[11]!==_[11])throw new Error("Missing KTX 2.0 identifier.");const n=new v,i=17*Uint32Array.BYTES_PER_ELEMENT,a=new y(e,_.length,i,!0);n.vkFormat=a._nextUint32(),n.typeSize=a._nextUint32(),n.pixelWidth=a._nextUint32(),n.pixelHeight=a._nextUint32(),n.pixelDepth=a._nextUint32(),n.layerCount=a._nextUint32(),n.faceCount=a._nextUint32();const r=a._nextUint32();n.supercompressionScheme=a._nextUint32();const o=a._nextUint32(),s=a._nextUint32(),l=a._nextUint32(),c=a._nextUint32(),h=a._nextUint64(),d=a._nextUint64(),u=new y(e,_.length+i,3*r*8,!0);for(let t=0;t<r;t++)n.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const m=new y(e,o,s,!0),x={vendorId:m._skip(4)._nextUint16(),descriptorType:m._nextUint16(),versionNumber:m._nextUint16(),descriptorBlockSize:m._nextUint16(),colorModel:m._nextUint8(),colorPrimaries:m._nextUint8(),transferFunction:m._nextUint8(),flags:m._nextUint8(),texelBlockDimension:{x:m._nextUint8()+1,y:m._nextUint8()+1,z:m._nextUint8()+1,w:m._nextUint8()+1},bytesPlane:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],samples:[]},f=(x.descriptorBlockSize/4-6)/4;for(let e=0;e<f;e++)x.samples[e]={bitOffset:m._nextUint16(),bitLength:m._nextUint8(),channelID:m._nextUint8(),samplePosition:[m._nextUint8(),m._nextUint8(),m._nextUint8(),m._nextUint8()],sampleLower:m._nextUint32(),sampleUpper:m._nextUint32()};n.dataFormatDescriptor.length=0,n.dataFormatDescriptor.push(x);const A=new y(e,l,c,!0);for(;A._offset<c;){const e=A._nextUint32(),t=A._scan(e),i=I(t),a=A._scan(e-t.byteLength);n.keyValue[i]=i.match(/^ktx/i)?I(a):a,A._offset%4&&A._skip(4-A._offset%4)}if(d<=0)return n;const p=new y(e,h,d,!0),g=p._nextUint16(),b=p._nextUint16(),T=p._nextUint32(),S=p._nextUint32(),E=p._nextUint32(),C=p._nextUint32(),w=[];for(let e=0;e<r;e++)w.push({imageFlags:p._nextUint32(),rgbSliceByteOffset:p._nextUint32(),rgbSliceByteLength:p._nextUint32(),alphaSliceByteOffset:p._nextUint32(),alphaSliceByteLength:p._nextUint32()});const D=h+p._offset,N=D+T,B=N+S,P=B+E,M=new Uint8Array(e.buffer,e.byteOffset+D,T),F=new Uint8Array(e.buffer,e.byteOffset+N,S),R=new Uint8Array(e.buffer,e.byteOffset+B,E),L=new Uint8Array(e.buffer,e.byteOffset+P,C);return n.globalData={endpointCount:g,selectorCount:b,imageDescs:w,endpointsData:M,selectorsData:F,tablesData:R,extendedData:L},n}(e)}__transcodeData(e){var t;const n=e.pixelWidth,i=e.pixelHeight,a=e.faceCount,r=null===(t=e.globalData)||void 0===t?void 0:t.imageDescs,o=e.dataFormatDescriptor[0],s=o.colorModel===u.UASTC?1:0,l=this.__hasAlpha(o,s),c=B.__mscTranscoderModule,_=1===s?new c.UastcImageTranscoder:new c.BasisLzEtc1sImageTranscoder,d=1===s?c.TextureFormat.UASTC4x4:c.TextureFormat.ETC1S,{transcodeTargetStr:m,compressionTextureType:f}=this.__getDeviceDependentParameters(l),A=c.TranscodeTarget[m],p=[],g={width:n,height:i,compressionTextureType:f,mipmapData:p,needGammaCorrection:o.transferFunction!==x.SRGB};for(let t=0;t<e.levels.length;t++){const u=Math.max(1,n>>t),m=Math.max(1,i>>t),x=new c.ImageInfo(d,u,m,t);let f=e.levels[t].levelData;const g=e.levels[t].uncompressedByteLength,v=x.numBlocksX*x.numBlocksY*o.bytesPlane[0];e.supercompressionScheme===h.ZSTD&&(f=B.__zstdDecoder.decode(f,g));let y=0;const I=t*Math.max(e.layerCount,1)*a*Math.max(e.pixelDepth,1);for(let n=0;n<a;n++){let i,a,o=null;if(e.supercompressionScheme===h.BASISLZ?(o=null==r?void 0:r[I+n],i=new Uint8Array(f,o.rgbSliceByteOffset,o.rgbSliceByteLength+o.alphaSliceByteLength)):(i=new Uint8Array(f,y,v),y+=v),1===s)x.flags=0,x.rgbByteOffset=0,x.rgbByteLength=g,x.alphaByteOffset=0,x.alphaByteLength=0,a=_.transcodeImage(A,i,x,0,l,!1);else{const t=e.globalData,n=_;n.decodePalettes(t.endpointCount,t.endpointsData,t.selectorCount,t.selectorsData),n.decodeTables(t.tablesData),x.flags=o.imageFlags,x.rgbByteOffset=0,x.rgbByteLength=o.rgbSliceByteLength,x.alphaByteOffset=o.alphaSliceByteOffset>0?o.rgbSliceByteLength:0,x.alphaByteLength=o.alphaSliceByteLength,a=n.transcodeImage(A,i,x,0,!1)}if(null!=(null==a?void 0:a.transcodedImage)){const e=a.transcodedImage.get_typed_memory_view().slice();a.transcodedImage.delete();const n={level:t,width:u,height:m,buffer:e};p.push(n)}}}return g}__hasAlpha(e,t){return 1===t?e.samples[0].channelID===p.RGBA:2===e.samples.length&&(e.samples[0].channelID===A.AAA||e.samples[1].channelID===A.AAA)}}class P extends o.Z{constructor(){super(),this.autoResize=!0,this.autoDetectTransparency=!1}generateTextureFromBasis(e,t){var n;this.__startedToLoad=!0,"undefined"==typeof BASIS&&console.error("Failed to call BASIS() function. Please check to import basis_transcoder.js."),P.__loadedBasisFunc?P.__BasisFile?this.__setBasisTexture(e,t):null===(n=P.__basisLoadPromise)||void 0===n||n.then((()=>{this.__setBasisTexture(e,t)})):(P.__loadedBasisFunc=!0,P.__basisLoadPromise=new Promise((n=>{BASIS().then((i=>{const{initializeBasis:a}=i;a(),P.__BasisFile=i.BasisFile,this.__setBasisTexture(e,t),n()}))})))}__setBasisTexture(e,{level:t=0,internalFormat:n=i.V.RGBA,format:l=i.V.RGBA,type:c=a.r.UnsignedByte,magFilter:_=r.d.Linear,minFilter:h=r.d.LinearMipmapLinear,wrapS:d=r.d.Repeat,wrapT:u=r.d.Repeat,generateMipmap:m=!0,anisotropy:x=!0,isPremultipliedAlpha:f=!1}={}){this.__startedToLoad=!0;const A=new P.__BasisFile(e);if(!A.startTranscoding())return console.error("failed to start transcoding."),A.close(),void A.delete();const p=s.Z.getWebGLResourceRepository().createCompressedTextureFromBasis(A,{border:0,format:l,type:c,magFilter:_,minFilter:h,wrapS:d,wrapT:u,anisotropy:x,isPremultipliedAlpha:f});this.cgApiResourceUid=p,this.__isTextureReady=!0,o.Z.__textureMap.set(p,this),A.close(),A.delete()}generateTextureFromKTX2(e,{magFilter:t=r.d.Linear,minFilter:n=r.d.LinearMipmapLinear,wrapS:i=r.d.Repeat,wrapT:a=r.d.Repeat,anisotropy:o=!0}={}){this.__startedToLoad=!0,B.getInstance().transcode(e).then((e=>{this.__width=e.width,this.__height=e.height,this.generateCompressedTextureWithMipmapFromTypedArray(e.mipmapData,e.compressionTextureType,{magFilter:t,minFilter:n,wrapS:i,wrapT:a,anisotropy:o})}))}generateTextureFromImage(e,{level:t=0,internalFormat:n=i.V.RGBA,format:_=i.V.RGBA,type:h=a.r.UnsignedByte,magFilter:d=r.d.Linear,minFilter:u=r.d.Linear,wrapS:m=r.d.Repeat,wrapT:x=r.d.Repeat,generateMipmap:f=!0,anisotropy:A=!0,isPremultipliedAlpha:p=!1}={}){this.__startedToLoad=!0,this.__htmlImageElement=e;let g=e;if(this.autoResize){const[e,t,n]=c.Z.getResizedCanvas(g,l.Z.maxSizeLimitOfNonCompressedTexture);g=e,this.__width=t,this.__height=n,this.__htmlCanvasElement=e}this.autoDetectTransparency&&(this.__hasTransparentPixels=c.Z.detectTransparentPixelExistence(g)),this.__width=g.width,this.__height=g.height;const v=s.Z.getWebGLResourceRepository().createTexture(g,{level:t,internalFormat:n,width:this.__width,height:this.__height,border:0,format:_,type:h,magFilter:d,minFilter:u,wrapS:m,wrapT:x,generateMipmap:f,anisotropy:A,isPremultipliedAlpha:p});this.cgApiResourceUid=v,this.__isTextureReady=!0,this.__uri=e.src,o.Z.__textureMap.set(v,this)}generateTextureFromUri(e,{level:t=0,internalFormat:n=i.V.RGBA,format:_=i.V.RGBA,type:h=a.r.UnsignedByte,magFilter:d=r.d.Linear,minFilter:u=r.d.Linear,wrapS:m=r.d.Repeat,wrapT:x=r.d.Repeat,generateMipmap:f=!0,anisotropy:A=!0,isPremultipliedAlpha:p=!1}={}){return this.__uri=e,this.__startedToLoad=!0,new Promise(((i,a)=>{this.__img=new Image,e.match(/^data:/)||(this.__img.crossOrigin="Anonymous"),this.__img.onload=()=>{this.__htmlImageElement=this.__img;let e=this.__img;if(this.autoResize){const[t,n,i]=c.Z.getResizedCanvas(e,l.Z.maxSizeLimitOfNonCompressedTexture);e=t,this.__width=n,this.__height=i,this.__htmlCanvasElement=t}this.autoDetectTransparency&&(this.__hasTransparentPixels=c.Z.detectTransparentPixelExistence(e)),this.__width=e.width,this.__height=e.height;const a=s.Z.getWebGLResourceRepository().createTexture(e,{level:t,internalFormat:n,width:this.__width,height:this.__height,border:0,format:_,type:h,magFilter:d,minFilter:u,wrapS:m,wrapT:x,generateMipmap:f,anisotropy:A,isPremultipliedAlpha:p});this.cgApiResourceUid=a,this.__isTextureReady=!0,o.Z.__textureMap.set(a,this),i()},this.__img.src=e}))}generate1x1TextureFrom(e="rgba(255,255,255,1)"){const t=document.createElement("canvas");t.width=1,t.height=1,this.__width=1,this.__height=1;const n=t.getContext("2d");n.fillStyle=e,n.fillRect(0,0,1,1);const l=s.Z.getWebGLResourceRepository().createTexture(t,{level:0,internalFormat:i.V.RGBA,width:1,height:1,border:0,format:i.V.RGBA,type:a.r.UnsignedByte,magFilter:r.d.Nearest,minFilter:r.d.Nearest,wrapS:r.d.ClampToEdge,wrapT:r.d.ClampToEdge,generateMipmap:!1,anisotropy:!1,isPremultipliedAlpha:!0});this.cgApiResourceUid=l,this.__isTextureReady=!0,o.Z.__textureMap.set(l,this)}generateTextureFromTypedArray(e,{level:t=0,internalFormat:n=i.V.RGBA,format:l=i.V.RGBA,magFilter:c=r.d.Linear,minFilter:_=r.d.LinearMipmapLinear,wrapS:h=r.d.Repeat,wrapT:d=r.d.Repeat,generateMipmap:u=!0,anisotropy:m=!0,isPremultipliedAlpha:x=!1}={}){const f=a.r.fromTypedArray(e),A=s.Z.getWebGLResourceRepository().createTexture(e,{level:t,internalFormat:n,width:this.__width,height:this.__height,border:0,format:l,type:f,magFilter:c,minFilter:_,wrapS:h,wrapT:d,generateMipmap:u,anisotropy:m,isPremultipliedAlpha:x});this.cgApiResourceUid=A,this.__isTextureReady=!0,o.Z.__textureMap.set(A,this)}generateCompressedTextureFromTypedArray(e,t,n,i,{magFilter:a=r.d.Linear,minFilter:l=r.d.LinearMipmapLinear,wrapS:c=r.d.ClampToEdge,wrapT:_=r.d.ClampToEdge,anisotropy:h=!0}={}){this.__width=t,this.__height=n;const d={level:0,width:t,height:n,buffer:e},u=s.Z.getWebGLResourceRepository().createCompressedTexture([d],i,{magFilter:a,minFilter:l,wrapS:c,wrapT:_,anisotropy:h});this.cgApiResourceUid=u,this.__isTextureReady=!0,o.Z.__textureMap.set(u,this)}generateCompressedTextureWithMipmapFromTypedArray(e,t,{magFilter:n=r.d.Linear,minFilter:i=r.d.LinearMipmapLinear,wrapS:a=r.d.ClampToEdge,wrapT:l=r.d.ClampToEdge,anisotropy:c=!0}={}){const _=e.find((e=>0===e.level));if(null==_)throw new Error("texture data with level 0 is not found");this.__width=_.width,this.__height=_.height;const h=s.Z.getWebGLResourceRepository().createCompressedTexture(e,t,{magFilter:n,minFilter:i,wrapS:a,wrapT:l,anisotropy:c});this.cgApiResourceUid=h,this.__isTextureReady=!0,o.Z.__textureMap.set(h,this)}importWebGLTextureDirectly(e,t=0,n=0){this.__width=t,this.__height=n;const i=s.Z.getWebGLResourceRepository().setWebGLTextureDirectly(e);this.cgApiResourceUid=i,this.__startedToLoad=!0,this.__isTextureReady=!0,o.Z.__textureMap.set(i,this)}}P.__loadedBasisFunc=!1},9849:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});class i{constructor(e,t,n){this.__channels=n,this.__width=e,this.__height=t,this.__data=new Float32Array(e*t*n)}resize(e,t,n){this.__width=e,this.__height=t,this.__channels=n,this.__data=new Float32Array(i.transfer(this.__data.buffer,e*t*n*4))}setPixelAtChannel(e,t,n,i){this.__data[t*this.__width*this.__channels+e*this.__channels+n]=i}get width(){return this.__width}get height(){return this.__height}get data(){return this.__data}getPixel(e,t,n){return this.__data[t*this.__width*this.__channels+e*this.__channels+n]}getPixelAs(e,t,n,i){return 3===n?new i(new Float32Array([this.__data[t*this.__width*this.__channels+e*this.__channels+0],this.__data[t*this.__width*this.__channels+e*this.__channels+1],this.__data[t*this.__width*this.__channels+e*this.__channels+2]])):4===n?new i(new Float32Array([this.__data[t*this.__width*this.__channels+e*this.__channels+0],this.__data[t*this.__width*this.__channels+e*this.__channels+1],this.__data[t*this.__width*this.__channels+e*this.__channels+2],this.__data[t*this.__width*this.__channels+e*this.__channels+3]])):void 0}getPixelAsArray(e,t){const n=[];for(let i=0;i<this.__channels;i++)n.push(this.__data[t*this.__width*this.__channels+e*this.__channels+i]);return n}initialize(e,t,n){this.__width=e,this.__height=t,this.__channels=n,this.__data=new Float32Array(e*t*n)}static transfer(e,t){e=Object(e);const n=new ArrayBuffer(t);if(!(e instanceof ArrayBuffer&&n instanceof ArrayBuffer))throw new TypeError("Source and destination must be ArrayBuffer instances");if(n.byteLength>=e.byteLength){let t=0,i=e.byteLength;[8,4,2,1].forEach((a=>{if(i>=a){const r=function(e,t,n,i,a){let r=Uint8Array;switch(e){case 8:r=Float64Array;break;case 4:r=Float32Array;break;case 2:r=Uint16Array;break;case 1:default:r=Uint8Array}const o=new r(t,i,Math.trunc(a/e)),s=new r(n,i,Math.trunc(a/e));for(let e=0;e<s.length;e++)s[e]=o[e];return{nextOffset:o.byteOffset+o.byteLength,leftBytes:t.byteLength-(o.byteOffset+o.byteLength)}}(a,e,n,t,i);t=r.nextOffset,i=r.leftBytes}}))}return n}}},5649:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>i});const i=Object.freeze({pbrCookTorranceBrdfLutDataUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFIGlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDUgNzkuMTYzNDk5LCAyMDE4LzA4LzEzLTE2OjQwOjIyICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxOSAoTWFjaW50b3NoKSIgeG1wOkNyZWF0ZURhdGU9IjIwMTktMDUtMjhUMTE6MDk6MjQrMDk6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDE5LTA1LTI4VDExOjA5OjU4KzA5OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDE5LTA1LTI4VDExOjA5OjU4KzA5OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOmQwMDIyNWQ0LTE2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",pbrKelemenSzirmayKalosBrdfLutDataUrl:"data:image/png;base64,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"})},4098:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var i=n(9721),a=n(4710),r=n(4507),o=n(916),s=n(1784),l=n(2404),c=n(5333),_=n(2251);class h extends i.Z{constructor(e,t,n){super(e,t,n)}static get componentTID(){return a.z.SparkGearComponentTID}onBeforeRender(){}onAfterRender(){const e=h;e.SPARK_BackupStatus(),_SPARK_Draw(this.__hSPFXInst),e.SPARK_RestoreStatus()}play(){_SPARK_Instance_Play(this.__hSPFXInst,1,!1,0)}stop(){_SPARK_Instance_Stop(this.__hSPFXInst)}pause(){_SPARK_Instance_Pause(this.__hSPFXInst)}isPlaying(){return _SPARK_Instance_IsPlaying(this.__hSPFXInst)}kickTrigger(e){_SPARK_Instance_KickTrigger(this.__hSPFXInst,e)}static SPARK_BackupStatus(){const e=h,t=e.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext();e.SPFX_ArrayBuffer=t.getParameter(t.ARRAY_BUFFER_BINDING),e.SPFX_ElementArrayBuffer=t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),e.SPFX_CurrentProgram=t.getParameter(t.CURRENT_PROGRAM),e.SPFX_FrontFace=t.getParameter(t.FRONT_FACE),e.SPFX_DepthFunc=t.getParameter(t.DEPTH_FUNC),e.SPFX_DepthWriteMask=t.getParameter(t.DEPTH_WRITEMASK),e.SPFX_StencilTestEnabled=t.isEnabled(t.STENCIL_TEST),e.SPFX_DepthTestEnabled=t.isEnabled(t.DEPTH_TEST),e.SPFX_CullFaceEnabled=t.isEnabled(t.CULL_FACE),e.SPFX_BlendEnabled=t.isEnabled(t.BLEND),e.SPFX_BlendSrcRgb=t.getParameter(t.BLEND_SRC_RGB),e.SPFX_BlendDstRgb=t.getParameter(t.BLEND_DST_RGB),e.SPFX_BlendSrcAlpha=t.getParameter(t.BLEND_SRC_ALPHA),e.SPFX_BlendDstAlpha=t.getParameter(t.BLEND_DST_ALPHA),e.SPFX_ActiveTexture=t.getParameter(t.ACTIVE_TEXTURE);for(let n=0;n<8;n++)t.activeTexture(t.TEXTURE0+n),e.SPFX_Texture[n]=t.getParameter(t.TEXTURE_BINDING_2D);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1)}static SPFX_Uninitialize(){const e=h;e.SPARK_BackupStatus(),_SPARK_Uninitialize(),e.SPARK_RestoreStatus()}static SPARK_SetCameraMatrix(e,t){const n=e._v;_SPARK_SetMatrix(0,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15]);const i=t._v;_SPARK_SetMatrix(1,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])}static SPARK_Draw(){const e=h;e.SPARK_BackupStatus(),_SPARK_DrawAll(),e.SPARK_RestoreStatus()}static SPARK_DrawDebugInfo(e){const t=h;t.SPARK_BackupStatus(),_SPARK_DrawDebugInfo(e),t.SPARK_RestoreStatus()}$create(){this.__sceneGraphComponent=this.__entityRepository.getComponentOfEntity(this.__entityUid,c.Z),this.moveStageTo(r.I.Load)}static common_$load(){if(h.__isInitialized)return;const e=_.Z.getInstance().getModule("webgl");h.SPFX_Initialize(e.WebGLResourceRepository.getInstance())}$load(){if(null==this.url)return;const e=h;!function(e,t,n){const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=()=>{switch(i.status){case 200:n(i.response);break;default:console.error("Failed to load ("+i.status+") : "+e)}},i.send(null)}(this.url,0,(t=>{const n=new Uint8Array(t);e.SPARK_BackupStatus();const i=window.Module.ccall("SPARK_Data_Create","number",["string","number","array","number"],[this.url,this.url.length,n,n.length]);this.__hSPFXInst=_SPARK_Instance_Create(i),_SPARK_Data_Delete(i),e.SPARK_RestoreStatus(),this.moveStageTo(r.I.Logic)}))}$logic(){this.isPlaying()||this.play();const e=l.Z.getInstance().getComponent(s.Z,s.Z.main);let t=h.__tmp_indentityMatrix,n=h.__tmp_indentityMatrix;e&&(t=e.viewMatrix,n=e.projectionMatrix),h.SPARK_SetCameraMatrix(t,n),h.SPFX_Update(1);const i=this.__sceneGraphComponent.worldMatrixInner;_SPARK_Instance_SetTransformFor3D(this.__hSPFXInst,i._v[0],i._v[4],i._v[8],i._v[12],i._v[1],i._v[5],i._v[9],i._v[13],i._v[2],i._v[6],i._v[10],i._v[14],i._v[3],i._v[7],i._v[11],i._v[15]),this.moveStageTo(r.I.Render)}$render(){this.onAfterRender(),this.moveStageTo(r.I.Logic)}}h.__isInitialized=!1,h.SPFX_Texture=[],h.__tmp_indentityMatrix=o.Z.identity(),h.SPARK_RestoreStatus=function(){const e=h,t=e.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext();t.useProgram(e.SPFX_CurrentProgram),t.bindBuffer(t.ARRAY_BUFFER,e.SPFX_ArrayBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.SPFX_ElementArrayBuffer),t.frontFace(e.SPFX_FrontFace),t.depthFunc(e.SPFX_DepthFunc),t.depthMask(e.SPFX_DepthWriteMask),t.blendFuncSeparate(e.SPFX_BlendSrcRgb,e.SPFX_BlendDstRgb,e.SPFX_BlendSrcAlpha,e.SPFX_BlendDstAlpha),e.SPFX_StencilTestEnabled?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),e.SPFX_DepthTestEnabled?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),e.SPFX_CullFaceEnabled?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),e.SPFX_BlendEnabled?t.enable(t.BLEND):t.disable(t.BLEND);for(let n=0;n<8;n++)t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e.SPFX_Texture[n]);t.activeTexture(e.SPFX_ActiveTexture)},h.SPFX_Initialize=function(e){const t=h;if(null==e.currentWebGLContextWrapper)return;t.SPFX_WebGLResourceRepository=e,window.GLctx=t.SPFX_WebGLResourceRepository.currentWebGLContextWrapper.getRawContext(),t.SPARK_BackupStatus();const n=t.SPFX_WebGLResourceRepository.currentWebGLContextWrapper;_SPARK_InitializeFor3D(n.width,n.height),t.SPARK_RestoreStatus(),t.__isInitialized=!0},h.SPFX_Update=function(e){_SPARK_Update(e)},l.Z.registerComponentClass(h);var d=n(1350),u=n(657);const m=Object.freeze({SparkGearComponent:h,createSparkGearEntity:function(){return d.Z.getInstance().createEntity([u.Z,c.Z,h])}})},5551:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var i,a,r,o,s,l,c=n(3346),_=n(7192),h=n(346),d=function(e,t,n,i,a){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,n):a?a.value=n:t.set(e,n),n},u=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};const m=-1;class x{constructor(e,t,n){this.__webglVersion=1,this.width=0,this.height=0,this.__activeTextureBackup=-1,this.__activeTextures2D=[],this.__activeTexturesCube=[],this.__isDebugMode=!1,this.__viewport_left=0,this.__viewport_top=0,this.__viewport_width=0,this.__viewport_height=0,this.__default_viewport_left=0,this.__default_viewport_top=0,this.__default_viewport_width=0,this.__default_viewport_height=0,i.set(this,m),a.set(this,m),r.set(this,m),o.set(this,m),s.set(this,m),l.set(this,m),this.__maxVertexUniformVectors=m,this.__maxFragmentUniformVectors=m,this.__extensions=new Map,this.__gl=e,this.width=t.width,this.height=t.height,this.canvas=t,this.__viewport_width=this.__default_viewport_width=this.width,this.__viewport_height=this.__default_viewport_height=this.height,this.__isDebugMode=n,"WebGL2RenderingContext"===this.__gl.constructor.name?(this.__webglVersion=2,this.webgl2ExtTFL=this.__getExtension(c.c.TextureFloatLinear),this.webgl2ExtTFA=this.__getExtension(c.c.TextureFilterAnisotropic),this.webgl2ExtCTAstc=this.__getCompressedTextureExtension(c.c.CompressedTextureAstc),this.webgl2ExtCTS3tc=this.__getCompressedTextureExtension(c.c.CompressedTextureS3tc),this.webgl2ExtCTPvrtc=this.__getCompressedTextureExtension(c.c.CompressedTexturePvrtc),this.webgl2ExtCTAtc=this.__getCompressedTextureExtension(c.c.CompressedTextureAtc),this.webgl2ExtCTEtc=this.__getCompressedTextureExtension(c.c.CompressedTextureEtc),this.webgl2ExtCTEtc1=this.__getCompressedTextureExtension(c.c.CompressedTextureEtc1),this.webgl2ExtCTBptc=this.__getCompressedTextureExtension(c.c.CompressedTextureBptc)):(this.webgl1ExtVAO=this.__getExtension(c.c.VertexArrayObject),this.webgl1ExtIA=this.__getExtension(c.c.InstancedArrays),this.webgl1ExtTF=this.__getExtension(c.c.TextureFloat),this.webgl1ExtTHF=this.__getExtension(c.c.TextureHalfFloat),this.webgl1ExtTFL=this.__getExtension(c.c.TextureFloatLinear),this.webgl1ExtTHFL=this.__getExtension(c.c.TextureHalfFloatLinear),this.webgl1ExtTFA=this.__getExtension(c.c.TextureFilterAnisotropic),this.webgl1ExtEIUI=this.__getExtension(c.c.ElementIndexUint),this.webgl1ExtSTL=this.__getExtension(c.c.ShaderTextureLod),this.webgl1ExtDRV=this.__getExtension(c.c.ShaderDerivatives),this.webgl1ExtDB=this.__getExtension(c.c.DrawBuffers),this.webgl1ExtBM=this.__getExtension(c.c.BlendMinmax),this.webgl1ExtCBF=this.__getExtension(c.c.ColorBufferFloat),this.webgl1ExtCTAstc=this.__getCompressedTextureExtension(c.c.CompressedTextureAstc),this.webgl1ExtCTS3tc=this.__getCompressedTextureExtension(c.c.CompressedTextureS3tc),this.webgl1ExtCTPvrtc=this.__getCompressedTextureExtension(c.c.CompressedTexturePvrtc),this.webgl1ExtCTAtc=this.__getCompressedTextureExtension(c.c.CompressedTextureAtc),this.webgl1ExtCTEtc=this.__getCompressedTextureExtension(c.c.CompressedTextureEtc),this.webgl1ExtCTEtc1=this.__getCompressedTextureExtension(c.c.CompressedTextureEtc1),this.webgl1ExtCTBptc=this.__getCompressedTextureExtension(c.c.CompressedTextureBptc)),this.__getUniformBufferInfo(),this.__getMaxUniformVectors()}getRawContext(){return this.__gl}getRawContextAsWebGL1(){return this.__gl}getRawContextAsWebGL2(){return this.__gl}get viewport(){return _.ZP.fromCopyArray([this.__viewport_left,this.__viewport_top,this.__viewport_width,this.__viewport_height])}get defaultViewport(){return _.ZP.fromCopyArray([this.__default_viewport_left,this.__default_viewport_top,this.__default_viewport_width,this.__default_viewport_height])}isSupportWebGL1Extension(e){return!!this.__getExtension(e)}isNotSupportWebGL1Extension(e){return!this.isSupportWebGL1Extension(e)}get isDebugMode(){return this.__isDebugMode}getIsWebGL2(e){return this.isWebGL2}get isWebGL2(){return 2===this.__webglVersion}createVertexArray(){return this.getIsWebGL2(this.__gl)?this.__gl.createVertexArray():null!=this.webgl1ExtVAO?this.webgl1ExtVAO.createVertexArrayOES():void 0}deleteVertexArray(e){this.getIsWebGL2(this.__gl)?this.__gl.deleteVertexArray(e):null!=this.webgl1ExtVAO&&this.webgl1ExtVAO.deleteVertexArrayOES(e)}bindVertexArray(e){this.getIsWebGL2(this.__gl)?this.__gl.bindVertexArray(e):null!=this.webgl1ExtVAO&&this.webgl1ExtVAO.bindVertexArrayOES(e)}vertexAttribDivisor(e,t){this.getIsWebGL2(this.__gl)?this.__gl.vertexAttribDivisor(e,t):this.webgl1ExtIA.vertexAttribDivisorANGLE(e,t)}drawElementsInstanced(e,t,n,i,a){this.getIsWebGL2(this.__gl)?this.__gl.drawElementsInstanced(e,t,n,i,a):this.webgl1ExtIA.drawElementsInstancedANGLE(e,t,n,i,a)}drawArraysInstanced(e,t,n,i){this.getIsWebGL2(this.__gl)?this.__gl.drawArraysInstanced(e,t,n,i):this.webgl1ExtIA.drawArraysInstancedANGLE(e,t,n,i)}colorAttachment(e){return 36064+e}drawBuffers(e){const t=this.__gl;if(0===e.length)return;const n=e[0].webGLConstantValue();this.getIsWebGL2(t)?t.drawBuffers(e.map((e=>e.webGLConstantValue()))):this.webgl1ExtDB&&this.webgl1ExtDB.drawBuffersWEBGL(e.map((e=>e.webGLConstantValue()))),n===t.NONE?t.colorMask(!1,!1,!1,!1):t.colorMask(!0,!0,!0,!0)}__activeTexture(e){if(this.__activeTextureBackup!==e){switch(e){case 0:this.__gl.activeTexture(this.__gl.TEXTURE0);break;case 1:this.__gl.activeTexture(this.__gl.TEXTURE1);break;case 2:this.__gl.activeTexture(this.__gl.TEXTURE2);break;case 3:this.__gl.activeTexture(this.__gl.TEXTURE3);break;case 4:this.__gl.activeTexture(this.__gl.TEXTURE4);break;case 5:this.__gl.activeTexture(this.__gl.TEXTURE5);break;case 6:this.__gl.activeTexture(this.__gl.TEXTURE6);break;case 7:this.__gl.activeTexture(this.__gl.TEXTURE7);break;case 8:this.__gl.activeTexture(this.__gl.TEXTURE8);break;case 9:this.__gl.activeTexture(this.__gl.TEXTURE9);break;case 10:this.__gl.activeTexture(this.__gl.TEXTURE10);break;case 11:this.__gl.activeTexture(this.__gl.TEXTURE11);break;case 12:this.__gl.activeTexture(this.__gl.TEXTURE12);break;case 13:this.__gl.activeTexture(this.__gl.TEXTURE13);break;case 14:this.__gl.activeTexture(this.__gl.TEXTURE14);break;case 15:this.__gl.activeTexture(this.__gl.TEXTURE15)}this.__activeTextureBackup=e}}bindTexture2D(e,t){this.__isDebugMode&&t&&(t._bound_as,t._bound_as="2D"),(h.Z.noWebGLTex2DStateCache||this.__activeTextures2D[e]!==t)&&(this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_2D,t),this.__activeTextures2D[e]=t)}bindTextureCube(e,t){this.__isDebugMode&&t&&(t._bound_as,t._bound_as="CUBE_MAP"),this.__activeTexturesCube[e]!==t&&(this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,t),this.__activeTexturesCube[e]=t)}unbindTexture2D(e){this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_2D,null),delete this.__activeTextures2D[e]}unbindTextureCube(e){this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,null),delete this.__activeTexturesCube[e]}unbindTextures(){for(let e=0;e<this.__activeTextures2D.length;e++)null!=this.__activeTextures2D[e]&&(this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_2D,null),delete this.__activeTextures2D[e]);for(let e=0;e<this.__activeTexturesCube.length;e++)null!=this.__activeTexturesCube[e]&&(this.__activeTexture(e),this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,null),delete this.__activeTexturesCube[e])}__getExtension(e){const t=this.__gl;if(!this.__extensions.has(e)){const n=t.getExtension(e.toString());if(null==n){const t=`${e.toString()} Not Available in this environment`;console.warn(t)}return this.__extensions.set(e,n),n}return this.__extensions.get(e)}__getCompressedTextureExtension(e){var t,n;const i=this.__gl;if(!this.__extensions.has(e)){const a=e.toString(),r=null!==(n=null!==(t=i.getExtension(a))&&void 0!==t?t:i.getExtension("MOZ_"+a))&&void 0!==n?n:i.getExtension("WEBKIT_"+a);if(null==r){const t=`${e.toString()} Not Available in this environment`;console.warn(t)}else this.__extensions.set(e,r);return r}return this.__extensions.get(e)}setViewport(e,t,n,i){const a=this.__gl;this.__viewport_width===n&&this.__viewport_height===i&&this.__viewport_left===e&&this.__viewport_top===t||(a.viewport(e,t,n,i),this.__viewport_left=e,this.__viewport_top=t,this.__viewport_width=n,this.__viewport_height=i)}setViewportAsVector4(e){const t=this.__gl;this.__viewport_width===e.z&&this.__viewport_height===e.w&&this.__viewport_left===e.x&&this.__viewport_top===e.y||(t.viewport(e.x,e.y,e.z,e.w),this.__viewport_left=e.x,this.__viewport_top=e.y,this.__viewport_width=e.z,this.__viewport_height=e.w)}__getUniformBufferInfo(){if(!this.isWebGL2)return;const e=this.__gl,t=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),n=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE);d(this,o,e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),"f"),d(this,s,e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),"f"),d(this,l,Math.min(u(this,o,"f"),u(this,s,"f")),"f"),d(this,i,n-n%t,"f"),d(this,r,t,"f"),d(this,a,n,"f")}__getMaxUniformVectors(){const e=this.getRawContext();this.__maxVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),this.__maxVertexUniformVectors=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS)}getMaxConventionUniformBlocks(){return u(this,l,"f")}getAlignedMaxUniformBlockSize(){return u(this,i,"f")}getMaxVertexUniformVectors(){return this.__maxVertexUniformVectors}getMaxFragmentUniformVectors(){return this.__maxFragmentUniformVectors}}i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,l=new WeakMap},3346:(e,t,n)=>{"use strict";n.d(t,{c:()=>S});var i=n(2343);class a extends i.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const r=new a({index:1,str:"OES_vertex_array_object"}),o=new a({index:2,str:"OES_texture_float"}),s=new a({index:3,str:"OES_texture_half_float"}),l=new a({index:4,str:"OES_texture_float_linear"}),c=new a({index:5,str:"OES_texture_half_float_linear"}),_=new a({index:6,str:"ANGLE_instanced_arrays"}),h=new a({index:7,str:"EXT_texture_filter_anisotropic"}),d=new a({index:8,str:"OES_element_index_uint"}),u=new a({index:9,str:"EXT_shader_texture_lod"}),m=new a({index:10,str:"OES_standard_derivatives"}),x=new a({index:11,str:"WEBGL_draw_buffers"}),f=new a({index:12,str:"EXT_blend_minmax"}),A=new a({index:13,str:"WEBGL_color_buffer_float"}),p=new a({index:14,str:"WEBGL_compressed_texture_astc"}),g=new a({index:15,str:"WEBGL_compressed_texture_s3tc"}),v=new a({index:16,str:"WEBGL_compressed_texture_pvrtc"}),y=new a({index:17,str:"WEBGL_compressed_texture_atc"}),I=new a({index:18,str:"WEBGL_compressed_texture_etc"}),b=new a({index:19,str:"WEBGL_compressed_texture_etc1"}),T=new a({index:20,str:"EXT_texture_compression_bptc"}),S=Object.freeze({VertexArrayObject:r,TextureFloat:o,TextureHalfFloat:s,TextureFloatLinear:l,TextureHalfFloatLinear:c,InstancedArrays:_,TextureFilterAnisotropic:h,ElementIndexUint:d,ShaderTextureLod:u,ShaderDerivatives:m,DrawBuffers:x,BlendMinmax:f,ColorBufferFloat:A,CompressedTextureAstc:p,CompressedTextureS3tc:g,CompressedTexturePvrtc:v,CompressedTextureAtc:y,CompressedTextureEtc:I,CompressedTextureEtc1:b,CompressedTextureBptc:T})},8268:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var i=n(7987),a=n(128),r=n(5981),o=n(9216),s=n(810),l=n(3999),c=n(5551),_=n(3032),h=n(4587),d=n(7290),u=n(4392),m=n(1986),x=n(7192),f=n(8422),A=n(6098),p=n(3449),g=n(2343);class v extends g.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const y=new v({index:0,str:"ETC1"}),I=new v({index:1,str:"ETC2"}),b=new v({index:2,str:"BC1"}),T=new v({index:3,str:"BC3"}),S=new v({index:4,str:"BC4"}),E=new v({index:5,str:"BC5"}),C=new v({index:6,str:"BC7_M6_OPAQUE"}),w=new v({index:7,str:"BC7_M5"}),D=new v({index:8,str:"PVRTC1_RGB"}),N=new v({index:9,str:"PVRTC1_RGBA"}),B=new v({index:10,str:"ASTC"}),P=new v({index:11,str:"ATC_RGB"}),M=new v({index:12,str:"ATC_RGBA"}),F=new v({index:13,str:"RGBA32"}),R=new v({index:14,str:"RGB565"}),L=new v({index:15,str:"BGR565"}),V=new v({index:16,str:"RGBA4444"}),W=[y,I,b,T,S,E,w,C,D,N,B,P,M,F,R,L,V],z=Object.freeze({ETC1:y,ETC2:I,BC1:b,BC3:T,BC4:S,BC5:E,BC7_M5:w,BC7_M6_OPAQUE:C,PVRTC1_RGB:D,PVRTC1_RGBA:N,ASTC:B,ATC_RGB:P,ATC_RGBA:M,RGBA32:F,RGB565:R,BGR565:L,RGBA4444:V,from:function(e){return(0,g.li)({typeList:W,index:e})},fromString:function(e){return(0,g.cu)({typeList:W,str:e})}});var H=n(3346),O=n(4690),G=n(3648),Q=n(9696);class k extends i.Z{constructor(){super(),this.__webglContexts=new Map,this.__resourceCounter=i.Z.InvalidCGAPIResourceUid,this.__webglResources=new Map}static getInstance(){return this.__instance||(this.__instance=new k),this.__instance}addWebGLContext(e,t,n,i){const a=new c.Z(e,t,i);this.__webglContexts.set("default",a),n&&(this.__glw=a)}generateWebGLContext(e,t,n,i,a,r=!0){let o;if(2===n){if(o=e.getContext("webgl2",t),r&&O.Is.not.exist(o))return void(o=e.getContext("webgl",t))}else o=e.getContext("webgl",t);return this.addWebGLContext(o,e,i,a),o}get currentWebGLContextWrapper(){return this.__glw}getResourceNumber(){return++this.__resourceCounter}getWebGLResource(e){const t=this.__webglResources.get(e);return null!=t?t:null}createIndexBuffer(e){const t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");this.__glw.bindVertexArray(null);const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e.getTypedArray(),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),i}updateIndexBuffer(e,t){const n=this.__glw,i=null==n?void 0:n.getRawContext();if(O.Is.not.exist(i))throw new Error("No WebGLRenderingContext set as Default.");const a=this.__webglResources.get(t);if(O.Is.not.exist(a))throw new Error("Not found VBO.");n.bindVertexArray(null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,a),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.getTypedArray()),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null)}createVertexBuffer(e){const t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");this.__glw.bindVertexArray(null);const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e.bufferView.getUint8Array(),t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),i}createVertexBufferFromTypedArray(e){const t=this.__glw.getRawContext();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");this.__glw.bindVertexArray(null);const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),i}updateVertexBuffer(e,t){const n=this.__glw,i=null==n?void 0:n.getRawContext();if(!O.Is.exist(i))throw new Error("No WebGLRenderingContext set as Default.");const a=this.__webglResources.get(t);if(!O.Is.exist(a))throw new Error("Not found VBO.");n.bindVertexArray(null),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferSubData(i.ARRAY_BUFFER,0,e.bufferView.getUint8Array()),i.bindBuffer(i.ARRAY_BUFFER,null)}createVertexArray(){if(null==this.__glw)throw new Error("No WebGLRenderingContext set as Default.");const e=this.__glw.createVertexArray();if(O.Is.not.exist(e))return;const t=this.getResourceNumber();return this.__webglResources.set(t,e),t}bindTexture2D(e,t){const n=this.getWebGLResource(t);this.__glw.bindTexture2D(e,n)}bindTextureCube(e,t){const n=this.getWebGLResource(t);this.__glw.bindTextureCube(e,n)}createVertexBufferAndIndexBuffer(e){let t;e.hasIndices()&&(t=this.createIndexBuffer(e.indicesAccessor));const n=[];for(let e=0;e<a.T.AttributeTypeNumber;e++)n[e]=!1;const i=[];return e.attributeAccessors.forEach(((t,a)=>{const r=this.createVertexBuffer(t),o=e.attributeSemantics[a].getAttributeSlot();n[o]=!0,i.push(r)})),{vaoHandle:-1,iboHandle:t,vboHandles:i,attributesFlags:n,setComplete:!1}}updateVertexBufferAndIndexBuffer(e,t){t.iboHandle&&this.updateIndexBuffer(e.indicesAccessor,t.iboHandle);const n=e.attributeAccessors;for(let e=0;e<n.length;e++)this.updateVertexBuffer(n[e],t.vboHandles[e])}createShaderProgram({material:e,vertexShaderStr:t,fragmentShaderStr:n,attributeNames:i,attributeSemantics:a}){const r=this.__glw.getRawContext();if(null==r)throw new Error("No WebGLRenderingContext set as Default.");const o=this.__glw.isDebugMode,s=r.createShader(r.VERTEX_SHADER);r.shaderSource(s,t),r.compileShader(s),o&&this.__checkShaderCompileStatus(e.materialTypeName,s,t);const l=r.createShader(r.FRAGMENT_SHADER);r.shaderSource(l,n),r.compileShader(l),o&&this.__checkShaderCompileStatus(e.materialTypeName,l,n);const c=r.createProgram();c._gl=r,c._materialTypeName=e.materialTypeName,c._vertexShaderStr=t,c._fragmentShaderStr=n,c._shaderSemanticsInfoMap=new Map,c._material=e,r.attachShader(c,s),r.attachShader(c,l),i.forEach(((e,t)=>{r.bindAttribLocation(c,a[t].getAttributeSlot(),e)})),r.linkProgram(c),c.__SPECTOR_rebuildProgram=this.rebuildProgram.bind(c),o&&this.__checkShaderProgramLinkStatus(e.materialTypeName,c,t,n);const _=this.getResourceNumber();return this.__webglResources.set(_,c),r.deleteShader(s),r.deleteShader(l),_}__checkShaderCompileStatus(e,t,n){const i=this.__glw.getRawContext();if(O.Is.false(i.getShaderParameter(t,i.COMPILE_STATUS))&&O.Is.false(i.isContextLost()))throw console.log("MaterialTypeName: "+e),console.log(A.Kf.addLineNumberToCode(n)),new Error("An error occurred compiling the shaders:"+i.getShaderInfoLog(t))}__checkShaderProgramLinkStatus(e,t,n,i){const a=this.__glw.getRawContext();if(O.Is.false(a.getProgramParameter(t,a.LINK_STATUS))&&O.Is.false(a.isContextLost()))throw console.log("MaterialTypeName: "+e),console.log(A.Kf.addLineNumberToCode("Vertex Shader:")),console.log(A.Kf.addLineNumberToCode(n)),console.log(A.Kf.addLineNumberToCode("Fragment Shader:")),console.log(A.Kf.addLineNumberToCode(i)),new Error("Unable to initialize the shader program: "+a.getProgramInfoLog(t))}setupUniformLocations(e,t,n){const i=this.__glw,a=i.getRawContext(),r=this.getWebGLResource(e),o=t.length;for(let e=0;e<o;e++){const n=t[e];r._shaderSemanticsInfoMap.set(n.semantic.str,n)}for(let e=0;e<o;e++){const o=t[e];if(n||o.needUniformInFastest||s.d.isTexture(o.compositionType)){const e=o.semantic.str;let t=h.f.fullSemanticStr(o);null!=o.index&&(t.match(/\[.+?\]/)?t=t.replace(/\[.+?\]/g,`[${o.index}]`):t+=`[${o.index}]`),!0!==o.none_u_prefix&&(t="u_"+t);const n=a.getUniformLocation(r,t),s=r;null!=o.index?(null==s[e]&&(s[e]=[]),s[e][o.index]=n):s[e]=n,null==n&&i.isDebugMode&&console.warn(`Rn: Can not get the uniform location: ${t}`)}}return r}setupBasicUniformLocations(e){const t=this.getWebGLResource(e),n=this.currentWebGLContextWrapper.getRawContext();t.dataTexture=n.getUniformLocation(t,"u_dataTexture"),t.currentComponentSIDs=n.getUniformLocation(t,"u_currentComponentSIDs")}setUniformValue(e,t,n,i,a){const r=e._shaderSemanticsInfoMap.get(t);if(O.Is.not.exist(r))return!1;let o=!1,l=0;r.compositionType===s.d.Mat3?(o=!0,l=3):r.compositionType===s.d.Mat4?(o=!0,l=4):l=r.compositionType.getNumberOfComponents();const c=r.compositionType===s.d.ScalarArray||r.compositionType===s.d.Vec4Array||r.compositionType===s.d.Vec3Array||r.compositionType===s.d.Vec2Array,_=t;let h=!1;return r.compositionType===s.d.Texture2D||r.compositionType===s.d.TextureCube?(h=this.setUniformValueInner(e,_,r,o,l,!1,{x:i[0]},a),this.bindTexture(r,i)):h=O.Is.not.exist(a)&&c?null==i._v?this.setUniformValueInner(e,_,r,o,l,!0,{x:i},a):this.setUniformValueInner(e,_,r,o,l,!0,{x:i._v},a):r.compositionType===s.d.Scalar?null==i._v?this.setUniformValueInner(e,_,r,o,l,!1,{x:i},a):this.setUniformValueInner(e,_,r,o,l,!0,{x:i._v},a):null==i._v?this.setUniformValueInner(e,_,r,o,l,!1,i,a):this.setUniformValueInner(e,_,r,o,l,!0,{x:i._v},a),h}bindTexture(e,t){e.compositionType===s.d.Texture2D?this.bindTexture2D(t[0],t[1]instanceof d.Z?t[1].cgApiResourceUid:t[1]):e.compositionType===s.d.TextureCube&&this.bindTextureCube(t[0],t[1]instanceof d.Z?t[1].cgApiResourceUid:t[1])}setUniformValueInner(e,t,n,i,a,r,{x:o,y:s,z:c,w:_},h){const d=t;let u;if(u=null!=h?e[d][h]:e[d],null==u)return!1;const m=u,x=this.__glw.getRawContext();if(i)4===a?x.uniformMatrix4fv(m,!1,o):x.uniformMatrix3fv(m,!1,o);else if(r){const e=n.componentType===l.r.Int||n.componentType===l.r.Short||n.componentType===l.r.Byte;1===a?e?x.uniform1iv(m,o):x.uniform1fv(m,o):2===a?e?x.uniform2iv(m,o):x.uniform2fv(m,o):3===a?e?x.uniform3iv(m,o):x.uniform3fv(m,o):4===a&&(e?x.uniform4iv(m,o):x.uniform4fv(m,o))}else{const e=n.componentType===l.r.Int||n.componentType===l.r.Short||n.componentType===l.r.Byte;1===a?e?x.uniform1i(m,o):x.uniform1f(m,o):2===a?e?x.uniform2i(m,o,s):x.uniform2f(m,o,s):3===a?e?x.uniform3i(m,o,s,c):x.uniform3f(m,o,s,c):4===a&&(e?x.uniform4i(m,o,s,c,_):x.uniform4f(m,o,s,c,_))}return!0}setVertexDataToPipeline({vaoHandle:e,iboHandle:t,vboHandles:n},r,o=i.Z.InvalidCGAPIResourceUid){const c=this.__glw.getRawContext(),_=this.getWebGLResource(e);if(this.__glw.bindVertexArray(_),null!=t){const e=this.getWebGLResource(t);if(null==e)throw new Error("Nothing Element Array Buffer!");c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e)}if(n.forEach(((e,t)=>{const n=this.getWebGLResource(e);if(null==n)throw new Error("Nothing Element Array Buffer at index "+t);c.bindBuffer(c.ARRAY_BUFFER,n),c.enableVertexAttribArray(r.attributeSemantics[t].getAttributeSlot()),c.vertexAttribPointer(r.attributeSemantics[t].getAttributeSlot(),r.attributeCompositionTypes[t].getNumberOfComponents(),r.attributeComponentTypes[t].index,r.attributeAccessors[t].normalized,r.attributeAccessors[t].byteStride,r.attributeAccessors[t].byteOffsetInBufferView)})),o!==i.Z.InvalidCGAPIResourceUid){const e=this.getWebGLResource(o);if(null==e)throw new Error("Nothing Element Array Buffer at index");c.bindBuffer(c.ARRAY_BUFFER,e),c.enableVertexAttribArray(a.T.Instance.getAttributeSlot()),c.vertexAttribPointer(a.T.Instance.getAttributeSlot(),s.d.Scalar.getNumberOfComponents(),l.r.Float.index,!1,0,0),this.__glw.vertexAttribDivisor(a.T.Instance.getAttributeSlot(),1)}c.bindBuffer(c.ARRAY_BUFFER,null),this.__glw.bindVertexArray(null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null)}createTexture(e,{level:t,internalFormat:n,width:i,height:a,border:r,format:o,type:s,magFilter:c,minFilter:h,wrapS:d,wrapT:u,generateMipmap:m,anisotropy:x,isPremultipliedAlpha:f}){const p=this.__glw.getRawContext(),g=this.__glw.isWebGL2,v=p.createTexture(),y=this.getResourceNumber();if(v._resourceUid=y,this.__webglResources.set(y,v),this.__glw.bindTexture2D(0,v),e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement)if(g){const s=this.__glw.getRawContextAsWebGL2();s.texImage2D(s.TEXTURE_2D,t,n.index,i,a,r,o.index,l.r.UnsignedByte.index,e)}else p.texImage2D(p.TEXTURE_2D,t,n.index,o.index,s.index,e);else g?p.texImage2D(p.TEXTURE_2D,t,n.index,i,a,r,o.index,l.r.Float.index,e):p.texImage2D(p.TEXTURE_2D,t,n.index,i,a,r,o.index,s.index,e);return p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,d.index),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,u.index),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,c.index),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,h.index),_.k.isPowerOfTwoTexture(i,a)&&(x?this.__glw.webgl2ExtTFA?p.texParameteri(p.TEXTURE_2D,this.__glw.webgl2ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,4):this.__glw.webgl1ExtTFA&&p.texParameteri(p.TEXTURE_2D,this.__glw.webgl1ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,4):this.__glw.webgl1ExtTFA&&p.texParameteri(p.TEXTURE_2D,this.__glw.webgl1ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,1),m&&1!==a&&1!==i&&(!this.__glw.isWebGL2||!A.Kf.isMobile())&&p.generateMipmap(p.TEXTURE_2D)),this.__glw.unbindTexture2D(0),y}createCompressedTexture(e,t,{magFilter:n,minFilter:i,wrapS:a,wrapT:o,anisotropy:s}){const l=this.__glw.getRawContext(),c=l.createTexture(),h=this.getResourceNumber();c._resourceUid=h,this.__webglResources.set(h,c),this.__glw.bindTexture2D(0,c);const d=t.index;for(const t of e)l.compressedTexImage2D(l.TEXTURE_2D,t.level,d,t.width,t.height,0,t.buffer);l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,n.index),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,a.index),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,o.index),i===r.d.LinearMipmapLinear&&(i=r.d.Linear),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,i.index);const u=e[0].width,m=e[0].height;return _.k.isPowerOfTwoTexture(u,m)&&(s?this.__glw.webgl2ExtTFA?l.texParameteri(l.TEXTURE_2D,this.__glw.webgl2ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,4):this.__glw.webgl1ExtTFA&&l.texParameteri(l.TEXTURE_2D,this.__glw.webgl1ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,4):this.__glw.webgl1ExtTFA&&l.texParameteri(l.TEXTURE_2D,this.__glw.webgl1ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,1)),this.__glw.unbindTexture2D(0),h}createCompressedTextureFromBasis(e,{border:t,format:n,type:i,magFilter:a,minFilter:o,wrapS:s,wrapT:l,anisotropy:c,isPremultipliedAlpha:_}){let h,d;const u=this.__glw.getRawContext(),m=u.createTexture(),x=this.getResourceNumber();m._resourceUid=x,this.__webglResources.set(x,m),u.bindTexture(u.TEXTURE_2D,m);const f=u.getExtension("WEBGL_compressed_texture_s3tc");f&&(h=z.BC3,d=f.COMPRESSED_RGBA_S3TC_DXT5_EXT);const A=u.getExtension("WEBGL_compressed_texture_etc1");A&&(h=z.ETC1,d=A.COMPRESSED_RGB_ETC1_WEBGL);const p=u.getExtension("WEBGL_compressed_texture_atc");p&&(h=z.ATC_RGBA,d=p.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL);const g=u.getExtension("WEBGL_compressed_texture_etc");g&&(h=z.ETC2,d=g.COMPRESSED_RGBA8_ETC2_EAC);const v=u.getExtension("WEBGL_compressed_texture_pvrtc")||u.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");v&&(h=z.PVRTC1_RGBA,d=v.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG);const y=u.getExtension("WEBGL_compressed_texture_astc");y&&(h=z.ASTC,d=y.COMPRESSED_RGBA_ASTC_4x4_KHR);const I=e.getNumLevels(0);for(let n=0;n<I;n++){const i=e.getImageWidth(0,n),a=e.getImageHeight(0,n),r=this.decodeBasisImage(e,h,0,n);u.compressedTexImage2D(u.TEXTURE_2D,n,d,i,a,t,r)}if(0===I){u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,a.index);let e=o;o===r.d.LinearMipmapLinear&&(e=r.d.Linear),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e.index)}else u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,a.index),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,o.index),c&&this.__glw.webgl1ExtTFA&&u.texParameteri(u.TEXTURE_2D,this.__glw.webgl1ExtTFA.TEXTURE_MAX_ANISOTROPY_EXT,4);return u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,s.index),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,l.index),this.__glw.unbindTexture2D(0),x}decodeBasisImage(e,t,n,i){const a=e.getImageTranscodedSizeInBytes(n,i,t.index),r=new Uint8Array(a);return e.transcodeImage(r,n,i,t.index,0,0)||console.error("failed to transcode the image."),r}createFrameBufferObject(){const e=this.__glw.getRawContext().createFramebuffer(),t=this.getResourceNumber();return this.__webglResources.set(t,e),t}attachColorBufferToFrameBufferObject(e,t,n){const i=this.__glw.getRawContext(),a=this.getWebGLResource(e.framebufferUID);i.bindFramebuffer(i.FRAMEBUFFER,a);const r=this.getWebGLResource(n.cgApiResourceUid),o=this.__glw.colorAttachment(t);n instanceof u.Z?(n._fbo=e,i.framebufferTexture2D(i.FRAMEBUFFER,o,i.TEXTURE_2D,r,0)):(n._fbo=e,i.framebufferRenderbuffer(i.FRAMEBUFFER,o,i.RENDERBUFFER,r)),i.bindFramebuffer(i.FRAMEBUFFER,null)}attachDepthBufferToFrameBufferObject(e,t){this.__attachDepthOrStencilBufferToFrameBufferObject(e,t,36096)}attachStencilBufferToFrameBufferObject(e,t){this.__attachDepthOrStencilBufferToFrameBufferObject(e,t,36128)}attachDepthStencilBufferToFrameBufferObject(e,t){this.__attachDepthOrStencilBufferToFrameBufferObject(e,t,33306)}__attachDepthOrStencilBufferToFrameBufferObject(e,t,n){const i=this.__glw.getRawContext(),a=this.getWebGLResource(e.framebufferUID);i.bindFramebuffer(i.FRAMEBUFFER,a);const r=this.getWebGLResource(t.cgApiResourceUid);t instanceof u.Z?(t._fbo=e,i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.TEXTURE_2D,r,0)):(t._fbo=e,i.framebufferRenderbuffer(i.FRAMEBUFFER,n,i.RENDERBUFFER,r)),i.bindFramebuffer(i.FRAMEBUFFER,null)}createRenderBuffer(e,t,n,i,a){const r=this.__glw.getRawContext(),o=r.createRenderbuffer(),s=this.getResourceNumber();return this.__webglResources.set(s,o),r.bindRenderbuffer(r.RENDERBUFFER,o),i?this.__glw.isWebGL2?r.renderbufferStorageMultisample(r.RENDERBUFFER,a,r[n.str],e,t):console.error("MSAA is unavailable in this webgl context"):r.renderbufferStorage(r.RENDERBUFFER,r[n.str],e,t),r.bindRenderbuffer(r.RENDERBUFFER,null),s}setDrawTargets(e){e?this.__glw.drawBuffers(e.colorAttachmentsRenderBufferTargets):this.__glw.drawBuffers([f.G.Back])}bindFramebuffer(e){const t=this.__glw.getRawContext();if(e){const n=e.cgApiResourceUid,i=this.getWebGLResource(n);t.bindFramebuffer(t.FRAMEBUFFER,i)}else t.bindFramebuffer(t.FRAMEBUFFER,null)}unbindFramebuffer(){const e=this.__glw.getRawContext();e.bindFramebuffer(e.FRAMEBUFFER,null)}createRenderTargetTexture({width:e,height:t,level:n,internalFormat:i,format:a,type:r,magFilter:o,minFilter:s,wrapS:c,wrapT:_}){const h=this.__glw.getRawContextAsWebGL2(),d=h.createTexture(),u=this.getResourceNumber();return d._resourceUid=u,this.__webglResources.set(u,d),this.__glw.bindTexture2D(0,d),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,o.index),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,s.index),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,c.index),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,_.index),!this.__glw.isWebGL2||6402!==i.index&&33189!==i.index&&33190!==i.index&&33191!==i.index||(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_COMPARE_MODE,h.COMPARE_REF_TO_TEXTURE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_COMPARE_FUNC,h.LESS)),this.__glw.isWebGL2?h.texImage2D(h.TEXTURE_2D,n,i.index,e,t,0,a.index,l.r.UnsignedByte.index,null):h.texImage2D(h.TEXTURE_2D,n,i.index,e,t,0,a.index,r.index,null),this.__glw.unbindTexture2D(0),u}createCubeTexture(e,t,n,i){const a=this.__glw.getRawContext(),r=a.createTexture(),o=this.getResourceNumber();r._resourceUid=o,this.__webglResources.set(o,r),this.__glw.bindTextureCube(0,r),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),t[0].posX.hdriFormat===m.c.HDR_LINEAR&&this.__glw.isNotSupportWebGL1Extension(H.c.TextureFloatLinear)?(e>=2?a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.NEAREST_MIPMAP_NEAREST):a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.NEAREST)):(e>=2?a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR):a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR));const s=(e,t,r)=>{if(e.hdriFormat===m.c.HDR_LINEAR)if(this.__glw.isWebGL2){const n=this.__glw.getRawContextAsWebGL2();n.texImage2D(t,r,n.RGB32F,e.width,e.height,0,n.RGB,n.FLOAT,e.dataFloat)}else a.texImage2D(t,r,a.RGB,e.width,e.height,0,a.RGB,a.FLOAT,e.dataFloat);else e instanceof HTMLImageElement||e instanceof HTMLCanvasElement?a.texImage2D(t,r,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,e):a.texImage2D(t,r,a.RGBA,n/2**r,i/2**r,0,a.RGBA,a.UNSIGNED_BYTE,e)};for(let e=0;e<t.length;e++){const n=t[e];s(n.posX,a.TEXTURE_CUBE_MAP_POSITIVE_X,e),s(n.negX,a.TEXTURE_CUBE_MAP_NEGATIVE_X,e),s(n.posY,a.TEXTURE_CUBE_MAP_POSITIVE_Y,e),s(n.negY,a.TEXTURE_CUBE_MAP_NEGATIVE_Y,e),s(n.posZ,a.TEXTURE_CUBE_MAP_POSITIVE_Z,e),s(n.negZ,a.TEXTURE_CUBE_MAP_NEGATIVE_Z,e)}return this.__glw.unbindTextureCube(0),o}async createCubeTextureFromFiles(e,t,n,i){const a=this.__glw.getRawContext(),r=[];let o=0,s=0;for(let l=0;l<t;l++){const t=()=>new Promise(((t,r)=>{let o=0;const s=[];let c=".jpg";i===m.c.HDR_LINEAR?c=".hdr":i===m.c.RGBE_PNG&&(c=".RGBE.PNG");let _="_right_",h="_left_",d="_top_",u="_bottom_",x="_front_",f="_back_";n&&(_="_posx_",h="_negx_",d="_posy_",u="_negy_",x="_posz_",f="_negz_");const A=[[e+_+l+c,a.TEXTURE_CUBE_MAP_POSITIVE_X],[e+h+l+c,a.TEXTURE_CUBE_MAP_NEGATIVE_X],[e+d+l+c,a.TEXTURE_CUBE_MAP_POSITIVE_Y],[e+u+l+c,a.TEXTURE_CUBE_MAP_NEGATIVE_Y],[e+x+l+c,a.TEXTURE_CUBE_MAP_POSITIVE_Z],[e+f+l+c,a.TEXTURE_CUBE_MAP_NEGATIVE_Z]];for(let e=0;e<A.length;e++){const n=A[e][1];let a;a=i===m.c.HDR_LINEAR||i===m.c.RGB9_E5_PNG?new HDRImage:new Image,a.hdriFormat=i,a.side=n,a.uri=A[e][0],a.crossOrigin="Anonymous",a.onload=()=>{o++,s.push(a),6===o&&t(s)},a.onerror=()=>{r(a.uri)},a.src=A[e][0]}}));let c;try{c=await t()}catch(e){try{c=await t()}catch(e){console.error(`failed to load ${e}`)}}const _={};for(const e of c){switch(e.side){case a.TEXTURE_CUBE_MAP_POSITIVE_X:_.posX=e;break;case a.TEXTURE_CUBE_MAP_POSITIVE_Y:_.posY=e;break;case a.TEXTURE_CUBE_MAP_POSITIVE_Z:_.posZ=e;break;case a.TEXTURE_CUBE_MAP_NEGATIVE_X:_.negX=e;break;case a.TEXTURE_CUBE_MAP_NEGATIVE_Y:_.negY=e;break;case a.TEXTURE_CUBE_MAP_NEGATIVE_Z:_.negZ=e}0===l&&(o=e.width,s=e.height)}r.push(_)}return this.createCubeTexture(t,r,o,s)}createCubeTextureFromBasis(e,{magFilter:t=r.d.Linear,minFilter:n=r.d.LinearMipmapLinear,wrapS:i=r.d.Repeat,wrapT:a=r.d.Repeat,border:o=0}){const s=this.__glw.getRawContext();let l,c;const _=s.createTexture(),h=this.getResourceNumber();_._resourceUid=h,this.__webglResources.set(h,_),this.__glw.bindTextureCube(0,_);const d=s.getExtension("WEBGL_compressed_texture_s3tc");d&&(l=z.BC3,c=d.COMPRESSED_RGBA_S3TC_DXT5_EXT);const u=s.getExtension("WEBGL_compressed_texture_etc1");u&&(l=z.ETC1,c=u.COMPRESSED_RGB_ETC1_WEBGL);const m=s.getExtension("WEBGL_compressed_texture_atc");m&&(l=z.ATC_RGBA,c=m.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL);const x=s.getExtension("WEBGL_compressed_texture_etc");x&&(l=z.ETC2,c=x.COMPRESSED_RGBA8_ETC2_EAC);const f=s.getExtension("WEBGL_compressed_texture_pvrtc")||s.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");f&&(l=z.PVRTC1_RGBA,c=f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG);const A=s.getExtension("WEBGL_compressed_texture_astc");A&&(l=z.ASTC,c=A.COMPRESSED_RGBA_ASTC_4x4_KHR);const p=e.getNumImages(),g=e.getNumLevels(0);if(s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,i.index),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,a.index),g>=2)s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,n.index),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,t.index);else{let e=n;n===r.d.LinearMipmapLinear&&(e=r.d.Linear),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,e.index),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,t.index)}for(let t=0;t<g;t++)for(let n=0;n<p;n++){const i=e.getImageWidth(n,t),a=e.getImageHeight(n,t),r=this.decodeBasisImage(e,l,n,t);s.compressedTexImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+n,t,c,i,a,o,r)}return this.__glw.unbindTextureCube(0),h}createDummyBlackCubeTexture(){const e=this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPj/HwADBwIAMCbHYQAAAABJRU5ErkJggg=="),t=new Uint8Array(e);return this.createCubeTexture(1,[{posX:t,negX:t,posY:t,negY:t,posZ:t,negZ:t}],1,1)}createDummyCubeTexture(e="rgba(0,0,0,1)"){const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,1,1),this.createCubeTexture(1,[{posX:t,negX:t,posY:t,negY:t,posZ:t,negZ:t}],1,1)}setWebGLTextureDirectly(e){const t=e,n=this.getResourceNumber();return t._resourceUid=n,this.__webglResources.set(n,t),n}async createTextureFromDataUri(e,{level:t,internalFormat:n,border:i,format:a,type:r,magFilter:o,minFilter:s,wrapS:l,wrapT:c,generateMipmap:_,anisotropy:h,isPremultipliedAlpha:d}){return new Promise((u=>{const m=new Image;e.match(/^data:/)||(m.crossOrigin="Anonymous"),m.onload=()=>{const e=m.width,x=m.height,f=this.createTexture(m,{level:t,internalFormat:n,width:e,height:x,border:i,format:a,type:r,magFilter:o,minFilter:s,wrapS:l,wrapT:c,generateMipmap:_,anisotropy:h,isPremultipliedAlpha:d});u(f)},m.src=e}))}updateTexture(e,t,{level:n,xoffset:i,yoffset:a,width:r,height:o,format:s,type:l}){const c=this.getWebGLResource(e),_=this.__glw.isWebGL2;if(this.__glw.bindTexture2D(0,c),_||ArrayBuffer.isView(t)){const e=this.__glw.getRawContextAsWebGL2();e.texSubImage2D(e.TEXTURE_2D,n,0,0,r,o,s.index,l.index,t)}else{const e=this.__glw.getRawContextAsWebGL1();e.texSubImage2D(e.TEXTURE_2D,n,0,0,s.index,l.index,t)}this.__glw.unbindTexture2D(0)}deleteFrameBufferObject(e){const t=this.getWebGLResource(e),n=this.__glw.getRawContext();null!=t&&(n.deleteFramebuffer(t),this.__webglResources.delete(e))}deleteRenderBuffer(e){const t=this.__glw.getRawContext(),n=this.getWebGLResource(e);t.deleteRenderbuffer(n),this.__webglResources.delete(e)}deleteTexture(e){const t=this.getWebGLResource(e),n=this.__glw.getRawContext();null!=t&&(n.deleteTexture(t),this.__webglResources.delete(e))}createDummyTexture(e="rgba(255,255,255,1)"){const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");return n.fillStyle=e,n.fillRect(0,0,1,1),this.createTexture(t,{level:0,internalFormat:o.V.RGBA,width:1,height:1,border:0,format:o.V.RGBA,type:l.r.UnsignedByte,magFilter:r.d.Nearest,minFilter:r.d.Nearest,wrapS:r.d.ClampToEdge,wrapT:r.d.ClampToEdge,generateMipmap:!1,anisotropy:!1,isPremultipliedAlpha:!1})}createDummyBlackTexture(){return this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPj/HwADBwIAMCbHYQAAAABJRU5ErkJggg==")}createDummyWhiteTexture(){return this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8/5/hPwAIAgL/4d1j8wAAAABJRU5ErkJggg==")}createDummyNormalTexture(){return this.__createDummyTextureInner("iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mOsr///HwAGgAL+v1RumAAAAABJRU5ErkJggg==")}__createDummyTextureInner(e){const t=p.Z.base64ToArrayBuffer(e);return this.createTexture(new Uint8Array(t),{level:0,internalFormat:o.V.RGBA,width:1,height:1,border:0,format:o.V.RGBA,type:l.r.UnsignedByte,magFilter:r.d.Nearest,minFilter:r.d.Nearest,wrapS:r.d.ClampToEdge,wrapT:r.d.ClampToEdge,generateMipmap:!1,anisotropy:!1,isPremultipliedAlpha:!1})}createUniformBuffer(e){const t=this.__glw.getRawContextAsWebGL2();if(null==t)throw new Error("No WebGLRenderingContext set as Default.");const n=t.createBuffer(),i=this.getResourceNumber();return this.__webglResources.set(i,n),t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,e,t.DYNAMIC_DRAW),t.bindBuffer(t.UNIFORM_BUFFER,null),i}updateUniformBuffer(e,t,n,i){const a=this.__glw.getRawContextAsWebGL2(),r=this.getWebGLResource(e);a.bindBuffer(a.UNIFORM_BUFFER,r),a.bufferSubData(a.UNIFORM_BUFFER,0,t,n,i),a.bindBuffer(a.UNIFORM_BUFFER,null)}bindUniformBlock(e,t,n){const i=this.__glw.getRawContextAsWebGL2();if(null==i)throw new Error("No WebGLRenderingContext set as Default.");const a=this.getWebGLResource(e),r=i.getUniformBlockIndex(a,t);i.uniformBlockBinding(a,r,n)}bindUniformBufferBase(e,t){const n=this.__glw.getRawContextAsWebGL2();if(null==n)throw new Error("No WebGLRenderingContext set as Default.");const i=this.getWebGLResource(t);n.bindBufferBase(n.UNIFORM_BUFFER,e,i)}deleteUniformBuffer(e){const t=this.__glw.getRawContext();null==t&&new Error("No WebGLRenderingContext set as Default.");const n=this.getWebGLResource(e);this.__webglResources.delete(e),t.deleteBuffer(n)}setupUniformBufferDataArea(e){const t=this.__glw.getRawContextAsWebGL2();null==t&&new Error("No WebGLRenderingContext set as Default.");const n=t.createBuffer(),i=this.getResourceNumber();this.__webglResources.set(i,n);const a=this.__glw.getAlignedMaxUniformBlockSize(),r=e||new Float32Array(a/4);t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,r,t.DYNAMIC_DRAW,0,a),t.bindBuffer(t.UNIFORM_BUFFER,null);const o=this.__glw.getMaxConventionUniformBlocks();for(let e=0;e<o;e++)t.bindBufferRange(t.UNIFORM_BUFFER,e,n,a*e,a);return i}getGlslDataUBODefinitionString(){let e="";const t=this.__glw.getMaxConventionUniformBlocks(),n=this.__glw.getAlignedMaxUniformBlockSize();for(let i=0;i<t;i++)e+=`\nlayout (std140) uniform Vec4Block${i} {\n  vec4 vec4Block${i}[${n/4/4}];\n};\n`;e+="\nvec4 fetchVec4FromVec4Block(int vec4Idx) {\n  int vec4IdxForEachBlock = vec4Idx % dataUBOVec4Size;\n  if (vec4Idx < dataUBOVec4Size) {\n    return vec4Block0[vec4IdxForEachBlock];\n  }";for(let n=1;n<t;n++)e+=`\n else if (vec4Idx < dataUBOVec4Size * ${n+1}) {\n    return vec4Block${n}[vec4IdxForEachBlock];\n}`;return e+="}\n",e}getGlslDataUBOVec4SizeString(){return`const int dataUBOVec4Size = ${this.__glw.getAlignedMaxUniformBlockSize()/4/4};`}createTransformFeedback(){const e=this.__glw.getRawContextAsWebGL2(),t=e.createTransformFeedback(),n=this.getResourceNumber();return this.__webglResources.set(n,t),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,t),n}deleteTransformFeedback(e){const t=this.__glw.getRawContextAsWebGL2(),n=this.getWebGLResource(e);t.deleteTransformFeedback(n),this.__webglResources.delete(e)}setViewport(e){var t,n;e?null===(t=this.__glw)||void 0===t||t.setViewportAsVector4(e):null===(n=this.__glw)||void 0===n||n.setViewport(0,0,this.__glw.width,this.__glw.height)}clearFrameBuffer(e){const t=this.__glw.getRawContext();let n=0;e.toClearColorBuffer&&(t.clearColor(e.clearColor.x,e.clearColor.y,e.clearColor.z,e.clearColor.w),n|=t.COLOR_BUFFER_BIT),e.toClearDepthBuffer&&(t.clearDepth(e.clearDepth),n|=t.DEPTH_BUFFER_BIT),e.toClearStencilBuffer&&(t.clearStencil(e.clearStencil),n|=t.STENCIL_BUFFER_BIT),0!==n&&t.clear(n)}deleteVertexDataResources(e){const t=this.__glw.getRawContext(),n=e.iboHandle;if(n){const e=this.getWebGLResource(n);t.deleteBuffer(e)}const i=e.vboHandles;for(const e of i){const n=this.getWebGLResource(e);t.deleteBuffer(n)}const a=e.vaoHandle,r=this.getWebGLResource(a);this.__glw.deleteVertexArray(r)}deleteVertexArray(e){const t=this.getWebGLResource(e);this.__glw.deleteVertexArray(t)}deleteVertexBuffer(e){const t=this.__glw.getRawContext(),n=this.getWebGLResource(e);t.deleteBuffer(n)}resizeCanvas(e,t){this.__glw.width=e,this.__glw.height=t,this.__glw.canvas.width=e,this.__glw.canvas.height=t,this.__glw.setViewportAsVector4(x.ZP.fromCopyArray([0,0,e,t]))}switchDepthTest(e){const t=this.__glw.getRawContext();e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST)}rebuildProgram(e,t,n,i){const a=this._material;if(O.Is.not.exist(a)){const e="Material Not found";return console.warn(e),i(e),!1}const r=G.Z.getInstance().processApproach,o=(0,Q.Z)(r),s=e.replace(/! =/g,"!="),l=t.replace(/! =/g,"!="),c=o.setupShaderForMaterial(a,{vertex:s,pixel:l});return n(k.getInstance().getWebGLResource(c)),!0}}},6406:(e,t,n)=>{"use strict";n.d(t,{Z:()=>N});var i=n(7571),a=n(5704),r=n(5850),o=n(7987),s=n(4690),l=n(2251),c=n(8268),_=n(7348),h=n(4587),d=n(810),u=n(3999),m=n(5324),x=n(3616),f=n(1813),A=n(2471);let p,g,v,y,I,b,T,S,E,C;function w(e,t,n){(g!==e||v!==t)&&(n.blendEquationSeparate(e,t),g=e,v=t)}function D(e,t,n,i,a){(y!==e||I!==t||b!==n||T!==i)&&(a.blendFuncSeparate(e,t,n,i),y=e,I=t,b=n,T=i)}const N=Object.freeze({setWebGLParameters:function(e,t){!function(e,t){const n=e.cullFace,i=e.cullFrontFaceCCW;S!==n&&(n?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),S=n),!0===n&&E!==i&&(i?t.frontFace(t.CCW):t.frontFace(t.CW),E=i)}(e,t),function(e,t){const n=e.isBlend();p!==n&&(n?t.enable(t.BLEND):t.disable(t.BLEND),p=n),e.alphaMode===a.F.Translucent?(w(e.blendEquationMode,e.blendEquationModeAlpha,t),D(e.blendFuncSrcFactor,e.blendFuncDstFactor,e.blendFuncAlphaSrcFactor,e.blendFuncAlphaDstFactor,t)):e.alphaMode===a.F.Additive&&(w(32774,32774,t),D(1,1,1,1,t))}(e,t),function(e,t){const n=e.alphaToCoverage;n!==C&&(n?t.enable(t.SAMPLE_ALPHA_TO_COVERAGE):t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),C=n)}(e,t)},startDepthMasking:function(e,t){r.Z.isDepthMaskTrueForTransparencies||e===r.Z.firstTransparentIndex&&t.depthMask(!1)},endDepthMasking:function(e,t){e===r.Z.lastTransparentIndex&&t.depthMask(!0)},updateVBOAndVAO:function(e){const t=e.getPrimitiveNumber();for(let n=0;n<t;n++){const t=e.getPrimitiveAt(n);s.Is.exist(t.vertexHandles)?t.update3DAPIVertexData():t.create3DAPIVertexData()}e.updateVariationVBO(),e.updateVAO()},isMeshSetup:function(e){if(e._variationVBOUid===o.Z.InvalidCGAPIResourceUid)return!1;const t=e.getPrimitiveNumber();for(let n=0;n<t;n++){const t=e.getPrimitiveAt(n);if(!s.Is.exist(t.vertexHandles)||t.isPositionAccessorUpdated)return!1}return!0},isMaterialsSetup:function(e){if(e.mesh._variationVBOUid!==o.Z.InvalidCGAPIResourceUid){const t=e.mesh.getPrimitiveNumber();let n=0;for(let i=0;i<t;i++)-1!==e.mesh.getPrimitiveAt(i).material._shaderProgramUid&&n++;return t===n}return!1},isSkipDrawing:function(e,t){return!!(e.isEmptyMaterial()||-1===e._shaderProgramUid||t<r.Z.firstTransparentIndex&&e.isBlend()||t>=r.Z.firstTransparentIndex&&!e.isBlend())},setVRViewport:function(e,t){const n=c.Z.getInstance(),i=l.Z.getInstance().getModule("xr"),a=i.WebXRSystem.getInstance();if(a.isWebXRMode)n.setViewport(a._getViewportAt(t));else{const a=i.WebVRSystem.getInstance();a.isWebVRMode&&n.setViewport(a.getViewportAt(function(e){const t=c.Z.getInstance();let n=e.getViewport();return null==n&&(n=t.currentWebGLContextWrapper.defaultViewport),n}(e),t))}},getDisplayNumber:function(e){return e?2:1},isVrMainPass:function(e){const t=l.Z.getInstance().getModule("xr");return((null==t?void 0:t.WebXRSystem.getInstance().isWebXRMode)||(null==t?void 0:t.WebVRSystem.getInstance().isWebVRMode))&&e.isVrRendering},getLocationOffsetOfProperty:function(e,t){return s.Is.exist(t)?i.Z.getLocationOffsetOfMemberOfMaterial(t,e):_.Z.getInstance().getLocationOffsetOfProperty(e)},getPointSpriteShaderSemanticsInfoArray:function(){return[{semantic:h.f.PointSize,compositionType:d.d.Scalar,componentType:u.r.Float,stage:m.H.PixelShader,initialValue:x.ZP.fromCopyNumber(30),min:0,max:Number.MAX_VALUE,isSystem:!1,updateInterval:f.a.EveryTime},{semantic:h.f.PointDistanceAttenuation,compositionType:d.d.Vec3,componentType:u.r.Float,stage:m.H.PixelShader,initialValue:A.ZP.fromCopyArray([0,.1,.01]),min:0,max:1,isSystem:!1,updateInterval:f.a.EveryTime}]}})},6042:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});var i=n(8268),a=n(6019),r=n(7987),o=n(4587),s=n(2404),l=n(4322),c=n(346),_=n(9216),h=n(3999),d=n(5981),u=n(810),m=n(1813),x=n(9286),f=n(5324),A=n(752),p=n(7348),g=n(6098),v=n(6406),y=n(4690);class I{constructor(){this.__webglResourceRepository=i.Z.getInstance(),this.__dataTextureUid=r.Z.InvalidCGAPIResourceUid,this.__lastShader=-1,this.__lastRenderPassTickCount=-1,this.componentMatrices=[{semantic:o.f.VertexAttributesExistenceArray,compositionType:u.d.ScalarArray,componentType:h.r.Int,stage:f.H.VertexShader,min:0,max:1,isSystem:!0,updateInterval:m.a.EveryTime},{semantic:o.f.WorldMatrix,compositionType:u.d.Mat4,componentType:h.r.Float,stage:f.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:m.a.EveryTime},{semantic:o.f.NormalMatrix,compositionType:u.d.Mat3,componentType:h.r.Float,stage:f.H.VertexShader,min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isSystem:!0,updateInterval:m.a.EveryTime}]}setupShaderProgram(e){if(null==e.mesh)return void a.Z.alertNoMeshSet(e);const t=e.mesh.getPrimitiveNumber();for(let n=0;n<t;n++){const t=e.mesh.getPrimitiveAt(n),i=t.material;if(null==i||i.isEmptyMaterial())continue;if(i._shaderProgramUid!==r.Z.InvalidCGAPIResourceUid)continue;const a=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();t.primitiveMode.index,a.POINTS;try{this.setupShaderForMaterial(i),t._backupMaterial()}catch(e){console.log(e),t._restoreMaterial(),this.setupShaderForMaterial(t.material)}}}setupShaderForMaterial(e,t){const n=i.Z.getInstance().currentWebGLContextWrapper;let a;a=y.Is.not.exist(t)?e.createProgram(I.__vertexShaderMethodDefinitions_uniform,o.f.getShaderProperty,n.isWebGL2):e.createProgramByUpdatedSources(t),e.setupBasicUniformsLocations(),e.setUniformLocationsOfMaterialNodes(!0);const r=this.componentMatrices,s=v.Z.getPointSpriteShaderSemanticsInfoArray();return e.setupAdditionalUniformLocations(r.concat(s),!0),I.__globalDataRepository.setUniformLocationsForUniformModeOnly(e._shaderProgramUid),a}$load(e){const t=e.mesh;y.Is.exist(t)?(v.Z.isMaterialsSetup(e)||this.setupShaderProgram(e),v.Z.isMeshSetup(t)||v.Z.updateVBOAndVAO(t)):a.Z.alertNoMeshSet(e)}$prerender(e,t,n){null!=e.mesh||a.Z.alertNoMeshSet(e)}common_$prerender(){const e=s.Z.getInstance();if(this.__lightComponents=e.getComponentsWithType(l.Z),this.__dataTextureUid===r.Z.InvalidCGAPIResourceUid){const e=x.Z.getInstance().getBuffer(A.$.GPUVertexData);if(null==e)return;e.takenSizeInByte/x.Z.bufferWidthLength/4>x.Z.bufferHeightLength&&console.warn("The buffer size exceeds the size of the data texture.");const t=x.Z.bufferWidthLength*x.Z.bufferHeightLength*4*4,n=g.Kf.concatArrayBuffers2({finalSize:t,srcs:[e.getArrayBuffer()],srcsCopySize:[e.takenSizeInByte],srcsOffset:[0]}),i=new Float32Array(n);this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:d.d.RGBA32F,width:x.Z.bufferWidthLength,height:x.Z.bufferHeightLength,border:0,format:_.V.RGBA,type:h.r.Float,magFilter:d.d.Nearest,minFilter:d.d.Nearest,wrapS:d.d.Repeat,wrapT:d.d.Repeat,generateMipmap:!1,anisotropy:!1,isPremultipliedAlpha:!0}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(i,{level:0,internalFormat:_.V.RGBA,width:x.Z.bufferWidthLength,height:x.Z.bufferHeightLength,border:0,format:_.V.RGBA,type:h.r.Float,magFilter:d.d.Nearest,minFilter:d.d.Nearest,wrapS:d.d.Repeat,wrapT:d.d.Repeat,generateMipmap:!1,anisotropy:!1,isPremultipliedAlpha:!0})}}attachGPUData(e){}attachShaderProgram(e){}attachVertexData(e,t,n,i){}attachVertexDataInner(e,t,n,i,a){const r=t.vertexHandles,o=this.__webglResourceRepository.getWebGLResource(e.getVaoUids(n)),s=i.getRawContext();if(null!=o)i.bindVertexArray(o);else{this.__webglResourceRepository.setVertexDataToPipeline(r,t,a);const e=this.__webglResourceRepository.getWebGLResource(r.iboHandle);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e)}}dettachVertexData(e){const t=e.getRawContext();e.bindVertexArray&&e.bindVertexArray(null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindBuffer(t.ARRAY_BUFFER,null)}static getInstance(){return this.__instance||(this.__instance=new I),this.__instance}common_$render(e,t,n,i,a){return!1}$render(e,t,n,i,o,s,l,c,_){if(null==t.mesh)return void a.Z.alertNoMeshSet(t);const h=this.__webglResourceRepository.currentWebGLContextWrapper,d=h.getRawContext();v.Z.startDepthMasking(e,d);const u=v.Z.isVrMainPass(s),m=v.Z.getDisplayNumber(u);for(let a=0;a<m;a++){u&&v.Z.setVRViewport(s,a);const m=t.mesh.getPrimitiveNumber();for(let x=0;x<m;x++){const m=t.mesh.getPrimitiveAt(x),f=s.getAppropriateMaterial(m,m.material);if(v.Z.isSkipDrawing(f,e))continue;this.attachVertexDataInner(t.mesh,m,x,h,r.Z.InvalidCGAPIResourceUid);const A=this.__webglResourceRepository.getWebGLResource(f._shaderProgramUid),p=f._shaderProgramUid;let g=l!==this.__lastRenderPassTickCount;p!==this.__lastShader&&(g=!0,d.useProgram(A),d.uniform1i(A.dataTexture,7),this.__webglResourceRepository.bindTexture2D(7,this.__dataTextureUid),this.__lastShader=p),this.__lastMaterial!==f&&(g=!0,this.__lastMaterial=f),v.Z.setWebGLParameters(f,d),f._setParametersForGPU({material:f,shaderProgram:A,firstTime:g,args:{setUniform:!0,glw:h,entity:o,primitive:m,worldMatrix:n,normalMatrix:i,lightComponents:this.__lightComponents,renderPass:s,diffuseCube:c,specularCube:_,isVr:u,displayIdx:a}}),m.indicesAccessor?h.drawElementsInstanced(m.primitiveMode.index,m.indicesAccessor.elementCount,m.indicesAccessor.componentType.index,0,1):h.drawArraysInstanced(m.primitiveMode.index,0,m.getVertexCountAsVerticesBased(),1)}}v.Z.endDepthMasking(e,d),this.__lastRenderPassTickCount=l}}I.__globalDataRepository=p.Z.getInstance(),I.__vertexShaderMethodDefinitions_uniform=`uniform mat4 u_worldMatrix;\nuniform mat3 u_normalMatrix;\n\nmat4 get_worldMatrix(float instanceId) {\n  return u_worldMatrix;\n}\n\nmat3 get_normalMatrix(float instanceId) {\n  return u_normalMatrix;\n}\n\n#ifdef RN_IS_MORPHING\n  vec3 get_position(float vertexId, vec3 basePosition) {\n    vec3 position = basePosition;\n    int scalar_idx = 3 * int(vertexId);\n    #ifdef GLSL_ES3\n      int posIn4bytes = scalar_idx % 4;\n    #else\n      int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n    #endif\n    for (int i=0; i<${c.Z.maxVertexMorphNumberInShader}; i++) {\n\n      int basePosIn16bytes = u_dataTextureMorphOffsetPosition[i] + (scalar_idx - posIn4bytes)/4;\n\n      vec3 addPos = vec3(0.0);\n      if (posIn4bytes == 0) {\n        vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        addPos = val.xyz;\n      } else if (posIn4bytes == 1) {\n        vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        addPos = vec3(val0.yzw);\n      } else if (posIn4bytes == 2) {\n        vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, widthOfDataTexture, heightOfDataTexture);\n        addPos = vec3(val0.zw, val1.x);\n      } else if (posIn4bytes == 3) {\n        vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, widthOfDataTexture, heightOfDataTexture);\n        addPos = vec3(val0.w, val1.xy);\n      }\n\n      // int index = u_dataTextureMorphOffsetPosition[i] + 1 * int(vertexId);\n      // vec3 addPos = fetchElement(u_dataTexture, index, widthOfDataTexture, heightOfDataTexture).xyz;\n\n      position += addPos * u_morphWeights[i];\n      if (i == u_morphTargetNumber-1) {\n        break;\n      }\n    }\n\n    return position;\n  }\n#endif\n  `},9696:(e,t,n)=>{"use strict";n.d(t,{Z:()=>D});var i=n(7683),a=n(6042),r=n(8268),o=n(9286),s=n(9216),l=n(3999),c=n(5981),_=n(752),h=n(6019),d=n(7987),u=n(4587),m=n(7571),x=n(810),f=n(9721),A=n(5333),p=n(2404),g=n(4322),v=n(346),y=n(1784),I=n(7348),b=n(4710),T=n(6098),S=n(6406),E=n(2251),C=n(4690);class w{constructor(){this.__webglResourceRepository=r.Z.getInstance(),this.__dataTextureUid=d.Z.InvalidCGAPIResourceUid,this.__dataUBOUid=d.Z.InvalidCGAPIResourceUid,this.__lastShader=d.Z.InvalidCGAPIResourceUid,this.__lastRenderPassTickCount=-1,this._totalSizeOfGPUShaderDataStorageExceptMorphData=0}get vertexShaderMethodDefinitions_dataTexture(){return`\n\n  mat4 get_worldMatrix(float instanceId)\n  {\n    int index = ${f.Z.getLocationOffsetOfMemberOfComponent(A.Z,"worldMatrix")} + 4 * int(instanceId);\n    mat4 matrix = fetchMat4(u_dataTexture, index, widthOfDataTexture, heightOfDataTexture);\n\n    return matrix;\n  }\n\n\n  mat3 get_normalMatrix(float instanceId) {\n    int index = ${f.Z.getLocationOffsetOfMemberOfComponent(A.Z,"normalMatrix")} + 3 * int(instanceId);\n    mat3 matrix = fetchMat3(u_dataTexture, index, widthOfDataTexture, heightOfDataTexture);\n    return matrix;\n  }\n\n#ifdef RN_IS_MORPHING\n  vec3 get_position(float vertexId, vec3 basePosition) {\n    vec3 position = basePosition;\n    int scalar_idx = 3 * int(vertexId);\n    #ifdef GLSL_ES3\n      int posIn4bytes = scalar_idx % 4;\n    #else\n      int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n    #endif\n    for (int i=0; i<${v.Z.maxVertexMorphNumberInShader}; i++) {\n\n      int basePosIn16bytes = u_dataTextureMorphOffsetPosition[i] + (scalar_idx - posIn4bytes)/4;\n\n      vec3 addPos = vec3(0.0);\n      if (posIn4bytes == 0) {\n        vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        addPos = val.xyz;\n      } else if (posIn4bytes == 1) {\n        vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        addPos = vec3(val0.yzw);\n      } else if (posIn4bytes == 2) {\n        vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, widthOfDataTexture, heightOfDataTexture);\n        addPos = vec3(val0.zw, val1.x);\n      } else if (posIn4bytes == 3) {\n        vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, widthOfDataTexture, heightOfDataTexture);\n        vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, widthOfDataTexture, heightOfDataTexture);\n        addPos = vec3(val0.w, val1.xy);\n      }\n\n      // int index = u_dataTextureMorphOffsetPosition[i] + 1 * int(vertexId);\n      // vec3 addPos = fetchElement(u_dataTexture, index, widthOfDataTexture, heightOfDataTexture).xyz;\n\n      position += addPos * u_morphWeights[i];\n      if (i == u_morphTargetNumber-1) {\n        break;\n      }\n    }\n\n    return position;\n  }\n#endif\n  `}setupShaderProgramForMeshComponent(e){if(null==e.mesh)return void h.Z.alertNoMeshSet(e);const t=e.mesh.getPrimitiveNumber();for(let n=0;n<t;n++){const t=e.mesh.getPrimitiveAt(n),i=t.material;if(null==i||i.isEmptyMaterial())continue;if(i.isShaderProgramReady())continue;const a=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();t.primitiveMode.index,a.POINTS;try{this.setupShaderForMaterial(i),t._backupMaterial()}catch(e){console.log(e),t._restoreMaterial(),this.setupShaderForMaterial(t._prevMaterial)}}}setupShaderForMaterial(e,t){const n=r.Z.getInstance().currentWebGLContextWrapper;let i;return i=C.Is.not.exist(t)?e.createProgram(this.vertexShaderMethodDefinitions_dataTexture,this.__getShaderProperty,n.isWebGL2):e.createProgramByUpdatedSources(t),e.setupBasicUniformsLocations(),e.setUniformLocationsOfMaterialNodes(!1),e.setupAdditionalUniformLocations(S.Z.getPointSpriteShaderSemanticsInfoArray(),!1),i}__getShaderProperty(e,t,n,i,a){var r,o;const s=t.compositionType.getGlslStr(t.componentType),c=[];let _,h=1;const d=t.compositionType===x.d.Texture2D||t.compositionType===x.d.TextureCube,f=t.semantic.str.replace(".","_");let A="";const p=t.compositionType.getGlslStr(t.componentType);let g="";t.maxIndex&&(g=`[${t.maxIndex}]`),(t.needUniformInFastest||d)&&(A=`  uniform ${p} u_${f}${g};\n`);const v=t.compositionType.getVec4SizeOfProperty();if(n<0){if(Math.abs(n)%u.w._scale!=0)return"";const i=m.Z.getLocationOffsetOfMemberOfMaterial(e,n);if(a)_=`\n          int vec4_idx = ${i} + ${v} * instanceId;\n          `;else{for(let e=0;e<t.maxIndex;e++)c.push(i);h=t.maxIndex;let e=`int indices[${h}];`;c.forEach(((t,n)=>{e+=`\nindices[${n}] = ${t};`})),_=`\n          ${e}\n          int vec4_idx = 0;\n          for (int i=0; i<${h}; i++) {\n            vec4_idx = indices[i] + ${v} * instanceId;\n            if (i == index) {\n              break;\n            }\n          }`}}else{const a=t.compositionType.getNumberOfComponents();let s=-1;s=i?S.Z.getLocationOffsetOfProperty(n):S.Z.getLocationOffsetOfProperty(n,e),-1===s&&console.error("Could not get the location offset of the property.");const l=v*(null!==(r=t.maxIndex)&&void 0!==r?r:1);_=`int vec4_idx = ${s} + ${l} * instanceId;\n`,x.d.isArray(t.compositionType)&&(_=`int vec4_idx = ${s} + ${l} * instanceId + ${v} * idxOfArray;\n`,_+=`int scalar_idx = ${4*s} + ${a*(null!==(o=t.maxIndex)&&void 0!==o?o:1)} * instanceId + ${a} * idxOfArray;\n`)}let y="";t.componentType===l.r.Int&&t.compositionType!==x.d.Scalar&&(y="i");let I="";d||(I+=`\n${s} get_${f}(highp float _instanceId, const int idxOfArray) {\n  int instanceId = int(_instanceId);\n  ${_}\n  `);let b=`${A}${I}`;switch(t.compositionType){case x.d.Vec4:case x.d.Vec4Array:b+="        highp vec4 val = fetchElement(u_dataTexture, vec4_idx, widthOfDataTexture, heightOfDataTexture);\n";break;case x.d.Vec3:b+="        vec4 col0 = fetchElement(u_dataTexture, vec4_idx, widthOfDataTexture, heightOfDataTexture);\n",b+=`        highp ${y}vec3 val = ${y}vec3(col0.xyz);`;break;case x.d.Vec3Array:b+="        vec3 val = fetchVec3No16BytesAligned(u_dataTexture, scalar_idx, widthOfDataTexture, heightOfDataTexture);\n";break;case x.d.Vec2:b+="        highp vec4 col0 = fetchElement(u_dataTexture, vec4_idx, widthOfDataTexture, heightOfDataTexture);\n",b+=`        highp ${y}vec2 val = ${y}vec2(col0.xy);`;break;case x.d.Vec2Array:b+="        highp vec2 val = fetchVec2No16BytesAligned(u_dataTexture, scalar_idx, widthOfDataTexture, heightOfDataTexture);\n";break;case x.d.Scalar:b+="        vec4 col0 = fetchElement(u_dataTexture, vec4_idx, widthOfDataTexture, heightOfDataTexture);\n",t.componentType===l.r.Int?b+="        int val = int(col0.x);":t.componentType===l.r.Bool?b+="        bool val = bool(col0.x);":b+="       float val = col0.x;";break;case x.d.ScalarArray:b+="        float col0 = fetchScalarNo16BytesAligned(u_dataTexture, scalar_idx, widthOfDataTexture, heightOfDataTexture);\n",t.componentType===l.r.Int?b+="        int val = int(col0);":t.componentType===l.r.Bool?b+="        bool val = bool(col0);":b+="       float val = col0;";break;case x.d.Mat4:case x.d.Mat4Array:b+="        mat4 val = fetchMat4(u_dataTexture, vec4_idx, widthOfDataTexture, heightOfDataTexture);\n";break;case x.d.Mat3:b+="        mat3 val = fetchMat3(u_dataTexture, vec4_idx, widthOfDataTexture, heightOfDataTexture);\n";break;case x.d.Mat3Array:b+="        mat3 val = fetchMat3No16BytesAligned(u_dataTexture, scalar_idx, widthOfDataTexture, heightOfDataTexture);\n";break;case x.d.Mat2:b+="        mat2 val = fetchMat2(u_dataTexture, vec4_idx, widthOfDataTexture, heightOfDataTexture);\n";break;case x.d.Mat2Array:b+="        mat2 val = fetchMat2No16BytesAligned(u_dataTexture, scalar_idx, widthOfDataTexture, heightOfDataTexture);\n";break;default:b+=""}return d||(b+="\n      return val;\n    }\n  "),b}$load(e){const t=e.mesh;C.Is.exist(t)?(w.__currentComponentSIDs=w.__globalDataRepository.getValue(u.f.CurrentComponentSIDs,0),S.Z.isMaterialsSetup(e)||this.setupShaderProgramForMeshComponent(e),S.Z.isMeshSetup(t)||S.Z.updateVBOAndVAO(t)):h.Z.alertNoMeshSet(e)}$prerender(e,t,n){t._readyForRendering||(null!=e.mesh?(e.mesh.isInstanceMesh(),t._readyForRendering=!0):h.Z.alertNoMeshSet(e))}__createAndUpdateDataTexture(){const e=o.Z.getInstance(),t=e.getBuffer(_.$.GPUInstanceData),n=this.__webglResourceRepository.currentWebGLContextWrapper,i=this.__isUboUse()?n.getAlignedMaxUniformBlockSize():0;if(null==t)return;const a=o.Z.bufferWidthLength*o.Z.bufferHeightLength*4*4;if(this.__dataTextureUid!==d.Z.InvalidCGAPIResourceUid){const e=t.takenSizeInByte-i,n=Math.min(Math.ceil(e/o.Z.bufferWidthLength/4/4),o.Z.bufferHeightLength),r=o.Z.bufferWidthLength*n*4*4;e>a&&console.warn("The buffer size exceeds the size of the data texture.");const c=new Float32Array(t.getArrayBuffer(),i,r/4);this.__webglResourceRepository.updateTexture(this.__dataTextureUid,c,{level:0,xoffset:0,yoffset:0,width:o.Z.bufferWidthLength,height:n,format:s.V.RGBA,type:l.r.Float})}else{const n=e.getBuffer(_.$.GPUVertexData);let r,h=0,d=new ArrayBuffer(0);null!=n&&(h=n.takenSizeInByte,d=n.getArrayBuffer());{const n=e.getBuffer(_.$.GPUVertexData);let s=0;null!=n&&(s=n.takenSizeInByte);let l=new ArrayBuffer(0);null!=n&&(l=n.getArrayBuffer());const c=t.takenSizeInByte-i,h=4*(o.Z.bufferWidthLength-c/4/4%o.Z.bufferWidthLength)*4,d=T.Kf.concatArrayBuffers2({finalSize:a,srcs:[t.getArrayBuffer(),l],srcsCopySize:[c+h,s],srcsOffset:[i,0]});c+h+s>a&&console.warn("The buffer size exceeds the size of the data texture."),r=new Float32Array(d),v.Z.totalSizeOfGPUShaderDataStorageExceptMorphData=t.takenSizeInByte+h}this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?this.__dataTextureUid=this.__webglResourceRepository.createTexture(r,{level:0,internalFormat:c.d.RGBA32F,width:o.Z.bufferWidthLength,height:o.Z.bufferHeightLength,border:0,format:s.V.RGBA,type:l.r.Float,magFilter:c.d.Nearest,minFilter:c.d.Nearest,wrapS:c.d.Repeat,wrapT:c.d.Repeat,generateMipmap:!1,anisotropy:!1,isPremultipliedAlpha:!0}):this.__dataTextureUid=this.__webglResourceRepository.createTexture(r,{level:0,internalFormat:s.V.RGBA,width:o.Z.bufferWidthLength,height:o.Z.bufferHeightLength,border:0,format:s.V.RGBA,type:l.r.Float,magFilter:c.d.Nearest,minFilter:c.d.Nearest,wrapS:c.d.Repeat,wrapT:c.d.Repeat,generateMipmap:!1,anisotropy:!1,isPremultipliedAlpha:!0})}}common_$prerender(){this.__createAndUpdateDataTexture(),this.__createAndUpdateUBO();const e=p.Z.getInstance();this.__lightComponents=e.getComponentsWithType(g.Z)}__isUboUse(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2&&v.Z.isUboEnabled}__createAndUpdateUBO(){if(this.__isUboUse()){const e=this.__webglResourceRepository.currentWebGLContextWrapper.getAlignedMaxUniformBlockSize(),t=o.Z.getInstance().getBuffer(_.$.GPUInstanceData);this.__dataUBOUid===d.Z.InvalidCGAPIResourceUid?this.__dataUBOUid=this.__webglResourceRepository.setupUniformBufferDataArea(new Float32Array(t.getArrayBuffer())):this.__webglResourceRepository.updateUniformBuffer(this.__dataUBOUid,new Float32Array(t.getArrayBuffer()),0,e)}}attachGPUData(e){const t=e.material,n=this.__webglResourceRepository.currentWebGLContextWrapper,i=n.getRawContext(),a=this.__webglResourceRepository.getWebGLResource(this.__dataTextureUid);n.bindTexture2D(0,a);const r=this.__webglResourceRepository.getWebGLResource(t._shaderProgramUid),o=i.getUniformLocation(r,"u_dataTexture");i.uniform1i(o,0)}attachGPUDataInner(e,t){this.__webglResourceRepository.bindTexture2D(0,this.__dataTextureUid);const n=e.getUniformLocation(t,"u_dataTexture");e.uniform1i(n,0)}attachShaderProgram(e){const t=e._shaderProgramUid;if(t!==this.__lastShader){const e=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext(),n=this.__webglResourceRepository.getWebGLResource(t);e.useProgram(n),this.__lastShader=t}}attachVertexData(e,t,n,i){}attachVertexDataInner(e,t,n,i,a){const r=t.vertexHandles,o=this.__webglResourceRepository.getWebGLResource(e.getVaoUids(n)),s=i.getRawContext();if(null!=o)i.bindVertexArray(o);else{this.__webglResourceRepository.setVertexDataToPipeline(r,t,e._variationVBOUid);const n=this.__webglResourceRepository.getWebGLResource(r.iboHandle);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,n)}}static getInstance(){return this.__instance||(this.__instance=new w),this.__instance}__setCurrentComponentSIDsForEachRenderPass(e,t,n){if(n){const e=E.Z.getInstance().getModule("xr"),n=e.WebXRSystem.getInstance();let i=-1;i=n.isWebXRMode?n._getCameraComponentSIDAt(t):e.WebVRSystem.getInstance().getCameraComponentSIDAt(t),w.__currentComponentSIDs._v[b.z.CameraComponentTID]=i}else{let t=e.cameraComponent;null==t&&(t=p.Z.getInstance().getComponent(y.Z,y.Z.main)),w.__currentComponentSIDs._v[b.z.CameraComponentTID]=t?t.componentSID:-1}}__setCurrentComponentSIDsForEachEntity(e,t,n){const i=n.getSkeletal();if(i){let e=0;i.componentSID<v.Z.maxSkeletonNumber&&(e=i.componentSID),w.__currentComponentSIDs._v[b.z.SkeletalComponentTID]=e}else w.__currentComponentSIDs._v[b.z.SkeletalComponentTID]=-1}__setCurrentComponentSIDsForEachPrimitive(e,t,n,i){w.__currentComponentSIDs._v[0]=n.materialSID,e.uniform1fv(w.__shaderProgram.currentComponentSIDs,w.__currentComponentSIDs._v)}common_$render(e,t,n,i,a,r){const o=this.__webglResourceRepository.currentWebGLContextWrapper,s=o.getRawContext(),l=S.Z.isVrMainPass(a),c=S.Z.getDisplayNumber(l);for(let n=0;n<c;n++){l&&S.Z.setVRViewport(a,n),this.__setCurrentComponentSIDsForEachRenderPass(a,n,l);for(let n=0;n<e.length;n++){const i=e[n];if(i===f.Z.invalidComponentSID)break;const r=t[i];if(null==r)break;const l=r.mesh;if(!(null==l?void 0:l.isOriginalMesh()))continue;S.Z.startDepthMasking(n,s);const c=r.entity;this.__setCurrentComponentSIDsForEachEntity(s,a,c);const _=c.getMeshRenderer(),h=l.getPrimitiveNumber();let d=!1;for(let e=0;e<h;e++){const t=l.getPrimitiveAt(e),i=a.getAppropriateMaterial(t,t.material);if(S.Z.isSkipDrawing(i,n))continue;const r=i._shaderProgramUid;if(this.attachVertexDataInner(l,t,e,o,l._variationVBOUid),r!==this.__lastShader){const e=this.__webglResourceRepository.getWebGLResource(r);s.useProgram(e),s.uniform1i(e.dataTexture,7),this.__webglResourceRepository.bindTexture2D(7,this.__dataTextureUid),w.__shaderProgram=e,d=!0}this.__lastMaterial!==i&&(d=!0,this.__lastMaterial=i),this.__setCurrentComponentSIDsForEachPrimitive(s,a,i,c),S.Z.setWebGLParameters(i,s),i._setParametersForGPU({material:i,shaderProgram:w.__shaderProgram,firstTime:d,args:{glw:o,entity:c,worldMatrix:c.getSceneGraph().worldMatrixInner,normalMatrix:c.getSceneGraph().normalMatrixInner,lightComponents:this.__lightComponents,renderPass:a,primitive:t,diffuseCube:_.diffuseCubeMap,specularCube:_.specularCubeMap,setUniform:!1}}),t.indicesAccessor?o.drawElementsInstanced(t.primitiveMode.index,t.indicesAccessor.elementCount,t.indicesAccessor.componentType.index,0,l.instanceCountIncludeOriginal):o.drawArraysInstanced(t.primitiveMode.index,0,t.getVertexCountAsVerticesBased(),l.instanceCountIncludeOriginal),this.__lastShader=r}}}return this.__lastRenderPassTickCount=r,!1}$render(e,t,n,i,a,r,o,s,l){const c=this.__webglResourceRepository.currentWebGLContextWrapper.getRawContext();S.Z.endDepthMasking(e,c)}}w.__globalDataRepository=I.Z.getInstance();const D=function(e){return i.V.isFastestApproach(e)?w.getInstance():(i.V.isUniformApproach(e),a.Z.getInstance())}},8511:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var i=n(9696),a=n(836),r=n(5551),o=n(8268),s=n(6042);const l=Object.freeze({getRenderingStrategy:i.Z,GLSLShader:a.Z,WebGLContextWrapper:r.Z,WebGLResourceRepository:o.Z,WebGLStrategyUniform:s.Z}),c=l;(0,eval)("this").RnWebGL=l},836:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var i=n(7683),a=n(4587),r=n(128),o=n(8268),s=n(4710),l=n(8430),c=n(9286);class _{constructor(){this.__webglResourceRepository=o.Z.getInstance()}get glsl_rt0(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"layout(location = 0) out vec4 rt0;\n":"vec4 rt0;\n"}get glsl_fragColor(){const e=this.__webglResourceRepository;return null!=e.currentWebGLContextWrapper&&e.currentWebGLContextWrapper.isWebGL2?"":"gl_FragColor = rt0;\n"}get glsl_vertex_in(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"attribute"}get glsl_fragment_in(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"in":"varying"}get glsl_vertex_out(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"out":"varying"}get glsl_vertex_centroid_out(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"centroid out":"varying"}get glsl_texture(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"texture":"texture2D"}get glsl_textureCube(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"texture":"textureCube"}get glsl_textureProj(){return this.__webglResourceRepository.currentWebGLContextWrapper.isWebGL2?"textureProj":"texture2DProj"}get glsl_versionText(){const e=this.__webglResourceRepository;return null!=e.currentWebGLContextWrapper&&e.currentWebGLContextWrapper.isWebGL2,""}get glslPrecision(){return"precision highp float;\nprecision highp int;\n    "}static get glslMainBegin(){return"\nvoid main() {\n"}static get glslMainEnd(){return"\n}\n    "}getGlslVertexShaderProperies(e=""){return e}get glsl1ShaderTextureLodExt(){return null!=o.Z.getInstance().currentWebGLContextWrapper.webgl1ExtSTL?"#extension GL_EXT_shader_texture_lod : require":""}get glsl1ShaderDerivativeExt(){return null!=o.Z.getInstance().currentWebGLContextWrapper.webgl1ExtDRV?"#extension GL_OES_standard_derivatives : require":""}get toNormalMatrix(){return"\nmat3 toNormalMatrix(mat4 m) {\n  float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n  a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n  a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n  a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3];\n\n  float b00 = a00 * a11 - a01 * a10,\n  b01 = a00 * a12 - a02 * a10,\n  b02 = a00 * a13 - a03 * a10,\n  b03 = a01 * a12 - a02 * a11,\n  b04 = a01 * a13 - a03 * a11,\n  b05 = a02 * a13 - a03 * a12,\n  b06 = a20 * a31 - a21 * a30,\n  b07 = a20 * a32 - a22 * a30,\n  b08 = a20 * a33 - a23 * a30,\n  b09 = a21 * a32 - a22 * a31,\n  b10 = a21 * a33 - a23 * a31,\n  b11 = a22 * a33 - a23 * a32;\n\n  float determinantVal = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n  return mat3(\n    a11 * b11 - a12 * b10 + a13 * b09, a12 * b08 - a10 * b11 - a13 * b07, a10 * b10 - a11 * b08 + a13 * b06,\n    a02 * b10 - a01 * b11 - a03 * b09, a00 * b11 - a02 * b08 + a03 * b07, a01 * b08 - a00 * b10 - a03 * b06,\n    a31 * b05 - a32 * b04 + a33 * b03, a32 * b02 - a30 * b05 - a33 * b01, a30 * b04 - a31 * b02 + a33 * b00) / determinantVal;\n}"}get getSkinMatrix(){return"\n#ifdef RN_IS_SKINNING\n\nhighp mat4 createMatrixFromQuaternionTranslationScale( highp vec4 quaternion, highp vec3 translation, highp vec3 scale ) {\n  highp vec4 q = quaternion;\n  highp vec3 t = translation;\n\n  highp float sx = q.x * q.x;\n  highp float sy = q.y * q.y;\n  highp float sz = q.z * q.z;\n  highp float cx = q.y * q.z;\n  highp float cy = q.x * q.z;\n  highp float cz = q.x * q.y;\n  highp float wx = q.w * q.x;\n  highp float wy = q.w * q.y;\n  highp float wz = q.w * q.z;\n\n  highp mat4 mat = mat4(\n    1.0 - 2.0 * (sy + sz), 2.0 * (cz + wz), 2.0 * (cy - wy), 0.0,\n    2.0 * (cz - wz), 1.0 - 2.0 * (sx + sz), 2.0 * (cx + wx), 0.0,\n    2.0 * (cy + wy), 2.0 * (cx - wx), 1.0 - 2.0 * (sx + sy), 0.0,\n    t.x, t.y, t.z, 1.0\n  );\n\n  highp mat4 uniformScaleMat = mat4(\n    scale.x, 0.0, 0.0, 0.0,\n    0.0, scale.y, 0.0, 0.0,\n    0.0, 0.0, scale.z, 0.0,\n    0.0, 0.0, 0.0, 1.0\n  );\n\n  return mat*uniformScaleMat;\n}\n\nhighp vec4 unpackedVec2ToNormalizedVec4(highp vec2 vec_xy, highp float criteria){\n\n  highp float r;\n  highp float g;\n  highp float b;\n  highp float a;\n\n  highp float ix = floor(vec_xy.x * criteria);\n  highp float v1x = ix / criteria;\n  highp float v1y = ix - floor(v1x) * criteria;\n\n  r = ( v1x + 1.0 ) / (criteria-1.0);\n  g = ( v1y + 1.0 ) / (criteria-1.0);\n\n  highp float iy = floor( vec_xy.y * criteria);\n  highp float v2x = iy / criteria;\n  highp float v2y = iy - floor(v2x) * criteria;\n\n  b = ( v2x + 1.0 ) / (criteria-1.0);\n  a = ( v2y + 1.0 ) / (criteria-1.0);\n\n  r -= 1.0/criteria;\n  g -= 1.0/criteria;\n  b -= 1.0/criteria;\n  a -= 1.0/criteria;\n\n  r = r*2.0-1.0;\n  g = g*2.0-1.0;\n  b = b*2.0-1.0;\n  a = a*2.0-1.0;\n\n  return vec4(r, g, b, a);\n}\n\nmat4 getSkinMatrix(float skeletalComponentSID) {\n\n#ifdef RN_BONE_DATA_TYPE_Mat44x1\n  mat4 skinMat = a_weight.x * get_boneMatrix(skeletalComponentSID, int(a_joint.x));\n  skinMat += a_weight.y * get_boneMatrix(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.z * get_boneMatrix(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.w * get_boneMatrix(skeletalComponentSID, int(a_joint.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X2)\n  vec2 criteria = vec2(4096.0, 4096.0);\n\n  vec4 tq_x = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 sq_x = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.x));\n  vec4 quat = unpackedVec2ToNormalizedVec4(vec2(tq_x.w, sq_x.w), criteria.x);\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(quat, tq_x.xyz, sq_x.xyz);\n\n  vec4 tq_y = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.y));\n  vec4 sq_y = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.y));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_y.w, sq_y.w), criteria.x);\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(quat, tq_y.xyz, sq_y.xyz);\n\n  vec4 tq_z = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.z));\n  vec4 sq_z = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.z));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_z.w, sq_z.w), criteria.x);\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(quat, tq_z.xyz, sq_z.xyz);\n\n  vec4 tq_w = get_boneTranslatePackedQuat(skeletalComponentSID, int(a_joint.w));\n  vec4 sq_w = get_boneScalePackedQuat(skeletalComponentSID, int(a_joint.w));\n  quat = unpackedVec2ToNormalizedVec4(vec2(tq_w.w, sq_w.w), criteria.x);\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(quat, tq_w.xyz, sq_w.xyz);\n\n  #elif defined(RN_BONE_DATA_TYPE_VEC4X2_OLD)\n  vec4 ts_x = get_boneTranslateScale(skeletalComponentSID, int(a_joint.x));\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.x)), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = get_boneTranslateScale(skeletalComponentSID, int(a_joint.y));\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.y)), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = get_boneTranslateScale(skeletalComponentSID, int(a_joint.z));\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.z)), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = get_boneTranslateScale(skeletalComponentSID, int(a_joint.w));\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    get_boneQuaternion(skeletalComponentSID, int(a_joint.w)), ts_w.xyz, vec3(ts_w.w));\n\n#elif defined(RN_BONE_DATA_TYPE_VEC4X1)\n  vec4 boneCompressedChunksX = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.x));\n  vec4 boneCompressedChunksY = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.y));\n  vec4 boneCompressedChunksZ = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.z));\n  vec4 boneCompressedChunksW = get_boneCompressedChunk(skeletalComponentSID, int(a_joint.w));\n\n  vec2 criteria = vec2(4096.0, 4096.0);\n  vec4 boneCompressedInfo = get_boneCompressedInfo(0.0, 0);\n\n  vec4 ts_x = unpackedVec2ToNormalizedVec4(boneCompressedChunksX.zw, criteria.y)*boneCompressedInfo;\n  mat4 skinMat = a_weight.x * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksX.xy, criteria.x), ts_x.xyz, vec3(ts_x.w));\n  vec4 ts_y = unpackedVec2ToNormalizedVec4(boneCompressedChunksY.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.y * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksY.xy, criteria.x), ts_y.xyz, vec3(ts_y.w));\n  vec4 ts_z = unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.z * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksZ.xy, criteria.x), ts_z.xyz, vec3(ts_z.w));\n  vec4 ts_w = unpackedVec2ToNormalizedVec4(boneCompressedChunksW.zw, criteria.y)*boneCompressedInfo;\n  skinMat += a_weight.w * createMatrixFromQuaternionTranslationScale(\n    unpackedVec2ToNormalizedVec4(boneCompressedChunksW.xy, criteria.x), ts_w.xyz, vec3(ts_w.w));\n#endif\n\n  return skinMat;\n}\n\n#endif\n"}get packing(){return"\nconst vec4 bitEnc = vec4(1.,255.,65025.,16581375.);\nconst vec4 bitDec = 1./bitEnc;\n\nvec4 encodeFloatRGBA(float v) {\n  float val = v;\n  float r = mod(val, 255.0);\n  val -= r;\n  float g = mod(val, 65025.0);\n  val -= g;\n  float b = mod(val, 16581375.0);\n  return vec4(r/255.0, g/65025.0, b/16581375.0, 1.0);\n}"}get processGeometryWithSkinningOptionally(){return"\n#ifdef RN_IS_SKINNING\nbool skinning(\n  float skeletalComponentSID,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n  )\n{\n  mat4 skinMat = getSkinMatrix(skeletalComponentSID);\n  outPosition_inWorld = skinMat * vec4(inPosition_inLocal, 1.0);\n  outNormalMatrix = toNormalMatrix(skinMat);\n  outNormal_inWorld = normalize(outNormalMatrix * inNormal_inLocal);\n\n  return true;\n}\n#endif\n\nbool processGeometryWithMorphingAndSkinning(\n  float skeletalComponentSID,\n  in mat4 worldMatrix,\n  in mat3 inNormalMatrix,\n  out mat3 outNormalMatrix,\n  in vec3 inPosition_inLocal,\n  out vec4 outPosition_inWorld,\n  in vec3 inNormal_inLocal,\n  out vec3 outNormal_inWorld\n) {\n  bool isSkinning = false;\n\n  vec3 position_inLocal;\n#ifdef RN_IS_MORPHING\n  if (u_morphTargetNumber == 0) {\n#endif\n    position_inLocal = inPosition_inLocal;\n#ifdef RN_IS_MORPHING\n  } else {\n    float vertexIdx = a_baryCentricCoord.w;\n    position_inLocal = get_position(vertexIdx, inPosition_inLocal);\n  }\n#endif\n\n\n#ifdef RN_IS_SKINNING\n  if (skeletalComponentSID >= 0.0) {\n    isSkinning = skinning(skeletalComponentSID, inNormalMatrix, outNormalMatrix, position_inLocal, outPosition_inWorld, inNormal_inLocal, outNormal_inWorld);\n  } else {\n#endif\n    outNormalMatrix = inNormalMatrix;\n    outPosition_inWorld = worldMatrix * vec4(position_inLocal, 1.0);\n    outNormal_inWorld = normalize(inNormalMatrix * inNormal_inLocal);\n#ifdef RN_IS_SKINNING\n  }\n#endif\n\n  return isSkinning;\n}"}get prerequisites(){const e=o.Z.getInstance(),t=e.getGlslDataUBODefinitionString(),n=e.getGlslDataUBOVec4SizeString();return`uniform float u_materialSID;\nuniform sampler2D u_dataTexture;\nconst int widthOfDataTexture = ${c.Z.bufferWidthLength};\nconst int heightOfDataTexture = ${c.Z.bufferHeightLength};\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  ${n}\n  ${t}\n#endif\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n`}get mainPrerequisites(){const e=l.Z.currentProcessApproach;return i.V.isFastestApproach(e)?`\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[${s.z.LightComponentTID}]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[${s.z.SkeletalComponentTID}];\n  #endif\n`:"\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n      "}get pointSprite(){return"  vec4 position_inWorld = worldMatrix * vec4(a_position, 1.0);\n  vec3 viewPosition = get_viewPosition(cameraSID, 0);\n  float distanceFromCamera = length(position_inWorld.xyz - viewPosition);\n  vec3 pointDistanceAttenuation = get_pointDistanceAttenuation(materialSID, 0);\n  float distanceAttenuationFactor = sqrt(1.0/(pointDistanceAttenuation.x + pointDistanceAttenuation.y * distanceFromCamera + pointDistanceAttenuation.z * distanceFromCamera * distanceFromCamera));\n  float maxPointSize = get_pointSize(materialSID, 0);\n  gl_PointSize = clamp(distanceAttenuationFactor * maxPointSize, 0.0, maxPointSize);"}get pbrUniformDefinition(){let e="";return e+="uniform vec2 uMetallicRoughnessFactors;\n",e+="uniform vec3 uBaseColorFactor;\n",e+="uniform vec2 uOcclusionFactors;",e+="uniform vec3 uEmissiveFactor;",e+="uniform sampler2D uMetallicRoughnessTexture;\n",e+="uniform sampler2D uOcclusionTexture;\n",e+="uniform sampler2D uEmissiveTexture;\n",e+="uniform sampler2D u_brdfLutTexture;\n",e+="uniform samplerCube uDiffuseEnvTexture;\n",e+="uniform samplerCube uSpecularEnvTexture;\n",e+="uniform vec4 uIBLParameters;\n",e+="uniform vec4 ambient;\n","uniform vec2 uMetallicRoughnessFactors;\nuniform vec3 uBaseColorFactor;\nuniform vec2 uOcclusionFactors;uniform vec3 uEmissiveFactor;uniform sampler2D uMetallicRoughnessTexture;\nuniform sampler2D uOcclusionTexture;\nuniform sampler2D uEmissiveTexture;\nuniform sampler2D u_brdfLutTexture;\nuniform samplerCube uDiffuseEnvTexture;\nuniform samplerCube uSpecularEnvTexture;\nuniform vec4 uIBLParameters;\nuniform vec4 ambient;\n"}get mipmapLevel(){return"\n    // https://stackoverflow.com/questions/24388346/how-to-access-automatic-mipmap-level-in-glsl-fragment-shader-texture\n    float mipmapLevel(vec3 uv_as_texel)\n    {\n      vec3  dx_vtc        = dFdx(uv_as_texel);\n      vec3  dy_vtc        = dFdy(uv_as_texel);\n      float delta_max_sqr = max(dot(dx_vtc, dx_vtc), dot(dy_vtc, dy_vtc));\n      float mml = 0.5 * log2(delta_max_sqr);\n      return max( 0.0, mml );\n    }"}get pbrMethodDefinition(){return`\n    const float M_PI = 3.141592653589793;\n    const float c_MinRoughness = 0.04;\n\n    float angular_n_h(float NH) {\n      return acos(NH);\n    }\n\n    float sqr(float x) {\n      return x*x;\n    }\n\n    float d_phong(float NH, float c1) {\n      return pow(\n        cos(acos(NH))\n        , c1\n      );\n    }\n\n    // this is from https://www.unrealengine.com/blog/physically-based-shading-on-mobile\n    vec3 envBRDFApprox( vec3 F0, float Roughness, float NoV ) {\n      const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022 );\n      const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04 );\n      vec4 r = Roughness * c0 + c1;\n      float a004 = min( r.x * r.x, exp2( -9.28 * NoV ) ) * r.x + r.y;\n      vec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\n      return F0 * AB.x + AB.y;\n    }\n\n    // GGX NDF\n    float d_ggx(float NH, float alphaRoughness) {\n      float roughnessSqr = alphaRoughness * alphaRoughness;\n      float f = (roughnessSqr - 1.0) * NH * NH + 1.0;\n      return roughnessSqr / (M_PI * f * f);\n    }\n\n    float d_torrance_reiz(float NH, float c3) {\n      float CosSquared = NH*NH;\n      float TanSquared = (1.0 - CosSquared)/CosSquared;\n      //return (1.0/M_PI) * sqr(c3/(CosSquared * (c3*c3 + TanSquared)));  // gamma = 2, aka GGX\n      return (1.0/sqrt(M_PI)) * (sqr(c3)/(CosSquared * (c3*c3 + TanSquared))); // gamma = 1, D_Berry\n    }\n\n    float d_beckmann(float NH, float m) {\n      float co = 1.0 / (4.0 * m * m * NH * NH * NH * NH);\n      float expx = exp((NH * NH - 1.0) / (m * m * NH * NH));\n      return co * expx;\n    }\n\n    // the same as glTF WebGL sample\n    // https://github.com/KhronosGroup/glTF-WebGL-PBR/blob/88eda8c5358efe03128b72b6c5f5f6e5b6d023e1/shaders/pbr-frag.glsl#L188\n    // That is, Unreal Engine based approach, but modified to use alphaRoughness (squared artist's roughness parameter),\n    // and based on 'Separable Masking and Shadowing' approximation (propesed by Christophe Schlick)\n    // https://www.cs.virginia.edu/~jdl/bib/appearance/analytic%20models/schlick94b.pdf\n    float g_shielding(float NL, float NV, float alphaRoughness) {\n      float r = alphaRoughness;\n\n      // Local Shadowing using "Schlick-Smith" Masking Function\n      float localShadowing = 2.0 * NL / (NL + sqrt(r * r + (1.0 - r * r) * (NL * NL)));\n\n      // Local Masking using "Schlick-Smith" Masking Function\n      float localMasking = 2.0 * NV / (NV + sqrt(r * r + (1.0 - r * r) * (NV * NV)));\n\n      return localShadowing * localMasking;\n    }\n\n    // The code from https://google.github.io/filament/Filament.html#listing_approximatedspecularv\n    // The idea is from [Heitz14] Eric Heitz. 2014. Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs.\n    float v_SmithGGXCorrelated(float NL, float NV, float alphaRoughness) {\n      float a2 = alphaRoughness * alphaRoughness;\n      float GGXV = NL * sqrt(NV * NV * (1.0 - a2) + a2);\n      float GGXL = NV * sqrt(NL * NL * (1.0 - a2) + a2);\n      return 0.5 / (GGXV + GGXL);\n    }\n\n    float v_SmithGGXCorrelatedFast(float NL, float NV, float alphaRoughness) {\n      float a = alphaRoughness;\n      float GGXV = NL * (NV * (1.0 - a) + a);\n      float GGXL = NV * (NL * (1.0 - a) + a);\n      return 0.5 / (GGXV + GGXL);\n    }\n\n    // The Schlick Approximation to Fresnel\n    vec3 fresnel(vec3 f0, float VH) {\n      return vec3(f0) + (vec3(1.0) - f0) * pow(1.0 - VH, 5.0);\n    }\n\n    vec3 cook_torrance_specular_brdf(float NH, float NL, float NV, vec3 F, float alphaRoughness) {\n      float D = d_ggx(NH, alphaRoughness);\n      float V = v_SmithGGXCorrelated(NL, NV, alphaRoughness);\n      return vec3(D)*vec3(V)*F;\n//      float G = g_shielding(NL, NV, alphaRoughness);\n//      return vec3(D)*vec3(G)*F/vec3(4.0*NL*NV);\n\n    }\n\n    vec3 diffuse_brdf(vec3 albedo)\n    {\n      return albedo / M_PI;\n    }\n\n    vec3 srgbToLinear(vec3 srgbColor) {\n      return pow(srgbColor, vec3(2.2));\n    }\n\n    float srgbToLinear(float value) {\n      return pow(value, 2.2);\n    }\n\n    vec3 linearToSrgb(vec3 linearColor) {\n      return pow(linearColor, vec3(1.0/2.2));\n    }\n\n    float linearToSrgb(float value) {\n      return pow(value, 1.0/2.2);\n    }\n\n    vec3 fresnelSchlickRoughness(vec3 F0, float cosTheta, float roughness)\n    {\n      return F0 + (max(vec3(1.0 - roughness), F0) - F0) * pow(1.0 - cosTheta, 5.0);\n    }\n\n    vec3 normalBlendingUDN(sampler2D baseMap, sampler2D detailMap, vec2 baseUv, vec2 detailUv) {\n      vec3 t = ${this.glsl_texture}(baseMap,   baseUv).xyz * 2.0 - 1.0;\n      vec3 u = ${this.glsl_texture}(detailMap, detailUv).xyz * 2.0 - 1.0;\n      vec3 r = normalize(vec3(t.xy + u.xy, t.z));\n      return r;\n    }\n\n    vec2 uvTransform(vec2 scale, vec2 offset, float rotation, vec2 uv) {\n      mat3 translationMat = mat3(1,0,0, 0,1,0, offset.x, offset.y, 1);\n      mat3 rotationMat = mat3(\n          cos(rotation), -sin(rotation), 0,\n          sin(rotation),  cos(rotation), 0,\n                      0,             0, 1\n      );\n      mat3 scaleMat = mat3(scale.x,0,0, 0,scale.y,0, 0,0,1);\n\n      mat3 matrix = translationMat * rotationMat * scaleMat;\n      vec2 uvTransformed = ( matrix * vec3(uv.xy, 1) ).xy;\n\n      return uvTransformed;\n    }\n\n    `}get hash(){return"\n    vec2 hash(vec2 p) {\n      return fract(sin(p * mat2(127.1, 311.7, 269.5, 183.3))*43758.5453123);\n    }\n    "}get returnToOriginalColorSpace(){return"\n// Decorrelated color space vectors and origin\nuniform vec3 u_colorSpaceVector1;\nuniform vec3 u_colorSpaceVector2;\nuniform vec3 u_colorSpaceVector3;\nuniform vec3 u_colorSpaceOrigin;\n\nvec3 ReturnToOriginalColorSpace(vec3 color)\n{\n  vec3 result =\n    u_colorSpaceOrigin +\n    u_colorSpaceVector1 * color.r +\n    u_colorSpaceVector2 * color.g +\n    u_colorSpaceVector3 * color.b;\n  return result;\n}"}get triangleGrid(){return"\nvoid TriangleGrid(vec2 uv,\n  out float w1, out float w2, out float w3,\n  out ivec2 vertex1, out ivec2 vertex2, out ivec2 vertex3)\n{\n  // Scaling of the input\n  uv *= 3.464; // 2 * sqrt(3)\n\n  // Skew input space into simplex triangle grid\n  const mat2 gridToSkewedGrid = mat2(1.0, 0.0, -0.57735027, 1.15470054);\n  vec2 skewedCoord = gridToSkewedGrid * uv;\n\n  // Compute local triangle vertex IDs and local barycentric coordinates\n  ivec2 baseId = ivec2(floor(skewedCoord));\n  vec3 temp = vec3(fract(skewedCoord), 0);\n  temp.z = 1.0 - temp.x - temp.y;\n  if (temp.z > 0.0)\n  {\n    w1 = temp.z;\n    w2 = temp.y;\n    w3 = temp.x;\n    vertex1 = baseId;\n    vertex2 = baseId + ivec2(0, 1);\n    vertex3 = baseId + ivec2(1, 0);\n  }\n  else\n  {\n    w1 = -temp.z;\n    w2 = 1.0 - temp.y;\n    w3 = 1.0 - temp.x;\n    vertex1 = baseId + ivec2(1, 1);\n    vertex2 = baseId + ivec2(1, 0);\n    vertex3 = baseId + ivec2(0, 1);\n  }\n}"}get mipmap_level(){return"\n// https://stackoverflow.com/questions/24388346/how-to-access-automatic-mipmap-level-in-glsl-fragment-shader-texture\nfloat mipmapLevel(in vec2 uv_as_texel)\n{\n  vec2  dx_vtc        = dFdx(uv_as_texel);\n  vec2  dy_vtc        = dFdy(uv_as_texel);\n  float delta_max_sqr = max(dot(dx_vtc, dx_vtc), dot(dy_vtc, dy_vtc));\n  float mml = 0.5 * log2(delta_max_sqr);\n  return max( 0, mml );\n}\n    "}byExampleProceduralNoise(){return"\n\nuniform sampler2D u_Tinput; // Gaussian input T(I)\nuniform sampler2D u_invT; // Inverse histogram transformation T^{-1}\n\n// By-Example procedural noise at uv\nvec3 byExampleProceduralNoise(vec2 uv, vec2 textureSizeOfTinput, vec2 textureSizeOfInvT)\n{\n\t// Get triangle info\n\tfloat w1, w2, w3;\n\tivec2 vertex1, vertex2, vertex3;\n\tTriangleGrid(uv, w1, w2, w3, vertex1, vertex2, vertex3);\n\n\t// Assign random offset to each triangle vertex\n\tvec2 uv1 = uv + hash(vertex1);\n\tvec2 uv2 = uv + hash(vertex2);\n\tvec2 uv3 = uv + hash(vertex3);\n\n\t// Precompute UV derivatives\n\tvec2 duvdx = dFdx(uv);\n\tvec2 duvdy = dFdy(uv);\n\n\t// Fetch Gaussian input\n\tvec3 G1 = textureGrad(u_Tinput, uv1, duvdx, duvdy).rgb;\n\tvec3 G2 = textureGrad(u_Tinput, uv2, duvdx, duvdy).rgb;\n\tvec3 G3 = textureGrad(u_Tinput, uv3, duvdx, duvdy).rgb;\n\n\t// Variance-preserving blending\n\tvec3 G = w1*G1 + w2*G2 + w3*G3;\n\tG = G - vec3(0.5);\n\tG = G * inversesqrt(w1*w1 + w2*w2 + w3*w3);\n\tG = G + vec3(0.5);\n\n\t// Compute LOD level to fetch the prefiltered look-up table invT\n\tfloat LOD = mipmapLevel(uv * textureSizeOfTinput).y / textureSizeOfInvT.y);\n\n\t// Fetch prefiltered LUT (T^{-1})\n\tvec3 color;\n\tcolor.r\t= texture(u_invT, vec2(G.r, LOD)).r;\n\tcolor.g\t= texture(u_invT, vec2(G.g, LOD)).g;\n\tcolor.b\t= texture(u_invT, vec2(G.b, LOD)).b;\n\n\t// Original color space\n\tcolor = returnToOriginalColorSpace(color);\n\n\treturn color;\n}"}get texture2DSeamless(){return"\n\nvec4 texture2DSeamless(vec2 uv, vec4 scaleTranslate) {\n  color = vec4(byExampleProceduralNoise(uv * scaleTranslate.xy + scaleTranslate.zw), 1);\n}\n"}get simpleMVPPosition(){return`\n  float cameraSID = u_currentComponentSIDs[${s.z.CameraComponentTID}];\n  mat4 worldMatrix = get_worldMatrix(a_instanceID);\n  mat4 viewMatrix = get_viewMatrix(cameraSID, 0);\n  mat4 projectionMatrix = get_projectionMatrix(cameraSID, 0);\n  gl_Position = projectionMatrix * viewMatrix * worldMatrix * vec4(a_position, 1.0);\n    `}get perturbedNormal(){return`\n#ifdef RN_USE_TANGENT_ATTRIBUTE\n  vec3 perturb_normal(vec3 normal_inWorld, vec3 viewVector, vec2 texcoord) {\n    vec3 tangent_inWorld = normalize(v_tangent_inWorld);\n    vec3 binormal_inWorld = normalize(v_binormal_inWorld);\n    mat3 tbnMat_tangent_to_world = mat3(tangent_inWorld, binormal_inWorld, normal_inWorld);\n\n    vec3 normal = ${this.glsl_texture}(u_normalTexture, texcoord).xyz * 2.0 - 1.0;\n    return normalize(tbnMat_tangent_to_world * normal);\n  }\n#else\n  #ifdef RN_IS_SUPPORTING_STANDARD_DERIVATIVES\n    // This is based on http://www.thetenthplanet.de/archives/1180\n    mat3 cotangent_frame(vec3 normal, vec3 position, vec2 uv) {\n      uv = gl_FrontFacing ? uv : -uv;\n\n      // get edge vectors of the pixel triangle\n      vec3 dp1 = dFdx(position);\n      vec3 dp2 = dFdy(position);\n      vec2 duv1 = dFdx(uv);\n      vec2 duv2 = dFdy(uv);\n\n      // solve the linear system\n      vec3 dp2perp = cross(dp2, normal);\n      vec3 dp1perp = cross(normal, dp1);\n      vec3 tangent = dp2perp * duv1.x + dp1perp * duv2.x;\n      vec3 bitangent = dp2perp * duv1.y + dp1perp * duv2.y;\n\n      // construct a scale-invariant frame\n      float invMat = inversesqrt(max(dot(tangent, tangent), dot(bitangent, bitangent)));\n      return mat3(tangent * invMat, bitangent * invMat, normal);\n    }\n\n    vec3 perturb_normal(vec3 normal, vec3 viewVector, vec2 texcoord) {\n      vec3 normalTex = ${this.glsl_texture}(u_normalTexture, texcoord).xyz * 2.0 - 1.0;\n\n      mat3 tbnMat_tangent_to_world = cotangent_frame(normal, -viewVector, texcoord);\n      return normalize(tbnMat_tangent_to_world * normalTex);\n    }\n  #else\n    vec3 perturb_normal(vec3 normal, vec3 viewVector, vec2 texcoord) {\n      return normal;\n    }\n  #endif\n#endif\n`}static getStringFromShaderAnyDataType(e){return e instanceof a.w?"u_"+e.str:e instanceof r.x?e.shaderStr:e}}},8149:(e,t,n)=>{"use strict";n.d(t,{Z:()=>R});var i=n(7987),a=n(2471),r=n(3496),o=n(7192),s=n(1350),l=n(657),c=n(5333),_=n(1784),h=n(3648),d=n(2251);const u={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})},m={xAxis:0,yAxis:0,button:0,state:u.ComponentState.DEFAULT};class x{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===u.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(m)}updateFromComponent({xAxis:e,yAxis:t,button:n,state:i}){const{normalizedXAxis:a,normalizedYAxis:r}=function(e=0,t=0){let n=e,i=t;if(Math.sqrt(e*e+t*t)>1){const a=Math.atan2(t,e);n=Math.cos(a),i=Math.sin(a)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5}}(e,t);switch(this.componentProperty){case u.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?a:.5;break;case u.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?r:.5;break;case u.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case u.ComponentProperty.STATE:this.valueNodeProperty===u.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class f{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const n=new x(t.visualResponses[e]);this.visualResponses[e]=n})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:u.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=u.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed&&1===this.values.button?this.values.state=u.ComponentState.PRESSED:t.touched&&this.values.button>u.ButtonTouchThreshold?this.values.state=u.ComponentState.TOUCHED:this.values.state=u.ComponentState.DEFAULT}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===u.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>u.AxisTouchThreshold&&(this.values.state=u.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===u.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>u.AxisTouchThreshold&&(this.values.state=u.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class A{constructor(e,t,n){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new f(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}async function p(e){const t=await fetch(e,{mode:"cors"});if(t.ok)return t.json();throw new Error(t.statusText)}var g=n(2749),v=n(6694),y=n(4690),I=n(4388),b=n(6098),T=n(9190),S=n(2566);n(2862);const E=new Map,C=Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON_1:"button_1",BUTTON_2:"button_2",BUTTON_3:"button_3",BUTTON_SPECIAL:"button_special"}),w=new Map;async function D(e,t,n){const{profile:i,assetPath:a}=await async function(e,t,n=null,i=!0,a=[]){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const r=await async function(e){if(!e)throw new Error("No basePath supplied");return await p(`${e}/profilesList.json`)}(t);let o;for(const n of a)for(const i of e.profiles){if(n!==i)continue;const e=r[i];e&&(o={profileId:i,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated})}if(!o)for(const n of e.profiles){const e=r[n];e&&(o={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated})}if(!o){if(!n)throw new Error("No matching profile name found");const e=r[n];if(!e)throw new Error(`No matching profile name found and default profile "${n}" missing.`);o={profileId:n,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const s=await p(o.profilePath);let l;if(i){let t;if(t="any"===e.handedness?s.layouts[Object.keys(s.layouts)[0]]:s.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${o.profileId}`);t.assetPath&&(l=o.profilePath.replace("profile.json",t.assetPath))}return{profile:s,assetPath:l}}(e,t,void 0,!0,n),r=new A(e,i,a);E.set(e,r);const o=await async function(e){const t=g.Z.getInstance(),n=await t.import(e.assetUrl);return function(e,t){Object.values(e.components).forEach((e=>{e.touchPointNodeName&&t.getChildByName(e.touchPointNodeName,!0)}))}(e,n),n}(r),s=v.Z.getInstance();if(y.Is.exist(o))return s.convertToRhodoniteObject(o)}w.set("a_button",C.BUTTON_1),w.set("b_button",C.BUTTON_2),w.set("x_button",C.BUTTON_1),w.set("y_button",C.BUTTON_2),w.set("thumbrest",C.BUTTON_3),w.set("menu",C.BUTTON_SPECIAL),w.set("xr_standard_trigger",C.TRIGGER),w.set("xr_standard_squeeze",C.SQUEEZE),w.set("xr_standard_thumbstick",C.THUMBSTICK),w.set("xr_standard_touchpad",C.TOUCHPAD),w.set("trigger",C.TRIGGER),w.set("squeeze",C.SQUEEZE),w.set("thumbstick",C.THUMBSTICK),w.set("touchpad",C.TOUCHPAD);let N=0;const B=T.ZP.one();var P=n(963),M=n(4267);const F=a.ZP.fromCopyArray([0,1.1,0]);class R{constructor(){this.__isWebXRMode=!1,this.__spaceType="local",this.__requestedToEnterWebXR=!1,this.__isReadyForWebXR=!1,this.__defaultPositionInLocalSpaceMode=F,this.__canvasWidthForVR=0,this.__canvasHeightForVR=0,this.__controllerEntities=[],this.__xrInputSources=[],this.__viewerTranslate=T.ZP.zero(),this.__viewerAzimuthAngle=M.ZP.zero(),this.__viewerOrientation=P.Z.identity(),this.__viewerScale=T.ZP.one();const e=s.Z.getInstance();this.__viewerEntity=e.createEntity([l.Z,c.Z]),this.__leftCameraEntity=e.createEntity([l.Z,c.Z,_.Z]),this.__rightCameraEntity=e.createEntity([l.Z,c.Z,_.Z]),this.__viewerEntity.getSceneGraph().addChild(this.__leftCameraEntity.getSceneGraph()),this.__viewerEntity.getSceneGraph().addChild(this.__rightCameraEntity.getSceneGraph())}async readyForWebXR(e,t){this.__basePath=t,await d.Z.getInstance().loadModule("xr");const n=i.Z.getWebGLResourceRepository().currentWebGLContextWrapper;if(null==n)return console.error("WebGL Context is not ready yet."),[];if(this.__glw=n,!await navigator.xr.isSessionSupported("immersive-vr"))return console.error("WebXR is not supported in this environment."),[];if(e)e.style.display="block";else{const e=document.createElement("p"),t=document.createElement("a");t.setAttribute("id","enter-vr");const i=document.createTextNode("Enter VR");t.appendChild(i),e.appendChild(t);const a=n.canvas;a.parentNode.insertBefore(e,a),window.addEventListener("click",this.enterWebXR.bind(this))}return this.__isReadyForWebXR=!0,[]}async enterWebXR({initialUserPosition:e,callbackOnXrSessionEnd:t=(()=>{}),profilePriorities:n=[]}){const r=i.Z.getWebGLResourceRepository().currentWebGLContextWrapper;if(null!=this.__xrSession)return this.__requestedToEnterWebXR=!0,this.__isWebXRMode=!0,!0;if(null!=r&&this.__isReadyForWebXR){let i;const r=await navigator.xr.requestSession("immersive-vr");this.__xrSession=r,r.addEventListener("end",(e=>{this.__xrSession=void 0,this.__webglLayer=void 0,this.__xrViewerPose=void 0,this.__xrReferenceSpace=void 0,this.__spaceType="local",this.__isReadyForWebXR=!1,this.__requestedToEnterWebXR=!1,this.__isWebXRMode=!1,this.__defaultPositionInLocalSpaceMode=F,console.log("XRSession ends."),h.Z.getInstance().stopRenderLoop(),h.Z.getInstance().restartRenderLoop(),t()}));const o=this,s=new Promise((e=>{r.addEventListener("inputsourceschange",(t=>{o.__onInputSourcesChange(t,e,n)}))}));try{i=await r.requestReferenceSpace("local-floor"),this.__spaceType="local-floor",this.__defaultPositionInLocalSpaceMode=null!=e?e:a.ZP.zero()}catch(t){console.error(`Failed to start XRSession: ${t}`),i=await r.requestReferenceSpace("local"),this.__spaceType="local",this.__defaultPositionInLocalSpaceMode=null!=e?e:F}return this.__xrReferenceSpace=i,await this.__setupWebGLLayer(r),this.__requestedToEnterWebXR=!0,h.Z.getInstance().stopRenderLoop(),h.Z.getInstance().restartRenderLoop(),console.warn("End of enterWebXR."),s}console.error("WebGL context or WebXRSession is not ready yet.")}exitWebXR(){this.__requestedToEnterWebXR=!1,this.__isWebXRMode=!1}async disableWebXR(){null!=this.__xrSession&&await this.__xrSession.end()}getCanvasWidthForVr(){return this.__canvasWidthForVR}getCanvasHeightForVr(){return this.__canvasHeightForVR}getControllerEntities(){return this.__controllerEntities}get leftViewMatrix(){return this.__leftCameraEntity.getCamera().viewMatrix}get rightViewMatrix(){return this.__rightCameraEntity.getCamera().viewMatrix}get leftProjectionMatrix(){var e;const t=null===(e=this.__xrViewerPose)||void 0===e?void 0:e.views[0];return new r.Z(null==t?void 0:t.projectionMatrix,!0)}get rightProjectionMatrix(){var e;const t=null===(e=this.__xrViewerPose)||void 0===e?void 0:e.views[1];return new r.Z(null==t?void 0:t.projectionMatrix,!0)}get framebuffer(){var e,t;return null===(t=null===(e=this.__xrSession)||void 0===e?void 0:e.renderState.baseLayer)||void 0===t?void 0:t.framebuffer}get requestedToEnterWebXR(){return this.__requestedToEnterWebXR}get xrSession(){return this.__xrSession}get requestedToEnterWebVR(){return this.__requestedToEnterWebXR}get isWebXRMode(){return this.__isWebXRMode}get isReadyForWebXR(){return this.__isReadyForWebXR}static getInstance(){return this.__instance||(this.__instance=new R),this.__instance}_getViewMatrixAt(e){return 0===e?this.leftViewMatrix:this.rightViewMatrix}_getProjectMatrixAt(e){return 0===e?this.leftProjectionMatrix:this.rightProjectionMatrix}_getViewportAt(e){return 0===e?this._getLeftViewport():this._getRightViewport()}_getLeftViewport(){return o.ZP.fromCopyArray([0,0,this.__canvasWidthForVR/2,this.__canvasHeightForVR])}_getRightViewport(){return o.ZP.fromCopyArray([this.__canvasWidthForVR/2,0,this.__canvasWidthForVR/2,this.__canvasHeightForVR])}_setValuesToGlobalDataRepository(){this.__leftCameraEntity.getCamera().projectionMatrix=this.leftProjectionMatrix,this.__rightCameraEntity.getCamera().projectionMatrix=this.rightProjectionMatrix,this.__leftCameraEntity.getCamera().setValuesToGlobalDataRepository(),this.__rightCameraEntity.getCamera().setValuesToGlobalDataRepository()}_getCameraWorldPositionAt(e){var t;const n=null===(t=this.__xrViewerPose)||void 0===t?void 0:t.views[e];if(y.Is.exist(n)){const e=n.transform.position,t=this.__defaultPositionInLocalSpaceMode,i=this.__viewerTranslate,r=a.ZP.add(a.ZP.fromCopyArray([e.x,e.y,e.z]),t);return a.ZP.fromCopyArray([(r.x+i.x)*this.__viewerScale.x,(r.y+i.y)*this.__viewerScale.y,(r.z+i.z)*this.__viewerScale.z])}return this.__defaultPositionInLocalSpaceMode}_getCameraComponentSIDAt(e){return 0===e?this.__leftCameraEntity.getCamera().componentSID:this.__rightCameraEntity.getCamera().componentSID}_preRender(e,t){var n,i;this.isWebXRMode&&this.__requestedToEnterWebXR&&null!=t&&(this.__updateView(t),this.__updateInputSources(t),n=e,i={viewerTranslate:this.__viewerTranslate,viewerScale:this.__viewerScale,viewerOrientation:this.__viewerOrientation,viewerAzimuthAngle:this.__viewerAzimuthAngle},Array.from(E.values()).forEach((e=>{e.updateFromGamepad(),Object.keys(e.components).forEach((t=>{!function(e,t,n,i){const a=w.get(e.rootNodeName);if(y.Is.not.exist(a))return;if(0===N)return void(N=i);const r=1e-6*(i-N);switch(a){case C.TRIGGER:!function(e,t,n,i){let a=0;const r=w.get(e.rootNodeName);("pressed"===e.values.state||"touched"===e.values.state)&&(console.log(r,e.values.button,t),a=(0,b.kS)({value:e.values.button,defaultValue:0})*i),"right"===t&&(a*=-1),B.x-=.1*a,B.y-=.1*a,B.z-=.1*a,B.x=Math.max(B.x,.05),B.y=Math.max(B.y,.05),B.z=Math.max(B.z,.05),B.x=Math.min(B.x,3),B.y=Math.min(B.y,3),B.z=Math.min(B.z,3),n.viewerScale.copyComponents(B)}(e,t,n,r);break;case C.THUMBSTICK:!function(e,t,n,i){const a=w.get(e.rootNodeName);let r=0,o=0;"pressed"===e.values.state?(console.log(a,e.values.button,e.values.state,t),r=(0,b.kS)({value:e.values.xAxis,defaultValue:0})*i,o=(0,b.kS)({value:e.values.yAxis,defaultValue:0})*i):"touched"===e.values.state&&(r=(0,b.kS)({value:e.values.xAxis,defaultValue:0})*i,o=(0,b.kS)({value:e.values.yAxis,defaultValue:0})*i),r=Math.min(r,1),o=Math.min(o,1);const s=T.ZP.zero();"right"===t?(n.viewerAzimuthAngle.x-=.15*r,s.y-=.1*o*n.viewerScale.x):(s.x+=.25*r*n.viewerScale.x,s.z+=.25*o*n.viewerScale.x),new S.Z(n.viewerOrientation).multiply(S.Z.rotateY(n.viewerAzimuthAngle.x)).multiplyVectorTo(s,s),n.viewerTranslate.add(s)}(e,t,n,r);break;case C.SQUEEZE:!function(e,t,n,i){const a=w.get(e.rootNodeName);("pressed"===e.values.state||"touched"===e.values.state)&&console.log(a,e.values.button,t)}(e,t);break;case C.BUTTON_1:case C.BUTTON_2:case C.BUTTON_3:case C.BUTTON_SPECIAL:!function(e,t,n,i){const a=w.get(e.rootNodeName);("pressed"===e.values.state||"touched"===e.values.state)&&console.log(a,e.values.button,e.values.state,t)}(e,t);break;case C.TOUCHPAD:"pressed"===(o=e).values.state||"touched"===o.values.state&&0!==o.values.yAxis&&o.values.yAxis}var o}(e.components[t],e.xrInputSource.handedness,i,n)}))})))}_postRender(){var e;this.__isWebXRMode&&(null===(e=this.__glw)||void 0===e||e.getRawContext()),this.requestedToEnterWebVR&&(this.__isWebXRMode=!0)}async __onInputSourcesChange(e,t,n){this.__xrInputSources.length=0;for(let t of e.added){this.__xrInputSources.push(t);const e=await D(t,this.__basePath,n);y.Is.exist(e)&&(this.__controllerEntities.push(e),this.__viewerEntity.getSceneGraph().addChild(e.getSceneGraph()))}t(this.__controllerEntities)}__setCameraInfoFromXRViews(e){if(y.Is.not.exist(e))return void console.warn("xrViewerPose not exist");const t=e.views[0],n=e.views[1];if(y.Is.not.exist(t)||y.Is.not.exist(n))return;const i=e.transform.orientation;this.__viewerOrientation.x=i.x,this.__viewerOrientation.y=i.y,this.__viewerOrientation.z=i.z,this.__viewerOrientation.w=i.w;const o=new r.Z(null==t?void 0:t.transform.matrix,!0),s=new r.Z(null==n?void 0:n.transform.matrix,!0),l=this.__viewerScale.x,c=t.transform.position,_=T.ZP.add(this.__defaultPositionInLocalSpaceMode,this.__viewerTranslate),h=T.ZP.add(this.__defaultPositionInLocalSpaceMode,this.__viewerTranslate),d=a.ZP.fromCopyArray([c.x,c.y,c.z]),u=a.ZP.fromCopyArray([c.x,c.y,c.z]),m=T.ZP.add(this.__defaultPositionInLocalSpaceMode,this.__viewerTranslate).add(d),x=T.ZP.add(this.__defaultPositionInLocalSpaceMode,this.__viewerTranslate).add(u),f=(_.x+h.x)/2,A=(_.z+h.z)/2,p=(m.x+x.x)/2,g=(m.z+x.z)/2,v=this.__viewerEntity.getTransform();v.translate=a.ZP.fromCopyArray([f,0,A]),v.scale=a.ZP.fromCopyArray([l,l,l]),v.rotate=a.ZP.fromCopyArray([0,this.__viewerAzimuthAngle.x,0]),o.translateY=m.y,o.translateX=m.x-p,o.translateZ=m.z-g,o.translateY+=d.y,o.translateX+=d.x,o.translateZ+=d.z,s.translateY=x.y,s.translateX=x.x-p,s.translateZ=x.z-g,s.translateY+=u.y,s.translateX+=u.x,s.translateZ+=u.z,this.__leftCameraEntity.getTransform().matrix=o,this.__rightCameraEntity.getTransform().matrix=s}async __setupWebGLLayer(e){var t;const n=null===(t=this.__glw)||void 0===t?void 0:t.getRawContext();if(null!=n){await n.makeXRCompatible(),this.__webglLayer=new window.XRWebGLLayer(e,n);const t=this.__webglLayer;e.updateRenderState({baseLayer:t,depthNear:.1,depthFar:1e4});const a=i.Z.getWebGLResourceRepository();this.__canvasWidthForVR=t.framebufferWidth,this.__canvasHeightForVR=t.framebufferHeight,console.log(this.__canvasWidthForVR),console.log(this.__canvasHeightForVR),a.resizeCanvas(this.__canvasWidthForVR,this.__canvasHeightForVR)}else console.error("WebGL context is not ready for WebXR.")}__updateView(e){this.__xrViewerPose=e.getViewerPose(this.__xrReferenceSpace),this.__setCameraInfoFromXRViews(this.__xrViewerPose)}__updateInputSources(e){this.__xrInputSources.forEach(((t,n)=>{if(y.Is.defined(t.gripSpace)){const o=e.getPose(t.gripSpace,this.__xrReferenceSpace);if(y.Is.exist(o)){const e=this.__controllerEntities[n];if(y.Is.exist(e)){const n=new r.Z(o.transform.matrix,!0),s=new r.Z(n);s.translateY+=this.__defaultPositionInLocalSpaceMode.y,s.translateY+=this.__viewerTranslate.y,e.getTransform().matrix=s;const l=(i=t,E.get(i));y.Is.exist(l)?function(e,t){const n=e.getTagValue("rnEntitiesByNames");Object.values(t.components).forEach((e=>{for(const t in e.visualResponses){const i=e.visualResponses[t],r=n.get(i.valueNodeName);if(y.Is.not.exist(r))console.warn("The entity of the controller doesn't exist");else if("visibility"===i.valueNodeProperty)r.getSceneGraph().isVisible=!!i.value;else if("transform"===i.valueNodeProperty){const e=n.get(i.minNodeName),t=n.get(i.maxNodeName);if(y.Is.not.exist(e)||y.Is.not.exist(t)){console.warn("The min/max Node of the component of the controller doesn't exist");continue}const o=e.getTransform(),s=t.getTransform();r.getTransform().quaternion=I.Z.qlerp(o.quaternionInner,s.quaternionInner,i.value),r.getTransform().translate=a.ZP.lerp(s.translateInner,o.translateInner,i.value)}}}))}(e,l):console.warn("motionController not found")}}}var i}))}}},9227:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>A});var i=n(7987),a=n(2471),r=n(916),o=n(3496),s=n(7192),l=n(1350),c=n(657),_=n(5333),h=n(1784),d=n(7348),u=n(4587);class m{constructor(){this.__isWebVRMode=!1,this.__requestedToEnterWebVR=!1,this.__isReadyForWebVR=!1,this.__defaultUserSittingPositionInVR=a.ZP.fromCopyArray([0,1.1,1.5]),this.__invertSittingToStandingTransform=r.Z.identity(),this.__minRenderWidthFromUser=0,this.__minRenderHeightFromUser=0,this.__canvasWidthBackup=0,this.__canvasHeightBackup=0,this.__canvasWidthForVR=0,this.__canvasHeightForVR=0,this.__leftViewMatrix=o.Z.identity(),this.__rightViewMatrix=o.Z.identity();const e=l.Z.getInstance();this.__leftCameraEntity=e.createEntity([c.Z,_.Z,h.Z]),this.__rightCameraEntity=e.createEntity([c.Z,_.Z,h.Z])}static getInstance(){return this.__instance||(this.__instance=new m),this.__instance}getFrameData(){null!=this.__webvrDisplay&&(this.__webvrDisplay.getFrameData(this.__webvrFrameData),this.__webvrDisplay.stageParameters?this.__invertSittingToStandingTransform=r.Z.invert(new r.Z(this.__webvrDisplay.stageParameters.sittingToStandingTransform,!0)):this.__invertSittingToStandingTransform=r.Z.invert(r.Z.translate(this.__defaultUserSittingPositionInVR)))}async enterWebVR(e,t,n){return new Promise(((a,r)=>{const o=i.Z.getWebGLResourceRepository(),s=o.currentWebGLContextWrapper;if(null==s||null==this.__webvrDisplay||this.__webvrDisplay.isPresenting)r("WebGL context or WebVRDisplay is not ready yet.");else{null!=e&&(this.__defaultUserSittingPositionInVR=e),null!=t&&(this.__minRenderWidthFromUser=t),null!=n&&(this.__minRenderHeightFromUser=n),this.__vrDisplay=this.__webvrDisplay;const i=this.__webvrDisplay.getEyeParameters("left"),l=this.__webvrDisplay.getEyeParameters("right");this.__canvasWidthBackup=s.width,this.__canvasHeightBackup=s.height,this.__minRenderWidthFromUser>i.renderWidth&&this.__minRenderHeightFromUser>l.renderWidth?(this.__canvasWidthForVR=2*this.__minRenderWidthFromUser,this.__canvasHeightForVR=this.__minRenderHeightFromUser):(this.__canvasWidthForVR=2*Math.max(i.renderWidth,l.renderWidth),this.__canvasHeightForVR=Math.max(i.renderHeight,l.renderHeight)),o.resizeCanvas(this.__canvasWidthForVR,this.__canvasHeightForVR),this.__webvrDisplay.requestPresent([{source:s.canvas}]).then((()=>{this.__requestedToEnterWebVR=!0,console.info("requestPresent is succeeded."),a()})).catch((()=>{console.error("Failed to requestPresent. Please check your VR Setting, or something wrong with your VR system?"),r()}))}}))}async readyForWebVR(e){return new Promise(((t,n)=>{const a=i.Z.getWebGLResourceRepository().currentWebGLContextWrapper;null!=a?(window.VRFrameData?this.__webvrFrameData=new window.VRFrameData:n("WebVR is not supported in this environment."),navigator.getVRDisplays?navigator.getVRDisplays().then((i=>{if(i.length>0){const r=i[i.length-1];if(r.depthNear=.01,r.depthFar=1e4,r.capabilities.canPresent){if(this.__webvrDisplay=r,e)e.style.display="block";else{const e=document.createElement("p"),t=document.createElement("a");t.setAttribute("id","enter-vr");const n=document.createTextNode("Enter VR");t.appendChild(n),e.appendChild(t);const i=a.canvas;i.parentNode.insertBefore(e,i),window.addEventListener("click",this.enterWebVR.bind(this))}this.__isReadyForWebVR=!0,t()}else console.error("Can't requestPresent now. try again."),n()}else console.error("Failed to get VR Display. Please check your VR Setting, or something wrong with your VR system?"),n()})).catch((()=>{console.error("Failed to get VR Displays. Please check your VR Setting."),n()})):(console.error("Your browser does not support WebVR. Or it is disabled. Check again."),n())):n("WebGL Context is not ready yet.")}))}async exitWebVR(){this.__isWebVRMode=!1,this.__webvrDisplay&&this.__webvrDisplay.isPresenting&&await this.__webvrDisplay.exitPresent(),i.Z.getWebGLResourceRepository().resizeCanvas(this.__canvasWidthBackup,this.__canvasHeightBackup),this.__isReadyForWebVR=!1}async disableWebVR(){this.__isWebVRMode=!1,this.__requestedToEnterWebVR=!1,this.__isReadyForWebVR=!1,this.__webvrDisplay&&this.__webvrDisplay.isPresenting&&await this.__webvrDisplay.exitPresent(),this.__webvrDisplay=void 0}get isWebVRMode(){return this.__isWebVRMode}get isReadyForWebVR(){return this.__isReadyForWebVR}webVrSubmitFrame(){this.__webvrDisplay&&this.__webvrDisplay.isPresenting&&this.__webvrDisplay.submitFrame()}get webVrFrameData(){return this.__webvrFrameData}get leftViewMatrix(){return r.Z.multiplyTo(new r.Z(this.__webvrFrameData.leftViewMatrix,!0),this.__invertSittingToStandingTransform,this.__leftViewMatrix),this.__leftViewMatrix}get rightViewMatrix(){return r.Z.multiplyTo(new r.Z(this.__webvrFrameData.rightViewMatrix,!0),this.__invertSittingToStandingTransform,this.__rightViewMatrix),this.__rightViewMatrix}get leftProjectionMatrix(){return new o.Z(this.__webvrFrameData.leftProjectionMatrix,!0)}get rightProjectionMatrix(){return new o.Z(this.__webvrFrameData.rightProjectionMatrix,!0)}getLeftViewport(e){return s.ZP.fromCopyArray([0,0,this.__canvasWidthForVR/2,this.__canvasHeightForVR])}getRightViewport(e){return s.ZP.fromCopyArray([this.__canvasWidthForVR/2,0,this.__canvasWidthForVR/2,this.__canvasHeightForVR])}getViewMatrixAt(e){return 0===e?this.leftViewMatrix:this.rightViewMatrix}getProjectMatrixAt(e){return 0===e?this.leftProjectionMatrix:this.rightProjectionMatrix}getViewportAt(e,t){return 0===t?this.getLeftViewport(e):this.getRightViewport(e)}getCameraWorldPosition(){var e,t;const n=null===(t=null===(e=this.__webvrDisplay)||void 0===e?void 0:e.getPose())||void 0===t?void 0:t.position;return null!=n?(console.log(n),a.ZP.fromFloat32Array(n)):a.ZP.zero()}get vrDisplay(){return this.__vrDisplay}setValuesToGlobalDataRepository(){const e=this.__leftCameraEntity.getCamera(),t=this.__rightCameraEntity.getCamera();e.viewMatrix=this.leftViewMatrix,t.viewMatrix=this.rightViewMatrix,e.projectionMatrix=this.leftProjectionMatrix,t.projectionMatrix=this.rightProjectionMatrix,e.setValuesToGlobalDataRepositoryOnlyMatrices(),t.setValuesToGlobalDataRepositoryOnlyMatrices();const n=d.Z.getInstance(),i=this.getCameraWorldPosition();n.setValue(u.f.ViewPosition,e.componentSID,i),n.setValue(u.f.ViewPosition,t.componentSID,i)}getCameraComponentSIDAt(e){return 0===e?this.__leftCameraEntity.getCamera().componentSID:this.__rightCameraEntity.getCamera().componentSID}get requestedToEnterWebVR(){return this.__requestedToEnterWebVR}_setIsWebVRMode(){this.__isWebVRMode=!0}getCanvasWidthForVr(){return this.__canvasWidthForVR}getCanvasHeightForVr(){return this.__canvasHeightForVR}preRender(){var e;(null==this?void 0:this.isWebVRMode)&&(null===(e=this.vrDisplay)||void 0===e?void 0:e.isPresenting)&&this.getFrameData()}postRender(){var e;(null==this?void 0:this.isWebVRMode)&&(null===(e=this.vrDisplay)||void 0===e?void 0:e.isPresenting)&&this.vrDisplay.submitFrame(),(null==this?void 0:this.requestedToEnterWebVR)&&this._setIsWebVRMode()}}var x=n(8149);const f=Object.freeze({WebVRSystem:m,WebXRSystem:x.Z}),A=f;(0,eval)("this").RnXR=f},5337:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={version:"963538a",branch:"master"}},2862:e=>{"use strict";e.exports=JSON.parse('{"profileId":"oculus-touch","fallbackProfileIds":["generic-trigger-squeeze-thumbstick"],"layouts":{"left":{"selectComponentId":"xr-standard-trigger","components":{"xr-standard-trigger":{"type":"trigger"},"xr-standard-squeeze":{"type":"squeeze"},"xr-standard-thumbstick":{"type":"thumbstick"},"x-button":{"type":"button"},"y-button":{"type":"button"},"thumbrest":{"type":"button"},"menu":{"type":"button","reserved":true}},"gamepad":{"mapping":"xr-standard","buttons":["xr-standard-trigger","xr-standard-squeeze",null,"xr-standard-thumbstick","x-button","y-button","thumbrest"],"axes":[null,null,{"componentId":"xr-standard-thumbstick","axis":"x-axis"},{"componentId":"xr-standard-thumbstick","axis":"y-axis"}]}},"right":{"selectComponentId":"xr-standard-trigger","components":{"xr-standard-trigger":{"type":"trigger"},"xr-standard-squeeze":{"type":"squeeze"},"xr-standard-thumbstick":{"type":"thumbstick"},"a-button":{"type":"button"},"b-button":{"type":"button"},"thumbrest":{"type":"button"}},"gamepad":{"mapping":"xr-standard","buttons":["xr-standard-trigger","xr-standard-squeeze",null,"xr-standard-thumbstick","a-button","b-button","thumbrest"],"axes":[null,null,{"componentId":"xr-standard-thumbstick","axis":"x-axis"},{"componentId":"xr-standard-thumbstick","axis":"y-axis"}]}}}}')}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};return(()=>{"use strict";n.d(i,{default:()=>Kt});var e=n(1350),t=n(1328),a=n(2404),r=n(657),o=n(5333),s=n(6019),l=n(5850),c=n(1845),_=n(3648),h=n(3616),d=n(2390),u=n(2471),m=n(7192),x=n(4267),f=n(8182),A=n(9190),p=n(4536),g=n(18),v=n(1447),y=n(916),I=n(1162),b=n(2566),T=n(3496),S=n(3449);class E{constructor(){}async import(e,t){var n;if(t&&t.files)for(const n in t.files){const i=S.Z.getExtension(n);if("gltf"===i||"glb"===i)return await this.importGltfOrGlbFromArrayBuffers(t.files[n],t.files,t,e)}const i=await S.Z.fetchArrayBuffer(e);return await this.importGltfOrGlbFromArrayBuffers(i,null!==(n=null==t?void 0:t.files)&&void 0!==n?n:{},t,e)}async importGltfOrGlbFromFile(e,t){const n=await S.Z.fetchArrayBuffer(e);return await this.importGltfOrGlbFromArrayBuffers(n,{},t,e).catch((e=>{console.log("this.__loadFromArrayBuffer error",e)}))}async importGltfOrGlbFromArrayBuffers(e,t,n,i){if(1179937895!==new DataView(e,0,20).getUint32(0,!0)){const a=S.Z.arrayBufferToString(e),r=JSON.parse(a);return await this.importGltf(r,t,n,i)}return await this.importGlb(e,t,n)}_getOptions(e,t,n){if(t.asset&&t.asset.extras&&t.asset.extras.rnLoaderOptions)for(const n in t.asset.extras.rnLoaderOptions)e[n]=t.asset.extras.rnLoaderOptions[n];for(const t in n)e[t]=n[t];return n&&n.loaderExtensionName&&"string"==typeof n.loaderExtensionName&&(null!=Rn[n.loaderExtensionName]?e.loaderExtension=Rn[n.loaderExtensionName].getInstance():(console.error(`${n.loaderExtensionName} not found!`),e.loaderExtension=void 0)),e}async importGlb(e,t,n){const i=new DataView(e,0,20);if(1!==i.getUint32(4,!0))throw new Error("invalid version field in this binary glTF file.");const a=i.getUint32(12,!0);if(0!==i.getUint32(16,!0))throw new Error("invalid chunkType of chunk0 in this binary glTF file.");const r=new Uint8Array(e,20,a),o=S.Z.uint8ArrayToString(r),s=JSON.parse(o),l=S.Z.createDefaultGltfOptions();n=this._getOptions(l,s,n);const c=new Uint8Array(e,20+a);return void 0===s.asset&&(s.asset={}),void 0===s.asset.extras&&(s.asset.extras={fileType:"glTF",version:"1"}),this._mergeExtendedJson(s,n.extendedJson),s.asset.extras.rnLoaderOptions=n,(await this._loadInner(s,t,n,c))[0][0]}async importGltf(e,t,n,i){const a=(null==i?void 0:i.substring(0,null==i?void 0:i.lastIndexOf("/")))+"/";void 0===e.asset&&(e.asset={}),void 0===e.asset.extras&&(e.asset.extras={fileType:"glTF",version:"1"});const r=S.Z.createDefaultGltfOptions();return n=this._getOptions(r,e,n),this._mergeExtendedJson(e,n.extendedJson),e.asset.extras.rnLoaderOptions=n,(await this._loadInner(e,t,n,void 0,a))[0][0]}_loadInner(e,t,n,i,a){const r=[];return r.push(this._loadResources(i,e,t,n,a)),r.push(new Promise(((t,i)=>{this._loadJsonContent(e,n),t()}))),Promise.all(r)}_loadJsonContent(e,t){this._convertToGltf2LikeStructure(e),this._loadDependenciesOfScenes(e),this._loadDependenciesOfNodes(e),this._loadDependenciesOfMeshes(e),this._loadDependenciesOfMaterials(e),this._loadDependenciesOfTextures(e),this._loadDependenciesOfJoints(e),this._loadDependenciesOfAnimations(e),this._loadDependenciesOfAccessors(e),this._loadDependenciesOfBufferViews(e)}_convertToGltf2LikeStructure(e){e.bufferDic=e.buffers,this.__createProperty(e,e.bufferDic,"buffers"),e.sceneDic=e.scenes,this.__createProperty(e,e.sceneDic,"scenes"),e.meshDic=e.meshes;{let t=0;e.nodeDic=e.nodes,e.nodes=[],e.nodesIndices=[];for(const n in e.nodeDic){e.nodesIndices.push(t);const i=e.nodeDic[n];i._index=t++,e.nodes.push(i)}}e.skinDic=e.skins,this.__createProperty(e,e.skinDic,"skins"),e.materialDic=e.materials,this.__createProperty(e,e.materialDic,"materials"),e.animationDic=e.animations,this.__createProperty(e,e.animationDic,"animations"),e.accessorDic=e.accessors,e.bufferViewDic=e.bufferViews,e.cameraDic=e.cameras,e.imageDic=e.images,e.samplerDic=e.samplers,e.shaderDic=e.shaders,e.textureDic=e.textures}__createProperty(e,t,n){if(null==e[n])return;const i=Object.keys(t).length,a=e[n]=new Array(i);let r=0;for(const e in t)a[r]=t[e],r++}_loadDependenciesOfScenes(e){for(const t in e.sceneDic){const n=e.sceneDic[t];n.nodeNames=n.nodes,n.nodes=[],n.nodesIndices=[];for(const t of n.nodeNames){n.nodes.push(e.nodeDic[t]);let i=0;for(const n in e.nodeDic){if(n===t)break;i++}n.nodesIndices.push(i)}}}_loadDependenciesOfNodes(e){for(const t of e.nodes){if(t.children){t.childrenNames=t.children.concat(),t.children=[],t.childrenIndices=[];for(const n of t.childrenNames){const i=e.nodeDic[n];t.children.push(i),t.childrenIndices.push(i._index)}}if(void 0!==t.meshes&&void 0!==e.meshes){t.meshNames=t.meshes,t.meshes=[];for(const n of t.meshNames)t.meshes.push(e.meshDic[n]);if(t.mesh=t.meshes[1],null==t.meshes||0===t.meshes.length)t.mesh=t.meshes[0];else{const e={name:"",primitives:[]};for(let n=0;n<t.meshes.length;n++)e.name+="_"+t.meshes[n].name,Array.prototype.push.apply(e.primitives,t.meshes[n].primitives);e.name+="_merged",t.mesh=e,t.meshes=void 0}}void 0!==t.skin&&void 0!==e.skins&&"string"==typeof t.skin&&(t.skinName=t.skin,t.skin=e.skinDic[t.skinName]),void 0!==t.camera&&void 0!==e.cameras&&(t.cameraName=t.camera,t.camera=e.cameraDic[t.cameraName])}}_loadDependenciesOfMeshes(e){for(const t in e.meshDic){const n=e.meshDic[t];for(const t of n.primitives){void 0!==t.material&&(t.materialName=t.material,t.material=e.materialDic[t.materialName],t.materialIndex=e.materials.indexOf(t.material)),t.attributeNames=Object.assign({},t.attributes),t.attributes=[];for(let n in t.attributeNames)if(null!=t.attributeNames[n]){const i=t.attributeNames[n],a=e.accessorDic[i];"JOINT"===n?(n="JOINTS_0",delete t.attributes.JOINT):"WEIGHT"===n&&(n="WEIGHTS_0",delete t.attributes.WEIGHT),a.extras={toGetAsTypedArray:!0,attributeName:n},t.attributes.push(a)}void 0!==t.indices&&(t.indicesName=t.indices,t.indices=e.accessorDic[t.indicesName])}}}_isKHRMaterialsCommon(e){return void 0!==e.extensions&&void 0!==e.extensions.KHR_materials_common}_loadDependenciesOfMaterials(e){if(e.materials)for(const t in e.materials){let n=e.materials[t];const i=n;this._isKHRMaterialsCommon(n)&&(n=n.extensions.KHR_materials_common);const a=(t,a)=>{for(const r in t){let o=null;if(a){if(o=t[r].value,void 0===o)continue}else o=t[r];if("string"==typeof o){const t=o;"diffuse"===r||"CONSTANT"===n.technique&&"ambient"===r?(i.diffuseColorTexture={},i.diffuseColorTexture.texture=e.textures[o]):"emission"===r&&t.match(/_normal$/)&&(i.emissionTexture={},i.emissionTexture.texture=e.textures[o]),i.extras={},i.extras.technique=n.technique}else"diffuse"===r&&(i.diffuseColorFactor=o)}};a(n.values,!1),n.technique&&e.techniques&&void 0!==e.techniques[n.technique]&&a(e.techniques[n.technique].parameters,!0)}}_loadDependenciesOfTextures(e){if(e.textures)for(const t in e.textureDic){const n=e.textureDic[t];void 0!==n.sampler&&(n.samplerName=n.sampler,n.sampler=e.samplerDic[n.samplerName]),void 0!==n.source&&(n.sourceName=n.source,n.image=e.imageDic[n.sourceName])}}_loadDependenciesOfJoints(e){if(e.skins)for(const t in e.skinDic){const n=e.skinDic[t];n.joints=[],n.jointsIndices=[];for(const t of n.jointNames){const i=e.nodeDic[t];n.joints.push(i),n.jointsIndices.push(i._index)}if(n.skeletonNames=n.skeletons,n.skeletonNames)for(const t of n.skeletonNames)n.skeleton=n.skeletons.push(e.nodeDic[t]);else n.skeleton=n.joints[0];n.skeletonIndex=n.skeleton._index,n.inverseBindMatricesName=n.inverseBindMatrices,n.inverseBindMatrices=e.accessorDic[n.inverseBindMatricesName],n.joints_tmp=n.joints,n.joints=[];for(const t of n.joints_tmp)n.joints.push(e.nodeDic[t.name]);n.joints_tmp=void 0}}_loadDependenciesOfAnimations(e){if(e.animations)for(const t in e.animationDic){const n=e.animationDic[t];n.samplerDic=n.samplers,n.samplers=[];for(const t of n.channels)t.sampler=n.samplerDic[t.sampler],t.target.node=e.nodeDic[t.target.id],t.target.nodeIndex=t.target.node._index,t.sampler.input=e.accessors[n.parameters.TIME],t.sampler.output=e.accessors[n.parameters[t.target.path]],n.samplers.push(t.sampler),"rotation"===t.target.path&&(void 0===t.sampler.output.extras&&(t.sampler.output.extras={}),t.sampler.output.extras.quaternionIfVec4=!0);n.channelDic=n.channels,n.channels=[];for(const e of n.channelDic)n.channels.push(e)}}_loadDependenciesOfAccessors(e){for(const t in e.accessorDic){const n=e.accessorDic[t];void 0!==n.bufferView&&(n.bufferViewName=n.bufferView,n.bufferView=e.bufferViewDic[n.bufferViewName])}}_loadDependenciesOfBufferViews(e){for(const t in e.bufferViewDic){const n=e.bufferViewDic[t];if(void 0!==n.buffer){n.bufferName=n.buffer,n.buffer=e.bufferDic[n.bufferName];let t=0;for(const i in e.bufferDic)i===n.bufferName&&(n.bufferIndex=t),t++}}}_mergeExtendedJson(e,t){let n=null;if(t instanceof ArrayBuffer){const e=S.Z.arrayBufferToString(t);n=JSON.parse(e)}else"string"==typeof t?n=JSON.parse(t):"object"==typeof t&&(n=t);Object.assign(e,n)}_loadResources(e,t,n,i,a){var r;const o=[];for(const i in t.buffers){const r=t.buffers[i];let s="";if(r.uri){const e=r.uri.split("/");s=e[e.length-1]}void 0===r.uri||""===r.uri||"data:,"===r.uri?o.push(new Promise(((n,i)=>{r.buffer=e,n(t)}))):r.uri.match(/^data:application\/(.*);base64,/)?o.push(new Promise(((e,n)=>{const i=S.Z.dataUriToArrayBuffer(r.uri);r.buffer=new Uint8Array(i),e(t)}))):n&&this.__containsFileName(n,s)?o.push(new Promise(((e,i)=>{const a=this.__getFullPathOfFileName(n,s),o=n[a];r.buffer=new Uint8Array(o),e(t)}))):o.push(S.Z.loadResourceAsync(a+r.uri,!0,((e,n)=>{r.buffer=new Uint8Array(n),e(t)}),((e,t)=>{})))}for(const i of null!==(r=t.images)&&void 0!==r?r:[]){let r;if(void 0!==i.extensions&&void 0!==i.extensions.KHR_binary_glTF){const n=S.Z.createUint8ArrayFromBufferViewInfo(t,i.extensions.KHR_binary_glTF.bufferView,e);r=S.Z.createBlobImageUriFromUint8Array(n,i.extensions.KHR_binary_glTF.mimeType)}else if(void 0===i.uri){const n=S.Z.createUint8ArrayFromBufferViewInfo(t,i.bufferView,e);r=S.Z.createBlobImageUriFromUint8Array(n,i.mimeType)}else{const e=i.uri,t=e.split("/"),o=t[t.length-1];if(n&&this.__containsFileName(n,o)){const e=this.__getFullPathOfFileName(n,o),t=n[e];r=S.Z.createBlobImageUriFromUint8Array(new Uint8Array(t),i.mimeType)}else r=e.match(/^data:/)?e:a+e}o.push(this.__loadImageUri(r,i,n))}if(i.defaultTextures){const e=i.defaultTextures.basePath,t=i.defaultTextures.textureInfos;for(const n of t){const t=n.fileName,i=e+t,a=S.Z.getExtension(t),r=S.Z.getMimeTypeFromExtension(a),s=S.Z.createImageFromUri(i,r).then((e=>{e.crossOrigin="Anonymous",n.image={image:e}}));o.push(s)}}return Promise.all(o)}__containsFileName(e,t){for(const n in e){const e=n.split("/");if(e[e.length-1]===t)return!0}return!1}__getFullPathOfFileName(e,t){for(const n in e){const e=n.split("/");if(e[e.length-1]===t)return n}}__loadImageUri(e,t,n){var i,a;let r;return r=e.match(/basis$/)?new Promise((n=>{fetch(e,{mode:"cors"}).then((e=>{e.arrayBuffer().then((e=>{const i=new Uint8Array(e);t.basis=i,n()}))}))})):(null===(i=t.uri)||void 0===i?void 0:i.match(/basis$/))?new Promise((e=>{t.basis=new Uint8Array(n[t.uri]),e()})):e.match(/ktx2$/)||null!=t.bufferView&&"image/ktx2"===t.mimeType?new Promise((n=>{fetch(e,{mode:"cors"}).then((e=>{e.arrayBuffer().then((e=>{const i=new Uint8Array(e);t.ktx2=i,n()}))}))})):(null===(a=t.uri)||void 0===a?void 0:a.match(/ktx2$/))?new Promise((e=>{t.ktx2=new Uint8Array(n[t.uri]),e()})):S.Z.createImageFromUri(e,t.mimeType).then((e=>{e.crossOrigin="Anonymous",t.image=e})),r}static getInstance(){return this.__instance||(this.__instance=new E),this.__instance}}var C=n(2749),w=n(2993),D=n(810),N=n(8696),B=n(128),P=n(4252);class M{constructor(){}async importPointCloud(e,t){const n=e.substring(0,e.lastIndexOf("/"))+"/",i=S.Z.createDefaultGltfOptions();if(t&&t.files)for(const e in t.files)if("drc"===S.Z.getExtension(e))return await this.__decodeDraco(t.files[e],i,n,t).catch((e=>{console.log("this.__decodeDraco error",e)}));const a=await S.Z.fetchArrayBuffer(e);return await this.__decodeDraco(a,i,n,t).catch((e=>{console.log("this.__decodeDraco error",e)}))}importArrayBuffer(e,t,n){const i=e.substring(0,e.lastIndexOf("/"))+"/",a=S.Z.createDefaultGltfOptions();return this.__decodeDraco(t,a,i,n).catch((e=>{console.log("__loadFromArrayBuffer error",e)}))}async __loadFromArrayBuffer(e,t,n,i){const a=new DataView(e,0,20);let r;if(1179937895!==a.getUint32(0,!0)){const a=S.Z.arrayBufferToString(e),o=JSON.parse(a);r=await this._loadAsTextJson(o,i,t,n).catch((e=>{console.log("this.__loadAsTextJson error",e)}))}else r=await this._loadAsBinaryJson(a,!0,e,i,t,n).catch((e=>{console.log("this.__loadAsBinaryJson error",e)}));return r}_getOptions(e,t,n){if(t.asset&&t.asset.extras&&t.asset.extras.rnLoaderOptions)for(const n in t.asset.extras.rnLoaderOptions)e[n]=t.asset.extras.rnLoaderOptions[n];for(const t in n)e[t]=n[t];return n&&n.loaderExtensionName&&"string"==typeof n.loaderExtensionName&&(null!=Rn[n.loaderExtensionName]?e.loaderExtension=Rn[n.loaderExtensionName].getInstance():(console.error(`${n.loaderExtensionName} not found!`),e.loaderExtension=void 0)),e}async _loadAsBinaryJson(e,t,n,i,a,r){const o=e.getUint32(12,t);if(1313821514!==e.getUint32(16,t))throw new Error("invalid chunkType of chunk0 in this binary glTF file.");const s=new Uint8Array(n,20,o),l=S.Z.uint8ArrayToString(s),c=JSON.parse(l);i=this._getOptions(a,c,i);const _=new Uint8Array(n,20+o+8);void 0===c.asset.extras&&(c.asset.extras={fileType:"glTF",version:"2"}),this._mergeExtendedJson(c,i.extendedJson),c.asset.extras.rnLoaderOptions=i;try{await this._loadInner(_,r,c,i)}catch(e){console.log("this._loadInner error in _loadAsBinaryJson",e)}return c}async _loadAsTextJson(e,t,n,i){void 0===e.asset.extras&&(e.asset.extras={fileType:"glTF",version:"2"}),t=this._getOptions(n,e,t),this._mergeExtendedJson(e,t.extendedJson),e.asset.extras.rnLoaderOptions=t;try{await this._loadInner(void 0,i,e,t)}catch(e){console.log("this._loadInner error in _loadAsTextJson",e)}return e}_loadInner(e,t,n,i){const a=[];return a.push(this._loadResources(e,t,n,i,{shaders:[],buffers:[],images:[]})),a.push(new Promise(((e,t)=>{this._loadJsonContent(n,i),e()}))),Promise.all(a)}_loadJsonContent(e,t){this._loadDependenciesOfScenes(e),this._loadDependenciesOfNodes(e),this._loadDependenciesOfMeshes(e),this._loadDependenciesOfMaterials(e),this._loadDependenciesOfTextures(e),this._loadDependenciesOfJoints(e),this._loadDependenciesOfAnimations(e),this._loadDependenciesOfAccessors(e),this._loadDependenciesOfBufferViews(e),void 0===e.asset.extras&&(e.asset.extras={})}_loadDependenciesOfScenes(e){for(const t of e.scenes){t.nodesIndices=t.nodes.concat();for(const n in t.nodesIndices)t.nodes[n]=e.nodes[t.nodes[n]]}}_loadDependenciesOfNodes(e){for(const t of e.nodes){if(t.children){t.childrenIndices=t.children.concat(),t.children=[];for(const n in t.childrenIndices)t.children[n]=e.nodes[t.childrenIndices[n]]}void 0!==t.mesh&&void 0!==e.meshes&&(t.meshIndex=t.mesh,t.mesh=e.meshes[t.meshIndex]),void 0!==t.skin&&void 0!==e.skins&&(t.skinIndex=t.skin,t.skin=e.skins[t.skinIndex],void 0===t.mesh.extras&&(t.mesh.extras={}),t.mesh.extras._skin=t.skin),void 0!==t.camera&&void 0!==e.cameras&&(t.cameraIndex=t.camera,t.camera=e.cameras[t.cameraIndex]),void 0!==t.extensions&&void 0!==e.extensions&&void 0!==e.extensions.KHR_lights_punctual&&(t.extensions.KHR_lights_punctual.lightIndex=t.extensions.KHR_lights_punctual.light,t.extensions.KHR_lights_punctual.light=e.extensions.KHR_lights_punctual.lights[t.extensions.KHR_lights_punctual.lightIndex])}}_loadDependenciesOfMeshes(e){for(const t of e.meshes)for(const n of t.primitives){void 0!==n.material&&(n.materialIndex=n.material,n.material=e.materials[n.materialIndex]),n.attributesIndex=Object.assign({},n.attributes);for(const t in n.attributesIndex)if(n.attributesIndex[t]>=0){const i=e.accessors[n.attributesIndex[t]];i.extras={toGetAsTypedArray:!0,attributeName:t},n.attributes[t]=i}else n.attributes[t]=void 0;if(null!=n.indices&&(n.indicesIndex=n.indices,n.indices=e.accessors[n.indicesIndex]),null!=n.targets){n.targetIndices=n.targets,n.targets=[];for(const t of n.targetIndices){const i={};for(const n in t)if(t[n]>=0){const a=e.accessors[t[n]];a.extras={toGetAsTypedArray:!0,attributeName:n},i[n]=a}else i[n]=void 0;n.targets.push(i)}}}}_checkRnGltfLoaderOptionsExist(e){return!(!e.asset.extras||!e.asset.extras.rnLoaderOptions)}_loadDependenciesOfMaterials(e){if(e.textures||(e.textures=[]),e.materials)for(const t of e.materials){if(t.pbrMetallicRoughness){const n=t.pbrMetallicRoughness.baseColorTexture;void 0!==n&&(n.texture=e.textures[n.index]);const i=t.pbrMetallicRoughness.metallicRoughnessTexture;void 0!==i&&(i.texture=e.textures[i.index])}const n=t.normalTexture;void 0!==n&&(n.texture=e.textures[n.index]);const i=t.occlusionTexture;void 0!==i&&(i.texture=e.textures[i.index]);const a=t.emissiveTexture;void 0!==a&&(a.texture=e.textures[a.index]),this._checkRnGltfLoaderOptionsExist(e)&&e.asset.extras.rnLoaderOptions.loaderExtension&&e.asset.extras.rnLoaderOptions.loaderExtension.setTextures&&e.asset.extras.rnLoaderOptions.loaderExtension.setTextures(e,t)}}_loadDependenciesOfTextures(e){if(e.textures)for(const t of e.textures)void 0!==t.sampler&&(t.samplerIndex=t.sampler,t.sampler=e.samplers[t.samplerIndex]),void 0!==t.source&&(t.sourceIndex=t.source,t.image=e.images[t.sourceIndex])}_loadDependenciesOfJoints(e){if(e.skins)for(const t of e.skins){t.skeletonIndex=t.skeleton,t.skeleton=e.nodes[t.skeletonIndex],t.inverseBindMatricesIndex=t.inverseBindMatrices,t.inverseBindMatrices=e.accessors[t.inverseBindMatricesIndex],null==t.skeleton&&(t.skeletonIndex=t.joints[0],t.skeleton=e.nodes[t.skeletonIndex]),t.jointsIndices=t.joints,t.joints=[];for(const n of t.jointsIndices)t.joints.push(e.nodes[n])}}_loadDependenciesOfAnimations(e){if(e.animations)for(const t of e.animations){for(const n of t.channels)n.samplerIndex=n.sampler,n.sampler=t.samplers[n.samplerIndex],n.target.nodeIndex=n.target.node,n.target.node=e.nodes[n.target.nodeIndex];for(const n of t.channels)if(n.sampler.inputIndex=n.sampler.input,n.sampler.outputIndex=n.sampler.output,n.sampler.input=e.accessors[n.sampler.inputIndex],n.sampler.output=e.accessors[n.sampler.outputIndex],void 0===n.sampler.output.extras&&(n.sampler.output.extras={}),"rotation"===n.target.path&&(n.sampler.output.extras.quaternionIfVec4=!0),"weights"===n.target.path){const e=n.sampler.output.count/n.sampler.input.count;n.sampler.output.extras.weightsArrayLength=e}}}_loadDependenciesOfAccessors(e){for(const t of e.accessors)if(null==t.bufferView&&(t.bufferView=0),t.bufferViewIndex=t.bufferView,t.bufferView=e.bufferViews[t.bufferViewIndex],null!=t.sparse){const n=t.sparse;n.indices.indicesIndex=n.indices.bufferView,n.indices.bufferView=e.bufferViews[n.indices.indicesIndex],n.values.valuesIndex=n.values.bufferView,n.values.bufferView=e.bufferViews[n.values.valuesIndex]}}_loadDependenciesOfBufferViews(e){for(const t of e.bufferViews)void 0!==t.buffer&&(t.bufferIndex=t.buffer,t.buffer=e.buffers[t.bufferIndex])}_mergeExtendedJson(e,t){let n=null;if(t instanceof ArrayBuffer){const e=S.Z.arrayBufferToString(t);n=JSON.parse(e)}else"string"==typeof t?(n=JSON.parse(t),n=n):"object"==typeof t&&(n=t);Object.assign(e,n)}_loadResources(e,t,n,i,a){const r=[];let o;for(const s in n.buffers){const l=n.buffers[s];let c,_;l.uri&&(c=l.uri.split("/"),_=c[c.length-1]),o=void 0===l.uri?new P.Z(((t,n)=>{a.buffers[s]=e,l.buffer=e,t(e)})):l.uri.match(/^data:application\/(.*);base64,/)?new P.Z(((e,t)=>{const n=S.Z.dataUriToArrayBuffer(l.uri);a.buffers[s]=new Uint8Array(n),l.buffer=new Uint8Array(n),e(n)})):i.files&&i.files[_]?new P.Z(((e,t)=>{const n=i.files[_];a.buffers[s]=new Uint8Array(n),l.buffer=new Uint8Array(n),e(n)})):new P.Z(S.Z.loadResourceAsync(t+l.uri,!0,((e,t)=>{a.buffers[s]=new Uint8Array(t),l.buffer=new Uint8Array(t),e(t)}),((e,t)=>{}))),l.bufferPromise=o,r.push(o)}for(const o in n.images){const s=o,l=n.images[s];let c;if(void 0===l.uri){let t=e;null==e&&(t=n.bufferViews[l.bufferView].buffer.buffer);const i=S.Z.createUint8ArrayFromBufferViewInfo(n,l.bufferView,e);c=S.Z.createBlobImageUriFromUint8Array(i,l.mimeType)}else{const e=l.uri,n=e.split("/"),a=n[n.length-1];if(i.files&&i.files[a]){const e=i.files[a];c=S.Z.createBlobImageUriFromUint8Array(new Uint8Array(e),l.mimeType)}else c=e.match(/^data:/)?e:t+e}const _=S.Z.createImageFromUri(c,l.mimeType).then((e=>{e.crossOrigin="Anonymous",a.images[s]=e,l.image=e}));r.push(_)}if(i.defaultTextures){const e=i.defaultTextures.basePath,t=i.defaultTextures.textureInfos;for(const n of t){const t=n.fileName,i=e+t,a=S.Z.getExtension(t),o=S.Z.getMimeTypeFromExtension(a),s=S.Z.createImageFromUri(i,o).then((e=>{e.crossOrigin="Anonymous",n.image={image:e}}));r.push(s)}}return Promise.all(r).catch((e=>{console.log("Promise.all error",e)}))}static getInstance(){return this.__instance||(this.__instance=new M),this.__instance}__decodeDraco(e,t,n,i){return this.__decodeBuffer(e).then((e=>{const a=JSON.stringify(e),r=JSON.parse(a);return this._loadAsTextJson(r,i,t,n).catch((e=>{console.log("this.__loadAsTextJson error",e)}))}))}__decodeBuffer(e){const t=new DracoDecoderModule,n=new t.Decoder,i=this.__getGeometryFromDracoBuffer(t,n,e);if(null==i)throw new Error("invalid dracoGeometry.");if(i.geometryType!==t.POINT_CLOUD)throw new Error("invalid geometryType of drc file.");if(-1===n.GetAttributeId(i,t.POSITION))throw t.destroy(n),t.destroy(i),new Error("Draco: No position attribute found.");const a=["POSITION","NORMAL","COLOR","TEX_COORD","GENERIC"],r=i.num_points(),o=[],s=[];let l=0;for(let e=0;e<a.length;e++){const c=n.GetAttributeId(i,t[a[e]]);if(-1===c){a.splice(e,1),e--;continue}const _=n.GetAttribute(i,c),h=new t.DracoFloat32Array;n.GetAttributeFloatForAllPoints(i,_,h),o[e]=h;const d=_.num_components();s[e]=d,"COLOR"===a[e]?l+=4*r:l+=r*d}const c=new Float32Array(l);for(let e=0,n=0;e<a.length;e++){if("COLOR"===a[e]&&3===s[e])for(let t=0;t<r;n+=4,t+=3)c[n]=o[e].GetValue(t),c[n+1]=o[e].GetValue(t+1),c[n+2]=o[e].GetValue(t+2),c[n+3]=1;else if("TEX_COORD"===a[e])for(let t=0;t<r;n+=2,t++)c[n]=o[e].GetValue(2*t),c[n+1]=1-o[e].GetValue(2*t+1);else for(let t=0;t<r*s[e];n++,t++)c[n]=o[e].GetValue(t);t.destroy(o[e])}return t.destroy(n),t.destroy(i),this.__decodedBufferToJSON(c,r,a,s)}async __decodedBufferToJSON(e,t,n,i){const a={asset:{version:"2.0"},extensionsUsed:["KHR_materials_unlit"],extensionsRequired:["KHR_materials_unlit"],nodes:[{name:"Node",mesh:0}],scenes:[{nodes:[0]}],materials:[{name:"point-cloud_material",pbrMetallicRoughness:{baseColorFactor:[1,1,1,1]},extensions:{KHR_materials_unlit:{}}}]};return await this.__setBuffersToJSON(e,a),this.__setAccessorsAndBufferViewsToJSON(t,n,i,a),this.__setMeshesToJSON(n,a),new Promise(((e,t)=>{e(a)}))}__setBuffersToJSON(e,t){return this.__convertBufferToURI(e.buffer).then((n=>{t.buffers=[{name:"input",byteLength:e.byteLength,uri:n}]})).catch((e=>{console.log("this.__convertBufferToURI error:",e)}))}__convertBufferToURI(e){return new Promise(((t,n)=>{const i=new Blob([e],{type:"application/octet-stream"}),a=new FileReader;a.onload=()=>{t(a.result)},a.onerror=()=>{n(a.error)},a.readAsDataURL(i)}))}__setAccessorsAndBufferViewsToJSON(e,t,n,i){const a=[],r=[];let o=0;for(let i=0,s=0;i<t.length;s++){const l=n[i];let c;c=1===l?"SCALAR":"VEC"+l;let _=0;const h=t[i];for(;i<t.length&&(a.push({name:"point-cloud_"+h+"_"+i,componentType:5126,count:e,type:c,bufferView:s,byteOffset:_}),"COLOR"===t[i]?_+=4*e*4:_+=e*l*4,i++,h==t[i]););r[s]={name:"bufferView_"+h,buffer:0,byteLength:_,byteOffset:o,byteStride:4*l,target:34962},o+=_}i.accessors=a,i.bufferViews=r}__setMeshesToJSON(e,t){const n={};for(let t=0;t<e.length;t++)"TEX_COORD"===e[t]?n.TEXCOORD_0=t:"GENERIC"===e[t]?n.TANGENT=t:n[e[t]]=t;const i={name:"Node-Mesh",primitives:[{mode:0,material:0,attributes:n}]};t.meshes=[i]}async importPointCloudToPrimitive(e){const t=await S.Z.fetchArrayBuffer(e);return this.__decodeDracoToPrimitive(t)}__decodeDracoToPrimitive(e){const t=new DracoDecoderModule,n=new t.Decoder,i=this.__getGeometryFromDracoBuffer(t,n,e);if(null==i)throw new Error("invalid dracoGeometry.");if(i.geometryType!==t.POINT_CLOUD)throw new Error("invalid geometryType of drc file.");const a=[],r=[],o=[];this.__getPositions(t,n,i,a,r,o),this.__getColors(t,n,i,a,r,o),this.__getNormals(t,n,i,a,r,o),this.__getTextureCoords(t,n,i,a,r,o);const s=c.Z.createPrimitive({attributeCompositionTypes:a,attributeSemantics:r,attributes:o,material:w.Z.createClassicUberMaterial({isSkinning:!1,isLighting:!0}),primitiveMode:N.T.Points});return t.destroy(n),t.destroy(i),s}__getGeometryFromDracoBuffer(e,t,n){const i=new e.DecoderBuffer;i.Init(new Int8Array(n),n.byteLength);const a=t.GetEncodedGeometryType(i);let r,o;if(a===e.TRIANGULAR_MESH)r=new e.Mesh,o=t.DecodeBufferToMesh(i,r);else if(a===e.POINT_CLOUD)r=new e.PointCloud,o=t.DecodeBufferToPointCloud(i,r);else{const e="Unknown geometry type.";console.error(e)}if(r.geometryType=a,!o.ok()||0==r.ptr){let n="Decoding failed: ";return n+=o.error_msg(),console.error(n),e.destroy(t),void e.destroy(r)}return e.destroy(i),r}__getPositions(e,t,n,i,a,r){const o=t.GetAttributeId(n,e.POSITION);if(-1===o)throw e.destroy(t),e.destroy(n),new Error("Draco: No position attribute found.");const s=t.GetAttribute(n,o),l=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(n,s,l);const c=3*n.num_points(),_=new Float32Array(c);for(let e=0;e<c;e+=1)_[e]=l.GetValue(e);return i.push(D.d.Vec3),a.push(B.T.Position),r.push(_),e.destroy(l),_}__getColors(e,t,n,i,a,r){const o=t.GetAttributeId(n,e.COLOR);if(-1===o)return null;{const s=t.GetAttribute(n,o),l=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(n,s,l);const c=n.num_points(),_=s.num_components(),h=4*c,d=new Float32Array(h);for(let e=0;e<h;e+=_)d[e]=l.GetValue(e),d[e+1]=l.GetValue(e+1),d[e+2]=l.GetValue(e+2),d[e+3]=4==_?l.GetValue(e+3):1;return i.push(D.d.Vec3),a.push(B.T.Color0),r.push(d),e.destroy(l),d}}__getNormals(e,t,n,i,a,r){const o=t.GetAttributeId(n,e.NORMAL);if(-1===o)return null;{const s=t.GetAttribute(n,o),l=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(n,s,l);const c=3*n.num_points(),_=new Float32Array(c);for(let e=0;e<c;e+=1)_[e]=l.GetValue(e);return i.push(D.d.Vec3),a.push(B.T.Normal),r.push(_),e.destroy(l),_}}__getTextureCoords(e,t,n,i,a,r){const o=t.GetAttributeId(n,e.TEX_COORD);if(-1===o)return null;{const s=t.GetAttribute(n,o),l=new e.DracoFloat32Array;t.GetAttributeFloatForAllPoints(n,s,l);const c=2*n.num_points(),_=new Float32Array(c);for(let e=0;e<c;e+=1)_[e]=l.GetValue(e);return i.push(D.d.Vec2),a.push(B.T.Texcoord0),r.push(_),e.destroy(l),_}}}var F=n(2343);class R extends F.Jx{constructor({index:e,str:t,ext:n,brand:i}){super({index:e,str:t}),this.extension=n,this.brand=i}}const L=new R({index:-1,str:"unknown",ext:"unknown",brand:"UnKnown"}),V=new R({index:0,str:"gltf",ext:"gltf",brand:"glTF"}),W=new R({index:1,str:"glb",ext:"glb",brand:"glTF"}),z=new R({index:2,str:"vrm",ext:"vrm",brand:"VRM"}),H=new R({index:3,str:"drc",ext:"drc",brand:"Draco"}),O=new R({index:4,str:"efk",ext:"efk",brand:"EffekseerEffect"}),G=[L,V,W,z,H,O],Q=Object.freeze({Unknown:L,Gltf:V,GltfBinary:W,VRM:z,Draco:H,EffekseerEffect:O,from:function(e){return(0,F.li)({typeList:G,index:e})},fromString:function(e){const t=(0,F.cu)({typeList:G,str:e});return null!=t?t:L},isGltfOrGlb:function(e){return e===V||e===W}});function k(e){for(const t in e){const e=S.Z.getExtension(t);if("gltf"===e)return Q.Gltf;if("glb"===e)return Q.GltfBinary;if("vrm"===e)return Q.VRM;if("drc"===e)return Q.Draco}return Q.Unknown}var U=n(6694),Z=n(9721),X=n(4710),q=n(4507),Y=n(4388),j=n(3581),K=n(963);class J{constructor(){this.__boneAxis=u.ZP.zero(),this.__length=0,this.__currentTail=u.ZP.zero(),this.__prevTail=u.ZP.zero(),this.__localDir=u.ZP.zero(),this.__localRotation=new Y.Z(0,0,0,1),this.__initalized=!1,this.__localChildPosition=u.ZP.zero()}initialize(e,t,n){this.__transform=e;const i=e.getWorldPositionOf(t);this.__currentTail=null!=n?n.getLocalPositionOf(i):i,this.__prevTail=this.__currentTail,this.__localRotation=e.entity.getTransform().quaternion,this.__boneAxis=u.ZP.normalize(t),this.__length=t.length(),this.__localChildPosition=t,this.__initalized=!0}get isInitialized(){return this.__initalized}get head(){return this.__transform}get tail(){return u.ZP.multiplyTo(this.__boneAxis,this.__length,J.__tmp_vec3),this.__transform.worldMatrixInner.multiplyVector3To(J.__tmp_vec3,J.__tmp_vec3_2),J.__tmp_vec3_2}get parentRotation(){return null!=this.__transform.parent?Y.Z.fromMatrix(this.__transform.parent.worldMatrixInner):new Y.Z(0,0,0,1)}static update(){for(const e of this.__boneGroups)this.updateInner(e.rootBones,e)}static updateInner(e,t){const n=t.dragForce,i=t.stiffnessForce*j.Z.lastTickTimeInterval*1,a=u.ZP.multiply(t.gravityDir,t.gravityPower*j.Z.lastTickTimeInterval*1),r=J.getColliderGroups(t.colliderGroupIndices);for(const o of e){const e=o.entity.getPhysics();if(e){e.strategy.update(i,n,a,r,t.hitRadius,void 0);const s=o.children;s&&this.updateInner(s,t)}}}static initialize(e){const t=e.children,n=e.entity.getPhysics().strategy;if(t.length>0)t[0].entity.getTransform(),n.initialize(e,y.Z.invert(e.worldMatrixInner).multiplyVector3(t[0].worldPosition),void 0);else{const t=u.ZP.subtract(e.worldPosition,e.parent.worldPosition);let i=u.ZP.fromCopyArray([1,1,1]);t.lengthSquared()>0&&(i=u.ZP.add(e.worldPosition,u.ZP.multiply(u.ZP.normalize(t),.07))),n.initialize(e,y.Z.invert(e.worldMatrixInner).multiplyVector3(i),void 0)}}calcParentDeltaRecursivle(e){u.ZP.subtract(e.worldPosition,e.parent.worldPosition)}update(e,t,n,i,a,r){const o=null!=r?r.getWorldPositionOf(this.__currentTail):this.__currentTail,s=null!=r?r.getWorldPositionOf(this.__prevTail):this.__prevTail,l=A.ZP.multiply(u.ZP.subtract(o,s),1-t),c=J.__tmp_quat;Y.Z.multiplyTo(this.parentRotation,this.__localRotation,c);const _=J.__tmp_vec3;_.copyComponents(this.__boneAxis).multiplyQuaternion(c).multiply(e);let h=u.ZP.add(u.ZP.add(u.ZP.add(o,l),_),n);const d=u.ZP.subtract(h,this.__transform.worldPosition);h=u.ZP.add(this.__transform.worldPosition,u.ZP.multiply(u.ZP.normalize(d),this.__length)),h=this.collision(i,h,a),this.__prevTail=null!=r?r.getLocalPositionOf(o):o,this.__currentTail=null!=r?r.getLocalPositionOf(h):h,this.applyRotation(h),this.head.children.length>0&&(this.head.children[0].entity.getTransform().translate=this.__transform.getLocalPositionOf(h))}applyRotation(e){const t=this.__localRotation,n=Y.Z.multiply(Y.Z.lookFromTo(this.__boneAxis,this.__transform.getLocalPositionOf(e)),t);return this.__boneAxis,n}collision(e,t,n){for(const i of e)for(const e of i.colliders){const a=i.baseSceneGraph.getWorldPositionOf(e.position),r=n+e.radius,o=u.ZP.subtract(t,a),s=r-o.length();if(s>=0){const e=u.ZP.normalize(o),n=u.ZP.multiply(u.ZP.add(a,e),s);return u.ZP.add(t,n)}}return t}static setBoneGroups(e){this.__boneGroups=e}static addColliderGroup(e,t){this.__colliderGroups.set(e,t)}static getColliderGroups(e){const t=[];for(const n of e)t.push(this.__colliderGroups.get(n));return t}}J.__tmp_vec3=A.ZP.zero(),J.__tmp_vec3_2=A.ZP.zero(),J.__tmp_quat=K.Z.identity(),J.__boneGroups=[],J.__colliderGroups=new Map;class $ extends Z.Z{constructor(e,t,n){super(e,t,n),this.__strategy=new J,this.moveStageTo(q.I.Logic)}static get componentTID(){return X.z.PhysicsComponentTID}get strategy(){return this.__strategy}static common_$logic(){J.update()}$logic(){}}a.Z.registerComponentClass($);class ee{constructor(){this.position=u.ZP.zero(),this.radius=0}}var te=n(2651);class ne{constructor(){this.colliders=[]}}var ie=n(9002);class ae extends ie.Z{constructor(){super(),this.stiffnessForce=.5,this.gravityPower=0,this.gravityDir=u.ZP.fromCopyArray([0,-1,0]),this.dragForce=.05,this.hitRadius=.02,this.rootBones=[],this.colliderGroupIndices=[]}}class re extends ie.Z{constructor(){super(),this.__renderPasses=[]}addRenderPasses(e){for(const t of e)this.__renderPasses.push(t)}clearRenderPasses(){this.__renderPasses.length=0}get renderPasses(){return this.__renderPasses}}var oe=n(2251),se=n(8268);class le extends ie.Z{constructor(){super(),this.__entities=[],this.__sceneGraphDirectlyAdded=[],this.__topLevelSceneGraphComponents=[],this.toClearColorBuffer=!1,this.toClearDepthBuffer=!0,this.toClearStencilBuffer=!1,this.isDepthTest=!0,this.clearColor=m.ZP.fromCopyArray([1,1,1,1]),this.clearDepth=1,this.clearStencil=0,this.cullFrontFaceCCW=!0,this.__primitiveMaterial=new Map,this.isVrRendering=!0,this.isOutputForVr=!1}setPreRenderFunction(e){this.__preRenderFunc=e}unsetPreRenderFunction(){this.__preRenderFunc=void 0}doPreRender(){null!=this.__preRenderFunc&&this.__preRenderFunc()}addEntities(e){for(const t of e){const e=t.getSceneGraph();this.__sceneGraphDirectlyAdded.push(e);const n=o.Z.flattenHierarchy(e,!1).map((e=>e.entity)),i=this.__entities.concat(n).reduce(((e,t)=>(e.set(t.entityUID,t),e)),new Map);this.__entities=Array.from(i.values())}this.__meshComponents=void 0,this.__topLevelSceneGraphComponents=void 0,this.__collectMeshComponents(),this.__collectTopLevelSceneGraphComponents()}get entities(){return this.__entities}clearEntities(){this.__meshComponents=void 0,this.__topLevelSceneGraphComponents=void 0,this.__entities=[]}__collectTopLevelSceneGraphComponents(){if(null==this.__topLevelSceneGraphComponents){const e=t=>(t.parent&&e(t.parent),t);this.__topLevelSceneGraphComponents=this.__sceneGraphDirectlyAdded.map((t=>e(t)));const t=new Set(this.__topLevelSceneGraphComponents);this.__topLevelSceneGraphComponents=Array.from(t)}}__collectMeshComponents(){null==this.__meshComponents&&(this.__meshComponents=[],this.__entities.filter((e=>{const t=e.getMesh();t&&this.__meshComponents.push(t)})))}get meshComponents(){return this.__collectMeshComponents(),this.__meshComponents}get sceneTopLevelGraphComponents(){return this.__collectTopLevelSceneGraphComponents(),null!=this.__topLevelSceneGraphComponents?this.__topLevelSceneGraphComponents:[]}setFramebuffer(e){this.__frameBuffer=e,null!=e?this.setViewport(m.ZP.fromCopyArray([0,0,e.width,e.height])):this.__viewport=void 0}getFramebuffer(){return this.__frameBuffer}setViewport(e){null!=this.__viewport?this.__viewport.copyComponents(e):this.__viewport=p.ZP.fromCopyArray([e.x,e.y,e.z,e.w])}getViewport(){let e=this.__viewport;return null!=e&&(e=le.__tmp_Vector4_0.copyComponents(e)),e}setResolveFramebuffer(e){const t=se.Z.getInstance().currentWebGLContextWrapper;t&&t.isWebGL2?this.__resolveFrameBuffer=e:console.error("resolve framebuffer is unavailable in this webgl context")}getResolveFramebuffer(){return this.__resolveFrameBuffer}copyFramebufferToResolveFramebuffer(){const e=se.Z.getInstance(),t=e.getWebGLResource(this.__frameBuffer.cgApiResourceUid),n=e.getWebGLResource(this.__resolveFrameBuffer.cgApiResourceUid),i=e.currentWebGLContextWrapper.getRawContextAsWebGL2();i.bindFramebuffer(i.READ_FRAMEBUFFER,t),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,n),i.blitFramebuffer(0,0,this.__frameBuffer.width,this.__frameBuffer.height,0,0,this.__resolveFrameBuffer.width,this.__resolveFrameBuffer.height,i.COLOR_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null)}__setupMaterial(e){e.isEmptyMaterial()||this.__setWebglRenderingStrategyIfNotYet(this.__webglRenderingStrategy).setupShaderForMaterial(e)}setMaterialForPrimitive(e,t){this.__primitiveMaterial.set(t,e),this.__setupMaterial(e)}setMaterial(e){this.__material=e,this.__setupMaterial(e)}get material(){return this.__material}__setWebglRenderingStrategyIfNotYet(e){if(null!=e)return e;const t=_.Z.getInstance().processApproach,n=oe.Z.getInstance().getModule("webgl").getRenderingStrategy(t);return this.__webglRenderingStrategy=n,n}__getMaterialOf(e){return this.__primitiveMaterial.get(e)}__hasMaterialOf(e){return this.__primitiveMaterial.has(e)}getAppropriateMaterial(e,t){let n;return n=this.__hasMaterialOf(e)?this.__getMaterialOf(e):null!=this.material?this.material:t,n}}le.__tmp_Vector4_0=p.ZP.zero();var ce=n(4690);class _e{constructor(){}static getInstance(){return this.__instance||(this.__instance=new _e),this.__instance}async importJsonOfVRM(e,t){t=this._getOptions(t);const n=C.Z.getInstance(),i=await n.import(e,t);if(!ce.Is.not.exist(i))return this._readVRMHumanoidInfo(i),i}async import(e,t){Array.isArray(e)||(e="string"==typeof e?[e]:[]),t=this.__initOptions(t);const n=await this.__importMultipleModelsFromUri(e,t);if(t&&t.cameraComponent)for(const e of n)e.cameraComponent=t.cameraComponent;return this.__setRenderPassesToExpression(n,t)}async importFromArrayBuffers(e,t){t=this.__initOptions(t);const n=await this.__importMultipleModelsFromArrayBuffers(e,t);if(t&&t.cameraComponent)for(const e of n)e.cameraComponent=t.cameraComponent;return this.__setRenderPassesToExpression(n,t)}__initOptions(e){if(null==e)e=S.Z.createDefaultGltfOptions();else{null==e.files&&(e.files={});for(const t in e.files){if(null==t.match(/.*\.vrm$/))continue;const n=t.split(".vrm")[0];if(n){const i=e.files[t];e.files[n+".glb"]=i,delete e.files[t]}}!1===Array.isArray(e.defaultMaterialHelperArgumentArray)?e.defaultMaterialHelperArgumentArray=[{}]:!1===e.defaultMaterialHelperArgumentArray[0].isMorphing&&(e.maxMorphTargetNumber=0)}return e}__setRenderPassesToExpression(e,t){var n;const i=null!==(n=t.expression)&&void 0!==n?n:new re;return i.renderPasses!==e&&(i.clearRenderPasses(),i.addRenderPasses(e)),i}__importMultipleModelsFromUri(e,t){var n;const i=[],a=(null===(n=t.expression)||void 0===n?void 0:n.renderPasses)||[];0===a.length&&a.push(new le);for(const n of e)""!==n&&null==t.files[n]&&i.push(this.__importToRenderPassesFromUriPromise(n,a,t));return Promise.all(i).then((()=>a))}__importMultipleModelsFromArrayBuffers(e,t){var n;const i=[],a=(null===(n=t.expression)||void 0===n?void 0:n.renderPasses)||[];0===a.length&&a.push(new le);for(const n in e){const e=S.Z.getExtension(n);this.__isValidExtension(e)&&i.push(this.__importToRenderPassesFromArrayBufferPromise(n,a,t,n))}return Promise.all(i).then((()=>a))}__isValidExtension(e){return"gltf"===e||"glb"===e||"vrm"===e||"drc"===e}__importToRenderPassesFromUriPromise(e,t,n){return S.Z.fetchArrayBuffer(e).then((i=>(n.files[e]=i,this.__importToRenderPassesFromArrayBufferPromise(e,t,n,e))))}__isGlb(e){return 1179937895===new DataView(e,0,20).getUint32(0,!0)}__getGlbVersion(e){return new DataView(e,0,20).getUint32(4,!0)}__getGltfVersion(e){var t,n;return"2"===(null===(n=null===(t=e.asset)||void 0===t?void 0:t.version)||void 0===n?void 0:n.charAt(0))?2:1}__importToRenderPassesFromArrayBufferPromise(e,t,n,i){const a=n.fileType,r=this.__getFileTypeFromFilePromise(e,n,a);return new Promise(((a,o)=>{const s=U.Z.getInstance(),l=n.files[e];n.isImportVRM=!1;let c=0;switch(r){case Q.Gltf:{const i=S.Z.arrayBufferToString(l),r=JSON.parse(i);let o;c=this.__getGltfVersion(r),o=1===c?E.getInstance():C.Z.getInstance(),o.importGltf(r,n.files,n,e).then((e=>{const n=s.convertToRhodoniteObject(e);t[0].addEntities([n]),a()}))}break;case Q.GltfBinary:{let e;c=this.__getGlbVersion(l),e=1===c?E.getInstance():C.Z.getInstance(),e.importGlb(l,n.files,n).then((e=>{const n=s.convertToRhodoniteObject(e);t[0].addEntities([n]),a()}))}break;case Q.Draco:M.getInstance().importArrayBuffer(i,l,n).then((e=>{if(null==e)console.error("importArrayBuffer error is occurred"),o();else{const n=s.convertToRhodoniteObject(e);t[0].addEntities([n]),a()}}));break;case Q.VRM:n.isImportVRM=!0,this.__importVRM(i,l,t,n).then((()=>{a()}));break;default:console.error("detect invalid format"),o()}}))}__getFileTypeFromFilePromise(e,t,n){return null!=n?Q.fromString(n):k({[e]:t.files[e]})}__importVRM(e,t,n,i){return C.Z.getInstance().importGltfOrGlbFromArrayBuffers(t,i.files,i).then((e=>{var t,i,a,r,o;const s=e,l=null===(i=null===(t=s.asset.extras)||void 0===t?void 0:t.rnLoaderOptions)||void 0===i?void 0:i.defaultMaterialHelperArgumentArray;let c;ce.Is.exist(l)&&(l[0].textures=null!==(a=l[0].textures)&&void 0!==a?a:this._createTextures(s),l[0].isLighting=null===(r=l[0].isLighting)||void 0===r||r,this._initializeMaterialProperties(s,l[0].textures.length));const _=U.Z.getInstance();if(this._existOutlineMaterial(s.extensions.VRM)){n[1]=null!==(o=n[1])&&void 0!==o?o:new le;const e=n[1];e.toClearColorBuffer=!1,e.toClearDepthBuffer=!1,s.extensions.VRM.rnExtension={renderPassOutline:e},c=_.convertToRhodoniteObject(s),e.addEntities([c])}else c=_.convertToRhodoniteObject(s);n[0].addEntities([c]),this._readSpringBone(c,s),this._readVRMHumanoidInfo(s,c)}))}_getOptions(e){if(null!=e){for(const t in e.files){const n=t.split(".vrm")[0];if(n){const i=e.files[t];e.files[n+".glb"]=i,delete e.files[t]}}e.isImportVRM=!0,null==e.defaultMaterialHelperArgumentArray&&(e.defaultMaterialHelperArgumentArray=[{}]),e.defaultMaterialHelperArgumentArray[0].isMorphing||(e.maxMorphTargetNumber=0)}else e={files:{},loaderExtension:void 0,defaultMaterialHelperName:void 0,defaultMaterialHelperArgumentArray:[{isLighting:!0,isMorphing:!0,isSkinning:!0}],statesOfElements:[{targets:[],states:{enable:[],functions:{}},isTransparent:!0,opacity:1,isTextureImageToLoadPreMultipliedAlpha:!1}],isImportVRM:!0};return e}_readVRMHumanoidInfo(e,t){const n=e.extensions.VRM.humanoid.humanBones,i=new Map;for(const t of n){i.set(t.bone,t.node);const n=e.nodes[t.node];t.name=n.name}null!=t&&t.tryToSetTag({tag:"humanoid_map_name_nodeId",value:i})}_readSpringBone(t,n){const i=e.Z.getInstance(),a=[];for(const e of n.extensions.VRM.secondaryAnimation.boneGroups){const t=new ae;t.tryToSetUniqueName(e.comment,!0),t.dragForce=e.dragForce,t.stiffnessForce=e.stiffiness,t.gravityPower=e.gravityPower,t.gravityDir=u.ZP.fromCopyArray([e.gravityDir.x,e.gravityDir.y,e.gravityDir.z]),t.colliderGroupIndices=e.colliderGroups,t.hitRadius=e.hitRadius;for(const i in e.bones){const a=e.bones[i],r=n.asset.extras.rnEntities[a];t.rootBones.push(r.getSceneGraph())}a.push(t)}J.setBoneGroups(a);for(const e of a)for(const t of e.rootBones)this.addPhysicsComponentRecursively(i,t);const r=[];for(const e in n.extensions.VRM.secondaryAnimation.colliderGroups){const t=n.extensions.VRM.secondaryAnimation.colliderGroups[e],i=new ne;r.push(i);const a=[];for(const e of t.colliders){const t=new ee;t.position=u.ZP.fromCopyArray([e.offset.x,e.offset.y,e.offset.z]),t.radius=e.radius,a.push(t)}i.colliders=a;const o=n.asset.extras.rnEntities[t.node].getSceneGraph();i.baseSceneGraph=o,J.addColliderGroup(parseInt(e),i)}}addPhysicsComponentRecursively(e,t){const n=t.entity;if(e.addComponentsToEntity([$],n.entityUID),J.initialize(t),t.children.length>0)for(const n of t.children)this.addPhysicsComponentRecursively(e,n)}_createTextures(e){e.textures||(e.textures=[]);const t=e.textures,n=[];for(let i=0;i<t.length;i++){const a=U.Z._createTexture({texture:t[i]},e);n[i]=a}const i=new te.Z;i.generate1x1TextureFrom(),n.push(i);const a=new te.Z;return a.generate1x1TextureFrom("rgba(0, 0, 0, 1)"),n.push(a),n}_existOutlineMaterial(e){const t=e.materialProperties;if(null!=t)for(const e of t)if(0!==e.floatProperties._OutlineWidthMode)return!0;return!1}_initializeMaterialProperties(e,t){const n=e.extensions.VRM.materialProperties;for(const i of n)if("VRM/MToon"===i.shader){this.__initializeMToonMaterialProperties(e,t);break}}__initializeMToonMaterialProperties(e,t){const n=e.extensions.VRM.materialProperties,i=t-2,a=t-1;for(let e=0;e<n.length;e++){const t=n[e].floatProperties;this.__initializeForUndefinedProperty(t,"_BlendMode",0),this.__initializeForUndefinedProperty(t,"_BumpScale",1),this.__initializeForUndefinedProperty(t,"_CullMode",2),this.__initializeForUndefinedProperty(t,"_Cutoff",.5),this.__initializeForUndefinedProperty(t,"_DebugMode",0),this.__initializeForUndefinedProperty(t,"_DstBlend",0),this.__initializeForUndefinedProperty(t,"_IndirectLightIntensity",.1),this.__initializeForUndefinedProperty(t,"_LightColorAttenuation",0),this.__initializeForUndefinedProperty(t,"_OutlineColorMode",0),this.__initializeForUndefinedProperty(t,"_OutlineCullMode",1),this.__initializeForUndefinedProperty(t,"_OutlineLightingMix",1),this.__initializeForUndefinedProperty(t,"_OutlineScaledMaxDistance",1),this.__initializeForUndefinedProperty(t,"_OutlineWidth",.5),this.__initializeForUndefinedProperty(t,"_OutlineWidthMode",0),this.__initializeForUndefinedProperty(t,"_ReceiveShadowRate",1),this.__initializeForUndefinedProperty(t,"_RimFresnelPower",1),this.__initializeForUndefinedProperty(t,"_RimLift",0),this.__initializeForUndefinedProperty(t,"_RimLightingMix",0),this.__initializeForUndefinedProperty(t,"_ShadeShift",0),this.__initializeForUndefinedProperty(t,"_ShadeToony",.9),this.__initializeForUndefinedProperty(t,"_ShadingGradeRate",1),this.__initializeForUndefinedProperty(t,"_SrcBlend",1),this.__initializeForUndefinedProperty(t,"_ZWrite",1);const r=n[e].vectorProperties;this.__initializeForUndefinedProperty(r,"_Color",[1,1,1,1]),this.__initializeForUndefinedProperty(r,"_EmissionColor",[0,0,0]),this.__initializeForUndefinedProperty(r,"_OutlineColor",[0,0,0,1]),this.__initializeForUndefinedProperty(r,"_ShadeColor",[.97,.81,.86,1]),this.__initializeForUndefinedProperty(r,"_RimColor",[0,0,0]);const o=n[e].textureProperties;this.__initializeForUndefinedProperty(o,"_BumpMap",i),this.__initializeForUndefinedProperty(o,"_EmissionMap",a),this.__initializeForUndefinedProperty(o,"_MainTex",i),this.__initializeForUndefinedProperty(o,"_OutlineWidthTexture",i),this.__initializeForUndefinedProperty(o,"_ReceiveShadowTexture",i),this.__initializeForUndefinedProperty(o,"_RimTexture",a),this.__initializeForUndefinedProperty(o,"_ShadeTexture",i),this.__initializeForUndefinedProperty(o,"_ShadingGradeTexture",i),this.__initializeForUndefinedProperty(o,"_SphereAdd",a)}}__initializeForUndefinedProperty(e,t,n){null==e[t]&&(e[t]=n)}}var he=n(4587);const de=n(5337).Z;class ue{constructor(){}static getInstance(){return this.__instance||(this.__instance=new ue),this.__instance}export(e,t){let n=ue.__entityRepository._getEntities();if(ce.Is.exist(t)&&t.entities.length>0){const e=t=>{const n=t.getSceneGraph();let i=[t];for(let t=0;t<n.children.length;t++){const a=n.children[t];i=i.concat(e(a.entity))}return i};n=t.entities.flatMap((t=>e(t)))}const i={asset:{version:"2.0",generator:`Rhodonite (${de.version})`}},a=e||"Rhodonite_"+(new Date).getTime();i.buffers=[{uri:a+".bin"}],i.bufferViews=[],i.accessors=[],i.materials=[{pbrMetallicRoughness:{baseColorFactor:[1,1,1,1]}}],this.countMeshes(i,n),this.createNodes(i,n),this.createMeshBinaryMetaData(i,n),this.createMeshes(i,n),this.createMaterials(i,n);const r=this.__createWriteBinary(i);this.download(i,a,r)}__createWriteBinary(e){const t=new ArrayBuffer(e.buffers[0].byteLength),n=new DataView(t);for(let t=0;t<e.accessors.length;t++){const i=e.accessors[t],a=i.accessor,r=a.compositionType,o=a.componentType,s=a.getDataViewSetter(o),l=i.count,c=e.bufferViews[i.bufferView].byteOffset;for(let e=0;e<l;e++)if(1===r.getNumberOfComponents()){const t=o.getSizeInBytes()*e,i=a.getScalar(e,{});n[s](c+t,i,!0)}else if(2===r.getNumberOfComponents()){const t=a.getVec2AsArray(e,{});for(let i=0;i<2;i++)n[s](c+o.getSizeInBytes()*(2*e+i),t[i],!0)}else if(3===r.getNumberOfComponents()){const t=a.getVec3AsArray(e,{});for(let i=0;i<3;i++)n[s](c+o.getSizeInBytes()*(3*e+i),t[i],!0)}else if(4===r.getNumberOfComponents()){const t=a.getVec4AsArray(e,{});for(let i=0;i<4;i++)n[s](c+o.getSizeInBytes()*(4*e+i),t[i],!0)}i.accessor=void 0}return t}countMeshes(e,t){let n=0;e.meshes=[];for(let e=0;e<t.length;e++){const i=t[e];i.getMesh()&&(i.gltfMeshIndex=n++)}}createMeshes(e,t){let n=0;e.meshes=[];for(let i=0;i<t.length;i++){const a=t[i],r=a.getMesh();if(r&&r.mesh){e.meshes[n]={};const t=e.meshes[n];t.primitives=[];const i=r.mesh.getPrimitiveNumber();for(let e=0;e<i;e++){t.primitives[e]={};const n=t.primitives[e],i=r.mesh.getPrimitiveAt(e),a=i.indicesAccessor;a&&(n.indices=a.gltfAccessorIndex,n.mode=i.primitiveMode.index);const o=i.attributeAccessors;n.attributes={};const s=n.attributes;for(let e=0;e<o.length;e++){const t=o[e];s[i.attributeSemantics[e].str]=t.gltfAccessorIndex}n.material=0}a.gltfMeshIndex=n++}}}createMaterials(e,t){let n=0,i=0,a=0,r=0;e.materials=[],e.textures=[],e.samplers=[],e.images=[],e.samplers[0]={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};for(let o=0;o<t.length;o++){const s=t[o].getMesh();if(s&&s.mesh){const t=e.meshes[n++],o=s.mesh.getPrimitiveNumber();for(let n=0;n<o;n++){const o=s.mesh.getPrimitiveAt(n),l=t.primitives[n],c=o.material,_={pbrMetallicRoughness:{}};let h,d=1,u=1;if(null!=c&&(h=c.getParameter(he.f.BaseColorFactor),null==h?h=c.getParameter(he.f.DiffuseColorFactor):(d=c.getParameter(he.f.MetallicRoughnessFactor).x,u=c.getParameter(he.f.MetallicRoughnessFactor).y)),h&&(_.pbrMetallicRoughness.baseColorFactor=Array.prototype.slice.call(h._v)),_.pbrMetallicRoughness.metallicFactor=d,_.pbrMetallicRoughness.roughnessFactor=u,c){_.alphaMode=c.alphaMode.str;const t=[],n=n=>{if(n&&n.width>1&&n.height>1){let i=r,o=!1;for(let t=0;t<e.images.length;t++)e.images[t].uri===n.name&&(i=t,o=!0);if(!o){const i={uri:n.name};-1!==t.indexOf(n.name)&&(i.uri+="_"+n.textureUID),t.push(i.uri),ce.Is.not.exist(i.uri.match(/\.(png|jpg|jpeg)/))&&(i.uri+=".png");const a=n.htmlCanvasElement;a&&a.toBlob((e=>{setTimeout((()=>{const t=document.createElement("a"),n=document.createEvent("MouseEvent");n.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),t.href=URL.createObjectURL(e),t.download=i.uri,t.dispatchEvent(n)}),1e4*Math.random())})),e.images[r++]=i}return e.textures[a]={sampler:0,source:i},a++}};let i,o,s=c.getParameter(he.f.BaseColorTexture);if(null!=s)i=s[1],o=n(i),null!=o&&(_.pbrMetallicRoughness.baseColorTexture={index:o});else if(s=c.getParameter(he.f.DiffuseColorTexture),null!=s){const e=n(s[1]);null!=e&&(_.pbrMetallicRoughness.diffuseColorTexture={index:e})}s=c.getParameter(he.f.MetallicRoughnessTexture),s&&(i=s[1],o=n(i),null!=o&&(_.pbrMetallicRoughness.metallicRoughnessTexture={index:o})),s=c.getParameter(he.f.NormalTexture),s&&(i=s[1],o=n(i),null!=o&&(_.normalTexture={index:o})),s=c.getParameter(he.f.OcclusionTexture),s&&(i=s[1],o=n(i),null!=o&&(_.occlusionTexture={index:o})),s=c.getParameter(he.f.EmissiveTexture),s&&(i=s[1],o=n(i),null!=o&&(_.emissiveTexture={index:o}))}e.materials.push(_),l.material=i++}}}}createNodes(e,t){e.nodes=[],e.scenes=[{nodes:[]}];const n=e.scenes[0],i=e.nodes;for(let e=0;e<t.length;e++)t[e].gltfNodeIndex=e;for(let e=0;e<t.length;e++){const a=t[e];i[e]={};const r=i[e];r.name=a.uniqueName,r.children=[];const o=a.getSceneGraph(),s=o.children;for(let e=0;e<s.length;e++){const t=s[e];r.children.push(t.entity.gltfNodeIndex)}r.matrix=Array.prototype.slice.call(a.getTransform().matrix._v),r.mesh=a.gltfMeshIndex,null==o.parent&&n.nodes.push(e)}}createMeshBinaryMetaData(e,t){let n=0,i=0;for(let a=0;a<t.length;a++){const r=t[a].getMesh();if(r&&r.mesh){const t=r.mesh.getPrimitiveNumber();for(let a=0;a<t;a++){const t=r.mesh.getPrimitiveAt(a),o=t.indicesAccessor;if(o){let t=!1;for(let n=0;n<e.bufferViews.length;n++)e.bufferViews[n].rnAccessor===o&&(t=!0,o.gltfAccessorIndex=n);if(!t){e.bufferViews[n]={};const t=e.bufferViews[n];t.rnAccessor=o,t.buffer=0,t.byteLength=o.byteLength,t.byteOffset=i,t.target=34963,e.accessors[n]={};const a=e.accessors[n];a.bufferView=n,a.byteOffset=0,a.componentType=5123,a.count=o.elementCount,o.calcMinMax(),a.max=[o.max],a.min=[o.min],a.type="SCALAR",i+=o.byteLength,o.gltfAccessorIndex=n,n++,a.accessor=o}}const s=t.attributeAccessors;for(let t=0;t<s.length;t++){const a=s[t];let r=!1;for(let t=0;t<e.bufferViews.length;t++)e.bufferViews[t].rnAccessor===a&&(r=!0,a.gltfAccessorIndex=t);if(!r){e.bufferViews[n]={};const r=e.bufferViews[n];r.rnAccessor=a,r.buffer=0,r.byteLength=s[t].byteLength,r.byteOffset=i,r.target=34962,e.accessors[n]={};const o=e.accessors[n];o.bufferView=n,o.byteOffset=0,o.componentType=5126,o.count=a.elementCount,a.calcMinMax(),o.max=Array.prototype.slice.call(a.max),o.min=Array.prototype.slice.call(a.min),o.type="VEC"+o.max.length,i+=a.byteLength,a.gltfAccessorIndex=n,n++,o.accessor=a}}}}}e.bufferViews.forEach((e=>{e.rnAccessor=void 0})),e.buffers[0].byteLength=i}download(e,t,n){let i=document.createElement("a"),a=document.createEvent("MouseEvent");i.download=t+".gltf",i.href="data:application/octet-stream,"+encodeURIComponent(JSON.stringify(e,null,2)),a.initEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(a),i=document.createElement("a"),a=document.createEvent("MouseEvent"),a.initEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null);const r=new Blob([n],{type:"octet/stream"}),o=window.URL.createObjectURL(r);i.download=t+".bin",i.href=o,i.dispatchEvent(a)}}ue.__entityRepository=e.Z.getInstance();var me=n(9286),xe=n(1784),fe=n(7861),Ae=n(4322),pe=n(2858),ge=n(4529),ve=n(346),ye=n(3999);class Ie extends c.Z{constructor(){super()}generate(e){const t=[];for(let n=0;n<=e.vSpan;n++)for(let i=0;i<=e.uSpan;i++)t.push((i/e.uSpan-.5)*e.width),t.push(0),t.push((n/e.vSpan-.5)*e.height);const n=[];for(let t=0;t<e.vSpan;t++){let i=0,a=0;for(let r=0;r<=e.uSpan;r++)n.push(t*(e.uSpan+1)+r),n.push((t+1)*(e.uSpan+1)+r),0===r?i=(t+1)*(e.uSpan+1)+r:r===e.uSpan&&(a=(t+1)*(e.uSpan+1)+r);n.push(a),n.push(i)}const i=[];for(let t=0;t<=e.vSpan;t++)for(let t=0;t<=e.uSpan;t++)i.push(0),i.push(1),i.push(0);const a=[];for(let t=0;t<=e.vSpan;t++){const n=e.flipTextureCoordinateY?t:e.vSpan-t;for(let t=0;t<=e.uSpan;t++)e.isUVRepeat?(a.push(t),a.push(n)):(a.push(t/e.uSpan),a.push(n/e.vSpan))}const r=[D.d.Vec3,D.d.Vec3,D.d.Vec2],o=[B.T.Position,B.T.Normal,B.T.Texcoord0],s=N.T.TriangleStrip,l=[new Float32Array(t),new Float32Array(i),new Float32Array(a)];let c=0;l.forEach((e=>{c+=e.byteLength}));const _=2*n.length,h=me.Z.getInstance().createBufferOnDemand(_+c,this,4),d=h.takeBufferView({byteLengthToNeed:_,byteStride:0}).takeAccessor({compositionType:D.d.Scalar,componentType:ye.r.UnsignedShort,count:n.length});for(let e=0;e<n.length;e++)d.setScalar(e,n[e],{});const u=h.takeBufferView({byteLengthToNeed:c,byteStride:0}),m=[],x=[];l.forEach(((e,t)=>{x[t]=ye.r.fromTypedArray(l[t]);const n=u.takeAccessor({compositionType:r[t],componentType:ye.r.fromTypedArray(l[t]),count:e.byteLength/r[t].getNumberOfComponents()/x[t].getSizeInBytes()});n.copyFromTypedArray(e),m.push(n)}));const f=new Map;for(let e=0;e<o.length;e++)f.set(o[e],m[e]);this.setData(f,s,e.material,d)}}class be extends c.Z{constructor(){super()}generate({radius:e,widthSegments:t,heightSegments:n,material:i}){const a=[],r=[],o=[];Math.abs(e)<Number.EPSILON&&(console.warn("The argument radius is zero / nearly zero. Rn will take the radius as 0.001 for safety. Check your code."),e=.001);for(let i=0;i<=n;i++){const s=i*Math.PI/n+1e-5,l=Math.sin(s),c=Math.cos(s);for(let s=0;s<=t;s++){const _=2*s*Math.PI/t,h=Math.sin(_),d=e*Math.cos(_)*l,m=e*c,x=e*h*l,f=u.ZP.fromCopyArray([d,m,x]);a.push(d),a.push(m),a.push(x);const A=1-s/t,p=i/n;r.push(A),r.push(p);const g=u.ZP.normalize(f);o.push(g.x),o.push(g.y),o.push(g.z)}}const s=[];for(let e=0;e<n;e++)for(let n=0;n<t;n++){const i=e*(t+1)+n,a=i+t+1;s.push(i+1),s.push(a),s.push(i),s.push(i+1),s.push(a+1),s.push(a)}const l=[D.d.Vec3,D.d.Vec3,D.d.Vec2],c=[B.T.Position,B.T.Normal,B.T.Texcoord0],_=N.T.Triangles,h=[new Float32Array(a),new Float32Array(o),new Float32Array(r)];let d=0;h.forEach((e=>{d+=e.byteLength}));const m=2*s.length,x=me.Z.getInstance().createBufferOnDemand(m+d,this,4),f=x.takeBufferView({byteLengthToNeed:m,byteStride:0}).takeAccessor({compositionType:D.d.Scalar,componentType:ye.r.UnsignedShort,count:s.length});for(let e=0;e<s.length;e++)f.setScalar(e,s[e],{});const A=x.takeBufferView({byteLengthToNeed:d,byteStride:0}),p=[],g=[];h.forEach(((e,t)=>{g[t]=ye.r.fromTypedArray(h[t]);const n=A.takeAccessor({compositionType:l[t],componentType:ye.r.fromTypedArray(h[t]),count:e.byteLength/l[t].getNumberOfComponents()/g[t].getSizeInBytes()});n.copyFromTypedArray(e),p.push(n)}));const v=new Map;for(let e=0;e<c.length;e++)v.set(c[e],p[e]);this.setData(v,_,i,f)}}var Te=n(7571),Se=n(7987),Ee=n(8422),Ce=n(4392);class we extends ie.Z{constructor(){super(),this.__colorAttachments=[],this.cgApiResourceUid=Se.Z.InvalidCGAPIResourceUid,this.width=0,this.height=0,this.__colorAttachmentMap=new Map}get colorAttachmentsRenderBufferTargets(){return Array.from(this.__colorAttachmentMap.keys())}get colorAttachments(){return this.__colorAttachments}get depthAttachment(){return this.__depthAttachment}get stencilAttachment(){return this.__stencilAttachment}get depthStencilAttachment(){return this.__depthStencilAttachment}getColorAttachedRenderTargetTexture(e){return null!=this.__colorAttachments[e]&&this.__colorAttachments[e]instanceof Ce.Z?this.__colorAttachments[e]:void 0}getDepthAttachedRenderTargetTexture(){return this.__depthAttachment instanceof Ce.Z?this.__depthAttachment:void 0}create(e,t){this.width=e,this.height=t;const n=Se.Z.getWebGLResourceRepository();return this.cgApiResourceUid=n.createFrameBufferObject(),this.cgApiResourceUid}get framebufferUID(){return this.cgApiResourceUid}setColorAttachmentAt(e,t){return t.width===this.width&&t.height===this.height&&(this.__colorAttachments[e]=t,Se.Z.getWebGLResourceRepository().attachColorBufferToFrameBufferObject(this,e,t),this.__colorAttachmentMap.set(Ee.G.from(e),t),!0)}setDepthAttachment(e){return e.width===this.width&&e.height===this.height&&(this.__depthAttachment=e,Se.Z.getWebGLResourceRepository().attachDepthBufferToFrameBufferObject(this,e),!0)}setStencilAttachment(e){return e.width===this.width&&e.height===this.height&&(this.__stencilAttachment=e,Se.Z.getWebGLResourceRepository().attachStencilBufferToFrameBufferObject(this,e),!0)}setDepthStencilAttachment(e){return e.width===this.width&&e.height===this.height&&(this.__depthStencilAttachment=e,Se.Z.getWebGLResourceRepository().attachDepthStencilBufferToFrameBufferObject(this,e),!0)}resize(e,t){Se.Z.getWebGLResourceRepository().deleteFrameBufferObject(this.cgApiResourceUid),this.cgApiResourceUid=Se.Z.InvalidCGAPIResourceUid,this.width=0,this.height=0,this.create(e,t),this.depthAttachment&&(this.depthAttachment.resize(e,t),this.setDepthAttachment(this.depthAttachment)),this.depthStencilAttachment&&(this.depthStencilAttachment.resize(e,t),this.setDepthStencilAttachment(this.depthStencilAttachment)),this.stencilAttachment&&(this.stencilAttachment.resize(e,t),this.setStencilAttachment(this.stencilAttachment));for(let n=0;n<this.colorAttachments.length;n++)this.colorAttachments[n].resize(e,t),this.setColorAttachmentAt(n,this.colorAttachments[n])}destroy3DAPIResources(){Se.Z.getWebGLResourceRepository().deleteFrameBufferObject(this.cgApiResourceUid),this.cgApiResourceUid=Se.Z.InvalidCGAPIResourceUid,this.width=0,this.height=0,this.depthAttachment&&(this.depthAttachment.destroy3DAPIResources(),this.__depthAttachment=void 0),this.depthStencilAttachment&&(this.depthStencilAttachment.destroy3DAPIResources(),this.__depthStencilAttachment=void 0),this.stencilAttachment&&(this.stencilAttachment.destroy3DAPIResources(),this.__stencilAttachment=void 0);for(const e of this.colorAttachments)e.destroy3DAPIResources();this.__colorAttachmentMap=new Map}whichColorAttachment(e){return this.__colorAttachments.indexOf(e)}}var De=n(5981);class Ne extends ie.Z{constructor(){super(),this.width=0,this.height=0,this.__internalFormat=De.d.Depth24,this.cgApiResourceUid=-1,this.__isMSAA=!1,this.__sampleCountMSAA=4}set _fbo(e){this.__fbo=e}get fbo(){return this.__fbo}create(e,t,n,{isMSAA:i=!1,sampleCountMSAA:a=this.__sampleCountMSAA}={}){this.width=e,this.height=t,this.__isMSAA=i,this.__sampleCountMSAA=a,this.__internalFormat=n;const r=Se.Z.getWebGLResourceRepository();this.cgApiResourceUid=r.createRenderBuffer(e,t,n,i,a)}resize(e,t){this.destroy3DAPIResources(),this.create(e,t,this.__internalFormat,{isMSAA:this.__isMSAA})}destroy3DAPIResources(){return this.width=0,this.height=0,Se.Z.getWebGLResourceRepository().deleteRenderBuffer(this.cgApiResourceUid),this.cgApiResourceUid=Se.Z.InvalidCGAPIResourceUid,!0}}var Be=n(9216);const Pe=Object.freeze({createTexturesForRenderTarget:function(e,t,n,{level:i=0,internalFormat:a=Be.V.RGBA,format:r=Be.V.RGBA,type:o=ye.r.UnsignedByte,magFilter:s=De.d.Linear,minFilter:l=De.d.Linear,wrapS:c=De.d.ClampToEdge,wrapT:_=De.d.ClampToEdge,createDepthBuffer:h=!0,isMSAA:d=!1,sampleCountMSAA:u=4}){const m=new we;m.create(e,t);for(let h=0;h<n;h++){const n=new Ce.Z;n.create({width:e,height:t,level:i,internalFormat:a,format:r,type:o,magFilter:s,minFilter:l,wrapS:c,wrapT:_}),m.setColorAttachmentAt(h,n)}if(h){const n=new Ne;n.create(e,t,De.d.Depth16,{isMSAA:d,sampleCountMSAA:u}),m.setDepthAttachment(n)}if(d){const i=new Ne;i.create(e,t,De.d.RGBA8,{isMSAA:d,sampleCountMSAA:u}),m.setColorAttachmentAt(n,i)}return m}});var Me,Fe=n(7290),Re=function(e,t,n,i,a){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,n):a?a.value=n:t.set(e,n),n},Le=function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)};class Ve extends Fe.Z{constructor(){super(),this.autoResize=!0,this.autoDetectTransparency=!1,Me.set(this,void 0)}__getResizedCanvas(e,t){const n=document.createElement("canvas"),i=S.Z.getNearestPowerOfTwo(e.width),a=S.Z.getNearestPowerOfTwo(e.height),r=a/i;let o=0,s=0;i>a?(o=Math.min(i,t),s=o*r):(s=Math.min(a,t),o=s/r),n.width=o,n.height=s;const l=n.getContext("2d");if(l.drawImage(e,0,0,e.width,e.height,0,0,o,s),this.autoDetectTransparency){this.__imageData=l.getImageData(0,0,o,s);for(let e=0;e<s;e++)for(let t=0;t<o;t++)if(this.__imageData.data[4*(t+e*o)+3]<1)return this.__hasTransparentPixels=!0,n;this.__hasTransparentPixels=!1}return n}generateTextureFromVideo(e,{level:t=0,internalFormat:n=Be.V.RGBA,format:i=Be.V.RGBA,type:a=ye.r.UnsignedByte,magFilter:r=De.d.Linear,minFilter:o=De.d.Linear,wrapS:s=De.d.ClampToEdge,wrapT:l=De.d.ClampToEdge,generateMipmap:c=!1,anisotropy:_=!1,isPremultipliedAlpha:h=!1,mutedAutoPlay:d=!0}={}){this.__startedToLoad=!0,Re(this,Me,e,"f"),d&&(e.autoplay=!0,e.muted=!0);const u=e;this.__width=u.width,this.__height=u.height;const m=Se.Z.getWebGLResourceRepository().createTexture(u,{level:t,internalFormat:n,width:this.__width,height:this.__height,border:0,format:i,type:a,magFilter:r,minFilter:o,wrapS:s,wrapT:l,generateMipmap:c,anisotropy:_,isPremultipliedAlpha:h});this.cgApiResourceUid=m,this.__isTextureReady=!0,this.__uri=e.src,Fe.Z.__textureMap.set(m,this)}generateTextureFromUri(e,{level:t=0,internalFormat:n=Be.V.RGBA,format:i=Be.V.RGBA,type:a=ye.r.UnsignedByte,magFilter:r=De.d.Linear,minFilter:o=De.d.Linear,wrapS:s=De.d.ClampToEdge,wrapT:l=De.d.ClampToEdge,generateMipmap:c=!1,anisotropy:_=!1,isPremultipliedAlpha:h=!1,mutedAutoPlay:d=!0,playButtonDomElement:u}={}){return this.__uri=e,this.__startedToLoad=!0,new Promise(((m,x)=>{const f=()=>{this.__width=A.width,this.__height=A.height;const e=Se.Z.getWebGLResourceRepository().createTexture(A,{level:t,internalFormat:n,width:this.__width,height:this.__height,border:0,format:i,type:a,magFilter:r,minFilter:o,wrapS:s,wrapT:l,generateMipmap:c,anisotropy:_,isPremultipliedAlpha:h});this.cgApiResourceUid=e,this.__isTextureReady=!0,m()};null==u||u.addEventListener("click",(()=>{f(),A.play()}),!0);const A=document.createElement("video");A.crossOrigin="anonymous",A.setAttribute("playsinline","playsinline"),d&&(A.autoplay=!0,A.muted=!0),A.preload="auto",Re(this,Me,A,"f"),A.addEventListener("canplaythrough",(()=>{f(),A.play()}),!0),A.addEventListener("ended",(()=>{A.play()}),!0),A.src=e}))}updateTexture(){const e=Se.Z.getWebGLResourceRepository();this.__isTextureReady&&Le(this,Me,"f")&&e.updateTexture(this.cgApiResourceUid,Le(this,Me,"f"),{level:0,xoffset:0,yoffset:0,width:this.__width,height:this.__height,format:Be.V.RGBA,type:ye.r.UnsignedByte})}set playbackRate(e){Le(this,Me,"f")&&(Le(this,Me,"f").playbackRate=e)}get playbackRate(){var e;const t=null===(e=Le(this,Me,"f"))||void 0===e?void 0:e.playbackRate;return null!=t?t:1}play(){var e;null===(e=Le(this,Me,"f"))||void 0===e||e.play()}pause(){Le(this,Me,"f").pause()}}Me=new WeakMap,Ve.__loadedBasisFunc=!1;const We=Object.freeze({createGroupEntity:function(){return e.Z.getInstance().createEntity([r.Z,o.Z])},createMeshEntity:function(){return e.Z.getInstance().createEntity([r.Z,o.Z,s.Z,l.Z])},createCameraEntity:function(){return e.Z.getInstance().createEntity([r.Z,o.Z,xe.Z])},createCameraWithControllerEntity:function(){return e.Z.getInstance().createEntity([r.Z,o.Z,xe.Z,ge.Z])}});var ze=n(8547),He=n(6214),Oe=n(6529),Ge=n(8346);class Qe{constructor(){}static getInstance(){return this.__instance||(this.__instance=new Qe),this.__instance}async import(e,t){var n,i;const a=_e.getInstance();t=a._getOptions(t);const r=C.Z.getInstance(),o=await r.import(e,t);if(ce.Is.not.exist(o))return[];const s=a._createTextures(o),l=null===(i=null===(n=o.asset.extras)||void 0===n?void 0:n.rnLoaderOptions)||void 0===i?void 0:i.defaultMaterialHelperArgumentArray;let c;ce.Is.exist(l)&&(l[0].textures=s),a._initializeMaterialProperties(o,s.length);const _=U.Z.getInstance(),h=_.convertToRhodoniteObject(o);return a._existOutlineMaterial(o.extensions.VRM)?(ce.Is.exist(l)&&(l[0].isOutline=!0),c=[h,_.convertToRhodoniteObject(o)]):c=[h],a._readSpringBone(h,o),a._readVRMHumanoidInfo(o,h),c}}var ke=n(85),Ue=n(7305);class Ze{constructor(){}assignAnimation(e,t,n,i=!1){return this.__setupAnimationForSameSkeleton(e,t,n,i),e}static getInstance(){return this.__instance||(this.__instance=new Ze),this.__instance}__getCorrespondingEntity(e,t,n,i,a,r){if(r){const n=e.getTagValue("rnEntitiesByNames"),a=t.nodes[i];return n.get(a.name)}{const t=n.extensions.VRM.humanoid.humanBones;let r;const o=new Map,s=new Map;for(const e of t)o.set(e.node,e.bone),s.set(e.name,e.bone);null!=a&&(r=s.get(a),null==r&&(r=o.get(i)));const l=e.getTagValue("humanoid_map_name_nodeId").get(r);return null!=l?e.getTagValue("rnEntities")[l]:void 0}}__isHips(e,t,n){const i=t.extensions.VRM.humanoid.humanBones,a=new Map;for(const e of i)a.set(e.node,e.bone);return e.getTagValue("humanoid_map_name_nodeId"),"hips"===a.get(n)}__setupAnimationForSameSkeleton(t,n,i,a){if(n.animations){const e=U.Z.getInstance();for(const t of n.animations)for(const n of t.samplers)e._accessBinaryWithAccessor(n.input),e._accessBinaryWithAccessor(n.output)}const r=e.Z.getInstance();if(n.animations&&n.animations.length>0)for(const e of n.animations)for(const o of e.channels){const s=o.sampler.input.extras.typedDataArray,l=o.sampler.output.extras.typedDataArray,c=null!=o.sampler.interpolation?o.sampler.interpolation:"LINEAR";let _="";_="translation"===o.target.path?"translate":"rotation"===o.target.path?"quaternion":o.target.path;const h=n.nodes[o.target.nodeIndex],d=this.__getCorrespondingEntity(t,n,i,o.target.nodeIndex,h.name,a);if(d){r.addComponentsToEntity([fe.Z],d.entityUID);const n=d.getComponent(fe.Z);n&&("quaternion"===_?n.setAnimation(ce.Is.exist(e.name)?e.name:"Untitled",_,s,l,4,Ue.k.fromString(c)):"translate"===_&&this.__isHips(t,i,o.target.nodeIndex)&&n.setAnimation(ce.Is.exist(e.name)?e.name:"Untitled",_,s,l,3,Ue.k.fromString(c)))}}}}var Xe=n(6098),qe=n(3032);const Ye=Object.freeze({createPlane:(t={width:1,height:1,uSpan:1,vSpan:1,isUVRepeat:!1})=>{const n=e.Z.getInstance().createEntity([r.Z,o.Z,s.Z,l.Z]),i=new Ie;i.generate(t);const a=n.getMesh(),c=new He.Z;return c.addPrimitive(i),a.setMesh(c),n}});var je=n(6547),Ke=n(4478),Je=n(6773),$e=n(4141),et=n(836);class tt extends et.Z{constructor(e,t,n){super(),this.__functionName=e,this.__compositionType=t,this.__componentType=n,this.__constantValueStr=""}setConstantValue(e){let t="";this.__componentType.isFloatingPoint()?t=e.glslStrAsFloat:this.__componentType.isInteger()?t=e.glslStrAsInt:this.__componentType===ye.r.Bool&&(t=e.x?"true":"false"),this.__constantValueStr=t}get vertexShaderDefinitions(){return`\n    void ${this.__functionName}(\n      out ${this.__compositionType.getGlslStr(this.__componentType)} outValue) {\n      outValue = ${this.__constantValueStr};\n    }\n    `}get pixelShaderDefinitions(){return`\n    void ${this.__functionName}(\n      out ${this.__compositionType.getGlslStr(this.__componentType)} outValue) {\n      outValue = ${this.__constantValueStr};\n    }\n    `}get attributeNames(){return[]}get attributeSemantics(){return[]}get attributeCompositions(){return[]}}class nt extends ie.Z{constructor(e,t,n){super(),this.__inputs=[],this.__outputs=[],this.__inputConnections=[],this.__shaderFunctionName=e,this.__shaderCode=t,this.__shaderNodeUid=++nt.__invalidShaderNodeCount,nt.shaderNodes[nt.__invalidShaderNodeCount]=this,this.__shader=n}get shaderFunctionName(){return this.__shaderFunctionName}get shaderCode(){return this.__shaderCode}get shaderNodeUid(){return this.__shaderNodeUid}getInput(e){for(const t of this.__inputs)if(t.name===e)return t}getInputs(){return this.__inputs}getOutput(e){for(const t of this.__outputs)if(t.name===e)return t}getOutputs(){return this.__outputs}addInputConnection(e,t,n){this.__inputConnections.push({shaderNodeUid:e.shaderNodeUid,outputNameOfPrev:t,inputNameOfThis:n})}get inputConnections(){return this.__inputConnections}get shader(){return this.__shader}}nt.shaderNodes=[],nt.__invalidShaderNodeUid=-1,nt.__invalidShaderNodeCount=-1;class it extends F.Jx{constructor({index:e,str:t}){super({index:e,str:t})}}const at=new it({index:0,str:"ClassicShading"}),rt=new it({index:1,str:"PBRShading"}),ot=(new it({index:2,str:"Lerp"}),new it({index:3,str:"Add"}),[at,rt]),st=Object.freeze({ClassicShading:at,PBRShading:rt,from:function(e){return(0,F.li)({typeList:ot,index:e})},fromString:function(e){return(0,F.cu)({typeList:ot,str:e})}});class lt extends et.Z{constructor(){super()}static getInstance(){return this.__instance||(this.__instance=new lt),this.__instance}get vertexShaderDefinitions(){return"\n    void outPosition(in vec4 inPosition) {\n      gl_Position = inPosition;\n    }\n    "}get vertexShaderBody(){return"\n\n    "}get pixelShaderDefinitions(){const e=this.glsl_fragColor;let t="";return""!==e&&(t="vec4"),`\n    void outColor(in vec4 inColor) {\n      ${t} rt0 = inColor;\n      ${e}\n    }\n    `}getPixelShaderBody(){return""}get attributeNames(){return[]}get attributeSemantics(){return[]}get attributeCompositions(){return[]}}lt.materialElement=st.PBRShading;var ct=n(2477);class _t extends et.Z{constructor(e,t,n){super(),this.__functionName=e,this.__compositionType=t,this.__componentType=n,this.__variableName=""}setVariableName(e){this.__variableName=e}get vertexShaderDefinitions(){return`\n    out ${this.__compositionType.getGlslStr(this.__componentType)} ${this.__variableName};\n    void ${this.__functionName}(\n      in ${this.__compositionType.getGlslStr(this.__componentType)} value) {\n      ${this.__variableName} = value;\n    }\n    `}get pixelShaderDefinitions(){return`\n    in ${this.__compositionType.getGlslStr(this.__componentType)} ${this.__variableName};\n    void ${this.__functionName}(\n      out ${this.__compositionType.getGlslStr(this.__componentType)} outValue) {\n      outValue = ${this.__variableName};\n    }\n    `}get attributeNames(){return[]}get attributeSemantics(){return[]}get attributeCompositions(){return[]}}class ht extends et.Z{constructor(e,t,n){super(),this.__functionName=e,this.__compositionType=t,this.__componentType=n,this.__variableName="",this.__valueStr=""}setVariableName(e){this.__variableName=e}setDefaultValue(e){this.__valueStr=e.toString()}get vertexShaderDefinitions(){return`\n    uniform ${this.__compositionType.getGlslStr(this.__componentType)} u_${this.__variableName}; // initialValue=${this.__valueStr}\n    void ${this.__functionName}(out ${this.__compositionType.getGlslStr(this.__componentType)} outValue) {\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n#else\n  float materialSID = u_materialSID;\n#endif\n\noutValue = get_${this.__variableName}(materialSID, 0);\n    }\n    `}get pixelShaderDefinitions(){return`\n    uniform ${this.__compositionType.getGlslStr(this.__componentType)} u_${this.__variableName}; // initialValue=${this.__valueStr}\n    void ${this.__functionName}(out ${this.__compositionType.getGlslStr(this.__componentType)} outValue) {\n#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n#else\n  float materialSID = u_materialSID;\n#endif\n\noutValue = get_${this.__variableName}(materialSID, 0);\n    }\n    `}get attributeNames(){return[]}get attributeSemantics(){return[]}get attributeCompositions(){return[]}}class dt extends et.Z{constructor(){super()}get vertexShaderDefinitions(){return"\n    "}get pixelShaderDefinitions(){return"\n    "}get attributeNames(){return[]}get attributeSemantics(){return[]}get attributeCompositions(){return[]}}class ut extends et.Z{constructor(e,t,n){super(),this.__functionName=e,this.__valueInputs=t,this.__valueOutputs=n}get vertexShaderDefinitions(){let e=`void ${this.__functionName}(\nin bool context,\n      `;for(let t=0;t<this.__valueInputs.length;t++){const n=this.__valueInputs[t];e+=`\n        in ${n.compositionType.getGlslStr(n.componentType)} value${t},`}for(let t=0;t<this.__valueOutputs.length;t++){const n=this.__valueOutputs[t];e+=`\n        out ${n.compositionType.getGlslStr(n.componentType)} outValue${t}`+(t===this.__valueOutputs.length-1?"":",")}e+=") {\n";for(let t=0;t<this.__valueOutputs.length;t++)e+=`\n      outValue${t} = value${t};\n`;return e+="}",e}get pixelShaderDefinitions(){return this.vertexShaderDefinitions}get attributeNames(){return[]}get attributeSemantics(){return[]}get attributeCompositions(){return[]}}class mt extends et.Z{constructor(e,t,n){super(),this.__functionName=e,this.__valueInputs=t,this.__valueOutputs=n}get vertexShaderDefinitions(){let e=`void ${this.__functionName}(`;for(let t=0;t<this.__valueInputs.length;t++){const n=this.__valueInputs[t];e+=`\n        in ${n.compositionType.getGlslStr(n.componentType)} value${t},`}for(let t=0;t<this.__valueOutputs.length;t++){const n=this.__valueOutputs[t];e+=`\n        out ${n.compositionType.getGlslStr(n.componentType)} outValue${t}`+(t===this.__valueOutputs.length-1?"":",")}e+=") {\n";for(let t=0;t<this.__valueOutputs.length;t++)e+=`\n      outValue${t} = value${t};\n`;return e+="}",e}get pixelShaderDefinitions(){return this.vertexShaderDefinitions}get attributeNames(){return[]}get attributeSemantics(){return[]}get attributeCompositions(){return[]}}var xt=n(5324);const ft="const float Epsilon = 0.0000001;\n#define saturateEpsilonToOne(x) clamp(x, Epsilon, 1.0)\n\nuniform float u_materialSID; // skipProcess=true\nuniform sampler2D u_dataTexture; // skipProcess=true\n/* shaderity: @{widthOfDataTexture} */\n/* shaderity: @{heightOfDataTexture} */\n\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n/* shaderity: @{dataUBOVec4Size} */\n/* shaderity: @{dataUBODefinition} */\n#endif\n\n\nhighp vec4 fetchElement(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n#if defined(GLSL_ES3) && defined(RN_IS_FASTEST_MODE) && defined(RN_IS_UBO_ENABLED)\n  if (vec4_idx < dataUBOVec4Size) {\n    return fetchVec4FromVec4Block(vec4_idx);\n  } else {\n    int idxOnDataTex = vec4_idx - dataUBOVec4Size;\n    highp ivec2 uv = ivec2(idxOnDataTex % texWidth, idxOnDataTex / texWidth);\n    return texelFetch( tex, uv, 0 );\n  }\n#elif defined(GLSL_ES3)\n  highp ivec2 uv = ivec2(vec4_idx % texWidth, vec4_idx / texWidth);\n  return texelFetch( tex, uv, 0 );\n#else\n  // This idea from https://qiita.com/YVT/items/c695ab4b3cf7faa93885\n  highp vec2 invSize = vec2(1.0/float(texWidth), 1.0/float(texHeight));\n  highp float t = (float(vec4_idx) + 0.5) * invSize.x;\n  highp float x = fract(t);\n  highp float y = (floor(t) + 0.5) * invSize.y;\n  #ifdef GLSL_ES3\n  return texture( tex, vec2(x, y));\n  #else\n  return texture2D( tex, vec2(x, y));\n  #endif\n#endif\n}\n\nvec2 fetchVec2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xy;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec2(val0.yz);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.zw);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec2(val0.w, val1.x);\n  }\n}\n\nvec3 fetchVec3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 val = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return val.xyz;\n  } else if (posIn4bytes == 1) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    return vec3(val0.yzw);\n  } else if (posIn4bytes == 2) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.zw, val1.x);\n  } else if (posIn4bytes == 3) {\n    vec4 val0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 val1 = fetchElement(u_dataTexture, basePosIn16bytes+1, texWidth, texHeight);\n    return vec3(val0.w, val1.xy);\n  }\n}\n\nvec4 fetchVec4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  return fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n}\n\nfloat fetchScalarNo16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  vec4 val = fetchElement(u_dataTexture, scalar_idx, texWidth, texHeight);\n  return val.x;\n}\n\nmat2 fetchMat2No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n  int vec4_idx = scalar_idx*4;\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat2 fetchMat2(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n\n  mat2 val = mat2(\n    col0.x, col0.y,\n    col0.z, col0.w\n    );\n\n  return val;\n}\n\nmat3 fetchMat3No16BytesAligned(highp sampler2D tex, int scalar_idx, int texWidth, int texHeight) {\n#ifdef GLSL_ES3\n  int posIn4bytes = scalar_idx % 4;\n#else\n  int posIn4bytes = int(mod(float(scalar_idx), 4.0));\n#endif\n\n  int basePosIn16bytes = scalar_idx*4 - posIn4bytes;\n  if (posIn4bytes == 0) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.x, col0.y, col0.z,\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x\n      );\n    return val;\n  } else if (posIn4bytes == 1) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.y, col0.z, col0.w,\n      col1.x, col1.y, col1.z,\n      col1.w, col2.x, col2.y\n      );\n    return val;\n  } else if (posIn4bytes == 2) {\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.z, col0.w, col1.x,\n      col1.y, col1.z, col1.w,\n      col2.x, col2.y, col2.z\n      );\n    return val;\n  } else { // posIn4bytes == 3\n    vec4 col0 = fetchElement(u_dataTexture, basePosIn16bytes, texWidth, texHeight);\n    vec4 col1 = fetchElement(u_dataTexture, basePosIn16bytes + 1, texWidth, texHeight);\n    vec4 col2 = fetchElement(u_dataTexture, basePosIn16bytes + 2, texWidth, texHeight);\n    mat3 val = mat3(\n      col0.w, col1.x, col1.y,\n      col1.z, col1.w, col2.x,\n      col2.y, col2.z, col2.w\n      );\n    return val;\n  }\n\n}\n\nmat3 fetchMat3(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n\n  mat3 val = mat3(\n    col0.x, col0.y, col0.z,\n    col0.w, col1.x, col1.y,\n    col1.z, col1.w, col2.x\n    );\n\n  return val;\n}\n\nmat4 fetchMat4(highp sampler2D tex, int vec4_idx, int texWidth, int texHeight) {\n  vec4 col0 = fetchElement(u_dataTexture, vec4_idx, texWidth, texHeight);\n  vec4 col1 = fetchElement(u_dataTexture, vec4_idx + 1, texWidth, texHeight);\n  vec4 col2 = fetchElement(u_dataTexture, vec4_idx + 2, texWidth, texHeight);\n  vec4 col3 = fetchElement(u_dataTexture, vec4_idx + 3, texWidth, texHeight);\n\n  mat4 val = mat4(\n    col0.x, col0.y, col0.z, col0.w,\n    col1.x, col1.y, col1.z, col1.w,\n    col2.x, col2.y, col2.z, col2.w,\n    col3.x, col3.y, col3.z, col3.w\n    );\n\n  return val;\n}\n\nfloat rand(const vec2 co){\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec3 descramble(vec3 v) {\n  float seed = 0.0;\n  v.x -= sin(fract(v.y*20.0));\n  v.z -= cos(fract(-v.y*10.0));\n  return v;\n}\n\n";class At{static createVertexShaderCode(e){var t;const n=e.concat(),i=this.__findBeginNode(n),a=this.__sortTopologically(i,n);let r="",o="attribute";(null===(t=Se.Z.getWebGLResourceRepository().currentWebGLContextWrapper)||void 0===t?void 0:t.isWebGL2)&&(o="in"),r+=`\n#version 300 es\nprecision highp float;\nprecision highp int;\n${ft}\n\n    ${o} float a_instanceID;\n`,r+=`\nuniform bool u_vertexAttributesExistenceArray[${B.T.AttributeTypeNumber}];\n`,r+="/* shaderity: @{matricesGetters} */",r+="/* shaderity: @{getters} */";let s="";return s+=At.getFunctionDefinition(a,xt.H.VertexShader),s+=At.__constructShaderWithNodes(a),{shader:r+s,shaderBody:s}}static createPixelShaderCode(e){const t=e.concat(),n=this.__findBeginNode(t),i=this.__sortTopologically(n,t);let a="";a+=`\n#version 300 es\nprecision highp float;\nprecision highp int;\n${ft}\n`,a+="/* shaderity: @{getters} */";let r="";return r+=At.getFunctionDefinition(i,xt.H.PixelShader),r+=At.__constructShaderWithNodes(i),{shader:a+r,shaderBody:r}}static __findBeginNode(e){let t;for(let n=0;n<e.length;n++){const i=e[n];0===i.inputConnections.length&&(t=i)}return t}static __sortTopologically(e,t){const n=[e.shaderNodeUid],i=[e];t.splice(t.indexOf(e),1);do{let e;t.forEach((t=>{let i=0;for(const e of t.inputConnections)-1===n.indexOf(e.shaderNodeUid)&&i++;0===i&&(e=t)})),i.push(e),n.push(e.shaderNodeUid),t.splice(t.indexOf(e),1)}while(0!==t.length);return i}static getFunctionDefinition(e,t){let n="";const i=[];for(let a=0;a<e.length;a++){const r=e[a];-1===i.indexOf(r.shaderFunctionName)&&(r.shaderCode?n+=r.shaderCode:t===xt.H.VertexShader?n+=r.shader.vertexShaderDefinitions:n+=r.shader.pixelShaderDefinitions,i.push(r.shaderFunctionName))}return n}static __constructShaderWithNodes(e){let t="";const n=function(e){return e.compositionType===D.d.Unknown||e.componentType===ye.r.Unknown};t+=et.Z.glslMainBegin,t+="#ifdef RN_IS_FASTEST_MODE\n  float materialSID = u_currentComponentSIDs[0]; // index 0 data is the materialSID\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = int(u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.LightComponentTID} */]);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.SkeletalComponentTID} */];\n  #endif\n\n#else\n\n  float materialSID = u_materialSID;\n\n  int lightNumber = 0;\n  #ifdef RN_IS_LIGHTING\n    lightNumber = get_lightNumber(0.0, 0);\n  #endif\n\n  float skeletalComponentSID = -1.0;\n  #ifdef RN_IS_SKINNING\n    skeletalComponentSID = float(get_skinningMode(0.0, 0));\n  #endif\n\n#endif\n";const i=[],a=[];{const r=[],o=[],s=new Map;for(let l=1;l<e.length;l++){const c=e[l];null==i[l]&&(i[l]=[]),l-1>=0&&null==a[l-1]&&(a[l-1]=[]);const _=c.inputConnections;for(let e=0;e<_.length;e++){const a=_[e],o=nt.shaderNodes[a.shaderNodeUid];if(n(c.getInputs()[e]))continue;const h=o.getOutput(a.outputNameOfPrev),d=c.getInput(a.inputNameOfThis),u=`${h.name}_${a.shaderNodeUid}_to_${c.shaderNodeUid}`;-1===r.indexOf(o.shaderNodeUid)&&(t+=`${d.compositionType.getGlslStr(d.componentType)} ${u} = ${d.compositionType.getGlslInitialValue(d.componentType)};\n`);const m=s.get(o.shaderNodeUid);i[l].push(m||u),r.push(a.shaderNodeUid)}for(let t=l;t<e.length;t++){const i=e[t],r=e[l-1],c=i.inputConnections;for(let e=0;e<c.length;e++){const t=c[e];if((null==r?void 0:r.shaderNodeUid)!==t.shaderNodeUid)continue;const _=nt.shaderNodes[t.shaderNodeUid];if(!n(i.getInputs()[e])){if(-1===o.indexOf(_.shaderNodeUid)){const e=`${_.getOutput(t.outputNameOfPrev).name}_${t.shaderNodeUid}_to_${i.shaderNodeUid}`;l-1>=0&&a[l-1].push(e),s.set(t.shaderNodeUid,e)}o.push(t.shaderNodeUid)}}}}}let r="";for(let n=0;n<e.length;n++){const o=e[n],s=o.shaderFunctionName;null==i[n]&&(i[n]=[]),null==a[n]&&(a[n]=[]);let l="";if("ifStatement"===s)r=i[n][0];else{if(s.match(/^blockBegin_/)&&(l+=`if (${r}) {\n`,r=""),o.getInputs().length!==i[n].length||o.getOutputs().length!==a[n].length)continue;const e=i[n].concat(a[n]);if(e.length>0){l+=`${s}(`;for(let t=0;t<e.length;t++)null!=e[t]&&(0!==t&&(l+=", "),l+=e[t]);l+=");\n"}s.match(/^blockEnd_/)&&(l+="}\n")}t+=l}return t+=et.Z.glslMainEnd,t}}var pt=n(1481),gt=n(3395),vt=n(8149),yt=n(792);const It=Symbol();class bt{constructor(e){this.__raw=e}}Object.defineProperty(bt.prototype,"getComponentFromEntities",{enumerable:!1,writable:!1,configurable:!0,value:function(e){const t=this.__raw,n=[];return t.forEach((t=>{const i=t.getComponentByComponentTID(e.componentTID);null!=i&&n.push(i)})),n}});var Tt=n(8985),St=n(9434),Et=n(4722),Ct=n(2939),wt=n(3474),Dt=n(5170),Nt=n(7860),Bt=n(4200);class Pt extends u.ZP{constructor(e){super(e)}get x(){return this._v[0]}get y(){return this._v[1]}get z(){return this._v[2]}get w(){return 1}get r(){return this._v[0]}get g(){return this._v[1]}get b(){return this._v[2]}get a(){return 1}static zero(){return super._zero(Float32Array)}static one(){return super._one(Float32Array)}static dummy(){return super._dummy(Float32Array)}static normalize(e){return super._normalize(e,Float32Array)}static add(e,t){return super._add(e,t,Float32Array)}static subtract(e,t){return super._subtract(e,t,Float32Array)}static multiply(e,t){return super._multiply(e,t,Float32Array)}static multiplyVector(e,t){return super._multiplyVector(e,t,Float32Array)}static divide(e,t){return super._divide(e,t,Float32Array)}static divideVector(e,t){return super._divideVector(e,t,Float32Array)}static cross(e,t){return super._cross(e,t,Float32Array)}clone(){return super.clone()}}var Mt=n(9849);function Ft(e,t,n){const i=1<<t;let a=0;for(let t=0;t<e.height;t+=i)for(let r=0;r<e.width;r+=i){let o=0,s=0;for(let a=0;a<i;a++)for(let l=0;l<i;l++){const i=e.getPixel(r+l,t+a,n);o+=i,s+=i*i}o/=i*i,s/=i*i,a+=Math.max(0,s-o*o)/(e.width*e.height/i/i)}return a}function Rt(e,t,n,i,a=128){const r=2*a;let o=0;for(let s=0;s<r;s++){const l=(s+.5)/r,c=qe.k.invGaussianCdf(l,t,n),_=Math.max(0,Math.min(a-1,Math.floor(c*a)));o+=e.getPixelAsArray(_,0)[i]}return o/=r,o}function Lt(e,t,n){for(let i=1;i<t.height;i++){const a=Ft(e,i,n),r=Math.sqrt(a);for(let e=0;e<t.width;e++){const a=Rt(t,(e+.5)/t.width,r,n);t.setPixelAtChannel(e,i,n,a)}}}function Vt(e,t,n,i=.5,a=.16666){const r=function(e){const t=[];for(let n=0;n<e;n++)t.push({});return t}(e.height*e.width);for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++)r[t*e.width+i].x=i,r[t*e.width+i].y=t,r[t*e.width+i].value=e.getPixel(i,t,n);r.sort(((e,t)=>e.value<t.value?-1:e.value>t.value?1:0));for(let e=0;e<r.length;e++){const o=r[e].x,s=r[e].y,l=(e+.5)/r.length,c=qe.k.invGaussianCdf(l,i,a);t.setPixelAtChannel(o,s,n,c)}}function Wt(e,t,n,i=.5,a=.16666){const r=[];for(let t=0;t<e.height;t++)for(let i=0;i<e.width;i++)r[t*e.width+i]=e.getPixel(i,t,n);r.sort(((e,t)=>e<t?-1:e>t?1:0));for(let e=0;e<t.width;e++){const o=(e+.5)/t.width,s=qe.k.gaussianCdf(o,i,a),l=r[Math.floor(s*r.length)];t.setPixelAtChannel(e,0,n,l)}}const zt=Object.freeze({precomputations:function(e,t=128){const n={};n.lutWidth=t,n.colorSpaceVector1=A.ZP.zero(),n.colorSpaceVector2=A.ZP.zero(),n.colorSpaceVector3=A.ZP.zero(),n.colorSpaceOrigin=A.ZP.zero();const i=new Mt.Z(e.width,e.height,3);!function(e,t,n,i,a,r){const o=[A.ZP.zero(),A.ZP.zero(),A.ZP.zero()];!function(e,t){let n=0,i=0,a=0,r=0,o=0,s=0,l=0,c=0,_=0;for(let t=0;t<e.height;t++)for(let h=0;h<e.width;h++){const d=e.getPixelAs(h,t,3,Pt);n+=d.x,i+=d.y,a+=d.z,r+=d.x*d.x,o+=d.y*d.y,s+=d.z*d.z,l+=d.x*d.y,c+=d.x*d.z,_+=d.y*d.z}const h=e.width*e.height;n/=h,i/=h,a/=h,r/=h,o/=h,s/=h,l/=h,c/=h,_/=h;const d=b.Z.zero();d.m00=r-n*n,d.m01=l-n*i,d.m02=c-n*a,d.m10=l-n*i,d.m11=o-i*i,d.m12=_-i*a,d.m20=c-n*a,d.m21=_-i*a,d.m22=s-a*a;const m=b.Z.zero(),x=A.ZP.zero();qe.k.computeEigenValuesAndVectors(d,m,x),t[0]=u.ZP.fromCopyArray([m.m00,m.m10,m.m20]),t[1]=u.ZP.fromCopyArray([m.m01,m.m11,m.m21]),t[2]=u.ZP.fromCopyArray([m.m02,m.m12,m.m22])}(e,o);for(let n=0;n<e.height;n++)for(let i=0;i<e.width;i++)for(let a=0;a<3;++a){const r=e.getPixelAs(i,n,3,Pt),s=u.ZP.dot(r,o[a]);t.setPixelAtChannel(i,n,a,s)}const s=[f.ZP.fromCopyArray2([Number.MAX_VALUE,-Number.MAX_VALUE]),f.ZP.fromCopyArray2([Number.MAX_VALUE,-Number.MAX_VALUE]),f.ZP.fromCopyArray2([Number.MAX_VALUE,-Number.MAX_VALUE])];for(let n=0;n<e.height;n++)for(let i=0;i<e.width;i++)for(let e=0;e<3;++e)s[e].x=Math.min(s[e].x,t.getPixelAsArray(i,n)[e]),s[e].y=Math.max(s[e].y,t.getPixelAsArray(i,n)[e]);for(let n=0;n<e.height;n++)for(let i=0;i<e.width;i++)for(let e=0;e<3;++e){const a=(t.getPixelAsArray(i,n)[e]-s[e].x)/(s[e].y-s[e].x);t.setPixelAtChannel(i,n,e,a)}r.x=s[0].x*o[0].x+s[1].x*o[1].x+s[2].x*o[2].x,r.y=s[0].x*o[0].y+s[1].x*o[1].y+s[2].x*o[2].y,r.z=s[0].x*o[0].z+s[1].x*o[1].z+s[2].x*o[2].z,n.x=o[0].x*(s[0].y-s[0].x),n.y=o[0].y*(s[0].y-s[0].x),n.z=o[0].z*(s[0].y-s[0].x),i.x=o[1].x*(s[1].y-s[1].x),i.y=o[1].y*(s[1].y-s[1].x),i.z=o[1].z*(s[1].y-s[1].x),a.x=o[2].x*(s[2].y-s[2].x),a.y=o[2].y*(s[2].y-s[2].x),a.z=o[2].z*(s[2].y-s[2].x)}(e,i,n.colorSpaceVector1,n.colorSpaceVector2,n.colorSpaceVector3,n.colorSpaceOrigin);const a=new Mt.Z(e.width,e.height,3);n.Tinput=a;for(let e=0;e<3;e++)Vt(i,a,e);const r=new Mt.Z(t,1,3);n.Tinv=r;for(let e=0;e<3;e++)Wt(i,r,e);r.resize(r.width,Math.floor(Math.log(a.width)/Math.log(2)),3);for(let e=0;e<3;e++)Lt(a,r,e);return n}});var Ht=n(5634),Ot=n(5704),Gt=n(9646),Qt=n(1226),kt=n(7683),Ut=n(8914),Zt=n(1986),Xt=n(9840),qt=n(3498),Yt=n(1715);const jt=n(5337).Z,Kt={Entity:t.Z,EntityRepository:e.Z,ComponentRepository:a.Z,TransformComponent:r.Z,SceneGraphComponent:o.Z,MeshComponent:s.Z,MeshRendererComponent:l.Z,AABB:ct.Z,Primitive:c.Z,System:_.Z,Scalar:h.ZP,Vector2:d.ZP,Vector3:u.ZP,Vector4:m.ZP,MutableScalar:x.ZP,MutableVector2:f.ZP,MutableVector3:A.ZP,MutableVector4:p.ZP,Matrix22:g.Z,Matrix33:v.Z,Matrix44:y.Z,MutableMatrix22:I.Z,MutableMatrix33:b.Z,MutableMatrix44:T.Z,Gltf1Importer:E,Gltf2Importer:C.Z,DrcPointCloudImporter:M,GltfImporter:_e,ModelConverter:U.Z,ModuleManager:oe.Z,MemoryManager:me.Z,CameraComponent:xe.Z,AnimationComponent:fe.Z,LightComponent:Ae.Z,CubeTexture:pe.Z,CameraControllerComponent:ge.Z,Gltf2Exporter:ue,detectFormatByArrayBuffers:k,detectFormatByUri:function(e){const t=e.split("."),n=t[t.length-1];return"efk"===n?"Effekseer":"drc"===n?"Draco":"vrm"===n?"VRM":"gltf"===n?"glTF":"Unknown"},Config:ve.Z,Plane:Ie,Sphere:be,Material:Te.Z,MaterialHelper:w.Z,MeshHelper:Ye,RenderPass:le,FrameBuffer:we,Expression:re,RenderTargetTexture:Ce.Z,RenderBuffer:Ne,RenderableHelper:Pe,AbstractTexture:Fe.Z,Texture:te.Z,VideoTexture:Ve,EntityHelper:We,MathClassUtil:ze.Z,Mesh:He.Z,Component:Z.Z,EnvConstantSingleMaterialNode:Oe.Z,ShadowMapDecodeClassicSingleMaterialNode:Ge.Z,RnObject:ie.Z,VRMImporter:Qe,BlendShapeComponent:ke.Z,AnimationAssigner:Ze,MiscUtil:Xe.Kf,MathUtil:qe.k,OrbitCameraController:je.Z,WalkThroughCameraController:Ke.Z,ShaderityUtility:Je.Z,AbstractMaterialNode:$e.Z,ConstantVariableShaderNode:class extends nt{constructor(e,t){super("constantVariable",void 0,void 0),this.__shaderFunctionName+="_"+this.__shaderNodeUid,this.__shader=new tt(this.__shaderFunctionName,e,t),this.__outputs.push({compositionType:e,componentType:t,name:"outValue"})}setDefaultInputValue(e,t){"value"===e&&this.__shader.setConstantValue(t)}},AddShaderNode:class extends nt{constructor(e,t){super("add","\nvoid add(in float lfs, in float rhs, out float outValue) {\n  outValue = lfs + rhs;\n}\nvoid add(in int lfs, in int rhs, out int outValue) {\n  outValue = lfs + rhs;\n}\nvoid add(in vec2 lfs, in vec2 rhs, out vec2 outValue) {\n  outValue = lfs + rhs;\n}\nvoid add(in vec3 lfs, in vec3 rhs, out vec3 outValue) {\n  outValue = lfs + rhs;\n}\nvoid add(in vec4 lfs, in vec4 rhs, out vec4 outValue) {\n  outValue = lfs + rhs;\n}\n"),this.__inputs.push({compositionType:e,componentType:t,name:"lhs"}),this.__inputs.push({compositionType:e,componentType:ye.r.Float,name:"rhs"}),this.__outputs.push({compositionType:e,componentType:t,name:"outValue"})}},DotProductShaderNode:class extends nt{constructor(e,t){super("dotProduct","\nvoid dotProduct(in vec2 lfs, in vec2 rhs, out float outValue) {\n  outValue = dot(lfs, rhs);\n}\nvoid dotProduct(in vec3 lfs, in vec3 rhs, out float outValue) {\n  outValue = dot(lfs, rhs);\n}\nvoid dotProduct(in vec4 lfs, in vec4 rhs, out float outValue) {\n  outValue = dot(lfs, rhs);\n}\n"),this.__inputs.push({compositionType:e,componentType:t,name:"lhs"}),this.__inputs.push({compositionType:e,componentType:ye.r.Float,name:"rhs"}),this.__outputs.push({compositionType:D.d.Scalar,componentType:t,name:"outValue"})}},MultiplyShaderNode:class extends nt{constructor(e,t,n,i){super("multiply","\nvoid multiply(in float lfs, in float rhs, out float outValue) {\n  outValue = lfs * rhs;\n}\nvoid multiply(in int lfs, in int rhs, out int outValue) {\n  outValue = lfs * rhs;\n}\nvoid multiply(in mat2 lfs, in mat2 rhs, out mat2 outValue) {\n  outValue = lfs * rhs;\n}\nvoid multiply(in mat3 lfs, in mat3 rhs, out mat3 outValue) {\n  outValue = lfs * rhs;\n}\nvoid multiply(in mat4 lfs, in mat4 rhs, out mat4 outValue) {\n  outValue = lfs * rhs;\n}\nvoid multiply(in mat3 lfs, in vec3 rhs, out vec3 outValue) {\n  outValue = lfs * rhs;\n}\nvoid multiply(in mat4 lfs, in vec4 rhs, out vec4 outValue) {\n  outValue = lfs * rhs;\n}\n\n");let a=D.d.Unknown;e===D.d.Mat4&&n===D.d.Mat4?a=D.d.Mat4:e===D.d.Mat4&&n===D.d.Vec4?a=D.d.Vec4:e===D.d.Scalar&&n===D.d.Scalar&&(a=D.d.Scalar),this.__inputs.push({compositionType:e,componentType:t,name:"lhs"}),this.__inputs.push({compositionType:n,componentType:i,name:"rhs"}),this.__outputs.push({compositionType:a,componentType:t,name:"outValue"})}},OutPositionShaderNode:class extends nt{constructor(){super("outPosition",void 0,lt.getInstance()),this.__inputs.push({compositionType:D.d.Vec4,componentType:ye.r.Float,name:"value"})}},OutColorShaderNode:class extends nt{constructor(){super("outColor",void 0,lt.getInstance()),this.__inputs.push({compositionType:D.d.Vec4,componentType:ye.r.Float,name:"value"})}},ScalarToVector4ShaderNode:class extends nt{constructor(){super("scalarToVector4","\nvoid scalarToVector4(in float x, in float y, in float z, in float w, out vec4 outValue) {\n  outValue.x = x;\n  outValue.y = y;\n  outValue.z = z;\n  outValue.w = w;\n}\n"),this.__inputs.push({compositionType:D.d.Scalar,componentType:ye.r.Float,name:"x"}),this.__inputs.push({compositionType:D.d.Scalar,componentType:ye.r.Float,name:"y"}),this.__inputs.push({compositionType:D.d.Scalar,componentType:ye.r.Float,name:"z"}),this.__inputs.push({compositionType:D.d.Scalar,componentType:ye.r.Float,name:"w"}),this.__outputs.push({compositionType:D.d.Vec4,componentType:ye.r.Float,name:"outValue"})}},Vector3AndScalarToVector4ShaderNode:class extends nt{constructor(){super("vector3AndScalarToVector4","\nvoid vector3AndScalarToVector4(in vec3 xyz, in float w, out vec4 outValue) {\n  outValue.x = xyz.x;\n  outValue.y = xyz.y;\n  outValue.z = xyz.z;\n  outValue.w = w;\n}\n"),this.__inputs.push({compositionType:D.d.Vec3,componentType:ye.r.Float,name:"xyz"}),this.__inputs.push({compositionType:D.d.Scalar,componentType:ye.r.Float,name:"w"}),this.__outputs.push({compositionType:D.d.Vec4,componentType:ye.r.Float,name:"outValue"})}},AttributePositionShaderNode:class extends nt{constructor(){super("attributePosition","\nin vec4 a_position;\n\nvoid attributePosition(out vec4 outValue) {\n  outValue = a_position;\n}\n"),this.__outputs.push({compositionType:D.d.Vec4,componentType:ye.r.Float,name:"outValue"})}},AttributeNormalShaderNode:class extends nt{constructor(){super("attributeNormal","\nin vec3 a_normal;\n\nvoid attributeNormal(out vec3 outValue) {\n  outValue = a_normal;\n}\n"),this.__outputs.push({compositionType:D.d.Vec3,componentType:ye.r.Float,name:"outValue"})}},WorldMatrixShaderNode:class extends nt{constructor(){super("worldMatrix","\nvoid worldMatrix(out mat4 outValue) {\n  outValue = get_worldMatrix(a_instanceID);\n}\n"),this.__outputs.push({compositionType:D.d.Mat4,componentType:ye.r.Float,name:"outValue"})}},ViewMatrixShaderNode:class extends nt{constructor(){super("viewMatrix","\nvoid viewMatrix(out mat4 outValue) {\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID}*/];\n  outValue = get_viewMatrix(cameraSID, 0);\n}\n"),this.__outputs.push({compositionType:D.d.Mat4,componentType:ye.r.Float,name:"outValue"})}},ProjectionMatrixShaderNode:class extends nt{constructor(){super("projectionMatrix","\nvoid projectionMatrix(out mat4 outValue) {\n  float cameraSID = u_currentComponentSIDs[/* shaderity: @{WellKnownComponentTIDs.CameraComponentTID}*/];\n  outValue = get_projectionMatrix(cameraSID, 0);\n}\n"),this.__outputs.push({compositionType:D.d.Mat4,componentType:ye.r.Float,name:"outValue"})}},VaryingInVariableShaderNode:class extends nt{constructor(e,t){super("varyingInVariable"),this.__shaderFunctionName+="_"+this.__shaderNodeUid,this.__shader=new _t(this.__shaderFunctionName,e,t),this.__outputs.push({compositionType:e,componentType:t,name:"outValue",isClosed:!0})}setVaryingVariableName(e){this.__shader.setVariableName(e)}},VaryingOutVariableShaderNode:class extends nt{constructor(e,t){super("varyingOutVariable"),this.__shaderFunctionName+="_"+this.__shaderNodeUid,this.__shader=new _t(this.__shaderFunctionName,e,t),this.__inputs.push({compositionType:e,componentType:t,name:"value"})}setVaryingVariableName(e){this.__shader.setVariableName(e)}},NormalMatrixShaderNode:class extends nt{constructor(){super("normalMatrix","\nvoid normalMatrix(out mat3 outValue) {\n  outValue = get_normalMatrix(a_instanceID);\n}\n"),this.__outputs.push({compositionType:D.d.Mat3,componentType:ye.r.Float,name:"outValue"})}},UniformDataShaderNode:class extends nt{constructor(e,t){super("uniformData"),this.__shaderFunctionName+="_"+this.__shaderNodeUid,this.__shader=new ht(this.__shaderFunctionName,e,t),this.__outputs.push({compositionType:e,componentType:t,name:"outValue"})}setDefaultInputValue(e,t){"value"===e&&this.__shader.setDefaultValue(t)}setUniformDataName(e){this.__shader.setVariableName(e)}},NormalizeShaderNode:class extends nt{constructor(e,t){super("normalize","\nvoid normalize(in vec2 value, out vec2 outValue) {\n  outValue = normalize(value);\n}\n\nvoid normalize(in vec3 value, out vec3 outValue) {\n  outValue = normalize(value);\n}\n\nvoid normalize(in vec4 value, out vec4 outValue) {\n  outValue = normalize(value);\n}\n"),this.__inputs.push({compositionType:e,componentType:t,name:"value"}),this.__outputs.push({compositionType:e,componentType:t,name:"outValue"})}},IfStatementShaderNode:class extends nt{constructor(){super("ifStatement",void 0,new dt),this.__inputs.push({compositionType:D.d.Scalar,componentType:ye.r.Bool,name:"condition"}),this.__outputs.push({compositionType:D.d.Unknown,componentType:ye.r.Unknown,name:"ifStart"})}},BlockBeginShaderNode:class extends nt{constructor(){super("blockBegin"),this.__valueInputs=[],this.__valueOutputs=[],this.__shaderFunctionName+="_"+this.__shaderNodeUid,this.__shader=new ut(this.__shaderFunctionName,this.__valueInputs,this.__valueOutputs),this.__inputs.push({compositionType:D.d.Scalar,componentType:ye.r.Bool,name:"blockStart"})}addInputAndOutput(e,t){const n={compositionType:e,componentType:t,name:`value_${this.__valueInputs.length}`},i={compositionType:e,componentType:t,name:`outValue_${this.__valueOutputs.length}`};this.__inputs.push(n),this.__outputs.push(i),this.__valueInputs.push(n),this.__valueOutputs.push(i)}},BlockEndShaderNode:class extends nt{constructor(){super("blockEnd"),this.__shaderFunctionName+="_"+this.__shaderNodeUid,this.__shader=new mt(this.__shaderFunctionName,this.__inputs,this.__outputs)}addInputAndOutput(e,t){const n={compositionType:e,componentType:t,name:`value_${this.__inputs.length}`},i={compositionType:e,componentType:t,name:`outValue_${this.__outputs.length}`};this.__inputs.push(n),this.__outputs.push(i)}},GreaterShaderNode:class extends nt{constructor(e,t){super("greater","\nvoid greater(in float lhs, in float rhs, out bool outValue) {\n  outValue = lhs > rhs;\n}\n\nvoid greater(in int lhs, in int rhs, out bool outValue) {\n  outValue = lhs > rhs;\n}\n"),this.__inputs.push({compositionType:e,componentType:t,name:"lhs"}),this.__inputs.push({compositionType:e,componentType:ye.r.Float,name:"rhs"}),this.__outputs.push({compositionType:D.d.Scalar,componentType:ye.r.Bool,name:"outValue"})}},ShaderGraphResolver:At,Quaternion:Y.Z,MutableQuaternion:K.Z,PbrShadingSingleMaterialNode:pt.Z,Buffer:gt.Z,CGAPIResourceRepository:Se.Z,WebXRSystem:vt.Z,VarianceShadowMapDecodeClassicSingleMaterialNode:Tt.Z,FurnaceTestSingleMaterialNode:St.Z,SynthesizeHDRMaterialNode:Et.Z,DetectHighLuminanceSingleMaterialNode:Ct.Z,DepthEncodeSingleMaterialNode:wt.Z,PbrShadingMaterialNode:pt.Z,MatCapMaterialNode:Dt.Z,GaussianBlurSingleMaterialNode:Nt.Z,GaussianBlurForEncodedDepthSingleMaterialNode:Bt.Z,ImageUtil:zt,GetComponentFromEntities:It,enhanceArray:()=>{Object.defineProperty(Array.prototype,"Rn",{enumerable:!1,configurable:!1,get(){return new bt(this)}})},EffekseerComponent:yt.default.EffekseerComponent,FileType:Q,VERSION:jt,CompositionType:D.d,ShaderType:xt.H,PixelFormat:Be.V,BoneDataType:Qt.N,CameraControllerType:Ut.M,AlphaMode:Ot.F,ProcessApproach:kt.V,ComponentType:ye.r,VertexAttribute:B.T,LightType:Ht.v,CameraType:Gt.i,ShaderSemantics:he.f,TextureParameter:De.d,PrimitiveMode:N.T,HdriFormat:Zt.c,ShadingModel:Xt.D,AnimationAttribute:qt.s,AnimationInterpolation:Ue.k,CompressionTextureType:Yt.b}})(),i.default})()}));