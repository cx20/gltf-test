/*
 *   RedGL - MIT License
 *   Copyright (c) 2018 - 2019 By RedCamel( webseon@gmail.com )
 *   https://github.com/redcamel/RedGL2/blob/dev/LICENSE
 *   Last modification time of this file - 2020.3.18 13:58:43
 *
 */

var RedDefinePropertyInfo,RedGLDetect,RedGLUtil,RedGL,RedBoxSelection,RedBaseController,RedImageLoader,RedBaseTexture,RedBaseObject3D,RedBaseContainer,RedBaseLight,RedFrameBuffer,RedBuffer,RedGeometry,RedInterleaveInfo,RedBaseMaterial,RedTextureOptionChecker,RedBitmapTexture,RedVideoTexture,RedDDSTexture,RedBitmapCubeTexture,RedColorMaterial,RedColorPhongMaterial,RedColorPhongTextureMaterial,RedEnvironmentMaterial,RedBitmapMaterial,RedParticleMaterial,RedBitmapPointCloudMaterial,RedSheetMaterial,RedStandardMaterial,RedVideoMaterial,RedPBRMaterial,RedColorPointCloudMaterial,RedPBRMaterial_System,RedTextMaterial,RedOutlineMaterial,RedOutlinePlaneMaterial,RedAmbientLight,RedDirectionalLight,RedPointLight,RedMTLLoader,RedOBJLoader,Red3DSLoader,RedDAELoader,RedGLTFLoader,RedLinePoint,RedLathe,RedAxis,RedGrid,RedMesh,RedLine,RedLatheMesh,RedSkyBox,RedSprite3D,RedTransformController,RedPointCloud,RedParticleUnit,RedColorPointCloud,RedBitmapPointCloud,RedParticleEmitter,RedBox,RedCylinder,RedPlane,RedSphere,RedProgram,RedSystemShaderCode,RedShader,RedRenderer,RedRenderDebuger,RedSystemUniformUpdater,RedView,RedWorld,RedScene,RedCamera,RedBasicController,RedObitController,RedGridMaterial,RedSkyBoxMaterial,RedDirectionalShadowMaterial,RedPostEffectMaterial,RedDirectionalShadow,RedShadowManager,RedText,RedMouseEventManager,RedMouseEventMaterial,RedPostEffectManager,RedBasePostEffect,RedPostEffect_Bloom,RedPostEffect_BloomThreshold,RedPostEffect_Blur,RedPostEffect_BlurX,RedPostEffect_BlurY,RedPostEffect_GaussianBlur,RedPostEffect_ZoomBlur,RedPostEffect_BrightnessContrast,RedPostEffect_Threshold,RedPostEffect_Invert,RedPostEffect_Gray,RedPostEffect_HueSaturation,RedPostEffect_HalfTone,RedPostEffect_Pixelize,RedPostEffect_Convolution,RedPostEffect_DoF,RedPostEffect_DoF_DepthMaterial,RedPostEffect_Film,RedPostEffect_Vignetting,RedPostEffect_FXAA,RedFilterFrameBuffer,RedFilterEffectManager,RedBaseFilter,RedFilterMaterial,RedFilter_BrightnessContrast,RedFilter_Gray,RedFilter_Invert,RedFilter_Threshold,RedFilter_HueSaturation,RedFilter_Blur,RedFilter_BlurX,RedFilter_BlurY,RedFilter_GaussianBlur,RedFilter_Pixelize,RedFilter_HalfTone,RedFilter_Bloom,RedFilter_BloomThreshold,RedFilter_Film,RedFilter_Convolution,RedGLOffScreen;!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(this,function(){return function(e){function t(i){if(r[i])return r[i].exports;var n=r[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,i){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=4)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setMatrixArrayType=function(e){t.ARRAY_TYPE=e},t.toRadian=function(e){return e*n},t.equals=function(e,t){return Math.abs(e-t)<=i*Math.max(1,Math.abs(e),Math.abs(t))};var i=t.EPSILON=1e-6,n=(t.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,t.RANDOM=Math.random,Math.PI/180)},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=t[6],u=t[7],c=t[8],f=r[0],h=r[1],R=r[2],m=r[3],p=r[4],_=r[5],g=r[6],v=r[7],E=r[8];return e[0]=f*i+h*o+R*l,e[1]=f*n+h*s+R*u,e[2]=f*a+h*d+R*c,e[3]=m*i+p*o+_*l,e[4]=m*n+p*s+_*u,e[5]=m*a+p*d+_*c,e[6]=g*i+v*o+E*l,e[7]=g*n+v*s+E*u,e[8]=g*a+v*d+E*c,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},t.clone=function(e){var t=new a.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromValues=function(e,t,r,i,n,o,s,d,l){var u=new a.ARRAY_TYPE(9);return u[0]=e,u[1]=t,u[2]=r,u[3]=i,u[4]=n,u[5]=o,u[6]=s,u[7]=d,u[8]=l,u},t.set=function(e,t,r,i,n,a,o,s,d,l){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=d,e[8]=l,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=n}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],l=t[7],u=t[8],c=u*o-s*l,f=-u*a+s*d,h=l*a-o*d,R=r*c+i*f+n*h;return R?(R=1/R,e[0]=c*R,e[1]=(-u*i+n*l)*R,e[2]=(s*i-n*o)*R,e[3]=f*R,e[4]=(u*r-n*d)*R,e[5]=(-s*r+n*a)*R,e[6]=h*R,e[7]=(-l*r+i*d)*R,e[8]=(o*r-i*a)*R,e):null},t.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],l=t[7],u=t[8];return e[0]=o*u-s*l,e[1]=n*l-i*u,e[2]=i*s-n*o,e[3]=s*d-a*u,e[4]=r*u-n*d,e[5]=n*a-r*s,e[6]=a*l-o*d,e[7]=i*d-r*l,e[8]=r*o-i*a,e},t.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],d=e[7],l=e[8];return t*(l*a-o*d)+r*(-l*n+o*s)+i*(d*n-a*s)},t.multiply=i,t.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=t[6],u=t[7],c=t[8],f=r[0],h=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=s,e[5]=d,e[6]=f*i+h*o+l,e[7]=f*n+h*s+u,e[8]=f*a+h*d+c,e},t.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=t[6],u=t[7],c=t[8],f=Math.sin(r),h=Math.cos(r);return e[0]=h*i+f*o,e[1]=h*n+f*s,e[2]=h*a+f*d,e[3]=h*o-f*i,e[4]=h*s-f*n,e[5]=h*d-f*a,e[6]=l,e[7]=u,e[8]=c,e},t.scale=function(e,t,r){var i=r[0],n=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.fromMat2d=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e},t.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,d=n+n,l=r*o,u=i*o,c=i*s,f=n*o,h=n*s,R=n*d,m=a*o,p=a*s,_=a*d;return e[0]=1-c-R,e[3]=u-_,e[6]=f+p,e[1]=u+_,e[4]=1-l-R,e[7]=h-m,e[2]=f-p,e[5]=h+m,e[8]=1-l-c,e},t.normalFromMat4=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],l=t[7],u=t[8],c=t[9],f=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15],g=r*s-i*o,v=r*d-n*o,E=r*l-a*o,M=i*d-n*s,b=i*l-a*s,L=n*l-a*d,T=u*m-c*R,P=u*p-f*R,x=u*_-h*R,y=c*p-f*m,w=c*_-h*m,U=f*_-h*p,I=g*U-v*w+E*y+M*x-b*P+L*T;return I?(I=1/I,e[0]=(s*U-d*w+l*y)*I,e[1]=(d*x-o*U-l*P)*I,e[2]=(o*w-s*x+l*T)*I,e[3]=(n*w-i*U-a*y)*I,e[4]=(r*U-n*x+a*P)*I,e[5]=(i*x-r*w-a*T)*I,e[6]=(m*L-p*b+_*M)*I,e[7]=(p*E-R*L-_*v)*I,e[8]=(R*b-m*E+_*g)*I,e):null},t.projection=function(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e},t.str=function(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e},t.subtract=n,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],d=e[5],l=e[6],u=e[7],c=e[8],f=t[0],h=t[1],R=t[2],m=t[3],p=t[4],_=t[5],g=t[6],v=t[7],E=t[8];return Math.abs(r-f)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-h)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-R)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(o-m)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(s-p)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(d-_)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(l-g)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(u-v)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(c-E)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(){var e=new R.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function n(e){var t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function a(e,t,r){var i=new R.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function d(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function l(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}function u(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2];return r*r+i*i+n*n}function c(e){var t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function f(e,t){var r=t[0],i=t[1],n=t[2],a=r*r+i*i+n*n;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new R.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.length=n,t.fromValues=a,t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.set=function(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},t.subtract=o,t.multiply=s,t.divide=d,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e},t.distance=l,t.squaredDistance=u,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},t.normalize=f,t.dot=h,t.cross=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],d=r[2];return e[0]=n*d-a*s,e[1]=a*o-i*d,e[2]=i*s-n*o,e},t.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e},t.hermite=function(e,t,r,i,n,a){var o=a*a,s=o*(2*a-3)+1,d=o*(a-2)+a,l=o*(a-1),u=o*(3-2*a);return e[0]=t[0]*s+r[0]*d+i[0]*l+n[0]*u,e[1]=t[1]*s+r[1]*d+i[1]*l+n[1]*u,e[2]=t[2]*s+r[2]*d+i[2]*l+n[2]*u,e},t.bezier=function(e,t,r,i,n,a){var o=1-a,s=o*o,d=a*a,l=s*o,u=3*a*s,c=3*d*o,f=d*a;return e[0]=t[0]*l+r[0]*u+i[0]*c+n[0]*f,e[1]=t[1]*l+r[1]*u+i[1]*c+n[1]*f,e[2]=t[2]*l+r[2]*u+i[2]*c+n[2]*f,e},t.random=function(e,t){t=t||1;var r=2*R.RANDOM()*Math.PI,i=2*R.RANDOM()-1,n=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(r)*n,e[1]=Math.sin(r)*n,e[2]=i*t,e},t.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[3]*i+r[7]*n+r[11]*a+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*n+r[8]*a+r[12])/o,e[1]=(r[1]*i+r[5]*n+r[9]*a+r[13])/o,e[2]=(r[2]*i+r[6]*n+r[10]*a+r[14])/o,e},t.transformMat3=function(e,t,r){var i=t[0],n=t[1],a=t[2];return e[0]=i*r[0]+n*r[3]+a*r[6],e[1]=i*r[1]+n*r[4]+a*r[7],e[2]=i*r[2]+n*r[5]+a*r[8],e},t.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],d=r[2],l=r[3],u=l*i+s*a-d*n,c=l*n+d*i-o*a,f=l*a+o*n-s*i,h=-o*i-s*n-d*a;return e[0]=u*l+h*-o+c*-d-f*-s,e[1]=c*l+h*-s+f*-o-u*-d,e[2]=f*l+h*-d+u*-s-c*-o,e},t.rotateX=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0],a[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),a[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateY=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),a[1]=n[1],a[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.rotateZ=function(e,t,r,i){var n=[],a=[];return n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],a[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),a[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),a[2]=n[2],e[0]=a[0]+r[0],e[1]=a[1]+r[1],e[2]=a[2]+r[2],e},t.angle=function(e,t){var r=a(e[0],e[1],e[2]),i=a(t[0],t[1],t[2]);f(r,r),f(i,i);var n=h(r,i);return n>1?0:n<-1?Math.PI:Math.acos(n)},t.str=function(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(r-a)<=R.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-o)<=R.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-s)<=R.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))};var R=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=o,t.mul=s,t.div=d,t.dist=l,t.sqrDist=u,t.len=n,t.sqrLen=c,t.forEach=function(){var e=i();return function(t,r,i,n,a,o){var s,d=void 0;for(r||(r=3),i||(i=0),s=n?Math.min(n*r+i,t.length):t.length,d=i;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],a(e,e,o),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2];return t}}()},function(e,t,r){"use strict";function i(){var e=new h.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function s(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function d(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+i*i+n*n+a*a)}function l(e,t){var r=t[0]-e[0],i=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return r*r+i*i+n*n+a*a}function u(e){var t=e[0],r=e[1],i=e[2],n=e[3];return Math.sqrt(t*t+r*r+i*i+n*n)}function c(e){var t=e[0],r=e[1],i=e[2],n=e[3];return t*t+r*r+i*i+n*n}function f(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=i*o,e[2]=n*o,e[3]=a*o),e}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.len=t.sqrDist=t.dist=t.div=t.mul=t.sub=void 0,t.create=i,t.clone=function(e){var t=new h.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.fromValues=function(e,t,r,i){var n=new h.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=n,t.multiply=a,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},t.scale=s,t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e},t.distance=d,t.squaredDistance=l,t.length=u,t.squaredLength=c,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},t.normalize=f,t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.lerp=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e[2]=o+i*(r[2]-o),e[3]=s+i*(r[3]-s),e},t.random=function(e,t){return t=t||1,e[0]=h.RANDOM(),e[1]=h.RANDOM(),e[2]=h.RANDOM(),e[3]=h.RANDOM(),f(e,e),s(e,e,t),e},t.transformMat4=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3];return e[0]=r[0]*i+r[4]*n+r[8]*a+r[12]*o,e[1]=r[1]*i+r[5]*n+r[9]*a+r[13]*o,e[2]=r[2]*i+r[6]*n+r[10]*a+r[14]*o,e[3]=r[3]*i+r[7]*n+r[11]*a+r[15]*o,e},t.transformQuat=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=r[0],s=r[1],d=r[2],l=r[3],u=l*i+s*a-d*n,c=l*n+d*i-o*a,f=l*a+o*n-s*i,h=-o*i-s*n-d*a;return e[0]=u*l+h*-o+c*-d-f*-s,e[1]=c*l+h*-s+f*-o-u*-d,e[2]=f*l+h*-d+u*-s-c*-o,e[3]=t[3],e},t.str=function(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=t[0],s=t[1],d=t[2],l=t[3];return Math.abs(r-o)<=h.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=h.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(n-d)<=h.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-l)<=h.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))};var h=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.sub=n,t.mul=a,t.div=o,t.dist=d,t.sqrDist=l,t.len=u,t.sqrLen=c,t.forEach=function(){var e=i();return function(t,r,i,n,a,o){var s,d=void 0;for(r||(r=4),i||(i=0),s=n?Math.min(n*r+i,t.length):t.length,d=i;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],e[2]=t[d+2],e[3]=t[d+3],a(e,e,o),t[d]=e[0],t[d+1]=e[1],t[d+2]=e[2],t[d+3]=e[3];return t}}()},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=t.vec3=t.vec2=t.quat=t.mat4=t.mat3=t.mat2d=t.mat2=t.glMatrix=void 0;var n=i(r(0)),a=i(r(5)),o=i(r(6)),s=i(r(1)),d=i(r(7)),l=i(r(8)),u=i(r(9)),c=i(r(2)),f=i(r(3));t.glMatrix=n,t.mat2=a,t.mat2d=o,t.mat3=s,t.mat4=d,t.quat=l,t.vec2=u,t.vec3=c,t.vec4=f},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],d=r[1],l=r[2],u=r[3];return e[0]=i*s+a*d,e[1]=n*s+o*d,e[2]=i*l+a*u,e[3]=n*l+o*u,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.fromValues=function(e,t,r,i){var n=new a.ARRAY_TYPE(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},t.set=function(e,t,r,i,n){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e},t.transpose=function(e,t){if(e===t){var r=t[1];e[1]=t[2],e[2]=r}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*a-n*i;return o?(o=1/o,e[0]=a*o,e[1]=-i*o,e[2]=-n*o,e[3]=r*o,e):null},t.adjoint=function(e,t){var r=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=r,e},t.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},t.multiply=i,t.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d+a*s,e[1]=n*d+o*s,e[2]=i*-s+a*d,e[3]=n*-s+o*d,e},t.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],d=r[1];return e[0]=i*s,e[1]=n*s,e[2]=a*d,e[3]=o*d,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e},t.str=function(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2))},t.LDU=function(e,t,r,i){return e[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-e[2]*r[1],[e,t,r]},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e},t.subtract=n,t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=t[0],d=t[1],l=t[2],u=t[3];return Math.abs(r-s)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-d)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-l)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-u)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(u))},t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=r[0],u=r[1],c=r[2],f=r[3],h=r[4],R=r[5];return e[0]=i*l+a*u,e[1]=n*l+o*u,e[2]=i*c+a*f,e[3]=n*c+o*f,e[4]=i*h+a*R+s,e[5]=n*h+o*R+d,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(6);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.clone=function(e){var t=new a.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.fromValues=function(e,t,r,i,n,o){var s=new a.ARRAY_TYPE(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=n,s[5]=o,s},t.set=function(e,t,r,i,n,a,o){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=r*a-i*n;return d?(d=1/d,e[0]=a*d,e[1]=-i*d,e[2]=-n*d,e[3]=r*d,e[4]=(n*s-a*o)*d,e[5]=(i*o-r*s)*d,e):null},t.determinant=function(e){return e[0]*e[3]-e[1]*e[2]},t.multiply=i,t.rotate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=Math.sin(r),u=Math.cos(r);return e[0]=i*u+a*l,e[1]=n*u+o*l,e[2]=i*-l+a*u,e[3]=n*-l+o*u,e[4]=s,e[5]=d,e},t.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=r[0],u=r[1];return e[0]=i*l,e[1]=n*l,e[2]=a*u,e[3]=o*u,e[4]=s,e[5]=d,e},t.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=r[0],u=r[1];return e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=i*l+a*u+s,e[5]=n*l+o*u+d,e},t.fromRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e},t.str=function(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+1)},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e},t.subtract=n,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],d=e[5],l=t[0],u=t[1],c=t[2],f=t[3],h=t[4],R=t[5];return Math.abs(r-l)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-u)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-c)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-f)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-h)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(d-R)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(R))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],d=t[5],l=t[6],u=t[7],c=t[8],f=t[9],h=t[10],R=t[11],m=t[12],p=t[13],_=t[14],g=t[15],v=r[0],E=r[1],M=r[2],b=r[3];return e[0]=v*i+E*s+M*c+b*m,e[1]=v*n+E*d+M*f+b*p,e[2]=v*a+E*l+M*h+b*_,e[3]=v*o+E*u+M*R+b*g,v=r[4],E=r[5],M=r[6],b=r[7],e[4]=v*i+E*s+M*c+b*m,e[5]=v*n+E*d+M*f+b*p,e[6]=v*a+E*l+M*h+b*_,e[7]=v*o+E*u+M*R+b*g,v=r[8],E=r[9],M=r[10],b=r[11],e[8]=v*i+E*s+M*c+b*m,e[9]=v*n+E*d+M*f+b*p,e[10]=v*a+E*l+M*h+b*_,e[11]=v*o+E*u+M*R+b*g,v=r[12],E=r[13],M=r[14],b=r[15],e[12]=v*i+E*s+M*c+b*m,e[13]=v*n+E*d+M*f+b*p,e[14]=v*a+E*l+M*h+b*_,e[15]=v*o+E*u+M*R+b*g,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}Object.defineProperty(t,"__esModule",{value:!0}),t.sub=t.mul=void 0,t.create=function(){var e=new a.ARRAY_TYPE(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.clone=function(e){var t=new a.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.fromValues=function(e,t,r,i,n,o,s,d,l,u,c,f,h,R,m,p){var _=new a.ARRAY_TYPE(16);return _[0]=e,_[1]=t,_[2]=r,_[3]=i,_[4]=n,_[5]=o,_[6]=s,_[7]=d,_[8]=l,_[9]=u,_[10]=c,_[11]=f,_[12]=h,_[13]=R,_[14]=m,_[15]=p,_},t.set=function(e,t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p){return e[0]=t,e[1]=r,e[2]=i,e[3]=n,e[4]=a,e[5]=o,e[6]=s,e[7]=d,e[8]=l,e[9]=u,e[10]=c,e[11]=f,e[12]=h,e[13]=R,e[14]=m,e[15]=p,e},t.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.transpose=function(e,t){if(e===t){var r=t[1],i=t[2],n=t[3],a=t[6],o=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=a,e[11]=t[14],e[12]=n,e[13]=o,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],l=t[7],u=t[8],c=t[9],f=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15],g=r*s-i*o,v=r*d-n*o,E=r*l-a*o,M=i*d-n*s,b=i*l-a*s,L=n*l-a*d,T=u*m-c*R,P=u*p-f*R,x=u*_-h*R,y=c*p-f*m,w=c*_-h*m,U=f*_-h*p,I=g*U-v*w+E*y+M*x-b*P+L*T;return I?(I=1/I,e[0]=(s*U-d*w+l*y)*I,e[1]=(n*w-i*U-a*y)*I,e[2]=(m*L-p*b+_*M)*I,e[3]=(f*b-c*L-h*M)*I,e[4]=(d*x-o*U-l*P)*I,e[5]=(r*U-n*x+a*P)*I,e[6]=(p*E-R*L-_*v)*I,e[7]=(u*L-f*E+h*v)*I,e[8]=(o*w-s*x+l*T)*I,e[9]=(i*x-r*w-a*T)*I,e[10]=(R*b-m*E+_*g)*I,e[11]=(c*E-u*b-h*g)*I,e[12]=(s*P-o*y-d*T)*I,e[13]=(r*y-i*P+n*T)*I,e[14]=(m*v-R*M-p*g)*I,e[15]=(u*M-c*v+f*g)*I,e):null},t.adjoint=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=t[4],s=t[5],d=t[6],l=t[7],u=t[8],c=t[9],f=t[10],h=t[11],R=t[12],m=t[13],p=t[14],_=t[15];return e[0]=s*(f*_-h*p)-c*(d*_-l*p)+m*(d*h-l*f),e[1]=-(i*(f*_-h*p)-c*(n*_-a*p)+m*(n*h-a*f)),e[2]=i*(d*_-l*p)-s*(n*_-a*p)+m*(n*l-a*d),e[3]=-(i*(d*h-l*f)-s*(n*h-a*f)+c*(n*l-a*d)),e[4]=-(o*(f*_-h*p)-u*(d*_-l*p)+R*(d*h-l*f)),e[5]=r*(f*_-h*p)-u*(n*_-a*p)+R*(n*h-a*f),e[6]=-(r*(d*_-l*p)-o*(n*_-a*p)+R*(n*l-a*d)),e[7]=r*(d*h-l*f)-o*(n*h-a*f)+u*(n*l-a*d),e[8]=o*(c*_-h*m)-u*(s*_-l*m)+R*(s*h-l*c),e[9]=-(r*(c*_-h*m)-u*(i*_-a*m)+R*(i*h-a*c)),e[10]=r*(s*_-l*m)-o*(i*_-a*m)+R*(i*l-a*s),e[11]=-(r*(s*h-l*c)-o*(i*h-a*c)+u*(i*l-a*s)),e[12]=-(o*(c*p-f*m)-u*(s*p-d*m)+R*(s*f-d*c)),e[13]=r*(c*p-f*m)-u*(i*p-n*m)+R*(i*f-n*c),e[14]=-(r*(s*p-d*m)-o*(i*p-n*m)+R*(i*d-n*s)),e[15]=r*(s*f-d*c)-o*(i*f-n*c)+u*(i*d-n*s),e},t.determinant=function(e){var t=e[0],r=e[1],i=e[2],n=e[3],a=e[4],o=e[5],s=e[6],d=e[7],l=e[8],u=e[9],c=e[10],f=e[11],h=e[12],R=e[13],m=e[14],p=e[15];return(t*o-r*a)*(c*p-f*m)-(t*s-i*a)*(u*p-f*R)+(t*d-n*a)*(u*m-c*R)+(r*s-i*o)*(l*p-f*h)-(r*d-n*o)*(l*m-c*h)+(i*d-n*s)*(l*R-u*h)},t.multiply=i,t.translate=function(e,t,r){var i=r[0],n=r[1],a=r[2],o=void 0,s=void 0,d=void 0,l=void 0,u=void 0,c=void 0,f=void 0,h=void 0,R=void 0,m=void 0,p=void 0,_=void 0;return t===e?(e[12]=t[0]*i+t[4]*n+t[8]*a+t[12],e[13]=t[1]*i+t[5]*n+t[9]*a+t[13],e[14]=t[2]*i+t[6]*n+t[10]*a+t[14],e[15]=t[3]*i+t[7]*n+t[11]*a+t[15]):(o=t[0],s=t[1],d=t[2],l=t[3],u=t[4],c=t[5],f=t[6],h=t[7],R=t[8],m=t[9],p=t[10],_=t[11],e[0]=o,e[1]=s,e[2]=d,e[3]=l,e[4]=u,e[5]=c,e[6]=f,e[7]=h,e[8]=R,e[9]=m,e[10]=p,e[11]=_,e[12]=o*i+u*n+R*a+t[12],e[13]=s*i+c*n+m*a+t[13],e[14]=d*i+f*n+p*a+t[14],e[15]=l*i+h*n+_*a+t[15]),e},t.scale=function(e,t,r){var i=r[0],n=r[1],a=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.rotate=function(e,t,r,i){var n=i[0],o=i[1],s=i[2],d=Math.sqrt(n*n+o*o+s*s),l=void 0,u=void 0,c=void 0,f=void 0,h=void 0,R=void 0,m=void 0,p=void 0,_=void 0,g=void 0,v=void 0,E=void 0,M=void 0,b=void 0,L=void 0,T=void 0,P=void 0,x=void 0,y=void 0,w=void 0,U=void 0,I=void 0,B=void 0,F=void 0;return Math.abs(d)<a.EPSILON?null:(n*=d=1/d,o*=d,s*=d,l=Math.sin(r),c=1-(u=Math.cos(r)),f=t[0],h=t[1],R=t[2],m=t[3],p=t[4],_=t[5],g=t[6],v=t[7],E=t[8],M=t[9],b=t[10],L=t[11],T=n*n*c+u,P=o*n*c+s*l,x=s*n*c-o*l,y=n*o*c-s*l,w=o*o*c+u,U=s*o*c+n*l,I=n*s*c+o*l,B=o*s*c-n*l,F=s*s*c+u,e[0]=f*T+p*P+E*x,e[1]=h*T+_*P+M*x,e[2]=R*T+g*P+b*x,e[3]=m*T+v*P+L*x,e[4]=f*y+p*w+E*U,e[5]=h*y+_*w+M*U,e[6]=R*y+g*w+b*U,e[7]=m*y+v*w+L*U,e[8]=f*I+p*B+E*F,e[9]=h*I+_*B+M*F,e[10]=R*I+g*B+b*F,e[11]=m*I+v*B+L*F,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)},t.rotateX=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[4],o=t[5],s=t[6],d=t[7],l=t[8],u=t[9],c=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+l*i,e[5]=o*n+u*i,e[6]=s*n+c*i,e[7]=d*n+f*i,e[8]=l*n-a*i,e[9]=u*n-o*i,e[10]=c*n-s*i,e[11]=f*n-d*i,e},t.rotateY=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],d=t[3],l=t[8],u=t[9],c=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-l*i,e[1]=o*n-u*i,e[2]=s*n-c*i,e[3]=d*n-f*i,e[8]=a*i+l*n,e[9]=o*i+u*n,e[10]=s*i+c*n,e[11]=d*i+f*n,e},t.rotateZ=function(e,t,r){var i=Math.sin(r),n=Math.cos(r),a=t[0],o=t[1],s=t[2],d=t[3],l=t[4],u=t[5],c=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+l*i,e[1]=o*n+u*i,e[2]=s*n+c*i,e[3]=d*n+f*i,e[4]=l*n-a*i,e[5]=u*n-o*i,e[6]=c*n-s*i,e[7]=f*n-d*i,e},t.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},t.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotation=function(e,t,r){var i=r[0],n=r[1],o=r[2],s=Math.sqrt(i*i+n*n+o*o),d=void 0,l=void 0,u=void 0;return Math.abs(s)<a.EPSILON?null:(i*=s=1/s,n*=s,o*=s,d=Math.sin(t),u=1-(l=Math.cos(t)),e[0]=i*i*u+l,e[1]=n*i*u+o*d,e[2]=o*i*u-n*d,e[3]=0,e[4]=i*n*u-o*d,e[5]=n*n*u+l,e[6]=o*n*u+i*d,e[7]=0,e[8]=i*o*u+n*d,e[9]=n*o*u-i*d,e[10]=o*o*u+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},t.fromXRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromYRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromZRotation=function(e,t){var r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.fromRotationTranslation=function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=i+i,d=n+n,l=a+a,u=i*s,c=i*d,f=i*l,h=n*d,R=n*l,m=a*l,p=o*s,_=o*d,g=o*l;return e[0]=1-(h+m),e[1]=c+g,e[2]=f-_,e[3]=0,e[4]=c-g,e[5]=1-(u+m),e[6]=R+p,e[7]=0,e[8]=f+_,e[9]=R-p,e[10]=1-(u+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},t.getScaling=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[4],o=t[5],s=t[6],d=t[8],l=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+n*n),e[1]=Math.sqrt(a*a+o*o+s*s),e[2]=Math.sqrt(d*d+l*l+u*u),e},t.getRotation=function(e,t){var r=t[0]+t[5]+t[10],i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},t.fromRotationTranslationScale=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3],d=n+n,l=a+a,u=o+o,c=n*d,f=n*l,h=n*u,R=a*l,m=a*u,p=o*u,_=s*d,g=s*l,v=s*u,E=i[0],M=i[1],b=i[2];return e[0]=(1-(R+p))*E,e[1]=(f+v)*E,e[2]=(h-g)*E,e[3]=0,e[4]=(f-v)*M,e[5]=(1-(c+p))*M,e[6]=(m+_)*M,e[7]=0,e[8]=(h+g)*b,e[9]=(m-_)*b,e[10]=(1-(c+R))*b,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e},t.fromRotationTranslationScaleOrigin=function(e,t,r,i,n){var a=t[0],o=t[1],s=t[2],d=t[3],l=a+a,u=o+o,c=s+s,f=a*l,h=a*u,R=a*c,m=o*u,p=o*c,_=s*c,g=d*l,v=d*u,E=d*c,M=i[0],b=i[1],L=i[2],T=n[0],P=n[1],x=n[2];return e[0]=(1-(m+_))*M,e[1]=(h+E)*M,e[2]=(R-v)*M,e[3]=0,e[4]=(h-E)*b,e[5]=(1-(f+_))*b,e[6]=(p+g)*b,e[7]=0,e[8]=(R+v)*L,e[9]=(p-g)*L,e[10]=(1-(f+m))*L,e[11]=0,e[12]=r[0]+T-(e[0]*T+e[4]*P+e[8]*x),e[13]=r[1]+P-(e[1]*T+e[5]*P+e[9]*x),e[14]=r[2]+x-(e[2]*T+e[6]*P+e[10]*x),e[15]=1,e},t.fromQuat=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r+r,s=i+i,d=n+n,l=r*o,u=i*o,c=i*s,f=n*o,h=n*s,R=n*d,m=a*o,p=a*s,_=a*d;return e[0]=1-c-R,e[1]=u+_,e[2]=f-p,e[3]=0,e[4]=u-_,e[5]=1-l-R,e[6]=h+m,e[7]=0,e[8]=f+p,e[9]=h-m,e[10]=1-l-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.frustum=function(e,t,r,i,n,a,o){var s=1/(r-t),d=1/(n-i),l=1/(a-o);return e[0]=2*a*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*d,e[6]=0,e[7]=0,e[8]=(r+t)*s,e[9]=(n+i)*d,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e},t.perspective=function(e,t,r,i,n){var a=1/Math.tan(t/2),o=1/(i-n);return e[0]=a/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(n+i)*o,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*n*i*o,e[15]=0,e},t.perspectiveFromFieldOfView=function(e,t,r,i){var n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),d=2/(o+s),l=2/(n+a);return e[0]=d,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(o-s)*d*.5,e[9]=(n-a)*l*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e},t.ortho=function(e,t,r,i,n,a,o){var s=1/(t-r),d=1/(i-n),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*d,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+r)*s,e[13]=(n+i)*d,e[14]=(o+a)*l,e[15]=1,e},t.lookAt=function(e,t,r,i){var n=void 0,o=void 0,s=void 0,d=void 0,l=void 0,u=void 0,c=void 0,f=void 0,h=void 0,R=void 0,m=t[0],p=t[1],_=t[2],g=i[0],v=i[1],E=i[2],M=r[0],b=r[1],L=r[2];return Math.abs(m-M)<a.EPSILON&&Math.abs(p-b)<a.EPSILON&&Math.abs(_-L)<a.EPSILON?mat4.identity(e):(c=m-M,f=p-b,h=_-L,n=v*(h*=R=1/Math.sqrt(c*c+f*f+h*h))-E*(f*=R),o=E*(c*=R)-g*h,s=g*f-v*c,(R=Math.sqrt(n*n+o*o+s*s))?(n*=R=1/R,o*=R,s*=R):(n=0,o=0,s=0),d=f*s-h*o,l=h*n-c*s,u=c*o-f*n,(R=Math.sqrt(d*d+l*l+u*u))?(d*=R=1/R,l*=R,u*=R):(d=0,l=0,u=0),e[0]=n,e[1]=d,e[2]=c,e[3]=0,e[4]=o,e[5]=l,e[6]=f,e[7]=0,e[8]=s,e[9]=u,e[10]=h,e[11]=0,e[12]=-(n*m+o*p+s*_),e[13]=-(d*m+l*p+u*_),e[14]=-(c*m+f*p+h*_),e[15]=1,e)},t.targetTo=function(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=i[0],d=i[1],l=i[2],u=n-r[0],c=a-r[1],f=o-r[2],h=u*u+c*c+f*f;h>0&&(u*=h=1/Math.sqrt(h),c*=h,f*=h);var R=d*f-l*c,m=l*u-s*f,p=s*c-d*u;return e[0]=R,e[1]=m,e[2]=p,e[3]=0,e[4]=c*p-f*m,e[5]=f*R-u*p,e[6]=u*m-c*R,e[7]=0,e[8]=u,e[9]=c,e[10]=f,e[11]=0,e[12]=n,e[13]=a,e[14]=o,e[15]=1,e},t.str=function(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"},t.frob=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2)+Math.pow(e[3],2)+Math.pow(e[4],2)+Math.pow(e[5],2)+Math.pow(e[6],2)+Math.pow(e[7],2)+Math.pow(e[8],2)+Math.pow(e[9],2)+Math.pow(e[10],2)+Math.pow(e[11],2)+Math.pow(e[12],2)+Math.pow(e[13],2)+Math.pow(e[14],2)+Math.pow(e[15],2))},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e},t.subtract=n,t.multiplyScalar=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e},t.multiplyScalarAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},t.equals=function(e,t){var r=e[0],i=e[1],n=e[2],o=e[3],s=e[4],d=e[5],l=e[6],u=e[7],c=e[8],f=e[9],h=e[10],R=e[11],m=e[12],p=e[13],_=e[14],g=e[15],v=t[0],E=t[1],M=t[2],b=t[3],L=t[4],T=t[5],P=t[6],x=t[7],y=t[8],w=t[9],U=t[10],I=t[11],B=t[12],F=t[13],D=t[14],G=t[15];return Math.abs(r-v)<=a.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(i-E)<=a.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(n-M)<=a.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(o-b)<=a.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(s-L)<=a.EPSILON*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(d-T)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(T))&&Math.abs(l-P)<=a.EPSILON*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(u-x)<=a.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(c-y)<=a.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(f-w)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(h-U)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(U))&&Math.abs(R-I)<=a.EPSILON*Math.max(1,Math.abs(R),Math.abs(I))&&Math.abs(m-B)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(p-F)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(_-D)<=a.EPSILON*Math.max(1,Math.abs(_),Math.abs(D))&&Math.abs(g-G)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(G))};var a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.mul=i,t.sub=n},function(e,t,r){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function n(){var e=new l.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function a(e,t,r){r*=.5;var i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function o(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=r[0],d=r[1],l=r[2],u=r[3];return e[0]=i*u+o*s+n*l-a*d,e[1]=n*u+o*d+a*s-i*l,e[2]=a*u+o*l+i*d-n*s,e[3]=o*u-i*s-n*d-a*l,e}function s(e,t,r,i){var n=t[0],a=t[1],o=t[2],s=t[3],d=r[0],l=r[1],u=r[2],c=r[3],f=void 0,h=void 0,R=void 0,m=void 0,p=void 0;return(h=n*d+a*l+o*u+s*c)<0&&(h=-h,d=-d,l=-l,u=-u,c=-c),1-h>1e-6?(f=Math.acos(h),R=Math.sin(f),m=Math.sin((1-i)*f)/R,p=Math.sin(i*f)/R):(m=1-i,p=i),e[0]=m*n+p*d,e[1]=m*a+p*l,e[2]=m*o+p*u,e[3]=m*s+p*c,e}function d(e,t){var r=t[0]+t[4]+t[8],i=void 0;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{var n=0;t[4]>t[0]&&(n=1),t[8]>t[3*n+n]&&(n=2);var a=(n+1)%3,o=(n+2)%3;i=Math.sqrt(t[3*n+n]-t[3*a+a]-t[3*o+o]+1),e[n]=.5*i,i=.5/i,e[3]=(t[3*a+o]-t[3*o+a])*i,e[a]=(t[3*a+n]+t[3*n+a])*i,e[o]=(t[3*o+n]+t[3*n+o])*i}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.setAxes=t.sqlerp=t.rotationTo=t.equals=t.exactEquals=t.normalize=t.sqrLen=t.squaredLength=t.len=t.length=t.lerp=t.dot=t.scale=t.mul=t.add=t.set=t.copy=t.fromValues=t.clone=void 0,t.create=n,t.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},t.setAxisAngle=a,t.getAxisAngle=function(e,t){var r=2*Math.acos(t[3]),i=Math.sin(r/2);return 0!=i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r},t.multiply=o,t.rotateX=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d+o*s,e[1]=n*d+a*s,e[2]=a*d-n*s,e[3]=o*d-i*s,e},t.rotateY=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d-a*s,e[1]=n*d+o*s,e[2]=a*d+i*s,e[3]=o*d-n*s,e},t.rotateZ=function(e,t,r){r*=.5;var i=t[0],n=t[1],a=t[2],o=t[3],s=Math.sin(r),d=Math.cos(r);return e[0]=i*d+n*s,e[1]=n*d-i*s,e[2]=a*d+o*s,e[3]=o*d-a*s,e},t.calculateW=function(e,t){var r=t[0],i=t[1],n=t[2];return e[0]=r,e[1]=i,e[2]=n,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),e},t.slerp=s,t.invert=function(e,t){var r=t[0],i=t[1],n=t[2],a=t[3],o=r*r+i*i+n*n+a*a,s=o?1/o:0;return e[0]=-r*s,e[1]=-i*s,e[2]=-n*s,e[3]=a*s,e},t.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},t.fromMat3=d,t.fromEuler=function(e,t,r,i){var n=.5*Math.PI/180;t*=n,r*=n,i*=n;var a=Math.sin(t),o=Math.cos(t),s=Math.sin(r),d=Math.cos(r),l=Math.sin(i),u=Math.cos(i);return e[0]=a*d*u-o*s*l,e[1]=o*s*u+a*d*l,e[2]=o*d*l-a*s*u,e[3]=o*d*u+a*s*l,e},t.str=function(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"};var l=i(r(0)),u=i(r(1)),c=i(r(2)),f=i(r(3)),h=(t.clone=f.clone,t.fromValues=f.fromValues,t.copy=f.copy,t.set=f.set,t.add=f.add,t.mul=o,t.scale=f.scale,t.dot=f.dot,t.lerp=f.lerp,t.length=f.length),R=(t.len=h,t.squaredLength=f.squaredLength),m=(t.sqrLen=R,t.normalize=f.normalize);t.exactEquals=f.exactEquals,t.equals=f.equals,t.rotationTo=function(){var e=c.create(),t=c.fromValues(1,0,0),r=c.fromValues(0,1,0);return function(i,n,o){var s=c.dot(n,o);return s<-.999999?(c.cross(e,t,n),c.len(e)<1e-6&&c.cross(e,r,n),c.normalize(e,e),a(i,e,Math.PI),i):s>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(c.cross(e,n,o),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+s,m(i,i))}}(),t.sqlerp=function(){var e=n(),t=n();return function(r,i,n,a,o,d){return s(e,i,o,d),s(t,n,a,d),s(r,e,t,2*d*(1-d)),r}}(),t.setAxes=function(){var e=u.create();return function(t,r,i,n){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=n[0],e[4]=n[1],e[7]=n[2],e[2]=-r[0],e[5]=-r[1],e[8]=-r[2],m(t,d(t,e))}}()},function(e,t,r){"use strict";function i(){var e=new c.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function a(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function o(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function s(e,t){var r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function d(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function l(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function u(e){var t=e[0],r=e[1];return t*t+r*r}Object.defineProperty(t,"__esModule",{value:!0}),t.forEach=t.sqrLen=t.sqrDist=t.dist=t.div=t.mul=t.sub=t.len=void 0,t.create=i,t.clone=function(e){var t=new c.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t},t.fromValues=function(e,t){var r=new c.ARRAY_TYPE(2);return r[0]=e,r[1]=t,r},t.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},t.set=function(e,t,r){return e[0]=t,e[1]=r,e},t.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e},t.subtract=n,t.multiply=a,t.divide=o,t.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},t.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},t.min=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e},t.max=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e},t.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},t.scale=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e},t.scaleAndAdd=function(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e},t.distance=s,t.squaredDistance=d,t.length=l,t.squaredLength=u,t.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},t.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},t.normalize=function(e,t){var r=t[0],i=t[1],n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),e[0]=t[0]*n,e[1]=t[1]*n),e},t.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.cross=function(e,t,r){var i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e},t.lerp=function(e,t,r,i){var n=t[0],a=t[1];return e[0]=n+i*(r[0]-n),e[1]=a+i*(r[1]-a),e},t.random=function(e,t){t=t||1;var r=2*c.RANDOM()*Math.PI;return e[0]=Math.cos(r)*t,e[1]=Math.sin(r)*t,e},t.transformMat2=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n,e[1]=r[1]*i+r[3]*n,e},t.transformMat2d=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[2]*n+r[4],e[1]=r[1]*i+r[3]*n+r[5],e},t.transformMat3=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[3]*n+r[6],e[1]=r[1]*i+r[4]*n+r[7],e},t.transformMat4=function(e,t,r){var i=t[0],n=t[1];return e[0]=r[0]*i+r[4]*n+r[12],e[1]=r[1]*i+r[5]*n+r[13],e},t.str=function(e){return"vec2("+e[0]+", "+e[1]+")"},t.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},t.equals=function(e,t){var r=e[0],i=e[1],n=t[0],a=t[1];return Math.abs(r-n)<=c.EPSILON*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-a)<=c.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))};var c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(0));t.len=l,t.sub=n,t.mul=a,t.div=o,t.dist=s,t.sqrDist=d,t.sqrLen=u,t.forEach=function(){var e=i();return function(t,r,i,n,a,o){var s,d=void 0;for(r||(r=2),i||(i=0),s=n?Math.min(n*r+i,t.length):t.length,d=i;d<s;d+=r)e[0]=t[d],e[1]=t[d+1],a(e,e,o),t[d]=e[0],t[d+1]=e[1];return t}}()}])}),function(){var e;e=function(e,t,r,i,n){var a,o;e.hasOwnProperty(r)&&RedGLUtil.throwFunc(t+" - "+r+" : 이미 정의된 속성"),n=n||{};var s=function(){return this["_"+r]};switch(i){case"hex":a={get:s,set:function(e){"string"==typeof e||RedGLUtil.throwFunc(t+" - "+r+" hex 형식만 허용함.","입력값 : "+e),RedGLUtil.regHex(e)||RedGLUtil.throwFunc(t+" - "+r+" : hex 형식만 허용함.","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"boolean":a={get:s,set:function(e){"boolean"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : boolean만 허용함.","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"number":var d=n.hasOwnProperty("min"),l=n.hasOwnProperty("max"),u=n.min,c=n.max;a={get:s,set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : 숫자만 허용함.","입력값 : "+e),d&&e<u&&(e=u),l&&e>c&&(e=c),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"uint":d=n.hasOwnProperty("min"),l=n.hasOwnProperty("max"),u=n.min,c=n.max;d&&u<0&&RedGLUtil.throwFunc(t+" - "+r+" : min옵션은 0보다 커야 함.","입력값 : "+u),l&&c<0&&RedGLUtil.throwFunc(t+" - "+r+" : max옵션은 0보다 커야 함.","입력값 : "+c),d&&l&&c<=u&&RedGLUtil.throwFunc(t+" - "+r+" : max옵션은 min옵션보다 커야 함.","min 입력값 : "+u,"max 입력값 : "+c),a={get:function(){return this["_"+r]},set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : uint만 허용함.","입력값 : "+e),d&&e<u&&(e=u),l&&e>c&&(e=c),e>=0&&Math.floor(e)==e||RedGLUtil.throwFunc(t+" - "+r+" : uint만 허용함(소수점은 허용하지 않음).","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"int":d=n.hasOwnProperty("min"),l=n.hasOwnProperty("max"),u=n.min,c=n.max;d&&l&&c<=u&&RedGLUtil.throwFunc(t+" - "+r+" : max옵션은 min옵션보다 커야 함.","min 입력값 : "+u,"max 입력값 : "+c),a={get:s,set:function(e){"number"!=typeof e&&RedGLUtil.throwFunc(t+" - "+r+" : int만 허용함.","입력값 : "+e),d&&e<u&&(e=u),l&&e>c&&(e=c),Math.floor(e)!=e&&RedGLUtil.throwFunc(t+" - "+r+" : int만 허용함(소수점은 허용하지 않음).","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this,e)}};break;case"sampler2D":o="RedBaseTexture";break;case"samplerCube":o="RedBitmapCubeTexture";break;case"samplerVideo":o="RedVideoTexture";break;default:RedGLUtil.throwFunc(r+" - type : "+i+" / "+r+" : 정의할수없는 타입입니다.")}if(o){var f=window[o];a=n.essential?{get:s,set:function(e){f==RedBitmapCubeTexture?e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e):!(e instanceof RedBitmapCubeTexture)&&e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e),this["_"+r]=e,n.callback&&n.callback.call(this)}}:{get:s,set:function(e){e&&(f==RedBitmapCubeTexture?e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e):!(e instanceof RedBitmapCubeTexture)&&e instanceof f||RedGLUtil.throwFunc(t+" - "+r+" : "+o+" Instance만 허용.","입력값 : "+e)),this["_"+r]=e,n.callback&&n.callback.call(this)}}}e["_"+r]=null,Object.defineProperty(e,r,a)},(RedDefinePropertyInfo={}).definePrototype=function(t,r,i,n){e(window[t].prototype,t,r,i,n)},RedDefinePropertyInfo.definePrototypes=function(t){for(var r,i=arguments.length;i-- >1;)r=arguments[i],e(window[t].prototype,t,r[0],r[1],r[2])},Object.freeze(RedDefinePropertyInfo)}(),(RedGLDetect=function(e){if(!(this instanceof RedGLDetect))return new RedGLDetect(e);var t,r,i,n,a,o=this,s=e.gl;for(i in t={basic:["VENDOR","VERSION","SHADING_LANGUAGE_VERSION","RENDERER"],frameBuffer:["MAX_RENDERBUFFER_SIZE","MAX_VIEWPORT_DIMS","RED_BITS","GREEN_BITS","BLUE_BITS","ALPHA_BITS","DEPTH_BITS","STENCIL_BITS"],vertexShader:["MAX_VERTEX_ATTRIBS","MAX_VARYING_VECTORS","MAX_VERTEX_UNIFORM_VECTORS"],fragmentShader:["MAX_FRAGMENT_UNIFORM_VECTORS"],texture:["MAX_TEXTURE_SIZE","MAX_CUBE_MAP_TEXTURE_SIZE","MAX_COMBINED_TEXTURE_IMAGE_UNITS","MAX_TEXTURE_IMAGE_UNITS","MAX_VERTEX_TEXTURE_IMAGE_UNITS"]})for(r=(a=t[i]).length,this[i]={};r--;)this[i][n=a[r]]=s.getParameter(s[n]);this.BROWSER_INFO=RedGLDetect.getBrowserInfo(),"ie"==this.BROWSER_INFO.browser&&(console.table=console.log),requestAnimationFrame(function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=10,t.height=20,r.fillStyle="red",r.fillRect(0,0,10,10),r.fillStyle="blue",r.fillRect(0,10,10,10),t.style.cssText="position:fixed;top:0px;left:0px";var i=RedBitmapTexture(e,t),n=s.createFramebuffer();s.bindFramebuffer(s.FRAMEBUFFER,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i.webglTexture,0);var a=new Uint8Array(4);s.readPixels(0,0,1,1,s.RGBA,s.UNSIGNED_BYTE,a),s.bindFramebuffer(s.FRAMEBUFFER,null),o.ableCanvasSourceFlipYonTexture=255===a[0],o.BROWSER_INFO.ableCanvasSourceFlipYonTexture=255===a[0]})}).BROWSER_INFO={},RedGLDetect.getBrowserInfo=function(){var e,t,r,i,n,a=RedGLDetect.BROWSER_INFO,o=window.navigator,s=o.userAgent.toLowerCase(),d=o.platform.toLowerCase(),l=o.appVersion.toLowerCase(),u="pc",c=0,f=function(){return s.indexOf("whale")<0?0:(t=parseFloat(/whale\/([\d]+)/.exec(s)[1]),e="whale")},h=function(){if(!(s.indexOf(n="chrome")<0&&s.indexOf(n="crios")<0))return e="chrome",t=parseFloat(("chrome"===n?/chrome\/([\d]+)/:/crios\/([\d]+)/).exec(s)[1])},R=function(){return s.indexOf("firefox")<0?0:(e="firefox",t=parseFloat(/firefox\/([\d]+)/.exec(s)[1]))},m=function(){return s.indexOf("safari")<0?0:(e="safari",t=parseFloat(/safari\/([\d]+)/.exec(s)[1]))},p=function(){var r;return s.indexOf(r="opera")<0&&s.indexOf(r="opr")<0?0:(e="opera",t="opera"===r?parseFloat(/version\/([\d]+)/.exec(s)[1]):parseFloat(/opr\/([\d]+)/.exec(s)[1]))},_=function(){return s.indexOf("naver")<0?0:e="naver"};if(a||(a={}),s.indexOf("android")>-1)e=r="android",u=-1===s.indexOf("mobile")?(e+="Tablet","tablet"):"mobile",i=(n=/android ([\d.]+)/.exec(s))?(n=n[1].split("."),parseFloat(n[0]+"."+n[1])):0,c=1,f()||_()||p()||h()||R()||(t=n=/safari\/([\d.]+)/.exec(s)?parseFloat(n[1]):0);else if(s.indexOf(n="ipad")>-1||s.indexOf(n="iphone")>-1)u="ipad"===n?"tablet":"mobile",e=r=n,i=(n=/os ([\d_]+)/.exec(s))?(n=n[1].split("_"),parseFloat(n[0]+"."+n[1])):0,c=1,f()||_()||p()||h()||R()||(t=(n=/mobile\/([\S]+)/.exec(s))?parseFloat(n[1]):0);else if(d.indexOf("win")>-1){for(n in g={5.1:"xp","6.0":"vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"})if(s.indexOf("windows nt "+n)>-1){i=g[n];break}r="win",(s.indexOf("edge")>-1?(s.indexOf("iemobile")>-1&&(r="winMobile"),e="edge",t=/edge\/([\d]+)/.exec(s)[1]):s.indexOf("msie")<0&&s.indexOf("trident")<0?void 0:(s.indexOf("iemobile")>-1&&(r="winMobile"),e="ie",t=s.indexOf("msie 7")>-1&&s.indexOf("trident")>-1?-1:s.indexOf("msie")<0?11:parseFloat(/msie ([\d]+)/.exec(s)[1])))||f()||p()||h()||R()||m()}else d.indexOf("mac")>-1?(r="mac",n=/os x ([\d._]+)/.exec(s)[1].replace("_",".").split("."),i=parseFloat(n[0]+"."+n[1]),f()||p()||h()||R()||m()):(r=l.indexOf("x11")>-1?"unix":l.indexOf("linux")>-1?"linux":0,f()||h()||R());for(n in g={device:u,isMobile:c,browser:e,browserVer:t,os:r,osVer:i,down:c?"touchstart":"mousedown",move:c?"touchmove":"mousemove",up:c?"touchend":"mouseup",click:"click",over:"mouseover",out:"mouseout"})g.hasOwnProperty(n)&&(a[n]=g[n]);if(window.OffscreenCanvas){var g=new window.OffscreenCanvas(2,2);try{g.getContext("2d")}catch(e){window.OffscreenCanvas=null}}return a},Object.freeze(RedGLDetect),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h;RedGLUtil={throwFunc:function(){throw"RedGL Error : "+Array.prototype.slice.call(arguments).join(" ")},isUint:function(e,t){return"number"==typeof e&&e>=0||RedGLUtil.throwFunc(t,"입력값 : "+e),Math.floor(e)===e||RedGLUtil.throwFunc(t,"입력값 : "+e),!0},hexToRGB_ZeroToOne:function(e){var t,r;if(e.indexOf("rgba")>-1&&(e=(e=(e=e.replace("rgba(","")).replace(")","")).split(","),e=RedGLUtil.rgb2hex(e[0],e[1],e[2])),/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return r=[],3===(t=e.substring(1).split("")).length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),t="0x"+t.join(""),r[0]=(t>>16&255)/255,r[1]=(t>>8&255)/255,r[2]=(255&t)/255,r;RedGLUtil.throwFunc("RedGLUtil.hexToRGB_ZeroToOne : 잘못된 hex값입니다.",e)},rgb2hex:function(e,t,r){return"#"+(16777216+(r|t<<8|e<<16)).toString(16).slice(1)},regHex:(h=/^#(?:[0-9a-fA-F]{3}){1,2}$/,function(e){return h.test(e)}),getStrFromComment:function(e){if("string"!=typeof e&&RedGLUtil.throwFunc("getStrFromComment : 해석할 값은 문자열만 가능",e),f=e.replace("@preserve","").toString().trim().match(/(\/\*)[\s\S]+(\*\/)/g))return f[0].replace(/\/\*|\*\//g,"").trim();RedGLUtil.throwFunc("getStrFromComment : 해석할 불가능한 값",e)},isPowerOf2:function(e){return 0==(e&e-1)},nextHighestPowerOfTwo:function(e){for(--e,c=1;c<32;c<<=1)e|=e>>c;return e+1},makePowerOf2Source:function(e,t,r){if(u=r,RedGLUtil.isPowerOf2(t.width)&&RedGLUtil.isPowerOf2(t.height))return t;d=RedGLUtil.nextHighestPowerOfTwo(t.width),l=RedGLUtil.nextHighestPowerOfTwo(t.height),d>u&&(d=u),l>u&&(l=u);var i=window.OffscreenCanvas?new OffscreenCanvas(d,l):document.createElement("canvas"),n=i.getContext("2d");return window.OffscreenCanvas||(i.width=d,i.height=l),n.drawImage(t,0,0,d,l),window.OffscreenCanvas?i.transferToImageBitmap():i},calculateNormals:function(e,t){var r,i,n=[],a=[];for(r=0;r<e.length;r+=3)n[r+0]=0,n[r+1]=0,n[r+2]=0,t.length||a.push(r/3);for(t.length||(t=a),r=0;r<t.length;r+=3){var o,s,d,l,u=[],c=[],f=[];for(o=3*t[r],s=3*t[r+1],d=3*t[r+2],u[0]=e[d+0]-e[s+0],u[1]=e[d+1]-e[s+1],u[2]=e[d+2]-e[s+2],c[0]=e[o+0]-e[s+0],c[1]=e[o+1]-e[s+1],c[2]=e[o+2]-e[s+2],f[0]=u[1]*c[2]-u[2]*c[1],f[1]=u[2]*c[0]-u[0]*c[2],f[2]=u[0]*c[1]-u[1]*c[0],i=0;i<3;i++)n[(l=3*t[r+i])+0]=n[l+0]+f[0],n[l+1]=n[l+1]+f[1],n[l+2]=n[l+2]+f[2]}for(r=0;r<e.length;r+=3){var h=[];h[0]=n[r+0],h[1]=n[r+1],h[2]=n[r+2];var R=Math.sqrt(h[0]*h[0]+h[1]*h[1]+h[2]*h[2]);0===R&&(R=1),h[0]=h[0]/R,h[1]=h[1]/R,h[2]=h[2]/R,n[r+0]=h[0],n[r+1]=h[1],n[r+2]=h[2]}return n},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},quaternionToRotationMat4:function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=r+r,s=i+i,d=n+n,l=r*o,u=r*s,c=r*d,f=i*s,h=i*d,R=n*d,m=a*o,p=a*s,_=a*d;return t[0]=1-(f+R),t[4]=u-_,t[8]=c+p,t[1]=u+_,t[5]=1-(l+R),t[9]=h-m,t[2]=c-p,t[6]=h+m,t[10]=1-(l+f),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},quaternionToRotation:function(e,t){var r=[],i=e[0],n=e[1],a=e[2],o=e[3],s=i+i,d=n+n,l=a+a,u=i*s,c=i*d,f=i*l,h=n*d,R=n*l,m=a*l,p=o*s,_=o*d,g=o*l;r[0]=1-(h+m),r[4]=c-g,r[8]=f+_,r[1]=c+g,r[5]=1-(u+m),r[9]=R-p,r[2]=f-_,r[6]=R+p,r[10]=1-(u+h),r[3]=0,r[7]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1;var v=[0,0,0];t=t||"XYZ";var E=r[0],M=r[4],b=r[8],L=r[1],T=r[5],P=r[9],x=r[2],y=r[6],w=r[10];return"XYZ"===t?(v[1]=Math.asin(RedGLUtil.clamp(b,-1,1)),Math.abs(b)<.99999?(v[0]=Math.atan2(-P,w),v[2]=Math.atan2(-M,E)):(v[0]=Math.atan2(y,T),v[2]=0)):"YXZ"===t?(v[0]=Math.asin(-RedGLUtil.clamp(P,-1,1)),Math.abs(P)<.99999?(v[1]=Math.atan2(b,w),v[2]=Math.atan2(L,T)):(v[1]=Math.atan2(-x,E),v[2]=0)):"ZXY"===t?(v[0]=Math.asin(RedGLUtil.clamp(y,-1,1)),Math.abs(y)<.99999?(v[1]=Math.atan2(-x,w),v[2]=Math.atan2(-M,T)):(v[1]=0,v[2]=Math.atan2(L,E))):"ZYX"===t?(v[1]=Math.asin(-RedGLUtil.clamp(x,-1,1)),Math.abs(x)<.99999?(v[0]=Math.atan2(y,w),v[2]=Math.atan2(L,E)):(v[0]=0,v[2]=Math.atan2(-M,T))):"YZX"===t?(v[2]=Math.asin(RedGLUtil.clamp(L,-1,1)),Math.abs(L)<.99999?(v[0]=Math.atan2(-P,T),v[1]=Math.atan2(-x,E)):(v[0]=0,v[1]=Math.atan2(b,w))):"XZY"===t&&(v[2]=Math.asin(-RedGLUtil.clamp(M,-1,1)),Math.abs(M)<.99999?(v[0]=Math.atan2(y,T),v[1]=Math.atan2(b,E)):(v[0]=Math.atan2(-P,w),v[1]=0)),v},mat4ToEuler:function(e,t,r){t=t||[0,0,0],r=r||"XYZ";var i=e[0],n=e[4],a=e[8],o=e[1],s=e[5],d=e[9],l=e[2],u=e[6],c=e[10];return"XYZ"===r?(t[1]=Math.asin(RedGLUtil.clamp(a,-1,1)),Math.abs(a)<.99999?(t[0]=Math.atan2(-d,c),t[2]=Math.atan2(-n,i)):(t[0]=Math.atan2(u,s),t[2]=0)):"YXZ"===r?(t[0]=Math.asin(-RedGLUtil.clamp(d,-1,1)),Math.abs(d)<.99999?(t[1]=Math.atan2(a,c),t[2]=Math.atan2(o,s)):(t[1]=Math.atan2(-l,i),t[2]=0)):"ZXY"===r?(t[0]=Math.asin(RedGLUtil.clamp(u,-1,1)),Math.abs(u)<.99999?(t[1]=Math.atan2(-l,c),t[2]=Math.atan2(-n,s)):(t[1]=0,t[2]=Math.atan2(o,i))):"ZYX"===r?(t[1]=Math.asin(-RedGLUtil.clamp(l,-1,1)),Math.abs(l)<.99999?(t[0]=Math.atan2(u,c),t[2]=Math.atan2(o,i)):(t[0]=0,t[2]=Math.atan2(-n,s))):"YZX"===r?(t[2]=Math.asin(RedGLUtil.clamp(o,-1,1)),Math.abs(o)<.99999?(t[0]=Math.atan2(-d,s),t[1]=Math.atan2(-l,i)):(t[0]=0,t[1]=Math.atan2(a,c))):"XZY"===r&&(t[2]=Math.asin(-RedGLUtil.clamp(n,-1,1)),Math.abs(n)<.99999?(t[0]=Math.atan2(u,s),t[1]=Math.atan2(a,i)):(t[0]=Math.atan2(-d,c),t[1]=0)),t},screenToWorld:(a=[0,0,0],o=mat4.create(),s=mat4.create(),function(d,l){return e=2*d[0]/d[2]-1,t=-2*d[1]/d[3]+1,l=l.camera?l.camera:l,mat4.multiply(s,l.perspectiveMTX,l.matrix),n=mat4.clone(s),mat4.invert(n,n),a=[e,t,1],mat4.identity(o),mat4.translate(o,o,a),mat4.multiply(n,n,o),a[0]=n[12],a[1]=n[13],a[2]=n[14],0!==(r=s[12]*e+s[13]*t+s[15])&&(i=1/r,a[0]/=i,a[1]/=i,a[2]/=i,a[0]=a[0]+l.x,a[1]=a[1]+l.y,a[2]=a[2]+l.z),a})},Object.freeze(RedGLUtil)}(),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f=[];window.addEventListener("resize",function(){f.forEach(function(e){e.setSize(e._width,e._height)})}),a={alpha:!1,depth:!0,stencil:!1,antialias:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1},u=["OES_element_index_uint","OES_standard_derivatives","EXT_texture_filter_anisotropic","WEBGL_compressed_texture_s3tc","WEBGL_debug_renderer_info"],i="webkit-3d,moz-webgl,3d,experimental-webgl,webgl".split(","),n=[],e=function(e,t,r){if(l=JSON.parse(JSON.stringify(a)),t)for(d in t)l[d]=t[d];for(r?(n.length=0,n.push(r)):n=i.concat(),d=n.length;d--;)if(o=e.getContext(s=n[d],l))return o.glExtension={},u.forEach(function(e){o.glExtension[e]=o.getExtension(e),o.glExtension[e]&&"WEBGL_debug_renderer_info"===e&&(o.vendor=o.getParameter(o.glExtension[e].UNMASKED_VENDOR_WEBGL),o.renderer=o.getParameter(o.glExtension[e].UNMASKED_RENDERER_WEBGL))}),o.version=s,o;return null},t=function(e,t){var r,i,n,a;for(r=e.detect.texture.MAX_COMBINED_TEXTURE_IMAGE_UNITS,a=RedBaseTexture.EMPTY_BASE64,i=RedBitmapTexture(e,a),n=RedBitmapCubeTexture(e,[a,a,a,a,a,a]),e._datas.emptyTexture={"2d":i,"3d":n};r--;)1===r?(t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_CUBE_MAP,n.webglTexture)):(t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,i.webglTexture))},(RedGL=function(i,n,a,o){return this instanceof RedGL?("CANVAS"===i.tagName||RedGLUtil.throwFunc("RedGL : Canvas Element만 허용"),d=this,this._datas={},this._width="100%",this._height="100%",this._renderScale=1,this._viewRect=[0,0,0,0],this._canvas=i,this.gl=s=e(i,a,o),s?(this.detect=RedGLDetect(this),this._UUID=RedGL.makeUUID(),this.setSize=(p=new Uint32Array(2),_=new Uint32Array(2),c=0,h=0,function(e,t,r){void 0===e&&RedGLUtil.throwFunc("RedGL setSize : width가 입력되지 않았습니다."),void 0===t&&RedGLUtil.throwFunc("RedGL setSize : height가 입력되지 않았습니다."),l=this._width=e,u=this._height=t,window.HTMLCanvasElement?("number"!=typeof l&&(l.indexOf("%")>-1?l=(document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)*parseFloat(l)/100:RedGLUtil.throwFunc("RedGL setSize : width는 0이상의 숫자나 %만 허용.","입력값 :",l)),"number"!=typeof u&&(u.indexOf("%")>-1?u=window.innerHeight*parseFloat(u)/100:RedGLUtil.throwFunc("RedGL setSize : height는 0이상의 숫자나 %만 허용.","입력값 :",u)),R=window.devicePixelRatio||1,m=this._canvas,(c!=l||h!=u||r)&&(m.width=l*R*this._renderScale,m.height=u*R*this._renderScale,m.style.width=l+"px",m.style.height=u+"px",c=l,h=u),this._viewRect[2]=c,this._viewRect[3]=h):(l=this._width=e,u=this._height=t,p[0]=l*this._renderScale,_[0]=u*this._renderScale,this._viewRect[2]=l,this._viewRect[3]=u)}),RedSystemShaderCode.init&&RedSystemShaderCode.init(d),t(d,s),f.push(d),void requestAnimationFrame(function(){r||(RedPBRMaterial_System(d),RedStandardMaterial(d,d._datas.emptyTexture["2d"]),RedEnvironmentMaterial(d,null,d._datas.emptyTexture["3d"])),d._mouseEventInfo=[],[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up].forEach(function(e){var t,r;"ie"===RedGLDetect.BROWSER_INFO.browser&&RedGLDetect.BROWSER_INFO.browserVer,t="offsetX",r="offsetY",d._canvas.addEventListener(e,function(e){e.preventDefault(),RedGLDetect.BROWSER_INFO.isMobile?e.changedTouches[0]&&(d._mouseEventInfo.push({type:e.type,x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY,nativeEvent:e}),d._mouseX=e.changedTouches[0].clientX,d._mouseY=e.changedTouches[0].clientY):(d._mouseEventInfo.push({type:e.type,x:e[t],y:e[r],nativeEvent:e}),d._mouseX=e[t],d._mouseY=e[r])},!1)}),d.setSize(d._width,d._height),n&&n.call(d,!0)})):n?n.call(d,!1):void 0):new RedGL(i,n,a,o);var s,d,l,u,c,h,R,m,p,_}).makeUUID=(c=0,function(){return c++}),RedGL.prototype={},RedDefinePropertyInfo.definePrototype("RedGL","renderScale","number",{min:.1,max:1,callback:function(){this.setSize(this._width,this._height,!0)}}),RedGL.setDoNotPrepareProgram=function(){r=!0},Object.freeze(RedGL)}(),function(){var e,t,r,i,n,a={x:0,y:0},o={x:0,y:0},s=[];n=function(n,d){return RedGLDetect.BROWSER_INFO.isMobile?n.changedTouches?(o.x=n.changedTouches[0].clientX,o.y=n.changedTouches[0].clientY):(o.x=a.x,o.y=a.y):(o.x=n.clientX,o.y=n.clientY),t=o.x-a.x,r=o.y-a.y,s=[a.x,a.y,t,r],t<0&&(s[2]=Math.abs(t),s[0]+=t),r<0&&(s[3]=Math.abs(r),s[1]+=r),e.style.left=s[0]+"px",e.style.top=s[1]+"px",e.style.width=s[2]+"px",e.style.height=s[3]+"px",i(d.scene,d,s)},i=function(e,t,r,n){return n||(n={selectList:[],unSelectList:[]}),e.children.forEach(function(e){var a=e.getScreenPoint(t);r[0]<=a[0]&&r[1]<=a[1]&&r[0]+r[2]>=a[0]&&r[1]+r[3]>=a[1]?n.selectList.push(e):n.unSelectList.push(e),i(e,t,r,n)}),n},RedBoxSelection=function(t,r,i){return this instanceof RedBoxSelection?(t instanceof RedGL||RedGLUtil.throwFunc("RedBoxSelection : RedGL Instance만 허용.",t),r instanceof RedView||RedGLUtil.throwFunc("RedBoxSelection : RedView Instance만 허용.",r),t._datas.RedBoxSelection?this:(t._datas.RedBoxSelection=this,void[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up].forEach(function(s){var d;d=function(e){var t=n(e,r);i&&i(t)},t._canvas.addEventListener(s,function(t){t.type===RedGLDetect.BROWSER_INFO.down&&(o.x=a.x=RedGLDetect.BROWSER_INFO.isMobile?t.changedTouches[0].clientX:t.clientX,o.y=a.y=RedGLDetect.BROWSER_INFO.isMobile?t.changedTouches[0].clientY:t.clientY,e||((e=document.createElement("div")).style.cssText="position:fixed;border:1px dashed red;z-index:0"),e.style.left="0px",e.style.top="0px",e.style.width="0px",e.style.height="0px",document.body.appendChild(e),r.camera&&r.camera.camera&&(r.camera.needUpdate=!1),d({}),window.addEventListener(RedGLDetect.BROWSER_INFO.move,d),window.addEventListener(RedGLDetect.BROWSER_INFO.isMobile?"touchend":"click",function(){r.camera.camera&&(r.camera.needUpdate=!0),e.parentNode&&document.body.removeChild(e),window.removeEventListener(RedGLDetect.BROWSER_INFO.move,d)}))})}))):new RedBoxSelection(t,r,i)}}(),(RedBaseController=function(){if(!(this instanceof RedBaseController))return new RedBaseController}).prototype={update:function(){RedGLUtil.throwFunc("RedBaseController : update - 재정의 해서 써라")}},Object.freeze(RedBaseController),function(){var e=function(e,t){return createImageBitmap(e,t||{imageOrientation:"none"})};RedImageLoader=function(t,r,i,n){var a,o,s,d,l=this;if(!(this instanceof RedImageLoader))return new RedImageLoader(t,r,i,n);("string"!=typeof t&&RedGLUtil.throwFunc("RedImageLoader : src는 문자열 만 허용.","입력값 : "+t),l._src=t,l._onLoad=r,l._onError=i,window&&window.document)?(d=function(e){e.removeEventListener("error",s),e.removeEventListener("load",o)},s=function(e){d(this),l._onError&&l._onError(e)},o=function(e){d(this),l.source=a,l._onLoad&&l._onLoad(e)},(a=new Image).crossOrigin="anonymous",a.src=t,a.addEventListener("error",s),a.addEventListener("load",o)):2===t.split(",").length&&"data:"===t.substr(0,5)?e(function(e,t){t=t||"";for(var r=atob(e),i=r.length,n=Math.ceil(i/1024),a=new Array(n),o=0;o<n;++o){for(var s=1024*o,d=Math.min(s+1024,i),l=new Array(d-s),u=s,c=0;u<d;++c,++u)l[c]=r[u].charCodeAt(0);a[o]=new Uint8Array(l)}return new Blob(a,{type:t})}(t.split(",")[1],"image/png"),n||{}).then(function(e){e.src=t,l.source=e,l._onLoad&&(l._onLoad(e),l._onLoad=void 0,l._onError=void 0)}):function(t,r,i,n){var a=this,o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="blob",o.onreadystatechange=function(){4===o.readyState&&(200===o.status?e(o.response,n||{imageOrientation:"none"}).then(function(e){e.src=t,a.source=e,a._onLoad&&(a._onLoad(o),a._onLoad=void 0,a._onError=void 0)}).catch(function(){a._onError&&(a._onError(o),a._onLoad=void 0,a._onError=void 0)}):a._onError&&(a._onError(o),a._onLoad=void 0,a._onError=void 0))},o.send()}.apply(l,[l._src,r,i,n])},Object.freeze(RedImageLoader)}(),function(){var e;(RedBaseTexture=function(){}).EMPTY_BASE64="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYxIDY0LjE0MDk0OSwgMjAxMC8xMi8wNy0xMDo1NzowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNS4xIFdpbmRvd3MiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NzMxRDhBQzRFNUZFMTFFN0IxMDVGNEEzQjQ0RjAwRDIiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NzMxRDhBQzVFNUZFMTFFN0IxMDVGNEEzQjQ0RjAwRDIiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo3MzFEOEFDMkU1RkUxMUU3QjEwNUY0QTNCNDRGMDBEMiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo3MzFEOEFDM0U1RkUxMUU3QjEwNUY0QTNCNDRGMDBEMiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PuojYFUAAAAQSURBVHjaYvj//z8DQIABAAj8Av7bok0WAAAAAElFTkSuQmCC",RedImageLoader(RedBaseTexture.EMPTY_BASE64),RedBaseTexture.prototype={setEmptyTexture:(e=new Uint8Array([0,0,0,0]),function(t,r){this instanceof RedBitmapCubeTexture?(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,r),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_CUBE_MAP,null)):(t.activeTexture(t.TEXTURE0+0),t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,2,2,0,t.LUMINANCE,t.UNSIGNED_BYTE,new Uint8Array([128,64,0,192])),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.generateMipmap(t.TEXTURE_2D),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.bindTexture(t.TEXTURE_2D,null))}),_load:function(){RedGLUtil.throwFunc("RedBaseTexture - _load : 반드시 재정의해야함")},src:function(){RedGLUtil.throwFunc("RedBaseTexture - src : 반드시 재정의해야함")},dispose:function(){this.webglTexture&&this._src!=RedBaseTexture.EMPTY_BASE64&&(this.webglTexture.gl.deleteTexture(this.webglTexture),this.webglTexture=null)}},Object.defineProperty(RedBaseTexture.prototype,"callback",{get:function(){return this._callback},set:function(e){e&&"function"!=typeof e&&RedGLUtil.throwFunc("RedBaseTexture : callback은 함수만 허용.","입력값 :",e),this._callback=e}}),Object.freeze(RedBaseTexture)}(),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h;(RedBaseObject3D=function(){if(!(this instanceof RedBaseObject3D))return new RedBaseObject3D}).build=function(e){this.name="object3D_"+(RedGL.makeUUID()+1),this.useTransparentSort=!1,this.useCullFace=!0,this.cullFace=e.BACK,this.useDepthMask=!0,this.useDepthTest=!0,this.depthTestFunc=e.LEQUAL,this.useBlendMode=!0,this.blendSrc=e.SRC_ALPHA,this.blendDst=e.ONE_MINUS_SRC_ALPHA,this.drawMode=e.TRIANGLES,this.pointSize=1,this.x=this.y=this.z=0,this.rotationX=this.rotationY=this.rotationZ=0,this.scaleX=this.scaleY=this.scaleZ=1,this.pivotX=0,this.pivotY=0,this.pivotZ=0,this.autoUpdateMatrix=!0,this._renderAutoUpdateMatrix=!0,this.matrix=mat4.create(),this.localMatrix=mat4.create(),this.normalMatrix=mat4.create(),this.children=[],this.useLOD=!1,this._lodLevels=[],this._mouseColorMaterial=null,this._mouseColorID=new Float32Array([parseInt(255*Math.random()),parseInt(255*Math.random()),parseInt(255*Math.random()),255]),this.outlineThickness=0,this._outlineAlpha=1,this._outlineColor=new Float32Array(4),this.outlineColor="#ff0000",this._filterList=[]},RedBaseObject3D.prototype={addFilter:function(e){e instanceof RedBaseFilter||RedGLUtil.throwFunc("RedFilterEffectManager : addFilter - RedBaseFilter Instance만 허용.","입력값 : "+e),this._filterList.push(e)},removeFilter:function(e){-1!=(s=this._filterList.indexOf(e))&&this._filterList.splice(s,1)},removeAllFilter:function(){this._filterList.length=0},addLOD:function(e,t,r,i){for(r||i||RedGLUtil.throwFunc("RedBaseObject3D - addLOD : geometry, material 둘중하나는 반드시 입력되어야함"),RedGLUtil.isUint(e)||RedGLUtil.throwFunc("RedBaseObject3D - addLOD : level은 uint만 허용함"),e>4&&RedGLUtil.throwFunc("RedBaseObject3D - addLOD : level은 0~4 level 까지 허용함"),n={level:e,distance:t,geometry:r||this.geometry,material:i||this.material},o=this._lodLevels.length,a=!0;o--;)this._lodLevels[o].level==e&&(this._lodLevels[o]=n,a=!1);a&&this._lodLevels.push(n)},removeLOD:function(e){RedGLUtil.isUint(e)||RedGLUtil.throwFunc("RedBaseObject3D - removeLOD : level : uint만 허용함");for(var t=this._lodLevels.length;t--;)if(this._lodLevels[t].level==e){this._lodLevels.splice(t,1);break}},localToWorld:function(){var e;return e=mat4.create(),function(t,r,i){return"number"==typeof t||RedGLUtil.throwFunc("RedBaseObject3D - localToWorld : x - number만 허용함","입력값 : ",t),"number"==typeof r||RedGLUtil.throwFunc("RedBaseObject3D - localToWorld : y - number만 허용함","입력값 : ",r),"number"==typeof i||RedGLUtil.throwFunc("RedBaseObject3D - localToWorld : z - number만 허용함","입력값 : ",i),t=t||0,r=r||0,i=i||0,mat4.identity(e),mat4.translate(e,e,[t,r,i]),mat4.multiply(e,this.matrix,e),[e[12],e[13],e[14]]}}(),worldToLocal:function(){var e,t;return e=mat4.create(),t=mat4.create(),function(r,i,n){return"number"==typeof r||RedGLUtil.throwFunc("RedBaseObject3D - worldToLocal : x - number만 허용함","입력값 : ",r),"number"==typeof i||RedGLUtil.throwFunc("RedBaseObject3D - worldToLocal : y - number만 허용함","입력값 : ",i),"number"==typeof n||RedGLUtil.throwFunc("RedBaseObject3D - worldToLocal : z - number만 허용함","입력값 : ",n),r=r||0,i=i||0,n=n||0,mat4.translate(e,e,[r,i,n]),mat4.multiply(t,e,this.matrix),[t[0]*r+t[1]*i+t[2]*n+t[3],t[4]*r+t[5]*i+t[6]*n+t[7],t[8]*r+t[9]*i+t[10]*n+t[11]]}}(),getScreenPoint:(i=mat4.create(),r={x:0,y:0,z:0,w:0},function(n){return mat4.identity(i),n instanceof RedView||RedGLUtil.throwFunc("RedBaseObject3D - getScreenPoint : redView - RedView Instance 만 허용함","입력값 : ",n),e=n.camera,t=n._viewRect,e instanceof RedBaseController&&(e=e.camera),mat4.multiply(i,e.perspectiveMTX,e.matrix),mat4.multiply(i,i,this.matrix),r.x=i[12],r.y=i[13],r.z=i[14],r.w=i[15],r.x=.5*r.x/r.w+.5,r.y=.5*r.y/r.w+.5,[(t[0]+r.x*t[2])/window.devicePixelRatio,(t[1]+(1-r.y)*t[3])/window.devicePixelRatio]}),disposeAll:function(){this.disposeAllTexture(),this.disposeAllBuffer()},disposeAllTexture:function(){this.material&&this.material.disposeAllTexture()},disposeTexture:function(e){this.material&&this.material.disposeTexture(e)},disposeAllBuffer:function(){this.geometry&&this.geometry.disposeAllBuffer()},disposeBuffer:function(e){this.geometry&&this.geometry.disposeBuffer(e)}},u=function(e){var t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p,_=e.matrix,g=e.geometry.interleaveBuffer.stride;for(t=r=i=n=a=o=0,u=e.geometry.interleaveBuffer.data,c=0,f=e.geometry.interleaveBuffer.pointNum;c<f;c++)d=1+(s=c*g),l=s+2,t=(h=_[0]*u[s]+_[4]*u[d]+_[8]*u[l])<t?h:t,n=h>n?h:n,r=(R=_[1]*u[s]+_[5]*u[d]+_[9]*u[l])<r?R:r,a=R>a?R:a,i=(m=_[2]*u[s]+_[6]*u[d]+_[10]*u[l])<i?m:i,o=m>o?m:o;return(p=[n-t,a-r,o-i]).minX=t,p.maxX=n,p.minY=r,p.maxY=a,p.minZ=i,p.maxZ=o,p},d=function(e){var t=u(e),r=mat4.create();return mat4.translate(r,r,e.localToWorld(0,0,0)),mat4.scale(r,r,t),{worldMatrix:r,volume:t}},l=function(e){var t=e.geometry.volume,r=mat4.create();return mat4.translate(r,r,e.localToWorld(0,0,0)),mat4.rotateX(r,r,-e.rotationX*Math.PI/180),mat4.rotateY(r,r,-e.rotationY*Math.PI/180),mat4.rotateZ(r,r,-e.rotationZ*Math.PI/180),mat4.scale(r,r,t),mat4.scale(r,r,[e.scaleX,e.scaleY,e.scaleZ]),{worldMatrix:r,volume:u(e)}},RedBaseObject3D.prototype.volumeCalculateAABB=function(){return this.volumeInfo=d(this)},RedBaseObject3D.prototype.volumeCalculateOBB=function(){return this.volumeInfo=l(this)},RedBaseObject3D.prototype.lookAt=(c=new Float32Array([0,1,0]),f=[],h=[],function(e,t,r){f[0]=e,f[1]=t,f[2]=r,mat4.identity(this.matrix),mat4.targetTo(this.matrix,[this.x,this.y,this.z],f,c),h=RedGLUtil.mat4ToEuler(this.matrix,[]),this.rotationX=180*-h[0]/Math.PI,this.rotationY=180*-h[1]/Math.PI,this.rotationZ=180*-h[2]/Math.PI}),Object.defineProperty(RedBaseObject3D.prototype,"geometry",{get:function(){return this._geometry},set:function(e){!e||e instanceof RedGeometry||RedGLUtil.throwFunc("geometry : RedGeometry Instance만 허용.","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedBaseObject3D.prototype,"material",{get:function(){return this._material},set:function(e){!e||e instanceof RedBaseMaterial||RedGLUtil.throwFunc("material : RedBaseMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.defineProperty(RedBaseObject3D.prototype,"outlineColor",{get:function(){return this._outlineColorHex},set:function(){var e;return function(t){this._outlineColorHex=t||"#ff0000",e=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._outlineColorHex),this._outlineColor[0]=e[0],this._outlineColor[1]=e[1],this._outlineColor[2]=e[2],this._outlineColor[3]=this._outlineAlpha}}()}),RedDefinePropertyInfo.definePrototype("RedBaseObject3D","outlineAlpha","number",{min:0,max:1,callback:function(e){this._outlineColor[3]=this._outlineAlpha=e}}),Object.freeze(RedBaseObject3D)}(),function(){var e,t;(e=(RedBaseContainer=function(){if(!(this instanceof RedBaseContainer))return new RedBaseContainer;this.children=[]}).prototype=new RedBaseObject3D).addChild=function(e){e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addChild","RedBaseObject3D Instance만 가능","입력값 : "+e),this.children.indexOf(e)>-1&&this.removeChild(e),this.children.push(e)},e.addChildAt=function(e,t){RedGLUtil.isUint(t,"addChildAt : index는 uint만 입력가능"),e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addChildAt","RedBaseObject3D Instance만 가능","입력값 : "+e),this.children.indexOf(e)>-1&&this.removeChild(e),this.children.length<t&&(t=this.children.length),null!=t?this.children.splice(t,0,e):this.children.push(e)},e.removeChild=function(e){-1==(t=this.children.indexOf(e))?RedGLUtil.throwFunc("removeChild","존재하지 않는 RedMesh를 삭제하려고 함"):this.children.splice(t,1)},e.removeChildAt=function(e){RedGLUtil.isUint(e,"removeChildAt : index는 uint만 입력가능"),this.children[e]?this.children.splice(e,1):RedGLUtil.throwFunc("removeChildAt","index 해당인덱스에 위치한 자식이 없음.","입력값 : "+e)},e.removeChildAll=function(){this.children.length=0},e.getChildAt=function(e){return RedGLUtil.isUint(e,"getChildAt : index는 uint만 입력가능"),this.children[e]},e.getChildIndex=function(e){return this.children.indexOf(e)},e.numChildren=function(){return this.children.length},e.sortGeometry=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortGeometry&&this.children[t].sortGeometry(e);this.children.sort(function(e,t){if(e._geometry&&t._geometry){if((e=e._geometry.interleaveBuffer._UUID)<(t=t._geometry.interleaveBuffer._UUID))return-1;if(e>t)return 1}return 0})},e.sortMaterial=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortMaterial&&this.children[t].sortMaterial(e);this.children.sort(function(e,t){if(e._geometry&&t._geometry){if((e=e._material.program._UUID)<(t=t._material.program._UUID))return-1;if(e>t)return 1}return 0})},e.sortGeometryAndMaterial=function(e){if(e)for(var t=this.children.length;t--;)this.children[t].sortGeometryAndMaterial&&this.children[t].sortGeometryAndMaterial(e);this.children.sort(function(e,t){if(e._geometry&&t._geometry){if((e=e._geometry.interleaveBuffer._UUID)==(t=t._geometry.interleaveBuffer._UUID)){var r=e._material.program._UUID,i=t._material.program._UUID;return r<i?-1:r>i?1:0}if(e<t)return-1;if(e>t)return 1}return 0})},Object.freeze(RedBaseContainer)}(),function(){var e;(RedBaseLight=function(){if(!(this instanceof RedBaseLight))return new RedBaseLight}).prototype={},RedDefinePropertyInfo.definePrototypes("RedBaseLight",["intensity","number",{min:0}],["alpha","number",{min:0,max:1,callback:function(e){this._lightColor[3]=this._alpha=e}}],["color","hex",{callback:function(){e=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._color),this._lightColor[0]=e[0],this._lightColor[1]=e[1],this._lightColor[2]=e[2],this._lightColor[3]=this._alpha}}]),Object.freeze(RedBaseLight)}(),(RedFrameBuffer=function(e,t,r){if(!(this instanceof RedFrameBuffer))return new RedFrameBuffer(e,t,r);var i;e instanceof RedGL||RedGLUtil.throwFunc("RedFrameBuffer : RedGL Instance만 허용.",e),t&&("number"==typeof t||RedGLUtil.throwFunc("RedFrameBuffer : width - 숫자만 허용","입력값 : ",t)),r&&("number"==typeof r||RedGLUtil.throwFunc("RedFrameBuffer : height - 숫자만 허용","입력값 : ",r)),i=e.gl,r=r||1080,(t=t||1920)>e.detect.texture.MAX_TEXTURE_SIZE&&(t=e.detect.texture.MAX_TEXTURE_SIZE),r>e.detect.texture.MAX_TEXTURE_SIZE&&(r=e.detect.texture.MAX_TEXTURE_SIZE),this.redGL=e,this.width=t,this.height=r,this.webglFrameBuffer=i.createFramebuffer(),this.webglRenderBuffer=i.createRenderbuffer(),this.texture=RedBitmapTexture(e),this._UUID=RedGL.makeUUID(),i.bindFramebuffer(i.FRAMEBUFFER,this.webglFrameBuffer),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture.webglTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.bindRenderbuffer(i.RENDERBUFFER,this.webglRenderBuffer),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT16,this.width,this.height),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture.webglTexture,0),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,this.webglRenderBuffer),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}).prototype={bind:function(e){e.bindFramebuffer(e.FRAMEBUFFER,this.webglFrameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture.webglTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.width,this.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindRenderbuffer(e.RENDERBUFFER,this.webglRenderBuffer),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.width,this.height),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.texture.webglTexture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this.webglRenderBuffer)},unbind:function(e){e.bindTexture(e.TEXTURE_2D,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null)}},RedDefinePropertyInfo.definePrototypes("RedFrameBuffer",["width","number",{min:2}],["height","number",{min:2}]),Object.freeze(RedFrameBuffer),function(){var e,t,r;e=function(e,t,r){switch(t){case RedBuffer.ARRAY_BUFFER:if(r instanceof Float32Array)return e.FLOAT;if(r instanceof Float64Array)return e.FLOAT;RedGLUtil.throwFunc("RedBuffer : 올바른 TypedArray(RedBuffer.ARRAY_BUFFER)형식을 사용해야합니다.","입력값 : "+r);break;case RedBuffer.ELEMENT_ARRAY_BUFFER:if(r instanceof Int8Array)return e.BYTE;if(r instanceof Int16Array)return e.SHORT;if(r instanceof Int32Array)return e.INT;if(r instanceof Uint8Array)return e.UNSIGNED_BYTE;if(r instanceof Uint16Array)return e.UNSIGNED_SHORT;if(r instanceof Uint32Array)return e.UNSIGNED_INT;RedGLUtil.throwFunc("RedBuffer : 올바른 TypedArray(RedBuffer.ELEMENT_ARRAY_BUFFER)형식을 사용해야합니다.","입력값 : "+r);break;default:RedGLUtil.throwFunc("RedBuffer : bufferType - 지원하지 않는 버퍼타입입니다. ","입력값 : "+t)}},t=function(e,t){switch(t){case RedBuffer.ARRAY_BUFFER:return e.ARRAY_BUFFER;case RedBuffer.ELEMENT_ARRAY_BUFFER:return e.ELEMENT_ARRAY_BUFFER;default:RedGLUtil.throwFunc("RedBuffer : bufferType - 지원하지 않는 버퍼타입입니다. ")}},r=function(e,t,r,i){var n,a,o,s,d;switch(r instanceof Float32Array?d=Float32Array.BYTES_PER_ELEMENT:r instanceof Float64Array&&(d=Float64Array.BYTES_PER_ELEMENT),n=0,t){case RedBuffer.ARRAY_BUFFER:if(e.interleaveDefineInfoList=i,i){for(i.length||RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList의 정보는 1개이상의 RedInterleaveInfo Instance로 구성되어야함.",i),a=0,o=i.length;a<o;a++)(s=i[a])instanceof RedInterleaveInfo||RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList의 정보는 RedInterleaveInfo Instance로만 구성되어야함.",i),s.offset=o<2?0:n,s.offset_BYTES_PER_ELEMENT=o<2?0:n*d,n+=s.size,s._UUID=RedGL.makeUUID(),i[s.attributeKey]=s;o<2?(e.stride=0,e.stride_BYTES_PER_ELEMENT=0,e.pointNum=r.length/3):(e.stride=n,e.stride_BYTES_PER_ELEMENT=n*d,e.pointNum=r.length/n),e.pointNum!==parseInt(e.pointNum)&&RedGLUtil.throwFunc("RedBuffer : ARRAY_BUFFER의 pointNum이 정수로 떨어지지 않음. 데이터구성과 interleaveDefineInfoList 구성 확인 필요")}else RedGLUtil.throwFunc("RedBuffer : interleaveDefineInfoList는 반드시 정의 되어야함.");break;case RedBuffer.ELEMENT_ARRAY_BUFFER:e.pointNum=r.length}},(RedBuffer=function(i,n,a,o,s,d){if(!(this instanceof RedBuffer))return new RedBuffer(i,n,a,o,s,d);i instanceof RedGL||RedGLUtil.throwFunc("RedBuffer : RedGL Instance만 허용.",i),"string"==typeof n||RedGLUtil.throwFunc("RedBuffer : key - 문자열만 허용.","입력값 : "+n),a||RedGLUtil.throwFunc("RedBuffer : bufferType : 미입력, 반드시 입력해야함."),a===RedBuffer.ARRAY_BUFFER||a===RedBuffer.ELEMENT_ARRAY_BUFFER||RedGLUtil.throwFunc("RedBuffer : bufferType - RedBuffer.ARRAY_BUFFER or RedBuffer.ELEMENT_ARRAY_BUFFER 만 허용함.","입력값 : "+a);var l=i.gl;if(i._datas.RedBuffer||(i._datas.RedBuffer={},i._datas.RedBuffer[RedBuffer.ARRAY_BUFFER]={},i._datas.RedBuffer[RedBuffer.ELEMENT_ARRAY_BUFFER]={}),i._datas.RedBuffer[a][n])return i._datas.RedBuffer[a][n];i._datas.RedBuffer[a][n]=this,a!==RedBuffer.ARRAY_BUFFER||s||RedGLUtil.throwFunc("RedBuffer : 신규생성시 interleaveDefineInfoList를 반드시 정의해야합니다.","입력값 : "+s),this.key=n,this.data=o,this.bufferType=a,this.glBufferType=t(l,this.bufferType),this.glArrayType=e(l,this.bufferType,this.data),this.drawMode=d||l.STATIC_DRAW,r(this,this.bufferType,this.data,s),this.webglBuffer=l.createBuffer(),this.webglBuffer.gl=l,this.webglBuffer.redGL=i,this._UUID=RedGL.makeUUID(),this.upload=function(t){this.glArrayType===e(l,a,t)?(this.data=t,l.bindBuffer(this.glBufferType,this.webglBuffer),l.bufferData(this.glBufferType,this.data,this.drawMode),r(this,this.bufferType,this.data,this.interleaveDefineInfoList),this.bufferType===RedBuffer.ARRAY_BUFFER&&(this.triangleNum=this.data.length/(this.stride?this.stride:3)),this.bufferType===RedBuffer.ELEMENT_ARRAY_BUFFER&&(this.triangleNum=this.pointNum/3)):RedGLUtil.throwFunc("RedBuffer : upload - data형식이 기존 형식과 다름",t)},this.upload(this.data)}).prototype.dispose=function(){this.webglBuffer&&!this.isPrimitiveBuffer&&(this.webglBuffer.gl.deleteBuffer(this.webglBuffer),delete this.webglBuffer.redGL._datas.RedBuffer[this.bufferType][this.key],this.webglBuffer=null)},RedBuffer.ARRAY_BUFFER="arrayBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER="elementArrayBuffer",Object.freeze(RedBuffer)}(),function(){var e,t;(RedGeometry=function(e,t){if(!(this instanceof RedGeometry))return new RedGeometry(e,t);this._UUID=RedGL.makeUUID(),e instanceof RedBuffer||RedGLUtil.throwFunc("RedGeometry : interleaveBuffer - RedBuffer Instance만 허용.",e),e.bufferType===RedBuffer.ARRAY_BUFFER||RedGLUtil.throwFunc("RedGeometry : interleaveBuffer - RedBuffer.ARRAY_BUFFER 타입만 허용.",e),t&&(e||RedGLUtil.throwFunc("RedGeometry : indexBuffer는 반드시 interleaveBuffer와 쌍으로 입력되어야함.",t),t instanceof RedBuffer||RedGLUtil.throwFunc("RedGeometry : indexBuffer - RedBuffer Instance만 허용.",t),t.bufferType===RedBuffer.ELEMENT_ARRAY_BUFFER||RedGLUtil.throwFunc("RedGeometry : indexBuffer - RedBuffer.ELEMENT_ARRAY_BUFFER 타입만 허용.",t)),this.interleaveBuffer=e,this.indexBuffer=t,this._volume=null}).prototype={disposeAllBuffer:function(){for(e in this)t=this[e],this&&t instanceof RedBuffer&&t.dispose()},disposeBuffer:function(e){this&&this[e]instanceof RedBuffer&&this[e].dispose()},volumeCalculate:function(){var e,t,r,i,n,a,o,s,d,l,u,c,f=this.interleaveBuffer.stride;for(e=t=r=i=n=a=0,l=this.interleaveBuffer.data,u=0,c=this.interleaveBuffer.pointNum;u<c;u++)s=(o=u*f)+1,d=o+2,e=l[o]<e?l[o]:e,i=l[o]>i?l[o]:i,t=l[s]<t?l[s]:t,n=l[s]>n?l[s]:n,r=l[d]<r?l[d]:r,a=l[d]>a?l[d]:a;return this._volume=[i-e,n-t,a-r],this._volume.minX=e,this._volume.maxX=i,this._volume.minY=t,this._volume.maxY=n,this._volume.minZ=r,this._volume.maxZ=a,this._volume}},Object.defineProperty(RedGeometry.prototype,"volume",{get:function(){return this._volume||this.volumeCalculate(),this._volume}}),Object.freeze(RedGeometry)}(),RedInterleaveInfo=function(e,t,r){if(!(this instanceof RedInterleaveInfo))return new RedInterleaveInfo(e,t,r);"string"==typeof e||RedGLUtil.throwFunc("RedInterleaveInfo : attributeKey - 문자열만 허용",e),"a"===e.charAt(0)||RedGLUtil.throwFunc("RedInterleaveInfo : attributeKey 첫글자는 a로 시작해야합니다.",e),e.charAt(1)===e.charAt(1).toUpperCase()||RedInterleaveInfo.throwFunc("RedInterleaveInfo : attributeKey 두번째 글자는 대문자 시작해야합니다.",e),"number"==typeof t||RedGLUtil.throwFunc("RedInterleaveInfo : size - 숫자만 허용",t),this.attributeKey=e,this.size=t,this.normalize=void 0!==r,this.offset=null},Object.freeze(RedInterleaveInfo),function(){var e,t,r,i,n,a,o,s;(RedBaseMaterial=function(){}).prototype={makeProgramList:(s=["fog","sprite3D","skin","directionalShadow"],s.sort(),a=function(e,t,r,i,s,d,l){e.basic[t]||(e.basic[t]=new n(r,e,t,i,s)),d.forEach(function(u,c){d.sort(),l.sort();var f=d.join("_");e[f]||(e[f]={}),e[f][t]||(e[f][t]=new n(r,e,t,i,s,d));var h=d.concat();h.splice(c,1),o(e,f,t,r,i,s,d,l),a(e,t,r,i,s,h,l)})},o=function(e,t,r,i,a,o,s,d){function l(e,t){var r,i,n,a,o;if(t>e.length||t<=0)return[];if(t===e.length)return[e];if(1===t){for(n=[],r=0;r<e.length;r++)n.push([e[r]]);return n}for(n=[],r=0;r<e.length-t+1;r++)for(a=e.slice(r,r+1),o=l(e.slice(r+1),t-1),i=0;i<o.length;i++)n.push(a.concat(o[i]));return n}(function(e){var t,r,i,n;for(i=[],t=1;t<=e.length;t++)for(n=l(e,t),r=0;r<n.length;r++)i.push(n[r]);return i})(d=d||[]).forEach(function(d){var l=d.join("_");e.basic[r+"_"+l]||(e.basic[r+"_"+l]=new n(i,e,r,a,o,null,d)),e[t][r+"_"+l]||(e[t][r+"_"+l]=new n(i,e,r,a,o,s,d))})},n=function(e,t,r,i,n,a,o){0,o=o||[],this.optionList=o.concat(a||[]),this.systemKey=(a||["basic"]).join("_"),this.searchKey=r+(o.length?"_"+o.join("_"):""),this.key=r+(this.optionList.length?"_"+this.optionList.join("_"):""),this._prepareProgramYn=!0,this._makePrepareProgram=function(){return t[this.systemKey][this.searchKey]=RedProgram.makeProgram(e,r,i,n,this.optionList)}},function(e,t,r,i,n,o){o||(o=[]),t._datas.RedProgramGroup||(t._datas.RedProgramGroup={}),t._datas.RedProgramGroup[r]?e._programList=t._datas.RedProgramGroup[r]:(e._programList={basic:{}},a(e._programList,r,t,i,n,s,o),e._programList.basic[r]=RedProgram.makeProgram(t,r,i,n),t._datas.RedProgramGroup[r]=e._programList),e.program=e._programList.basic[r]}),_searchProgram:function(e,n){if(i=[],n)for(t=n.length;t--;)this[r=n[t]]&&i.push(r);i.length?(i.sort(),i=e+"_"+i.join("_")):i=e,this.program=this._programList.basic[i]},checkUniformAndProperty:function(){var e,t,r;return function(){for(this.program._prepareProgramYn&&(this.program=this.program._makePrepareProgram()),t=this.program.uniformLocation,e=t.length;e--;)r=t[e],!r.location||r.materialPropertyName in this||RedGLUtil.throwFunc(this.program.key+"- ",r.materialPropertyName,"속성이 정의 되지않았습니다.")}}(),disposeAllTexture:function(){for(e in this)this[e]instanceof RedBaseTexture&&this[e].dispose()},disposeTexture:function(e){this[e]instanceof RedBaseTexture&&this[e].dispose()}},Object.freeze(RedBaseMaterial)}(),RedTextureOptionChecker={check:function(e,t,r){var i;t&&((i=t.min)&&i!=r.LINEAR&&i!=r.NEAREST&&i!=r.NEAREST_MIPMAP_NEAREST&&i!=r.LINEAR_MIPMAP_NEAREST&&i!=r.NEAREST_MIPMAP_LINEAR&&i!=r.LINEAR_MIPMAP_LINEAR&&RedGLUtil.throwFunc(e+": min 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i),(i=t.mag)&&i!=r.LINEAR&&i!=r.NEAREST&&RedGLUtil.throwFunc(e+" : mag 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i),(i=t.wrap_s)&&i!=r.REPEAT&&i!=r.CLAMP_TO_EDGE&&i!=r.MIRRORED_REPEAT&&RedGLUtil.throwFunc(e+" : wrap_s 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i),(i=t.wrap_t)&&i!=r.REPEAT&&i!=r.CLAMP_TO_EDGE&&i!=r.MIRRORED_REPEAT&&RedGLUtil.throwFunc(e+" : wrap_t 텍스쳐 옵션에서 사용할수 없는값 입력됨.","입력값 : "+i))}},Object.freeze(RedTextureOptionChecker),function(){var e,t,r;t=function(e,t,r,i){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.min?i.min:e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i.mag?i.mag:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,i.wrap_s?i.wrap_s:e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,i.wrap_t?i.wrap_t:e.REPEAT),e.glExtension.EXT_texture_filter_anisotropic&&i.anisotropic&&e.texParameterf(e.TEXTURE_2D,e.glExtension.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.anisotropic);try{e.generateMipmap(e.TEXTURE_2D)}catch(e){}e.bindTexture(e.TEXTURE_2D,null)},e=function(e,i,n,a,o,s){if(o||(o={}),window.OffscreenCanvas&&a instanceof OffscreenCanvas||window.HTMLCanvasElement&&a instanceof HTMLCanvasElement){var d=RedGLUtil.makePowerOf2Source(e,a,r);t(e,n,d,o),s&&s.call(i,!0)}else RedImageLoader(a,function(){var a=RedGLUtil.makePowerOf2Source(e,this.source,r);t(e,n,a,o),s&&s.call(i,!0)},function(){s&&s.call(i,!1)})},(RedBitmapTexture=function(t,i,n,a){var o;if(!(this instanceof RedBitmapTexture))return new RedBitmapTexture(t,i,n,a);t instanceof RedGL||RedGLUtil.throwFunc("RedBitmapTexture : RedGL Instance만 허용.",t),a&&"function"==typeof a||!a||RedGLUtil.throwFunc("RedBitmapTexture : callback Function만 허용.",a),o=t.gl,r=t.detect.texture.MAX_TEXTURE_SIZE,n=n||{};var s=i+JSON.stringify(n);if("string"==typeof i&&(t._datas.textures||(t._datas.textures={}),t._datas.textures[s]))return a&&setTimeout(function(){a.call(this,!0)},1),t._datas.textures[s];this.webglTexture=o.createTexture(),this.webglTexture.gl=o,this._load=function(t){RedTextureOptionChecker.check("RedBitmapTexture",n,o),t&&this.setEmptyTexture(o,this.webglTexture),this._src&&e(o,this,this.webglTexture,this._src,this._option,this._callback)},this._option=n,this.callback=a,this.src=i,this._UUID=RedGL.makeUUID(),t._datas.textures[s]=this}).prototype=new RedBaseTexture,Object.defineProperty(RedBitmapTexture.prototype,"src",{get:function(){return this._src},set:function(e){if(window.OffscreenCanvas)return this._src=e,void this._load(!0);!e||"string"==typeof e||window.HTMLCanvasElement&&e instanceof HTMLCanvasElement||RedGLUtil.throwFunc("RedBitmapTexture : src는 문자열 or Canvas Element만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),Object.defineProperty(RedBitmapTexture.prototype,"option",{get:function(){return this._option},set:function(e){this._option=e,this._load(!1)}}),Object.freeze(RedBitmapTexture)}(),function(){var e,t;t=function(e,t,r){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.bindTexture(e.TEXTURE_2D,null)},e=function(e,r,i,n,a){var o,s,d,l;d=function(e){e.removeEventListener("error",o),e.removeEventListener("canplaythrough",s)},o=function(){d(this),a&&a.call(r,!1)},s=function(){d(this),this.play(),r._videoDom.loaded=!0,t(e,i,this),a&&a.call(r,!0)},n instanceof HTMLVideoElement?l=n:(l=document.createElement("video")).src=n,l.loop=!0,l.muted=!0,l.setAttribute("autoplay",""),l.style.cssText="position:absolute;top:0px;left:0px;z-index:200",r._videoDom=l,r._videoDom.loaded=!1,l.addEventListener("error",o),l.addEventListener("canplaythrough",s)},(RedVideoTexture=function(t,r,i){var n;if(!(this instanceof RedVideoTexture))return new RedVideoTexture(t,r,i);t instanceof RedGL||RedGLUtil.throwFunc("RedVideoTexture : RedGL Instance만 허용.",t),n=t.gl,this.webglTexture=n.createTexture(),this.webglTexture.gl=n,this._UUID=RedGL.makeUUID(),this._load=function(t){t&&this.setEmptyTexture(n,this.webglTexture),this._src&&e(n,this,this.webglTexture,this._src,this._callback)},this.callback=i,this.src=r}).prototype=new RedBaseTexture,Object.defineProperty(RedVideoTexture.prototype,"src",{get:function(){return this._src},set:function(e){!e||"string"==typeof e||e instanceof HTMLVideoElement||RedGLUtil.throwFunc("RedVideoTexture : src는 문자열 or HTMLVideoElement만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),Object.freeze(RedVideoTexture)}(),(RedDDSTexture=function(e,t,r,i){var n;if(!(this instanceof RedDDSTexture))return new RedDDSTexture(e,t,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedDDSTexture : RedGL Instance만 허용.",e),(n=e.gl).glExtension.WEBGL_compressed_texture_s3tc||RedGLUtil.throwFunc("RedDDSTexture : WEBGL_compressed_texture_s3tc확장을 지원하지않는 하드웨어입니다."),this.webglTexture=n.createTexture(),this.webglTexture.gl=n,this._load=function(e){RedTextureOptionChecker.check("RedDDSTexture",r,n),e&&this.setEmptyTexture(n,this.webglTexture),this._src&&this.loadDDSTexture(n,n.glExtension.WEBGL_compressed_texture_s3tc,this._src,this._callback)},this.callback=i,this.src=t,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseTexture,Object.defineProperty(RedDDSTexture.prototype,"src",{get:function(){return this._src},set:function(e){e&&"string"!=typeof e&&RedGLUtil.throwFunc("RedDDSTexture : src는 문자열만 허용.","입력값 : "+e),this._src=e,this._load(!0)}}),function(e){"use strict";function t(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}var r=t("DXT1"),i=t("DXT3"),n=t("DXT5"),a=e.uploadDDSLevels=function(e,t,a,o){var s,d,l,u,c,f,h,R,m,p=new Int32Array(a,0,31);if(542327876!=p[0])return 0;if(4&!p[20])return 0;switch(p[21]){case r:s=8,d=t.COMPRESSED_RGBA_S3TC_DXT1_EXT;break;case i:s=16,d=t.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case n:s=16,d=t.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return null}for(R=1,131072&p[2]&&!1!==o&&(R=Math.max(1,p[7])),l=p[4],u=p[3],f=p[1]+4,m=0;m<R;++m)c=Math.max(4,l)/4*Math.max(4,u)/4*s,h=new Uint8Array(a,f,c),e.compressedTexImage2D(e.TEXTURE_2D,m,d,l,u,0,h),f+=c,l*=.5,u*=.5;return R};e.loadDDSTexture=function(e,t,r,i,n){var o=this.webglTexture,s=new XMLHttpRequest;return s.open("GET",r,!0),s.responseType="arraybuffer",i||(i={}),s.onload=function(){e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,o);var r=a(e,t,this.response);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i.min?i.min:r>1?e.LINEAR_MIPMAP_NEAREST:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,i.mag?i.mag:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),n&&n(!0)},s.onerror=function(){n&&n(!1)},s.send(null),o}}(RedDDSTexture.prototype),Object.freeze(RedDDSTexture),function(){var e;e=function(e,t,r,i,n,a){var o,s,d,l,u,c=[];for(n=n||{},o=function(){0===u&&a&&a.call(t,!1),u++},s=function(){if(6==++l){e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,n.min?n.min:e.LINEAR_MIPMAP_NEAREST),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,n.mag?n.mag:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,n.wrap_s?n.wrap_s:e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,n.wrap_t?n.wrap_t:e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c[0].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_X,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c[1].source),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c[2].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c[3].source),e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c[4].source),e.texImage2D(e.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,c[5].source),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0);try{e.generateMipmap(e.TEXTURE_CUBE_MAP)}catch(e){}e.bindTexture(e.TEXTURE_CUBE_MAP,null),0===u&&a&&a.call(t,!0)}},d=6,l=0,u=0;d--;)c[d]=RedImageLoader(i[d],s,o,{})},(RedBitmapCubeTexture=function(t,r,i,n){var a;if(!(this instanceof RedBitmapCubeTexture))return new RedBitmapCubeTexture(t,r,i,n);t instanceof RedGL||RedGLUtil.throwFunc("RedBitmapCubeTexture : RedGL Instance만 허용.","입력값 : "+t),n&&"function"==typeof n||!n||RedGLUtil.throwFunc("RedBitmapCubeTexture : callback Function만 허용.",n),a=t.gl,i=i||{};var o=r.toString()+JSON.stringify(i);if(r instanceof Array&&(t._datas.textures||(t._datas.textures={}),t._datas.textures[o]))return n&&setTimeout(function(){n.call(this,!0)},1),t._datas.textures[o];this.webglTexture=a.createTexture(),this.webglTexture.gl=a,this._UUID=RedGL.makeUUID(),this._load=function(t){RedTextureOptionChecker.check("RedBitmapCubeTexture",i,a),t&&this.setEmptyTexture(a,this.webglTexture),this._srcList&&e(a,this,this.webglTexture,this._srcList,this._option,this._callback)},this._option=i,this.callback=n,this.srcList=r,t._datas.textures[o]=this}).prototype=new RedBaseTexture,Object.defineProperty(RedBitmapCubeTexture.prototype,"srcList",{get:function(){return this._srcList},set:function(e){e instanceof Array||RedGLUtil.throwFunc("RedBitmapCubeTexture : srcList는 배열만 허용.","입력값 : "+e),6===e.length||RedGLUtil.throwFunc("RedBitmapCubeTexture : srcList 길이는 6이어야함","입력값 : "+e),this._srcList=e,this._load(!0)}}),Object.defineProperty(RedBitmapCubeTexture.prototype,"option",{get:function(){return this._option},set:function(e){this._option=e,this._load(!1)}}),Object.freeze(RedBitmapCubeTexture)}(),function(){var e,t,r,i,n=[];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform vec4 u_color;
void main(void) {
vec4 finalColor = u_color;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedColorMaterial=function(i,a,o){if(!(this instanceof RedColorMaterial))return new RedColorMaterial(i,a,o);i instanceof RedGL||RedGLUtil.throwFunc("RedColorMaterial : RedGL Instance만 허용.","입력값 : "+i),this.makeProgramList(this,i,"RedColorMaterialProgram",e,t,n),this._color=new Float32Array(4),this.alpha=null==o?1:o,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedColorMaterial.DEFINE_OBJECT_COLOR={get:function(){return this._colorHex},set:function(e){this._colorHex=e||"#ff2211",i=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._colorHex),this._color[0]=i[0],this._color[1]=i[1],this._color[2]=i[2],this._color[3]=this._alpha}},RedColorMaterial.DEFINE_OBJECT_ALPHA={min:0,max:1,callback:function(e){this._color[3]=this._alpha=e}},Object.defineProperty(RedColorMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototype("RedColorMaterial","alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA),Object.freeze(RedColorMaterial)}(),function(){var e,t,r,i=["useFlatMode"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
uniform float u_shininess;
uniform float u_specularPower;
uniform vec4 u_color;
vec3 N;
vec4 texelColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
vec4 finalColor;
void main(void) {
texelColor = u_color;
N = normalize(vVertexNormal);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
finalColor.a = texelColor.a;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedColorPhongMaterialProgram",i)}};(RedColorPhongMaterial=function(n,a,o){if(!(this instanceof RedColorPhongMaterial))return new RedColorPhongMaterial(n,a,o);n instanceof RedGL||RedGLUtil.throwFunc("RedColorPhongMaterial : RedGL Instance만 허용.","입력값 : "+n),this.makeProgramList(this,n,"RedColorPhongMaterialProgram",e,t,i),this._color=new Float32Array(4),this.shininess=16,this.specularPower=1,this.alpha=null==o?1:o,this.useFlatMode=!1,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.defineProperty(RedColorPhongMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototypes("RedColorPhongMaterial",["alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA],["shininess","number",{min:0}],["specularPower","number",{min:0}],["useFlatMode","boolean",n]),Object.freeze(RedColorPhongMaterial)}(),function(){var e,t,r,i=["normalTexture","specularTexture","displacementTexture","emissiveTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform vec4 u_color;
vec4 texelColor;
vec4 emissiveColor;
vec4 finalColor;
vec3 N;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
void main(void) {
texelColor = u_color;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture# specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedColorPhongTextureMaterialProgram",i)}};(RedColorPhongTextureMaterial=function(n,a,o,s,d,l,u){if(!(this instanceof RedColorPhongTextureMaterial))return new RedColorPhongTextureMaterial(n,a,o,s,d,l,u);n instanceof RedGL||RedGLUtil.throwFunc("RedColorPhongTextureMaterial : RedGL Instance만 허용.","입력값 : "+n),this.makeProgramList(this,n,"RedColorPhongTextureMaterialProgram",e,t,i),this._color=new Float32Array(4),this.normalTexture=s,this.specularTexture=d,this.displacementTexture=l,this.emissiveTexture=u,this.normalPower=1,this.shininess=16,this.specularPower=1,this.emissiveFactor=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=null==o?1:o,this.color=a||"#ff0000",this.usePreMultiply=!1,this.useFlatMode=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.defineProperty(RedColorPhongTextureMaterial.prototype,"color",RedColorMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototypes("RedColorPhongTextureMaterial",["alpha","number",RedColorMaterial.DEFINE_OBJECT_ALPHA],["normalTexture","sampler2D",n],["specularTexture","sampler2D",n],["displacementTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["normalPower","number",{min:0}],["shininess","number",{min:0}],["specularPower","number",{min:0}],["emissiveFactor","number",{min:0}],["displacementPower","number",{min:0}],["displacementFlowSpeedX","number"],["displacementFlowSpeedY","number"],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedColorPhongTextureMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","specularTexture","displacementTexture","emissiveTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform float u_reflectionPower;
uniform float u_alpha;
uniform bool u_useFlatMode;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec3 N;
float specularTextureValue;
vec4 finalColor;
void main(void) {
texelColor = vec4(0.0,0.0,0.0,0.0);
//#REDGL_DEFINE#diffuseTexture# texelColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#diffuseTexture# //#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
//#REDGL_DEFINE#diffuseTexture# if(texelColor.a ==0.0) discard;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
vec3 R = reflect( vVertexPosition.xyz - uCameraPosition, N);
reflectionColor = textureCube(u_environmentTexture, R);
texelColor = mix(texelColor, reflectionColor ,u_reflectionPower);
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture#  specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a * u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedEnvironmentMaterial=function(n,a,o,s,d,l,u){if(!(this instanceof RedEnvironmentMaterial))return new RedEnvironmentMaterial(n,a,o,s,d,l,u);n instanceof RedGL||RedGLUtil.throwFunc("RedEnvironmentMaterial : RedGL Instance만 허용.",n),o instanceof RedBitmapCubeTexture||RedGLUtil.throwFunc("RedEnvironmentMaterial : environmentTexture - RedBitmapCubeTexture Instance만 허용."),this.makeProgramList(this,n,"RedEnvironmentMaterialProgram",e,t,i),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.specularTexture=d,this.displacementTexture=l,this.emissiveTexture=u,this.normalPower=1,this.shininess=8,this.specularPower=1,this.emissiveFactor=1,this.reflectionPower=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=1,this.useFlatMode=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("RedEnvironmentMaterialProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedEnvironmentMaterial",["alpha","number",{min:0,max:1}],["diffuseTexture","sampler2D",n],["environmentTexture","samplerCube",{essential:!0,callback:n.callback}],["normalTexture","sampler2D",n],["specularTexture","sampler2D",n],["displacementTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["normalPower","number",{min:0}],["shininess","number",{min:0}],["specularPower","number",{min:0}],["emissiveFactor","number",{min:0}],["reflectionPower","number",{min:0}],["displacementPower","number",{min:0}],["displacementFlowSpeedX","number"],["displacementFlowSpeedY","number"],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedEnvironmentMaterial)}(),function(){var e,t,r,i=["usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedBitmapMaterial=function(n,a){if(!(this instanceof RedBitmapMaterial))return new RedBitmapMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedBitmapMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedBitmapMaterialProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("RedBitmapMaterialProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedBitmapMaterial",["diffuseTexture","sampler2D",{essential:!0}],["alpha","number",{min:0,max:1}],["usePreMultiply","boolean",n]),Object.freeze(RedBitmapMaterial)}(),function(){var e,t,r,i=["diffuseTexture","usePreMultiply"];e=function(){
/* @preserve
const mat4 cMode2D = mat4(
0.5, 0.0, 0.0, 0.0,
0.0, 0.5, 0.0, 0.0,
0.0, 0.0, 0.5, 0.0,
0.0, 0.0, 0.0, 1.0
);
void main(void) {
if(uMode2DYn){
gl_Position = uPMatrix * uCameraMatrix * cMode2D * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
vVertexColor = aVertexColor;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
uniform float u_cutOff;
uniform float u_alpha;
void main(void) {
vec4 finalColor = vVertexColor;
//#REDGL_DEFINE#diffuseTexture# finalColor = texture2D(u_diffuseTexture, gl_PointCoord.xy);
//#REDGL_DEFINE#diffuseTexture# //#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
//#REDGL_DEFINE#diffuseTexture# finalColor.rgb += vVertexColor.rgb * vVertexColor.a;
//#REDGL_DEFINE#diffuseTexture# finalColor.a *= vVertexColor.a;
finalColor.a *= u_alpha;
//#REDGL_DEFINE#diffuseTexture# if(finalColor.a < u_cutOff) discard;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("particleProgram",i)}};(RedParticleMaterial=function(n,a){if(!(this instanceof RedParticleMaterial))return new RedParticleMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedParticleMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"particleProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.cutOff=0,this.usePreMultiply=!0,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedParticleMaterial",["diffuseTexture","sampler2D",{callback:function(){this._searchProgram("particleProgram",i)}}],["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["usePreMultiply","boolean",n]),Object.freeze(RedParticleMaterial)}(),function(){var e,t,r,i=["usePreMultiply"];e=function(){
/* @preserve
void main(void) {
if(uMode2DYn){
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform sampler2D u_diffuseTexture;
uniform float u_cutOff;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, gl_PointCoord.xy);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a < u_cutOff) discard;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedBitmapPointCloudMaterial=function(n,a){if(!(this instanceof RedBitmapPointCloudMaterial))return new RedBitmapPointCloudMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedBitmapPointCloudMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"bitmapPointCloudProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.cutOff=.1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("bitmapPointCloudProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedBitmapPointCloudMaterial",["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["diffuseTexture","sampler2D",{essential:!0}],["usePreMultiply","boolean",n]),Object.freeze(RedBitmapPointCloudMaterial)}(),function(){var e,t,r,i=["usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
uniform vec4 u_sheetRect;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
vTexcoord = vec2(
vTexcoord.s * u_sheetRect.x + u_sheetRect.z,
vTexcoord.t * u_sheetRect.y - u_sheetRect.w
);
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# finalColor.rgb *= finalColor.a;
finalColor.a *= u_alpha;
if(finalColor.a ==0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedSheetMaterialProgram",i)}};(RedSheetMaterial=function(n,a,o,s,d,l){if(!(this instanceof RedSheetMaterial))return new RedSheetMaterial(n,a,o,s,d,l);n instanceof RedGL||RedGLUtil.throwFunc("RedSheetMaterial : RedGL Instance만 허용.",n),o=o||60,s=s||1,d=d||1,l=l||1,this.makeProgramList(this,n,"RedSheetMaterialProgram",e,t,i),this.diffuseTexture=a,this._sheetRect=new Float32Array(4),this.alpha=1,this.usePreMultiply=!1,this._perFrameTime=0,this._nextFrameTime=0,this._playYn=!0,this.segmentW=s,this.segmentH=d,this.totalFrame=l,this.frameRate=o,this.currentIndex=0,this.loop=!0,this._aniMap={},this.__RedSheetMaterialYn=!0,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedSheetMaterial.prototype.addAction=function(e,t){this._aniMap[e]=t},RedSheetMaterial.prototype.setAction=function(e){this.diffuseTexture=this._aniMap[e].texture,this.segmentW=this._aniMap[e].segmentW,this.segmentH=this._aniMap[e].segmentH,this.totalFrame=this._aniMap[e].totalFrame,this.frameRate=this._aniMap[e].frameRate,this.currentIndex=0,this._nextFrameTime=0},RedSheetMaterial.prototype.play=function(){this._playYn=!0},RedSheetMaterial.prototype.stop=function(){this._playYn=!1,this.currentIndex=0},RedSheetMaterial.prototype.pause=function(){this._playYn=!1},RedSheetMaterial.prototype.gotoAndStop=function(e){e>this.totalFrame-1&&(e=this.totalFrame-1),e<0&&(e=0),this._playYn=!1,this.currentIndex=e},RedSheetMaterial.prototype.gotoAndPlay=function(e){e>this.totalFrame-1&&(e=this.totalFrame-1),e<0&&(e=0),this._playYn=!0,this.currentIndex=e,this._nextFrameTime=0},RedDefinePropertyInfo.definePrototypes("RedSheetMaterial",["diffuseTexture","sampler2D",{essential:!0}],["totalFrame","number",{min:1}],["loop","boolean"],["frameRate","number",{min:1,callback:function(){this._perFrameTime=1e3/this._frameRate}}],["segmentW","number",{min:1}],["segmentH","number",{min:1}],["alpha","number",{min:0,max:1}],["usePreMultiply","boolean",n]),Object.freeze(RedSheetMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","specularTexture","emissiveTexture","displacementTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#displacementTexture# uniform sampler2D u_displacementTexture;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementPower;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedX;
//#REDGL_DEFINE#displacementTexture# uniform float u_displacementFlowSpeedY;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#displacementTexture# vVertexPosition.xyz += normalize(vVertexNormal) * texture2D(u_displacementTexture, vTexcoord + vec2(
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedX * (uTime/1000.0),
//#REDGL_DEFINE#displacementTexture#    u_displacementFlowSpeedY * (uTime/1000.0)
//#REDGL_DEFINE#displacementTexture# )).x * u_displacementPower ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * vVertexPosition;
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#fragmentShareFunc#getDirectionalLightColor#
//#REDGL_DEFINE#fragmentShareFunc#getPointLightColor#
uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#specularTexture# uniform sampler2D u_specularTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_shininess;
uniform float u_specularPower;
//#REDGL_DEFINE#emissiveTexture# uniform float u_emissiveFactor;
uniform float u_alpha;
vec4 texelColor;
vec4 emissiveColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
float specularTextureValue;
vec4 finalColor;
vec3 N;
void main(void) {
texelColor = texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
if(texelColor.a == 0.0) discard;
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# //#REDGL_DEFINE#usePreMultiply# emissiveColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue = 1.0;
//#REDGL_DEFINE#specularTexture# specularTextureValue = texture2D(u_specularTexture, vTexcoord).r;
vec4 finalColor = uAmbientLightColor * uAmbientIntensity
+ getDirectionalLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
)
+ getPointLightColor(
texelColor,
N,
u_shininess,
specularLightColor,
specularTextureValue,
u_specularPower
);
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb * u_emissiveFactor;
finalColor.a = texelColor.a * u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/};var n={callback:function(){this._searchProgram("RedStandardMaterialProgram",i)}};(RedStandardMaterial=function(n,a,o,s,d,l){if(!(this instanceof RedStandardMaterial))return new RedStandardMaterial(n,a,o,s,d,l);n instanceof RedGL||RedGLUtil.throwFunc("RedStandardMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedStandardMaterialProgram",e,t,i),this.diffuseTexture=a,this.normalTexture=o,this.specularTexture=s,this.emissiveTexture=l,this.displacementTexture=d,this.normalPower=1,this.shininess=16,this.specularPower=1,this.emissiveFactor=1,this.displacementPower=.1,this.displacementFlowSpeedX=0,this.displacementFlowSpeedY=0,this.alpha=1,this._UUID=RedGL.makeUUID(),this.useFlatMode=!1,this.usePreMultiply=!1,r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedStandardMaterial",["alpha","number",{min:0,max:1}],["diffuseTexture","sampler2D",{essential:!0,callback:n.callback}],["normalTexture","sampler2D",n],["specularTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["displacementTexture","sampler2D",n],["normalPower","number",{min:0}],["shininess","number",{min:0}],["specularPower","number",{min:0}],["emissiveFactor","number",{min:0}],["displacementPower","number",{min:0}],["displacementFlowSpeedX","number"],["displacementFlowSpeedY","number"],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedStandardMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_videoTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_videoTexture, vTexcoord);
if(finalColor.a ==0.0) discard;
finalColor.a = u_alpha;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedVideoMaterial=function(i,n){if(!(this instanceof RedVideoMaterial))return new RedVideoMaterial(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedVideoMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedVideoMaterialProgram",e,t),this.videoTexture=n,this.alpha=1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedVideoMaterial",["alpha","number",{min:0,max:1}],["videoTexture","samplerVideo",{essential:!0}]),Object.freeze(RedVideoMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","environmentTexture","occlusionTexture","emissiveTexture","roughnessTexture","useFlatMode","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
uniform vec4 uBaseColorFactor;
uniform float u_emissiveFactor;
uniform float u_cutOff;
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#occlusionTexture# uniform sampler2D u_occlusionTexture;
//#REDGL_DEFINE#environmentTexture# uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#roughnessTexture# uniform sampler2D u_roughnessTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_specularPower;
uniform float u_metallicFactor;
uniform float u_roughnessFactor;
uniform float u_occlusionPower;
uniform float u_alpha;
vec4 la;
vec4 ld;
vec4 ls;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 roughnessColor;
vec4 occlusionColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec4 finalColor;
vec3 N;
vec3 L;
float lambertTerm;
float specular;
float specularTextureValue;
float distanceLength;
float attenuation;
void main(void) {
la = uAmbientLightColor * uAmbientLightColor.a;
ld = vec4(0.0, 0.0, 0.0, 1.0);
ls = vec4(0.0, 0.0, 0.0, 1.0);
float tMetallicPower = u_metallicFactor;
float tRoughnessPower = u_roughnessFactor;
//#REDGL_DEFINE#roughnessTexture# roughnessColor = texture2D(u_roughnessTexture, vTexcoord);
//#REDGL_DEFINE#roughnessTexture# tMetallicPower *= roughnessColor.b; // 메탈릭 산출 roughnessColor.b
//#REDGL_DEFINE#roughnessTexture# tRoughnessPower *= roughnessColor.g; // 거칠기 산출 roughnessColor.g
texelColor = uBaseColorFactor;
//#REDGL_DEFINE#diffuseTexture# texelColor *= texture2D(u_diffuseTexture, vTexcoord);
//#REDGL_DEFINE#usePreMultiply# texelColor.rgb *= texelColor.a;
if(texelColor.a <= u_cutOff) discard;
N = normalize(vVertexNormal);
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, vTexcoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, vTexcoord, normalColor.rgb) ;
vec3 R = reflect( vVertexPosition.xyz-uCameraPosition, N);
//#REDGL_DEFINE#environmentTexture# reflectionColor = textureCube(u_environmentTexture, R);
//#REDGL_DEFINE#environmentTexture# reflectionColor.rgb *= reflectionColor.a;
//#REDGL_DEFINE#environmentTexture# texelColor.rgb = mix( texelColor.rgb , reflectionColor.rgb , max(tMetallicPower-tRoughnessPower,0.1)*(1.0-tRoughnessPower));
//#REDGL_DEFINE#environmentTexture# texelColor = mix( texelColor , vec4(0.04, 0.04, 0.04, 1.0) , tRoughnessPower * (tMetallicPower) * 0.5);
float shininess = 128.0 ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue =  1.0 ;
for(int i=0; i<cDIRETIONAL_MAX; i++){
if(i == uDirectionalLightNum) break;
L = normalize(-uDirectionalLightPositionList[i]);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;
specular = pow( max(dot(reflect(L, N), -L), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * u_specularPower * specularTextureValue * uDirectionalLightIntensityList[i]* uDirectionalLightColorList[i].a * (1.0-tRoughnessPower+0.04);
}
}
for(int i=0;i<cPOINT_MAX;i++){
if(i== uPointLightNum) break;
L =  -uPointLightPositionList[i] + vVertexPosition.xyz;
distanceLength = abs(length(L));
if(uPointLightRadiusList[i]> distanceLength){
attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;
L = normalize(L);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;
specular = pow( max(dot(reflect(L, N), -N), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * uPointLightIntensityList[i]  * uPointLightColorList[i].a * (1.0-tRoughnessPower+0.04) ;
}
}
}
finalColor = la * uAmbientIntensity + ld + ls;
finalColor.a = texelColor.a * u_alpha ;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, vTexcoord);
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= emissiveColor.a * u_emissiveFactor;
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= u_emissiveFactor;
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb;
//#REDGL_DEFINE#occlusionTexture# occlusionColor = texture2D(u_occlusionTexture, vTexcoord);
//#REDGL_DEFINE#occlusionTexture# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * occlusionColor.r, occlusionColor.r * u_occlusionPower);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedPBRMaterial=function(n,a,o,s,d,l,u){if(!(this instanceof RedPBRMaterial))return new RedPBRMaterial(n,a,o,s,d,l,u);n instanceof RedGL||RedGLUtil.throwFunc("RedPBRMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedPBRMaterialProgram",e,t,i),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.occlusionTexture=d,this.emissiveTexture=l,this.roughnessTexture=u,this.normalPower=1,this.specularPower=1,this.occlusionPower=1,this.metallicFactor=1,this.roughnessFactor=.1,this.baseColorFactor=[1,1,1,1],this.emissiveFactor=1,this.alpha=1,this.cutOff=0,this.useFlatMode=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial;var n={callback:function(){this._searchProgram("RedPBRMaterialProgram",i)}};RedDefinePropertyInfo.definePrototypes("RedPBRMaterial",["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["diffuseTexture","sampler2D",n],["environmentTexture","samplerCube",{callback:n.callback}],["normalTexture","sampler2D",n],["occlusionTexture","sampler2D",n],["emissiveTexture","sampler2D",n],["roughnessTexture","sampler2D",n],["normalPower","number",{min:0}],["specularPower","number",{min:0}],["metallicFactor","number",{min:0,max:1}],["emissiveFactor","number",{min:0,max:1}],["roughnessFactor","number",{min:0,max:1}],["occlusionPower","number",{min:0}],["useFlatMode","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedPBRMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vVertexColor = aVertexColor;
if(uMode2DYn){
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition.x, -aVertexPosition.y, aVertexPosition.z, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w;
}else {
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
gl_PointSize = abs(aPointSize)/gl_Position.w * uResolution.y;
}
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform float u_alpha;
void main(void) {
vec4 finalColor = vVertexColor;
finalColor.a *= u_alpha;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedColorPointCloudMaterial=function(i){if(!(this instanceof RedColorPointCloudMaterial))return new RedColorPointCloudMaterial(i);i instanceof RedGL||RedGLUtil.throwFunc("RedColorPointCloudMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"colorPointCloudProgram",e,t),this.alpha=1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedColorPointCloudMaterial","alpha","number",{min:0,max:1}),Object.freeze(RedColorPointCloudMaterial)}(),function(){var e,t,r,i=["diffuseTexture","normalTexture","environmentTexture","occlusionTexture","emissiveTexture","roughnessTexture","useFlatMode","useMaterialDoubleSide","useVertexTangent","useVertexColor_0","usePreMultiply"];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
//#REDGL_DEFINE#useVertexColor_0# attribute vec4 aVertexColor_0;
//#REDGL_DEFINE#useVertexColor_0# varying vec4 vVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# attribute vec4 aVertexTangent;
//#REDGL_DEFINE#useVertexTangent# varying vec4 vVertexTangent;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
vTexcoord1 = aTexcoord1;
//#REDGL_DEFINE#useVertexColor_0# vVertexColor_0 = aVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# vVertexTangent = aVertexTangent;
//#REDGL_DEFINE#skin#true# vVertexNormal = (uNMatrix * getSkinMatrix() * vec4(aVertexNormal,0.0)).xyz;
//#REDGL_DEFINE#skin#false# vVertexNormal = (uNMatrix *  vec4(aVertexNormal,1.0)).xyz;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * vVertexPosition;
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter * uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
//#REDGL_DEFINE#fragmentShareFunc#getFlatNormal#
//#REDGL_DEFINE#fragmentShareFunc#cotangent_frame#
//#REDGL_DEFINE#fragmentShareFunc#perturb_normal#
//#REDGL_DEFINE#useVertexColor_0# varying vec4 vVertexColor_0;
//#REDGL_DEFINE#useVertexTangent# varying vec4 vVertexTangent;
uniform vec4 uBaseColorFactor;
uniform vec3 uEmissiveFactor;
uniform float u_cutOff;
//#REDGL_DEFINE#diffuseTexture# uniform sampler2D u_diffuseTexture;
//#REDGL_DEFINE#normalTexture# uniform sampler2D u_normalTexture;
//#REDGL_DEFINE#occlusionTexture# uniform sampler2D u_occlusionTexture;
//#REDGL_DEFINE#environmentTexture# uniform samplerCube u_environmentTexture;
//#REDGL_DEFINE#emissiveTexture# uniform sampler2D u_emissiveTexture;
//#REDGL_DEFINE#roughnessTexture# uniform sampler2D u_roughnessTexture;
//#REDGL_DEFINE#normalTexture# uniform float u_normalPower;
uniform float u_specularPower;
uniform float u_metallicFactor;
uniform float u_roughnessFactor;
uniform float u_occlusionPower;
uniform float u_alpha;
uniform int u_diffuseTexCoordIndex;
uniform int u_occlusionTexCoordIndex;
uniform int u_emissiveTexCoordIndex;
uniform int u_roughnessTexCoordIndex;
uniform int u_normalTexCoordIndex;
vec4 la;
vec4 ld;
vec4 ls;
vec4 texelColor= vec4(0.0,0.0,0.0,0.0);
vec4 emissiveColor;
vec4 roughnessColor;
vec4 occlusionColor;
vec4 reflectionColor;
vec4 specularLightColor= vec4(1.0, 1.0, 1.0, 1.0);
vec4 finalColor;
vec3 N;
vec3 L;
float lambertTerm;
float specular;
float specularTextureValue;
float distanceLength;
float attenuation;
vec2 u_diffuseTexCoord ;
vec2 u_occlusionTexCoord;
vec2 u_emissiveTexCoord;
vec2 u_roughnessTexCoord;
vec2 u_normalTexCoord;
void main(void) {
la = uAmbientLightColor * uAmbientLightColor.a;
ld = vec4(0.0, 0.0, 0.0, 1.0);
ls = vec4(0.0, 0.0, 0.0, 1.0);
u_diffuseTexCoord = u_diffuseTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_normalTexCoord = u_normalTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_occlusionTexCoord = u_occlusionTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_emissiveTexCoord = u_emissiveTexCoordIndex==0 ? vTexcoord : vTexcoord1;
u_roughnessTexCoord  = u_roughnessTexCoordIndex==0 ? vTexcoord : vTexcoord1;
float tMetallicPower = u_metallicFactor;
float tRoughnessPower = u_roughnessFactor;
//#REDGL_DEFINE#roughnessTexture# roughnessColor = texture2D(u_roughnessTexture, u_roughnessTexCoord);
//#REDGL_DEFINE#roughnessTexture# tMetallicPower *= roughnessColor.b; // 메탈릭 산출 roughnessColor.b
//#REDGL_DEFINE#roughnessTexture# tRoughnessPower *= roughnessColor.g; // 거칠기 산출 roughnessColor.g
texelColor = uBaseColorFactor;
//#REDGL_DEFINE#useVertexColor_0# texelColor *= clamp(vVertexColor_0,0.0,1.0) ;
//#REDGL_DEFINE#diffuseTexture# texelColor *= texture2D(u_diffuseTexture, u_diffuseTexCoord);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#diffuseTexture# texelColor.rgb *= texelColor.a;
N = normalize(vVertexNormal);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 fdx = dFdx(vVertexPosition.xyz);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 fdy = dFdy(vVertexPosition.xyz);
//#REDGL_DEFINE#useMaterialDoubleSide# vec3 faceNormal = normalize(cross(fdx,fdy));
bool backFaceYn = false;
//#REDGL_DEFINE#useMaterialDoubleSide# if (dot (vVertexNormal, faceNormal) < 0.0) { N = -N; backFaceYn = true; };
vec4 normalColor = vec4(0.0);
//#REDGL_DEFINE#normalTexture# normalColor = texture2D(u_normalTexture, u_normalTexCoord);
//#REDGL_DEFINE#useFlatMode# N = getFlatNormal(vVertexPosition.xyz);
//#REDGL_DEFINE#normalTexture# N = perturb_normal(N, vVertexPosition.xyz, backFaceYn ?  1.0 - u_normalTexCoord : u_normalTexCoord, vec3(normalColor.r, 1.0- normalColor.g, normalColor.b) );
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 pos_dx = dFdx(vVertexPosition.xyz);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 pos_dy = dFdy(vVertexPosition.xyz);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 tex_dx = dFdx(vec3(u_normalTexCoord, 0.0));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 tex_dy = dFdy(vec3(u_normalTexCoord, 0.0));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 ng = normalize(vVertexNormal);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# t = normalize(t - ng * dot(ng, t));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# vec3 b = normalize(cross(ng, t));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# mat3 tbn = mat3(t, b, ng);
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# N = normalize(tbn * ((2.0 * normalColor.rgb - 1.0) * vec3(1.0, 1.0 * vVertexTangent.w,1.0)));
//#REDGL_DEFINE#useVertexTangent# //#REDGL_DEFINE#normalTexture# N = backFaceYn ? -N : N;
vec3 R = reflect( vVertexPosition.xyz-uCameraPosition, N);
//#REDGL_DEFINE#environmentTexture# reflectionColor = textureCube(u_environmentTexture, R);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#environmentTexture# reflectionColor.rgb *= reflectionColor.a;
//#REDGL_DEFINE#environmentTexture# texelColor.rgb = mix( texelColor.rgb , reflectionColor.rgb , max(tMetallicPower-tRoughnessPower,0.1)*(1.0-tRoughnessPower));
//#REDGL_DEFINE#environmentTexture# texelColor = mix( texelColor , vec4(0.04, 0.04, 0.04, 1.0) , tRoughnessPower * (tMetallicPower) * 0.5);
if(texelColor.a <= u_cutOff) discard;
float shininess = 128.0 ;
specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);
specularTextureValue =  1.0 ;
for(int i=0; i<cDIRETIONAL_MAX; i++){
if(i == uDirectionalLightNum) break;
L = normalize(-uDirectionalLightPositionList[i]);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;
specular = pow( max(dot(reflect(L, N), -L), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * u_specularPower * specularTextureValue * uDirectionalLightIntensityList[i]* uDirectionalLightColorList[i].a * (1.0-tRoughnessPower+0.04);
}
}
for(int i=0;i<cPOINT_MAX;i++){
if(i== uPointLightNum) break;
L =  -uPointLightPositionList[i] + vVertexPosition.xyz;
distanceLength = abs(length(L));
if(uPointLightRadiusList[i]> distanceLength){
attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;
L = normalize(L);
lambertTerm = dot(N,-L);
if(lambertTerm > 0.0){
ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;
specular = pow( max(dot(reflect(L, N), -N), 0.0), pow(shininess, 1.0-tRoughnessPower+0.04) );
specular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;
ls +=  specularLightColor * specular * uPointLightIntensityList[i]  * uPointLightColorList[i].a * (1.0-tRoughnessPower+0.04) ;
}
}
}
finalColor = la * uAmbientIntensity + ld + ls;
finalColor.a = texelColor.a * u_alpha ;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture), 0.5);
//#REDGL_DEFINE#emissiveTexture# emissiveColor = texture2D(u_emissiveTexture, u_emissiveTexCoord);
//#REDGL_DEFINE#usePreMultiply# //#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= emissiveColor.a;
//#REDGL_DEFINE#emissiveTexture# emissiveColor.rgb *= uEmissiveFactor;
//#REDGL_DEFINE#emissiveTexture# finalColor.rgb += emissiveColor.rgb;
//#REDGL_DEFINE#occlusionTexture# occlusionColor = texture2D(u_occlusionTexture, u_occlusionTexCoord);
//#REDGL_DEFINE#occlusionTexture# finalColor.rgb = mix(finalColor.rgb, finalColor.rgb * occlusionColor.r, occlusionColor.r * u_occlusionPower);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedPBRMaterial_System=function(n,a,o,s,d,l,u){if(!(this instanceof RedPBRMaterial_System))return new RedPBRMaterial_System(n,a,o,s,d,l,u);n instanceof RedGL||RedGLUtil.throwFunc("RedPBRMaterial_System : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedPBRMaterialSystemProgram",RedGLUtil.getStrFromComment(e.toString()),RedGLUtil.getStrFromComment(t.toString()),i),this.diffuseTexture=a,this.environmentTexture=o,this.normalTexture=s,this.occlusionTexture=d,this.emissiveTexture=l,this.roughnessTexture=u,this.normalPower=1,this.specularPower=1,this.metallicFactor=1,this.roughnessFactor=1,this.diffuseTexCoordIndex=0,this.occlusionTexCoordIndex=0,this.emissiveTexCoordIndex=0,this.roughnessTexCoordIndex=0,this.normalTexCoordIndex=0,this.occlusionPower=1,this.baseColorFactor=null,this.emissiveFactor=null,this.alpha=1,this.cutOff=0,this.useMaterialDoubleSide=!1,this.useVertexColor_0=!1,this.useFlatMode=!1,this.useVertexTangent=!1,this.usePreMultiply=!1,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0),this._needSearchProgram=null}).prototype=new RedBaseMaterial;var n={callback:function(){var e=this;cancelAnimationFrame(this._needSearchProgram),this._needSearchProgram=requestAnimationFrame(function(){e._searchProgram("RedPBRMaterialSystemProgram",i),e._needSearchProgram=null})}};RedDefinePropertyInfo.definePrototypes("RedPBRMaterial_System",["alpha","number",{min:0,max:1}],["cutOff","number",{min:0,max:1}],["diffuseTexture","sampler2D",n],["diffuseTexCoordIndex","number"],["environmentTexture","samplerCube",{callback:n.callback}],["normalTexture","sampler2D",n],["normalTexCoordIndex","number"],["occlusionTexture","sampler2D",n],["occlusionTexCoordIndex","number"],["emissiveTexture","sampler2D",n],["emissiveTexCoordIndex","number"],["roughnessTexture","sampler2D",n],["roughnessTexCoordIndex","number"],["normalPower","number",{min:0}],["specularPower","number",{min:0}],["metallicFactor","number",{min:0,max:1}],["roughnessFactor","number",{min:0,max:1}],["occlusionPower","number",{min:0}],["useFlatMode","boolean",n],["useMaterialDoubleSide","boolean",n],["useVertexColor_0","boolean",n],["useVertexTangent","boolean",n],["usePreMultiply","boolean",n]),Object.freeze(RedPBRMaterial_System)}(),function(){var e,t,r,i=[];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
uniform float u_width;
uniform float u_height;
void main(void) {
gl_PointSize = uPointSize;
vTexcoord = aTexcoord;
mat4 targetMatrix;
if(uMode2DYn){
targetMatrix = uMMatrix * mat4(
u_width, 0.0, 0.0, 0.0,
0.0, u_height, 0.0, 0.0,
0.0, 0.0, 1.0, 0.0,
0.0, 0.0, 0.0, 1.0
) ;
gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}else{
//#REDGL_DEFINE#sprite3D#true# targetMatrix = uMMatrix * mat4(
//#REDGL_DEFINE#sprite3D#true#    u_width/uResolution.y, 0.0, 0.0, 0.0,
//#REDGL_DEFINE#sprite3D#true#    0.0, u_height/uResolution.y, 0.0, 0.0,
//#REDGL_DEFINE#sprite3D#true# 	0.0, 0.0, 1.0, 0.0,
//#REDGL_DEFINE#sprite3D#true# 	0.0, 0.0, 0.0, 1.0
//#REDGL_DEFINE#sprite3D#true# ) ;
//#REDGL_DEFINE#sprite3D#false# targetMatrix = uMMatrix * mat4(
//#REDGL_DEFINE#sprite3D#false#    u_width/max(u_width,u_height), 0.0, 0.0, 0.0,
//#REDGL_DEFINE#sprite3D#false#    0.0, u_height/max(u_width,u_height), 0.0, 0.0,
//#REDGL_DEFINE#sprite3D#false# 	0.0, 0.0, 1.0, 0.0,
//#REDGL_DEFINE#sprite3D#false# 	0.0, 0.0, 0.0, 1.0
//#REDGL_DEFINE#sprite3D#false# ) ;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
uniform sampler2D u_diffuseTexture;
uniform float u_alpha;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
finalColor.a *= u_alpha;
if(finalColor.a == 0.0) discard;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedTextMaterial=function(n,a){if(!(this instanceof RedTextMaterial))return new RedTextMaterial(n,a);n instanceof RedGL||RedGLUtil.throwFunc("RedTextMaterial : RedGL Instance만 허용.",n),this.makeProgramList(this,n,"RedTextMaterialProgram",e,t,i),this.diffuseTexture=a,this.alpha=1,this.width=2,this.height=2,this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototypes("RedTextMaterial",["diffuseTexture","sampler2D",{essential:!0}],["alpha","number",{min:0,max:1}],["width","number",{min:2,callback:function(e){this._width=e}}],["height","number",{min:2,callback:function(e){this._height=e}}]),Object.freeze(RedTextMaterial)}(),function(){var e,t,r,i,n=[];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
float outlineSize = uOutlineThickness;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
float tScaleX = length(vec3(uMMatrix[0][0], uMMatrix[0][1], uMMatrix[0][2]));
float tScaleY = length(vec3(uMMatrix[1][0], uMMatrix[1][1], uMMatrix[1][2]));
float tScaleZ = length(vec3(uMMatrix[2][0], uMMatrix[2][1], uMMatrix[2][2]));
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#skin#false#//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix * vec4(aVertexPosition * vec3(1.0+outlineSize/tScaleX,1.0+outlineSize/tScaleY,1.0+outlineSize/tScaleZ) , 1.0);
//#REDGL_DEFINE#skin#true#//#REDGL_DEFINE#sprite3D#false#  gl_Position = uPMatrix * uCameraMatrix *  targetMatrix *  vec4(aVertexPosition + vec3( aVertexNormal * vec3(outlineSize/tScaleX,outlineSize/tScaleY,outlineSize/tScaleZ)), 1.0);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
void main(void) {
vec4 finalColor = uOutlineColor;
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedOutlineMaterial=function(i,a,o){if(!(this instanceof RedOutlineMaterial))return new RedOutlineMaterial(i,a,o);i instanceof RedGL||RedGLUtil.throwFunc("RedOutlineMaterial : RedGL Instance만 허용.","입력값 : "+i),this.makeProgramList(this,i,"RedOutlineMaterialProgram",e,t,n),this._color=new Float32Array(4),this.alpha=null==o?1:o,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedOutlineMaterial.DEFINE_OBJECT_COLOR={get:function(){return this._colorHex},set:function(e){this._colorHex=e||"#ff2211",i=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._colorHex),this._color[0]=i[0],this._color[1]=i[1],this._color[2]=i[2],this._color[3]=this._alpha}},RedOutlineMaterial.DEFINE_OBJECT_ALPHA={min:0,max:1,callback:function(e){this._color[3]=this._alpha=e}},Object.defineProperty(RedOutlineMaterial.prototype,"color",RedOutlineMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototype("RedOutlineMaterial","alpha","number",RedOutlineMaterial.DEFINE_OBJECT_ALPHA),Object.freeze(RedOutlineMaterial)}(),function(){var e,t,r,i,n=[];e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
float outlineSize = uOutlineThickness;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
vVertexPosition =  targetMatrix *  vec4(aVertexPosition, 1.0);
float tScaleX = length(vec3(targetMatrix[0][0], targetMatrix[0][1], targetMatrix[0][2]));
float tScaleY = length(vec3(targetMatrix[1][0], targetMatrix[1][1], targetMatrix[1][2]));
float tScaleZ = length(vec3(targetMatrix[2][0], targetMatrix[2][1], targetMatrix[2][2]));
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix * vec4(aVertexPosition * vec3(1.0+outlineSize/tScaleX,1.0+outlineSize/tScaleY,1.0+outlineSize/tScaleZ) , 1.0);
vTexcoord = aTexcoord-0.5;
vTexcoord *= vec2(1.0+outlineSize/tScaleX,1.0+outlineSize/tScaleY);
//#REDGL_DEFINE#directionalShadow#true# vResolution = uResolution;
//#REDGL_DEFINE#directionalShadow#true# vShadowPos = cTexUnitConverter  *  uDirectionalShadowLightMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
//#REDGL_DEFINE#fragmentShareFunc#decodeFloatShadow#
//#REDGL_DEFINE#fragmentShareFunc#getShadowColor#
void main(void) {
vec4 finalColor = uOutlineColor;
if(-0.495 <vTexcoord.x && vTexcoord.x<0.495 && -0.495 <vTexcoord.y && vTexcoord.y<0.495) {
if(-0.490 <vTexcoord.x && vTexcoord.x<0.490 && -0.490 <vTexcoord.y && vTexcoord.y<0.490) discard;
else finalColor.a *= 0.5;
}
//#REDGL_DEFINE#directionalShadow#true# finalColor.rgb *= getShadowColor( vShadowPos, vResolution, uDirectionalShadowTexture);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedOutlinePlaneMaterial=function(i,a,o){if(!(this instanceof RedOutlinePlaneMaterial))return new RedOutlinePlaneMaterial(i,a,o);i instanceof RedGL||RedGLUtil.throwFunc("RedOutlinePlaneMaterial : RedGL Instance만 허용.","입력값 : "+i),this.makeProgramList(this,i,"RedOutlinePlaneMaterialProgram",e,t,n),this._color=new Float32Array(4),this.alpha=null==o?1:o,this.color=a||"#ff0000",this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedOutlinePlaneMaterial.DEFINE_OBJECT_COLOR={get:function(){return this._colorHex},set:function(e){this._colorHex=e||"#ff2211",i=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._colorHex),this._color[0]=i[0],this._color[1]=i[1],this._color[2]=i[2],this._color[3]=this._alpha}},RedOutlinePlaneMaterial.DEFINE_OBJECT_ALPHA={min:0,max:1,callback:function(e){this._color[3]=this._alpha=e}},Object.defineProperty(RedOutlinePlaneMaterial.prototype,"color",RedOutlinePlaneMaterial.DEFINE_OBJECT_COLOR),RedDefinePropertyInfo.definePrototype("RedOutlinePlaneMaterial","alpha","number",RedOutlinePlaneMaterial.DEFINE_OBJECT_ALPHA),Object.freeze(RedOutlinePlaneMaterial)}(),(RedAmbientLight=function(e,t,r,i){if(!(this instanceof RedAmbientLight))return new RedAmbientLight(e,t,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedAmbientLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=null==i?1:i,this.alpha=null==r?.1:r,this.color=t||"#fff",this._UUID=RedGL.makeUUID()}).TYPE="RedAmbientLight",RedAmbientLight.prototype=new RedBaseLight,Object.defineProperty(RedAmbientLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedAmbientLight.TYPE}),Object.freeze(RedAmbientLight),(RedDirectionalLight=function(e,t,r,i){if(!(this instanceof RedDirectionalLight))return new RedDirectionalLight(e,t,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=null==i?1:i,this.alpha=null==r?1:r,this.color=t||"#fff",this.x=0,this.y=-1,this.z=0,this._UUID=RedGL.makeUUID(),this.debug=!1,this._debugObject=RedSprite3D(e,RedBitmapMaterial(e,RedBitmapTexture(e,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA25pVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDozQjcyMEREMTUyMDYxMUU4OTRDNTgzQTBBMEY2MkFFNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDODA1NTI0RjUyMDYxMUU4QkVBQTg3NjZCN0M1OUI2OCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDODA1NTI0RTUyMDYxMUU4QkVBQTg3NjZCN0M1OUI2OCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgMjAxNyAoV2luZG93cykiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDowNmFjYmZjZi05YjBkLThlNGItODZiNy1kNWViYWNjZDg4OGMiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6M0I3MjBERDE1MjA2MTFFODk0QzU4M0EwQTBGNjJBRTQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4vVcpuAAAHNUlEQVR42uxbeWyURRT/tiw9OAJYUekfeBCFNmqlkAgRtURQaTywWIhGSfDAAzmkggcoKopKRQXFKKZqNGmkqGAkGEQFhaQenGrAI3iUpKilaiPSytKt74XfF6evM/vN7n67+xn6kl/Sb3bmvTdvZt68eTMNtbe3O8cyhboM0GWALgN0LKkJpUv2lYQFBFbgYcI7aZF6bcf+ZmXI8L0IlYShhBLCbELPTCiSKQOcTRimfA8nFP/fDTCEMJrQw2bpEVqV71ZLXXpARmHQDDCZ8DnhI8IrFkZoI0SVb/77iEXnX4WMzyAzEAbIJSwk9Mb3RMKMFMzWmYQK/N0bMnODYAB2q42i7B5CkY+dZ153i7JGyM64Af4hVIk13cdjFoQsy1yaAZ6qz6iC7ED4gJWEjaLsRkKpoX53MX1zUaajUvBSaSNkBmoXuI/QonyHCXMIeZq6PxJ+Vb5/I/ykqZcHHmGljGXcG8RtcCfhRVFWpjgulfahEzvQjn1GvaZeBXio9AJhV1ADoUcITaJsmKHuKvxWgr91NFx8N0FG2gOhbpb1WMGbxXRd6SE/lg61wrneRPjdT51tDkOTELe3YvrVWPC9CnH+h4SPlfKLCKMQChco/oEN1UD4krAF7Vy6EO14uay2kH0N4XZCDmFJpwEQhyEvAwxF1OV66MOEd8G4znIkuJNTCNcjhO3jUb+ZsIfwOqLKFks5IzFQlxOyURYhnAvjJXQa7Cu2J2Y8gbCBsJhwskf7SzCizxJGWHTejSFGoM0W8IhFA6HLBuiWLbbbvsn4gJ2GKd8T29NWeGodHx6NdXByWQn6pxLwqDT8XgEd5hiO0zXog5HCHkr8QbiO8AMOHwPF78fDUZWL9cmeep6B527CNsK3hAMKn8HYFYo0HX2S0I8wXyRUag0y6nFwWuBl5bDFSPCiuR/WvItwg6bO+YoB7jR0fjthBXxIg0FWAdbwVIy+SvOwyzytyNTRyzDYnlSlxEYh6hunePCLsV75t82aNrx7PCiiv1h0IurfajC2K+t9ZSd5j7AIv1mnxBLNCXJK61KMEiuxCdvOds0U5o48lGCcsgDt5RIqwUGoFMbfAQMcjDcn6GdSlPfe5aJsKWFWksHaM8gFqDSN8HxC3FKUFM3CulXpa2xPydJi8FJpql+6+2WACwiDNCPX4APvBvBSaRBkBsYAY+AXXOItbo2PZ5Y14Kn6oDF+MA7HyPMVI5I6IrI2XPY9Yb9SfpZoX6c5FSZDTeA5OIZM3jnOgL7t4lDUhiN0i40BLkNkVYjGUc0pqxGxQS1m0QBR5xvHf5I8B0A268eJWL5d6q/RNwSD7EYaba2XAZZrIj5J/bA9rYbFszUj5jdJntnoWHfoMtjCT50iDZCpm6HAkG4GTMMSKFKmjzRaI6wewfdhUSc/BbpKnoehXwS6LMQSaNPo24bQuMrGAGuRkChWHIi6nrjNd0pYGxUOkWlICgwgee5X1nstQvDTYZB20ccInGCr7S7A3vLTOJT7inCFSE7k++gL8sFTypQG2Z+pOOADEYezQxrv4+iPF07uIGQGJhD6hLBXlM3C8TZZKtCcJ/ZCZmAMEMVZX6UzCXN94D0XvFRaodnv02qAXkhHLXL+u/6qRrCh0kybrIzHcXim5jhcjb9LocPVIhS3pmM+IRLPDCiE5TcrnXegQDn+ZuGzNW25I5zcvMXDLxSgzjpD52crHSx3Ot47joNu1U4cL0hsZkAIcfbkGCFyKpOiLj3qdEyK8uXL24a65qRonBkhjvmf42YGQQeQCXpL45QqkcxI1tFG4QiXaPzXBJxd+hvaciL3DudodjuhJXCOofN/I6zky8tVBo/MCvPN7vYEPXYUbcs0nXd/XwUdqqBTp/FGHxLeBf5EGOkSJyLfJIzFqPzs0X49nNV0RJbNFh1vRt3paLveo349dBmLmaieSyLoQ1I+QL0c5UTkGxad4PVZgmjNj8vRMfAbNlkmvhy9DUmdpC9H1ZliO41V59SKkTFtTe4Vdpvh9/NgxFyFt22qrZuWb4LboG3n+dDykkitTfTgG4v3JKfjW6LqOI7abekMhV2ar1Fwq6FuBZzcNkf/jEbX9jixFSZNfl6McP6gTgQn6xCmymQkxxP80us05XDDT2D3iXp5cLpl4qg+0kn0nVAKX4s/Jjp/BNuT7oED5+ZOEKHvqYa8RJXTMTOdB1m+kF8GmIQRdMR63WSoH3E6P5aOGOpuUg4/Lo2GzEAYIAc5xFyxly+L0abdssylZSKGyIXMnCAYIKQJRZ/QHI2TIeb1uCjr74f+fhiApy9fkvyFbw5Plzr+E88C90UIy3rAsX9AZaSwT8q9RviCcJJz9FXZIQu5WWIgvN71Mc8pyC384li+AEmXARwoZKtU1On8WNrm6fshp/Oj7EDsAvHSLhHkbMM5IO0UzpAB+Oj6FPJ4IRxaDmZCka5/nOwyQJcBjm0D/CvAAF/S81D+EWScAAAAAElFTkSuQmCC")))}).TYPE="RedDirectionalLight",RedDirectionalLight.prototype=new RedBaseLight,Object.defineProperty(RedDirectionalLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedDirectionalLight.TYPE}),Object.freeze(RedDirectionalLight),(RedPointLight=function(e,t,r,i,n){if(!(this instanceof RedPointLight))return new RedPointLight(e,t,r,i,n);e instanceof RedGL||RedGLUtil.throwFunc("RedPointLight : RedGL Instance만 허용.","입력값 : "+e),this._lightColor=new Float32Array(4),this.intensity=null==n?1:n,this.alpha=null==r?1:r,this.radius=null==i?1:i,this.color=t||"#fff",this.x=0,this.y=0,this.z=0,this.radius=1,this.debug=!1,this._debugObject=RedMesh(e,RedSphere(e,1,16,16,16),RedColorMaterial(e)),this._debugObject.drawMode=e.gl.LINE_STRIP,this._UUID=RedGL.makeUUID()}).TYPE="RedPointLight",RedPointLight.prototype=new RedBaseLight,Object.defineProperty(RedPointLight.prototype,"TYPE",{configurable:!1,writable:!1,value:RedPointLight.TYPE}),RedDefinePropertyInfo.definePrototype("RedPointLight","radius","number",{min:0}),Object.freeze(RedPointLight),function(){var e,t;t=function(){},RedMTLLoader=function(r,i,n,a){if(!(this instanceof RedMTLLoader))return new RedMTLLoader(r,i,n,a);var o=this,s=new XMLHttpRequest;s.open("GET",i+n,!0),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),s.onreadystatechange=function(){if(4==s.readyState){var i;if(o.complete=!0,200==s.status)i=e(o,r,s.responseText),o.parseData=i;else o.parseData=new t;a&&a(o.parseData)}},s.addEventListener("error",function(e){}),s.send(),this.path=i,this.fileName=n,this.complete=!1,this.parseData=null},e=function(e,r,i){var n,a,o,s,d,l,u,c,f,h,R,m,p,_;for(var g in n={},o=/^(newmtl )/,s=/^(Ns )/,d=/^(Ka )/,l=/^(Kd )/,u=/^(Ks )/,c=/^(Ni )/,f=/^(d )/,h=/^(illum )/,R=/^(map_Kd )/,/^(map_Ks )/,m=/^(map_Ns )/,p=/^(map_bump )/,(i=i.replace(/^\#[\s\S]+?\n/g,"")).split("\n").forEach(function(t){var r;o.test(t)?(r=t.replace("newmtl ","").trim(),_={name:r},n[r]=_):d.test(t)?_.Ka=t.replace("Ka ","").split(" "):l.test(t)?_.Kd=t.replace("Kd ","").split(" "):u.test(t)?_.Ks=t.replace("Ks ","").split(" "):s.test(t)?_.Ns=+t.replace("Ns ",""):c.test(t)?_.Ni=+t.replace("Ni ",""):f.test(t)?_.d=+t.replace("d ",""):h.test(t)?(_.illum=+t.replace("illum ",""),_.illum):R.test(t)?_.map_Kd=e.path+t.replace("map_Kd ",""):m.test(t)?_.map_Ns=e.path+t.replace("map_Ns ",""):p.test(t)&&(_.map_bump=e.path+t.replace("map_bump ","").split(" ")[2])}),a=new t,n)a[g]=n[g];return a},Object.freeze(RedMTLLoader)}(),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h,R;RedOBJLoader=function(t,r,i,n){if(!(this instanceof RedOBJLoader))return new RedOBJLoader(t,r,i,n);var a=this,o=new XMLHttpRequest;o.open("GET",r+i,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),o.onreadystatechange=function(){4===o.readyState&&(a.result=e(a,t,o.responseText),a.modelParsingComplete=!0,a.resultMesh=void 0,n&&(a.mtlLoader?a.mtlLoader.complete&&n(a.result):n(a.result)))},o.send(),this.path=r,this.fileName=i,this.mtlLoader=null,this.modelParsingComplete=!1,this.callback=n,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedOBJLoader_"+RedGL.makeUUID(),this.result=null},r=function(e,t,r){var i,n,a,o;for(i in o={},t){var s,d,l,u,c,f;if((a=t[i]).mesh,a.use&&a.resultInterleave.length)f=a.ableLight,(n=r.parseData[a.materialKey])&&(n.map_Kd?(o[n.map_Kd]?d=o[n.map_Kd]:(d=RedBitmapTexture(e,n.map_Kd),o[n.map_Kd]=d),s=f?RedStandardMaterial(e,d):RedBitmapMaterial(e,d)):n.Kd&&(l=255*n.Kd[0],u=255*n.Kd[1],c=255*n.Kd[2],s=f?RedColorPhongTextureMaterial(e,RedGLUtil.rgb2hex(l,u,c)):a.ableNormal?RedColorPhongMaterial(e,RedGLUtil.rgb2hex(l,u,c)):RedColorMaterial(e,RedGLUtil.rgb2hex(l,u,c))),s&&(n.map_Ns&&(o[n.map_Ns]?d=o[n.map_Ns]:(d=RedBitmapTexture(e,n.map_Ns),o[n.map_Ns]=d),s.specularTexture=d),n.map_bump&&(o[n.map_bump]?d=o[n.map_bump]:(d=RedBitmapTexture(e,n.map_bump),o[n.map_bump]=d),s.normalTexture=d),void 0!==n.Ns&&(s.shininess=n.Ns),a.mesh.material=s))}},t=function(e,r,i){for(var n in i){var a,o;if((a=i[n]).use){var s,d,l,u=[];a.resultPosition.length&&u.push(RedInterleaveInfo("aVertexPosition",3)),a.resultNormal.length&&u.push(RedInterleaveInfo("aVertexNormal",3)),a.resultUV.length&&u.push(RedInterleaveInfo("aTexcoord",2)),s=RedBuffer(e,n+"_interleave",RedBuffer.ARRAY_BUFFER,new Float32Array(a.resultInterleave.length?a.resultInterleave:a.resultPosition),u),a.index.length&&a.index.length&&(d=RedBuffer(e,n+"_index",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(a.index))),l=a.resultUV.length&&a.resultNormal.length?RedColorPhongTextureMaterial(e,"#00ff00"):a.resultNormal?RedColorPhongMaterial(e,"#00ff00"):RedColorMaterial(e,"#0000ff"),o=RedMesh(e,RedGeometry(s,d),l),a.ableUV=!!a.resultUV.length,a.ableNormal=!!a.resultNormal.length,a.ableLight=!!(a.ableUV&a.ableNormal)}else o=RedMesh(e);o.name=n,a.mesh=o,r.addChild(o),t(e,o,a.childrenInfo)}},h=/^(mtllib )/,R=/^(usemtl )/,n=/^o /,a=/^g /,o=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,s=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,d=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,l=/f\s+(([\d]{1,}[\s]?){3,})+/,u=/f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,c=/f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,f=/f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,i=function(e,t,i){var m,p,_,g,v,E,M,b,L,T;for(_={position:[],normal:[],uv:[],points:[],normalPoints:[],uvPoints:[]},p={},m={},M=i.length;M--;)if(n.test(i[M])){b=!0;break}return b||(T={name:L="objModel"+RedGL.makeUUID(),groupName:L,index:[],position:[],resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},p[L]=g=T,m[L]=g,v=L),i.forEach(function(i){if(h.test(i))return E=RedMTLLoader(e,t.path,i.split(" ")[1],function(i){t.mtlLoader=i,t.modelParsingComplete&&t.callback&&(r(e,m,E),t.callback(t.result))}),void(t.mtlLoader=E);var M;if(R.test(i))b=i.split(" ").slice(1).join("").trim(),m[v].materialKey=b;else if(a.test(i))b=i.split(" ").slice(1).join("").trim(),p[v].use=!1,L={name:b,groupName:v,materialKey:b.replace(v+"_",""),index:[],position:g.position,resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},m[b]=g=L,p[v].childrenInfo[b]=g;else if(n.test(i)){var b,L;L={name:b=i.split(" ").slice(1).join("").trim(),groupName:b,materialKey:b,index:[],position:[],resultPosition:[],resultNormal:[],resultUV:[],resultInterleave:[],use:!0,childrenInfo:{}},p[b]=g=L,m[b]=g,v=b}if(o.test(i))M=i.split(" "),_.position.push(+M[1],+M[2],+M[3]),g.position.push(+M[1],+M[2],+M[3]),_.points[_.points.length]=[+M[1],+M[2],+M[3]];else if(s.test(i)){var T;T=i.split(" "),_.normal.push(+T[1],+T[2],+T[3]),_.normalPoints[_.normalPoints.length]=[+T[1],+T[2],+T[3]]}else if(d.test(i)){var P;P=i.split(" "),_.uv.push(+P[1],1-P[2]),_.uvPoints[_.uvPoints.length]=[+P[1],1-P[2]]}else if(f.test(i))(w=i.split(" ").slice(1,4)).forEach(function(e){var t,r,i;i=0,e=e.split("/"),I=+e[0]-1,x=+e[2]-1,t=_.points[I],r=_.normalPoints[x],_.position.length&&(i+=3),_.normal.length&&(i+=3),g.index.push(g.resultInterleave.length/i),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.normal.length&&(g.resultNormal.push(r[0],r[1],r[2]),g.resultInterleave.push(r[0],r[1],r[2]))});else if(c.test(i)){var x;if(4===(w=i.split(" ").slice(1,5)).length){var y=w[3];w[3]=w[0],w[4]=w[2],w[5]=y}w.forEach(function(e){var t,r,i,n;n=0,e=e.split("/"),I=+e[0]-1,U=+e[1]-1,x=+e[2]-1,t=_.points[I],i=_.uvPoints[U],r=_.normalPoints[x],_.position.length&&(n+=3),_.normal.length&&(n+=3),_.uv.length&&(n+=2),g.index.push(g.resultInterleave.length/n),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.normal.length&&(g.resultNormal.push(r[0],r[1],r[2]),g.resultInterleave.push(r[0],r[1],r[2])),_.uv.length&&(g.resultUV.push(i[0],i[1]),g.resultInterleave.push(i[0],i[1]))})}else if(u.test(i)){var w,U;(w=i.split(" ").slice(1,4)).forEach(function(e){var t,r,i;i=0,e=e.split("/"),I=+e[0]-1,U=+e[1]-1,t=_.points[I],r=_.uvPoints[U],_.position.length&&(i+=3),_.uv.length&&(i+=2),g.index.push(g.resultInterleave.length/i),_.position.length&&(g.resultPosition.push(t[0],t[1],t[2]),g.resultInterleave.push(t[0],t[1],t[2])),_.uv.length&&(g.resultUV.push(r[0],r[1]),g.resultInterleave.push(r[0],r[1]))})}else if(l.test(i)){var I;I=i.split(" "),g.resultInterleave=g.resultPosition=g.position,g.index.push(+I[1]-1,+I[2]-1,+I[3]-1),g.index.push(+I[1]-1,+I[3]-1,+I[4]-1)}}),{info:m,infoHierarchy:p}},e=function(e,r,n){n=n.replace(/^\#[\s\S]+?\n/g,"");var a=i(r,e,n.split("\n"));return t(r,e.resultMesh,a.infoHierarchy),new function(e){for(var t in e)this[t]=e[t]}({fileName:e.fileName,path:e.path,resultMesh:e.resultMesh,parseRawInfo:a.info,parseInfoHierarchy:a.infoHierarchy,parseInfoMaterial:e.mtlLoader})},Object.freeze(RedOBJLoader)}(),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p,_,g;Red3DSLoader=function(t,r,i,n){if(!(this instanceof Red3DSLoader))return new Red3DSLoader(t,r,i,n);var a=this,o=new XMLHttpRequest;o.open("GET",r+i,!0),o.responseType="arraybuffer",o.onreadystatechange=function(){4==o.readyState&&200===o.status&&(a.result=e(a,t,o.response),n&&n(a.result))},o.send(),this.redGL=t,this.position=0,this.materials={},this.meshs=[],this.path=r,this.fileName=i,this.callback=n,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRed3DSLoader_"+RedGL.makeUUID(),this.result=null},r=function(e,t){var r={};return r.cur=e.position,r.id=a(e,t),r.size=o(e,t),r.end=r.cur+r.size,r.cur+=6,r},i=function(e,t,i){if(i.cur>=i.end)return 0;e.position=i.cur;try{var n=r(e,t);return i.cur+=n.size,n.id}catch(e){return 0}},n=function(e,t){e.position=t.end},a=function(e,t){var r=t.getUint16(e.position,!0);return e.position+=2,r},o=function(e,t){var r=t.getUint32(e.position,!0);return e.position+=4,r},d=function(e,t){var r=t.getUint8(e.position,!0);return e.position+=1,r},s=function(e,t,r){var i,n,a="";for(i=0;i<r&&(n=d(e,t));i++)a+=String.fromCharCode(n);return a},R=function(e,t){try{var r=t.getFloat32(e.position,!0);return e.position+=4,r}catch(e){}},l=function(e,t){var i,a=r(e,t);return 17===a.id||18===a.id?i=RedGLUtil.rgb2hex(d(e,t),d(e,t),d(e,t)):16!==a.id&&19!==a.id||(i=RedGLUtil.rgb2hex(d(e,t),d(e,t),d(e,t))),n(e,a),i},c=function(e){e.position-=6},u=function(e,t,a){for(var o=r(e,t),d=i(e,t,o),l={};0!==d;){switch(d){case 41728:var u=s(e,t,128);l=RedBitmapTexture(e.redGL,a+u);break;case 41816:l.offset||(l.offset={}),l.offset.x=R(e,t);break;case 41818:l.offset||(l.offset={}),l.offset.y=R(e,t);break;case 41812:l.repeat||(l.repeat={}),l.repeat.x=R(e,t);break;case 41814:l.repeat||(l.repeat={}),l.repeat.y=R(e,t)}d=i(e,t,o)}return n(e,o),l},_=function(e,t,o){for(var f,h=r(e,t),R=i(e,t,h),m={};0!==R;){switch(R){case 40960:m.name=s(e,t,64);break;case 41093:m.wireframe=!0;break;case 41095:d(e,t);break;case 41089:case 41091:break;case 40992:m.color=l(e,t);break;case 41008:case 40976:break;case 41024:var p=a(e,t);m.shininess=p;break;case 41472:c(e),m.diffuseTexture=u(e,t,o);break;case 41520:c(e),m.normalTexture=u(e,t,o);break;case 41488:c(e);break;case 41476:c(e),m.specularTexture=u(e,t,o)}R=i(e,t,h)}m.diffuseTexture?"shininess"in m?((f=RedStandardMaterial(e.redGL,m.diffuseTexture)).normalTexture=m.normalTexture,f.specularTexture=m.specularTexture):f=RedBitmapTexture(e.redGL,m.diffuseTexture):(m.normalTexture||m.specularTexture?f=RedColorPhongTextureMaterial(e.redGL):"shininess"in m?f=RedColorPhongMaterial(e.redGL):RedColorMaterial(e.redGL),f.color=m.color),n(e,h),f.shininess=m.shininess,f.name=m.name,e.materials[m.name]=f},f=function(e,t,n){for(var a=r(e,t),s=i(e,t,a);0!==s;){switch(s){case 15678:o(e,t);break;case 256:var d=R(e,t);e.resultMesh.scaleX=d,e.resultMesh.scaleY=d,e.resultMesh.scaleZ=d;break;case 16384:c(e),m(e,t);break;case 45055:c(e),_(e,t,n)}s=i(e,t,a)}},g=function(e,t){r(e,t);for(var i=s(e,t,64),n=a(e,t),o=[],d=0;d<n;++d)o.push(a(e,t));return{name:i,index:o}},p=function(e,t,i){for(var o=r(e,t),s=a(e,t),d=[],l=0;l<s;++l)d.push(a(e,t),a(e,t),a(e,t)),a(e,t);for(;e.position<o.end;){if(16688===(o=r(e,t)).id){c(e);var u=g(e,t),f=e.materials[u.name];void 0!==f&&(i.material=f,""===f.name&&(f.name=i.name))}n(e,o)}return n(e,o),d},h=function(e,t){for(var o,s,d,l,u,f=r(e,t),h=i(e,t,f),m=[],_=RedMesh(e.redGL);0!==h;){switch(h){case 16656:var g=a(e,t),v=[];for(s=0;s<g;s++)v.push(R(e,t),R(e,t),R(e,t));break;case 16672:c(e),o=p(e,t,_);break;case 16704:var E=a(e,t);for(m=[],s=0;s<E;s++)m.push(R(e,t)),m.push(1-R(e,t));break;case 16736:var M=[];for(s=0;s<12;s++)M[s]=R(e,t);var b=mat4.create();b[0]=M[0],b[1]=M[6],b[2]=M[3],b[3]=M[9],b[4]=M[2],b[5]=M[8],b[6]=M[5],b[7]=M[11],b[8]=M[1],b[9]=M[7],b[10]=M[4],b[11]=M[10],b[12]=0,b[13]=0,b[14]=0,b[15]=1}h=i(e,t,f)}n(e,f);var L=RedGLUtil.calculateNormals(v,o),T=[];for(s=0,d=v.length/3;s<d;s++)T.push(v[3*s+0],v[3*s+1],v[3*s+2]),T.push(L[3*s+0],L[3*s+1],L[3*s+2]),m.length&&T.push(m[2*s+0],m[2*s+1]);var P=[];P.push(RedInterleaveInfo("aVertexPosition",3)),P.push(RedInterleaveInfo("aVertexNormal",3)),m.length&&P.push(RedInterleaveInfo("aTexcoord",2)),l=RedBuffer(e.redGL,"testRed3DS",RedBuffer.ARRAY_BUFFER,new Float32Array(T),P),u=RedBuffer(e.redGL,"testRed3DS",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(o));var x=RedGeometry(l,u);return _.geometry=x,_.name="mesh"+RedGL.makeUUID(),_.matrix=b,_},m=function(e,t){var a=r(e,t),o=s(e,t,64);a.cur=e.position;for(var d,l=i(e,t,a);0!==l;)16640===l&&(c(e),(d=h(e,t)).name=o,e.meshs.push(d)),l=i(e,t,a);n(e,a)},t=function(e,t,n){var a=new DataView(t),o=r(e,a);if(15786===o.id||49725===o.id||19789===o.id)for(var s=i(e,a,o);0!==s;){switch(s){case 2:break;case 15677:c(e),f(e,a,n)}s=i(e,a,o)}},e=function(e,r,i){return t(e,i,e.path),e.meshs.forEach(function(t){e.resultMesh.addChild(t)}),{fileName:e.fileName,path:e.path,resultMesh:e.resultMesh}},Object.freeze(Red3DSLoader)}(),function(){var e,t,r,i,n,a,o;RedDAELoader=function(t,r,i,n){if(!(this instanceof RedDAELoader))return new RedDAELoader(t,r,i,n);var a=r+i,o=this,s=new XMLHttpRequest;s.open("GET",a,!0),s.setRequestHeader("Content-Type","application/xml; charset=UTF-8"),s.onreadystatechange=function(){if(4===s.readyState&&200===s.status){var r=new DOMParser;o.result=e(o,t,r.parseFromString(s.responseText,"text/xml")),n&&n(o.result)}},s.send(),this.path=r,this.fileName=i,this.callback=n,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedDAELoader_"+RedGL.makeUUID(),this.result=null},i=function(e){var t,r,i,n,a,o,s,d=[],l=[],u=[];for(a=(n=e[0].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,o=(n=e[1].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,s=(n=e[2].querySelector("float_array"))?n.textContent.split(" ").map(Number):null,t=0,r=a.length/3;t<r;t++)i=3*t,d.push([a[i],a[i+1],a[i+2]]);if(o)for(t=0,r=o.length/3;t<r;t++)i=3*t,l.push([o[i],o[i+1],o[i+2]]);if(s)for(t=0,r=s.length/2;t<r;t++)i=2*t,u.push([s[i],1-s[i+1]]);return{pointList:d,normalPointList:l,uvPointList:u}},n=function(e,t,r){var i={};return r.querySelectorAll("library_images image").forEach(function(r){i[r.getAttribute("id")]=RedBitmapTexture(e,t.path+r.querySelector("init_from").textContent)}),i},a=function(e,t){var r={};return e.querySelectorAll("library_effects effect").forEach(function(e){e.querySelector("newparam init_from")&&(r[e.getAttribute("id")]={texture:t[e.querySelector("newparam init_from").textContent]})}),r},o=function(e,t){var r={};return e.querySelectorAll("library_materials material").forEach(function(e){r[e.getAttribute("id")]={effect:t[e.querySelector("instance_effect").getAttribute("url").replace("#","")]}}),r},t=function(e,t,r){var i=n(e,t,r),s=a(r,i);return{textureMap:i,effectMap:s,materialMap:o(r,s)}},r=function(e,r,n){n.querySelectorAll("library_geometries geometry mesh").forEach(function(a){var o,s,d;o=a.querySelectorAll("source"),s=i(o),d=t(r,e,n);var l=a.querySelectorAll("source").length;a.querySelectorAll("polylist").forEach(function(t){var i,n,a,o,u=[],c=t.querySelector("p").textContent.split(" "),f=[],h=[],R=[],m=[];c.forEach(function(e,t){t%l==0?f.push(+e):t%l==1?h.push(+e):t%l==2&&R.push(+e)});var p={};if(f.forEach(function(e,t){u[o=8*e]=s.pointList[e][0],u[o+1]=s.pointList[e][1],u[o+2]=s.pointList[e][2],p[e]||(p[e]=[]),p[e].push(t),u[o+3]=s.normalPointList[h[t]][0],u[o+4]=s.normalPointList[h[t]][1],u[o+5]=s.normalPointList[h[t]][2],u[o+6]=s.uvPointList[R[t]][0],u[o+7]=s.uvPointList[R[t]][1],m.push(e)}),i=RedBuffer(r,"daeInterleaveBuffer"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(u),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),n=RedBuffer(r,"daeIndexData"+RedGL.makeUUID(),RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(m)),(a=RedMesh(r)).geometry=RedGeometry(i,n),d.materialMap[t.getAttribute("material")].effect){var _=d.materialMap[t.getAttribute("material")].effect.texture;a.material=RedStandardMaterial(r,_)}else a.material=RedColorPhongMaterial(r);e.resultMesh.addChild(a)})})},e=function(e,t,i){return r(e,t,i),{fileName:e.fileName,path:e.path,resultMesh:e.resultMesh}},Object.freeze(RedDAELoader)}(),function(){var e,t,r={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},i=(t={},function(e,r,i,n){if(t[e])requestAnimationFrame(function(){i(t[e])});else{var a=new XMLHttpRequest;a.open("GET",e,!0),a.onreadystatechange=function(r){4===a.readyState&&200===a.status?(t[e]=a,i(a)):n(a,r)},a.send()}}),n=function(){var e={};return function(t,r,i){if(e[t])requestAnimationFrame(function(){r(e[t])});else{var n=new XMLHttpRequest;n.open("GET",t,!0),n.overrideMimeType("application/octet-stream"),n.responseType="arraybuffer",n.onreadystatechange=function(a){4===n.readyState&&200===n.status?(e[t]=n,r(n)):i(n,a)},n.send()}}}();RedGLTFLoader=function(t,r,o,s,d,l){if(!(this instanceof RedGLTFLoader))return new RedGLTFLoader(t,r,o,s,d,l);var u=this;if(o.indexOf(".glb")>-1){var c;c=function(e){var t="";return e.map(function(e){t+=String.fromCharCode(e)}),t},n(r+o,function(r){for(var i=null,n=null,a=null,o=null,d=0,l=0,f=null,h=new DataView(r.response,12),R=(c(new Uint8Array(r.response,0,4)),h.getUint32(4,!0),h.getUint32(8,!0),new DataView(r.response,12));d<R.byteLength;)l=R.getUint32(d,!0),d+=4,f=R.getUint32(d,!0),d+=4,1313821514===f?(n=new Uint8Array(r.response,12+d,l),i=c(n)):5130562===f&&(o=12+d,a=r.response.slice(o,o+l)),d+=l;if(null===i)throw new Error("JSON content not found");var m=JSON.parse(i),p=a;m.images&&m.images.forEach(function(e){if("image/png"===e.mimeType||"image/jpeg"===e.mimeType||"image/gif"===e.mimeType){var t;t=m.bufferViews[e.bufferView].byteOffset||0;var r=p.slice(t,t+m.bufferViews[e.bufferView].byteLength),i=new Blob([new Uint8Array(r)],{type:e.mimeType});e.uri=URL.createObjectURL(i)}}),e(u,t,m,function(){s&&s(u)},p)},function(e,t){})}else i(r+o,null,function(r){e(u,t,JSON.parse(r.response),function(){s&&s(u)})},function(e,t){});this.redGL=t,this.path=r,this.fileName=o,this.resultMesh=RedMesh(t),this.resultMesh.name="instanceOfRedGLTFLoader_"+RedGL.makeUUID(),this.parsingResult={groups:[],materials:[],uris:{buffers:[]},textures:{},cameras:[],animations:[]},this.parsingOption=l,this.environmentTexture=d||null;var f=null;this.stopAnimation=function(){a.indexOf(f)>-1&&a.splice(a.indexOf(f),1)},this.playAnimation=function(e){a.push(f={startTime:performance.now(),targetAnimationData:e})}},RedDefinePropertyInfo.definePrototype("RedGLTFLoader","environmentTexture","samplerCube",{callback:function(e){this.parsingResult.materials.forEach(function(t){"environmentTexture"in t&&(t.environmentTexture=e)})}});var a=[];RedGLTFLoader.animationLooper=function(e){for(var t,r,i,n,o,s,d,l,u,c,f,h,R,m,p,_,g,v,E,M,b,L,T,P,x,y,w,U,I,B,F,D,G,A,S,O,C,N,k,Y,X,j,z,V,Z,W,H,q,J,K,Q,$,ee,te,re,ie,ne=a.length;ne--;)for(w=(P=(y=a[ne]).targetAnimationData).length;w--;){for(U=P[w],t=(e-y.startTime)%(1e3*P.maxTime)/1e3,I=U.target,D=U.time,G=U.time,A=D.length,S=0,B=0,r=D[F=D.length-1],i=D[B];S<A;S++){var ae=D[S];if(ae<t&&(r=D[F=S],i=null==D[F+1]?D[B=0]:D[B=F+1]),0==S&&t<D[S]){r=D[F=A-1],i=D[B=S],t=ae;break}if(S==A-1&&t>ae){r=D[F=0],i=D[B=A-1],t=ae;break}}if("CUBICSPLINE"==U.interpolation){"NaN"==(x=i-r).toString()&&(x=0);var oe=(t-r)/x;"NaN"==oe.toString()&&(oe=0);var se=oe*oe,de=se*oe,le=-2*de+3*se,ue=de-se,ce=1-le,fe=ue-se+oe;if(I){var he,Re,me,pe,_e=U.data;switch(U.key){case"rotation":if((T=(E=_e[12*F+4])*E+(M=_e[12*F+5])*M+(b=_e[12*F+6])*b+(L=_e[12*F+7])*L)>0&&(T=1/Math.sqrt(T)),f=E*T,h=M*T,R=b*T,m=L*T,(T=(E=_e[12*B+4])*E+(M=_e[12*B+5])*M+(b=_e[12*B+6])*b+(L=_e[12*B+7])*L)>0&&(T=1/Math.sqrt(T)),n=E*T,o=M*T,s=b*T,d=L*T,(T=(E=_e[12*F+8])*E+(M=_e[12*F+9])*M+(b=_e[12*F+10])*b+(L=_e[12*F+11])*L)>0&&(T=1/Math.sqrt(T)),p=E*T,_=M*T,g=b*T,v=L*T,(T=(E=_e[12*F+0])*E+(M=_e[12*F+1])*M+(b=_e[12*F+2])*b+(L=_e[12*F+3])*L)>0&&(T=1/Math.sqrt(T)),F!=A-1){var ge=[0,0,0],ve=(E=ce*(he=f)+fe*(Re=p*x)+le*(me=n)+ue*(pe=E*T*x))*(Ne=E+E),Ee=E*(ke=(M=ce*(he=h)+fe*(Re=_*x)+le*(me=o)+ue*(pe=M*T*x))+M),Me=E*(Ye=(b=ce*(he=R)+fe*(Re=g*x)+le*(me=s)+ue*(pe=b*T*x))+b),be=M*Ye,Le=(L=ce*(he=m)+fe*(Re=v*x)+le*(me=d)+ue*(pe=L*T*x))*Ne,Te=L*ke,Pe=L*Ye;(Ce=[])[0]=1-((Xe=M*ke)+(je=b*Ye)),Ce[4]=Ee-Pe,Ce[8]=Me+Te,Ce[1]=Ee+Pe,Ce[5]=1-(ve+je),Ce[9]=be-Le,Ce[2]=Me-Te,Ce[6]=be+Le,Ce[10]=1-(ve+Xe),Ce[3]=0,Ce[7]=0,Ce[11]=0,Ce[12]=0,Ce[13]=0,Ce[14]=0,Ce[15]=1;var xe=Ce[0],ye=Ce[4],we=Ce[8],Ue=(Ce[1],Ce[5]),Ie=Ce[9],Be=(Ce[2],Ce[6]),Fe=Ce[10];ge[1]=Math.asin(Math.max(-1,Math.min(1,we))),Math.abs(we)<.99999?(ge[0]=Math.atan2(-Ie,Fe),ge[2]=Math.atan2(-ye,xe)):(ge[0]=Math.atan2(Be,Ue),ge[2]=0),ge[0]=-180*ge[0]/Math.PI,ge[1]=-180*ge[1]/Math.PI,ge[2]=-180*ge[2]/Math.PI,I.rotationX=ge[0],I.rotationY=ge[1],I.rotationZ=ge[2]}break;case"translation":n=_e[9*F+3],o=_e[9*F+4],s=_e[9*F+5],f=_e[9*B+3],h=_e[9*B+4],R=_e[9*B+5],p=_e[9*F+6],_=_e[9*F+7],g=_e[9*F+8],l=_e[9*B+0],u=_e[9*B+1],c=_e[9*B+2],F!=A-1&&(he=f,Re=p*x,me=n,pe=l*x,I.x=ce*he+fe*Re+le*me+ue*pe,he=h,Re=_*x,me=o,pe=u*x,I.y=ce*he+fe*Re+le*me+ue*pe,he=R,Re=g*x,me=s,pe=c*x,I.z=ce*he+fe*Re+le*me+ue*pe);break;case"scale":n=_e[9*F+3],o=_e[9*F+4],s=_e[9*F+5],f=_e[9*B+3],h=_e[9*B+4],R=_e[9*B+5],p=_e[9*F+6],_=_e[9*F+7],g=_e[9*F+8],l=_e[9*B+0],u=_e[9*B+1],c=_e[9*B+2],F!=A-1&&(he=f,Re=p*x,me=n,pe=l*x,I.scaleX=ce*he+fe*Re+le*me+ue*pe,he=h,Re=_*x,me=o,pe=u*x,I.scaleY=ce*he+fe*Re+le*me+ue*pe,he=R,Re=g*x,me=s,pe=c*x,I.scaleZ=ce*he+fe*Re+le*me+ue*pe);break;case"weights":for(O=U.targets.length;O--;){for(N=(C=U.targets[O]).geometry.interleaveBuffer.data,k=C._morphInfo.origin,Y=C.geometry.interleaveBuffer.stride,j=N.length/Y,K=C._morphInfo.list.length,G=U.data,(Q=C._morphInfo.list).cacheData||(Q.cacheData={}),X=0;X<j;X++){if(J=X*Y,ie=Q.cacheData[J+"_"+F+"_"+B])z=ie[0],V=ie[1],Z=ie[2],W=ie[3],H=ie[4],q=ie[5];else{for(z=k[J],V=k[J],Z=k[J+1],W=k[J+1],H=k[J+2],q=k[J+2],$=K;$--;)$%3==1&&(ee=G[F*K+$],te=G[B*K+$],z+=ee*(ze=(re=Q[$].interleaveData)[J]),V+=te*ze,Z+=ee*(ze=re[J+1]),W+=te*ze,H+=ee*(ze=re[J+2]),q+=te*ze);Q.cacheData[J+"_"+F+"_"+B]=[z,V,Z,W,H,q]}N[J]=z+x*(V-z),N[J+1]=Z+x*(W-Z),N[J+2]=H+x*(q-H)}C.geometry.interleaveBuffer.upload(N)}}}}else if("NaN"==(x="STEP"==U.interpolation?0:(t-r)/(i-r)).toString()&&(x=0),I){_e=U.data;switch(U.key){case"rotation":var De,Ge,Ae,Se,Oe;(T=(E=_e[4*F])*E+(M=_e[4*F+1])*M+(b=_e[4*F+2])*b+(L=_e[4*F+3])*L)>0&&(T=1/Math.sqrt(T)),f=E*T,h=M*T,R=b*T,m=L*T,(T=(E=_e[4*B])*E+(M=_e[4*B+1])*M+(b=_e[4*B+2])*b+(L=_e[4*B+3])*L)>0&&(T=1/Math.sqrt(T)),(Ge=f*(n=E*T)+h*(o=M*T)+R*(s=b*T)+m*(d=L*T))<0&&(Ge=-Ge,n=-n,o=-o,s=-s,d=-d),1-Ge>glMatrix.EPSILON?(De=Math.acos(Ge),Ae=Math.sin(De),Se=Math.sin((1-x)*De)/Ae,Oe=Math.sin(x*De)/Ae):(Se=1-x,Oe=x);var Ce,Ne,ke,Ye,Xe,je;ge=[0,0,0],ve=(E=Se*f+Oe*n)*(Ne=E+E),Ee=E*(ke=(M=Se*h+Oe*o)+M),Me=E*(Ye=(b=Se*R+Oe*s)+b),be=M*Ye,Le=(L=Se*m+Oe*d)*Ne,Te=L*ke,Pe=L*Ye;(Ce=[])[0]=1-((Xe=M*ke)+(je=b*Ye)),Ce[4]=Ee-Pe,Ce[8]=Me+Te,Ce[1]=Ee+Pe,Ce[5]=1-(ve+je),Ce[9]=be-Le,Ce[2]=Me-Te,Ce[6]=be+Le,Ce[10]=1-(ve+Xe),Ce[3]=0,Ce[7]=0,Ce[11]=0,Ce[12]=0,Ce[13]=0,Ce[14]=0,Ce[15]=1;xe=Ce[0],ye=Ce[4],we=Ce[8],Ce[1],Ue=Ce[5],Ie=Ce[9],Ce[2],Be=Ce[6],Fe=Ce[10];ge[1]=Math.asin(Math.max(-1,Math.min(1,we))),Math.abs(we)<.99999?(ge[0]=Math.atan2(-Ie,Fe),ge[2]=Math.atan2(-ye,xe)):(ge[0]=Math.atan2(Be,Ue),ge[2]=0),ge[0]=-180*ge[0]/Math.PI,ge[1]=-180*ge[1]/Math.PI,ge[2]=-180*ge[2]/Math.PI,I.rotationX=ge[0],I.rotationY=ge[1],I.rotationZ=ge[2];break;case"translation":n=_e[3*B],o=_e[3*B+1],s=_e[3*B+2],f=_e[3*F],h=_e[3*F+1],R=_e[3*F+2],I.x=f+x*(n-f),I.y=h+x*(o-h),I.z=R+x*(s-R);break;case"scale":n=_e[3*B],o=_e[3*B+1],s=_e[3*B+2],f=_e[3*F],h=_e[3*F+1],R=_e[3*F+2],I.scaleX=f+x*(n-f),I.scaleY=h+x*(o-h),I.scaleZ=R+x*(s-R);break;case"weights":for(O=U.targets.length;O--;){var ze;for(N=(C=U.targets[O]).geometry.interleaveBuffer.data,k=C._morphInfo.origin,Y=C.geometry.interleaveBuffer.stride,j=N.length/Y,K=C._morphInfo.list.length,G=U.data,(Q=C._morphInfo.list).cacheData||(Q.cacheData={}),X=0;X<j;X++){if(J=X*Y,ie=Q.cacheData[J+"_"+F+"_"+B])z=ie[0],V=ie[1],Z=ie[2],W=ie[3],H=ie[4],q=ie[5];else{for(z=k[J],V=k[J],Z=k[J+1],W=k[J+1],H=k[J+2],q=k[J+2],$=K;$--;)ee=G[F*K+$],te=G[B*K+$],z+=ee*(ze=(re=Q[$].interleaveData)[J]),V+=te*ze,Z+=ee*(ze=re[J+1]),W+=te*ze,H+=ee*(ze=re[J+2]),q+=te*ze;Q.cacheData[J+"_"+F+"_"+B]=[z,V,Z,W,H,q]}N[J]=z+x*(V-z),N[J+1]=Z+x*(W-Z),N[J+2]=H+x*(q-H)}C.geometry.interleaveBuffer.upload(N)}}}}},e=function(){var e,t,i,a,o,s,d,l,u,c,f,h,R,m;e=function(e){void 0===e.asset&&RedGLUtil.throwFunc("RedGLTFLoader - asset은 반드시 정의되어야함"),e.asset.version[0]<2&&RedGLUtil.throwFunc("RedGLTFLoader - asset의 버전은 2.0이상이어야함")},i=function(e,t,r){var i=0,a=0,o=[];t.buffers.forEach(function(e,t){e._redURIkey="buffers",e._redURIIndex=t,o.push(e)}),o.forEach(function(t){if(i++,t.uri instanceof ArrayBuffer)a++,e.parsingResult.uris[t._redURIkey][t._redURIIndex]=new DataView(t.uri),a==i&&r&&r();else{var o="data:"==t.uri.substr(0,5)?t.uri:e.path+t.uri;n(o,function(n){a++,e.parsingResult.uris[t._redURIkey][t._redURIIndex]=new DataView(n.response),a==i&&r&&r()},function(e,t){})}})},t=function(e,t,r){i(e,t,r)},l=function(e,t){t.cameras&&t.cameras.forEach(function(t){var r=RedCamera();"orthographic"==t.type?r.mode2DYn=!0:(r.fov=180*t.perspective.yfov/Math.PI,r.farClipping=t.perspective.zfar,r.nearClipping=t.perspective.znear),e.parsingResult.cameras.push(r)})},a=function(e,t,r){var i,n,a,o;a=t.scenes[0].nodes,i=0,n=a.length;var s=function(){o=a[i],d(e,t,o,t.nodes[o],e.resultMesh),++i===n?r&&r():requestAnimationFrame(s)};requestAnimationFrame(s)},f=mat4.create(),h=[0,0,0],R=[],m=[],u=function(e,t){"matrix"in t&&(c=t.matrix,RedGLUtil.mat4ToEuler(c,h),e.rotationX=-180*h[0]/Math.PI,e.rotationY=-180*h[1]/Math.PI,e.rotationZ=-180*h[2]/Math.PI,e.x=c[12],e.y=c[13],e.z=c[14],mat4.getScaling(m,c),e.scaleX=m[0],e.scaleY=m[1],e.scaleZ=m[2]),"rotation"in t&&(R=t.rotation,RedGLUtil.quaternionToRotationMat4(R,f),RedGLUtil.mat4ToEuler(f,h),e.rotationX=-180*h[0]/Math.PI,e.rotationY=-180*h[1]/Math.PI,e.rotationZ=-180*h[2]/Math.PI),"translation"in t&&(e.x=t.translation[0],e.y=t.translation[1],e.z=t.translation[2]),"scale"in t&&(e.scaleX=t.scale[0],e.scaleY=t.scale[1],e.scaleZ=t.scale[2])};var p=function(e,t,r,i){if(n=r[i].RedMesh){var n=r[i].RedMesh;t.joints.push(n),n.material=RedColorMaterial(e.redGL,"#ff0000"),n.drawMode=e.redGL.gl.LINE_LOOP,n.depthTestFunc=e.redGL.gl.NEVER}else requestAnimationFrame(function(){p(e,t,r,i)})},_=function(e,t,r,i){var n={joints:[],inverseBindMatrices:[]},a=t.nodes;r.joints.forEach(function(t){p(e,n,a,t)}),r.skeleton&&(n.skeleton=t.nodes[r.skeleton].RedMesh);var o,s=r.inverseBindMatrices,d=new b(e,t,s),l=d.componentType_BYTES_PER_ELEMENT,u=d.bufferViewByteStride,c=d.bufferURIDataView,f=d.getMethod,h=d.accessor.type,R=d.accessor.count,m=0,_=u/l,g=d.startIndex;switch(h){case"MAT4":if(u)for(o=g+R*(u/l);g<o;g++)m%_<16&&n.inverseBindMatrices.push(c[f](g*l,!0)),m++;else for(o=g+16*R;g<o;g++)n.inverseBindMatrices.push(c[f](g*l,!0)),m++}n.inverseBindMatrices=new Float32Array(n.inverseBindMatrices),i.skinInfo=n};d=function(e,t,r,i,n){if("mesh"in i){var a=i.mesh;o(e,t,t.meshes[a]).forEach(function(r){i.RedMesh=r,n.addChild(r),u(r,i),"children"in i&&i.children.forEach(function(i){d(e,t,i,t.nodes[i],r)}),"skin"in i&&requestAnimationFrame(function(){_(e,t,t.skins[i.skin],r)})})}else{var s;if(e.parsingResult.groups[r]?(s=e.parsingResult.groups[r],i.RedMesh=s):(s=RedMesh(e.redGL),n.addChild(s),i.RedMesh=s,e.parsingResult.groups[r]=s,e.parsingResult.groups[r].name=i.name),u(s,i),"camera"in i){e.parsingResult.cameras[i.camera]._parentMesh=n,e.parsingResult.cameras[i.camera]._targetMesh=s;var l=RedMesh(e.redGL);s.addChild(l),e.parsingResult.cameras[i.camera]._cameraMesh=l}"children"in i&&i.children.forEach(function(r){d(e,t,r,t.nodes[r],s)}),"skin"in i&&requestAnimationFrame(function(){_(e,t,t.skins[i.skin],s)})}};var g,v,E,M=function(e,t,i,n,a,o,s,d,l,u){if(i.sparse){var c=[],f=[],h=[];!function(){var a,o,s,d,l,u=i.sparse,R=u.values,m=n.bufferViews[R.bufferView],p=m.buffer;n.buffers[p].uri&&(a=e.parsingResult.uris.buffers[p]),(d=r[i.componentType])==Float32Array&&(l="getFloat32"),d==Uint32Array&&(l="getUint32"),d==Uint16Array&&(l="getUint16"),d==Int16Array&&(l="getInt16"),d==Uint8Array&&(l="getUint8"),d==Int8Array&&(l="getInt8");var _=i.byteOffset||0;switch(o=((m.byteOffset||0)+_)/d.BYTES_PER_ELEMENT,i.type){case"VEC3":for(s=o+d.BYTES_PER_ELEMENT*u.count/d.BYTES_PER_ELEMENT*3;o<s;o++)"NORMAL"==t?f.push(a[l](o*d.BYTES_PER_ELEMENT,!0)):"POSITION"==t&&c.push(a[l](o*d.BYTES_PER_ELEMENT,!0));break;case"VEC2":for(s=o+d.BYTES_PER_ELEMENT*u.count/d.BYTES_PER_ELEMENT*2;o<s;o++)"TEXCOORD_0"==t&&h.push(a[l](o*d.BYTES_PER_ELEMENT,!0))}}();var R,m,p,_,g,v=i.sparse,E=v.indices,M=n.bufferViews[E.bufferView],b=M.buffer;n.buffers[b].uri&&(R=e.parsingResult.uris.buffers[b]),(_=r[E.componentType])==Uint16Array?g="getUint16":_==Uint8Array&&(g="getUint8");var L=E.byteOffset||0;p=(m=((M.byteOffset||0)+L)/_.BYTES_PER_ELEMENT)+_.BYTES_PER_ELEMENT*v.count/_.BYTES_PER_ELEMENT;for(var T=0;m<p;m++){var P=R[g](m*_.BYTES_PER_ELEMENT,!0);a[3*P]=c[3*T],a[3*P+1]=c[3*T+1],a[3*P+2]=c[3*T+2],T++}}},b=function(e,t,i){switch(this.accessor=t.accessors[i],this.bufferView=t.bufferViews[this.accessor.bufferView],this.bufferIndex=this.bufferView.buffer,this.buffer=t.buffers[this.bufferIndex],this.bufferURIDataView=null,this.buffer.uri&&(this.bufferURIDataView=e.parsingResult.uris.buffers[this.bufferIndex]),this.componentType=r[this.accessor.componentType],this.componentType_BYTES_PER_ELEMENT=this.componentType.BYTES_PER_ELEMENT,this.componentType){case Float32Array:this.getMethod="getFloat32";break;case Uint32Array:this.getMethod="getUint32";break;case Uint16Array:this.getMethod="getUint16";break;case Int16Array:this.getMethod="getInt16";break;case Uint8Array:this.getMethod="getUint8";break;case Int8Array:this.getMethod="getInt8";break;default:RedGLUtil.throwFunc("파싱할수없는 타입",this.componentType)}this.accessorBufferOffset=this.accessor.byteOffset||0,this.bufferViewOffset=this.bufferView.byteOffset||0,this.bufferViewByteStride=this.bufferView.byteStride||0,this.startIndex=(this.bufferViewOffset+this.accessorBufferOffset)/this.componentType_BYTES_PER_ELEMENT},L=function(e,t,r,i,n,a,o,s,d,l,u,c){var f,h=i.componentType_BYTES_PER_ELEMENT,R=i.bufferViewByteStride,m=i.bufferURIDataView,p=i.getMethod,_=i.accessor.type,g=i.accessor.count,v=0,E=R/h,M=i.startIndex;switch(_){case"VEC4":if(R)for(f=M+g*(R/h);M<f;M++)v%E<4&&("WEIGHTS_0"==r?d.push(m[p](M*h,!0)):"JOINTS_0"==r?l.push(m[p](M*h,!0)):"COLOR_0"==r?u.push(m[p](M*h,!0)):"TANGENT"==r&&c.push(m[p](M*h,!0))),v++;else for(f=M+4*g;M<f;M++)"WEIGHTS_0"==r?d.push(m[p](M*h,!0)):"JOINTS_0"==r?l.push(m[p](M*h,!0)):"COLOR_0"==r?u.push(m[p](M*h,!0)):"TANGENT"==r&&c.push(m[p](M*h,!0)),v++;break;case"VEC3":if(R)for(f=M+g*(R/h);M<f;M++)v%E<3&&("NORMAL"==r?s.push(m[p](M*h,!0)):"POSITION"==r?n.push(m[p](M*h,!0)):"COLOR_0"==r&&(u.push(m[p](M*h,!0)),v%E==2&&u.push(1))),v++;else for(f=M+3*g;M<f;M++)"NORMAL"==r?s.push(m[p](M*h,!0)):"POSITION"==r?n.push(m[p](M*h,!0)):"COLOR_0"==r&&(u.push(m[p](M*h,!0)),v%3==2&&u.push(1)),v++;break;case"VEC2":if(R)for(f=M+g*(R/h);M<f;M++)v%E<2&&("TEXCOORD_0"==r?a.push(m[p](M*h,!0)):"TEXCOORD_1"==r?o.push(m[p](M*h,!0)):RedGLUtil.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r)),v++;else for(f=M+2*g;M<f;M++)"TEXCOORD_0"==r?a.push(m[p](M*h,!0)):"TEXCOORD_1"==r?o.push(m[p](M*h,!0)):RedGLUtil.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r),v++}},T=function(e,t,r,i){var n=[];r.targets&&r.targets.forEach(function(r){var i={vertices:[],verticesColor_0:[],normals:[],uvs:[],uvs1:[],jointWeights:[],joints:[],tangents:[]};for(var a in n.push(i),r){var o=i.vertices,s=i.verticesColor_0,d=i.normals,l=i.uvs,u=i.uvs1,c=i.jointWeights,f=i.joints,h=i.tangents,R=r[a],m=new b(e,t,R);L(0,0,a,m,o,l,u,d,c,f,s,h),m.accessor.sparse&&M(e,a,m.accessor,t,o)}}),this.list=n,n.weights=i||[],this.origin=null},P=(g=function(e,t,r){return t.images[r].uri.indexOf("blob:http")>-1?t.images[r].uri:(t.images[r].uri.indexOf(";base64,")>-1?"":e.path)+t.images[r].uri},v=function(e,t,r){var i={};if(t.samplers){var n=t.samplers[r];"magFilter"in n&&(i.mag=n.magFilter),"minFilter"in n&&(i.min=n.minFilter),"wrapS"in n&&(i.wrap_s=n.wrapS),"wrapT"in n&&(i.wrap_t=n.wrapT)}return i.string=JSON.stringify(i),i},function(e,t,r){var i,n,a=!1,o=.5;if("material"in r){var s,d,l,u,c,f=r.material,h=t.materials[f];if("doubleSided"in h&&(a=!!h.doubleSided),"alphaMode"in h&&(n=h.alphaMode),"alphaCutoff"in h&&(o=h.alphaCutoff),"baseColorTexture"in h.pbrMetallicRoughness){var R=h.pbrMetallicRoughness.baseColorTexture.index,m=t.textures[R],p=m.source,_=g(e,t,p),E=m.sampler,M=_+(G=v(0,t,E)).string;s=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,G)}if("metallicRoughnessTexture"in h.pbrMetallicRoughness){var b=h.pbrMetallicRoughness.metallicRoughnessTexture.index,L=t.textures[b],T=L.source;_=g(e,t,T),E=L.sampler,M=_+(G=v(0,t,E)).string,l=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,G)}var P=h.normalTexture;if(null!=P){P=P.index;var x=t.textures[P],y=x.source;_=g(e,t,y),E=x.sampler,M=_+(G=v(0,t,E)).string,d=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,G)}var w=h.emissiveTexture;if(null!=w){w=w.index;var U=t.textures[w],I=U.source;_=g(e,t,I),E=U.sampler,M=_+(G=v(0,t,E)).string,u=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,G)}var B,F,D=h.occlusionTexture;if(null!=D){D=D.index;var G,A=t.textures[D],S=A.source;_=g(e,t,S),E=A.sampler,M=_+(G=v(0,t,E)).string,c=e.parsingResult.textures[M]?e.parsingResult.textures[M]:e.parsingResult.textures[M]=RedBitmapTexture(e.redGL,_,G)}"metallicFactor"in h.pbrMetallicRoughness&&(B=h.pbrMetallicRoughness.metallicFactor),"roughnessFactor"in h.pbrMetallicRoughness&&(F=h.pbrMetallicRoughness.roughnessFactor);var O=e.environmentTexture;i=RedPBRMaterial_System(e.redGL,s,O,d,c,u,l,null),C=h.pbrMetallicRoughness&&h.pbrMetallicRoughness.baseColorFactor?h.pbrMetallicRoughness.baseColorFactor:[1,1,1,1],i.baseColorFactor=new Float32Array(C),h.pbrMetallicRoughness&&(i.metallicFactor=null!=B?B:1,i.roughnessFactor=null!=F?F:1),i.emissiveFactor=null!=h.emissiveFactor?h.emissiveFactor:new Float32Array([1,1,1]),h.pbrMetallicRoughness&&(h.pbrMetallicRoughness.metallicRoughnessTexture&&(i.roughnessTexCoordIndex=h.pbrMetallicRoughness.metallicRoughnessTexture.texCoord||0),h.pbrMetallicRoughness.baseColorTexture&&(i.diffuseTexCoordIndex=h.pbrMetallicRoughness.baseColorTexture.texCoord||0)),h.occlusionTexture&&(i.occlusionTexCoordIndex=h.occlusionTexture.texCoord||0,i.occlusionPower=h.occlusionTexture.strength||1),h.emissiveTexture&&(i.emissiveTexCoordIndex=h.emissiveTexture.texCoord||0),h.normalTexture&&(i.normalTexCoordIndex=h.normalTexture.texCoord||0)}else{var C=[Math.random(),Math.random(),Math.random(),1];(i=RedPBRMaterial_System(e.redGL)).baseColorFactor=new Float32Array(C)}return[i,a,n,o]}),x=function(e,t,r,i,n,a,o,s,d){for(var l=0,u=t.length/3,c=0;l<u;l++)t.length&&(e[c++]=t[3*l+0],e[c++]=t[3*l+1],e[c++]=t[3*l+2]),r.length?(e[c++]=r[4*l+0],e[c++]=r[4*l+1],e[c++]=r[4*l+2],e[c++]=r[4*l+3]):(e[c++]=0,e[c++]=0,e[c++]=0,e[c++]=0),i.length&&(e[c++]=i[3*l+0],e[c++]=i[3*l+1],e[c++]=i[3*l+2]),n.length||n.push(0,0),n.length&&(e[c++]=n[2*l+0],e[c++]=n[2*l+1]),a.length?(e[c++]=a[2*l+0],e[c++]=a[2*l+1]):n.length&&(e[c++]=n[2*l+0],e[c++]=n[2*l+1]),o.length&&(e[c++]=o[4*l+0],e[c++]=o[4*l+1],e[c++]=o[4*l+2],e[c++]=o[4*l+3]),s.length&&(e[c++]=s[4*l+0],e[c++]=s[4*l+1],e[c++]=s[4*l+2],e[c++]=s[4*l+3]),d.length?(e[c++]=d[4*l+0],e[c++]=d[4*l+1],e[c++]=d[4*l+2],e[c++]=d[4*l+3]):(e[c++]=0,e[c++]=0,e[c++]=0,e[c++]=0)};return o=function(e,t,r){var i,n,a,o;r.name&&(i=r.name);var s=[];return r.primitives.forEach(function(d,l){var u,c,f,h,R=[],m=[],p=[],_=[],g=[],v=[],E=[],y=[],w=[];if(d.attributes)for(var U in d.attributes){var I=d.attributes[U],B=new b(e,t,I);L(0,0,U,B,m,_,g,v,E,y,p,w),B.accessor.sparse&&M(e,U,B.accessor,t,m)}if("indices"in d){I=d.indices;!function(e,t,r,i,n){var a,o=i.componentType_BYTES_PER_ELEMENT,s=i.bufferURIDataView,d=i.getMethod,l=i.accessor.type,u=i.accessor.count,c=i.startIndex;switch(l){case"SCALAR":for(a=c+u;c<a;c++)n.push(s[d](c*o,!0))}}(0,0,0,B=new b(e,t,I),R)}if(c=P(e,t,d),n=c[1],a=c[2],o=c[3],(c=c[0])instanceof RedPBRMaterial_System&&e.parsingResult.materials.push(c),"mode"in d)switch(d.mode){case 0:f=e.redGL.gl.POINTS;break;case 1:f=e.redGL.gl.LINES;break;case 2:f=e.redGL.gl.LINE_LOOP;break;case 3:f=e.redGL.gl.LINE_STRIP;break;case 4:f=e.redGL.gl.TRIANGLES;break;case 5:f=e.redGL.gl.TRIANGLE_STRIP;break;case 6:f=e.redGL.gl.TRIANGLE_FAN}h=v.length?v:RedGLUtil.calculateNormals(m,R);var F,D=[];x(D,m,p,h,_,g,E,y,w);var G=[];if(m.length&&G.push(RedInterleaveInfo("aVertexPosition",3)),G.push(RedInterleaveInfo("aVertexColor_0",4)),h.length&&G.push(RedInterleaveInfo("aVertexNormal",3)),_.length&&G.push(RedInterleaveInfo("aTexcoord",2)),g.length?G.push(RedInterleaveInfo("aTexcoord1",2)):_.length&&G.push(RedInterleaveInfo("aTexcoord1",2)),E.length&&G.push(RedInterleaveInfo("aVertexWeight",4)),y.length&&G.push(RedInterleaveInfo("aVertexJoint",4)),G.push(RedInterleaveInfo("aVertexTangent",4)),F=RedGeometry(RedBuffer(e.redGL,"testGLTF_interleaveBuffer_"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(D),G),R.length?RedBuffer(e.redGL,"testGLTF_indexBuffer_"+RedGL.makeUUID(),RedBuffer.ELEMENT_ARRAY_BUFFER,e.redGL.gl.glExtension.OES_element_index_uint?new Uint32Array(R):new Uint16Array(R)):null),c||RedGLUtil.throwFunc("재질을 파싱할수없는경우 ",d),u=RedMesh(e.redGL,F,c),i&&(u.name=i,e.parsingOption))for(var A in e.parsingOption)i.toLowerCase().indexOf(A)>-1&&e.parsingOption[A](u);switch(u.drawMode=f||e.redGL.gl.TRIANGLES,n&&(u.useCullFace=!1,c.useMaterialDoubleSide=!0),a){case"BLEND":u.useTransparentSort=!0;break;case"MASK":u.useBlendMode=!1,c.cutOff=o;break;default:u.useBlendMode=!1,c._cutOff=-.1}p.length&&(c.useVertexColor_0=!0),w.length&&(c.useVertexTangent=!0);var S=new T(e,t,d,r.weights);S.list.forEach(function(e){var t;t=e.normals.length?e.normals:RedGLUtil.calculateNormals(e.vertices,R);var r=[];x(r,e.vertices,e.verticesColor_0,t,e.uvs,e.uvs1,e.jointWeights,e.joints,e.tangents),e.interleaveData=r}),u._morphInfo=S,u._morphInfo.origin=new Float32Array(D);var O=u.geometry.interleaveBuffer.data,C=0;G.forEach(function(e){C+=e.size});u._morphInfo.list.forEach(function(e,t){for(var r=0,i=O.length/C,n=null==u._morphInfo.list.weights[t]?.5:u._morphInfo.list.weights[t];r<i;r++)O[r*C+0]+=e.vertices[3*r+0]*n,O[r*C+1]+=e.vertices[3*r+1]*n,O[r*C+2]+=e.vertices[3*r+2]*n}),u.geometry.interleaveBuffer.upload(O),u._morphInfo.origin=new Float32Array(O),d.RedMesh=u,s.push(u)}),s},E=function(e,t,r){var i,n=[],a=new b(e,t,r),o=a.componentType_BYTES_PER_ELEMENT,s=a.bufferURIDataView,d=a.getMethod,l=a.accessor.type,u=a.accessor.count,c=a.startIndex;switch(l){case"SCALAR":for(i=c+1*u;c<i;c++)n.push(s[d](c*o,!0));break;case"VEC4":for(i=c+4*u;c<i;c++)n.push(s[d](c*o,!0));break;case"VEC3":for(i=c+3*u;c<i;c++)n.push(s[d](c*o,!0))}return n},s=function(e,t){var r=t.nodes,i=t.meshes;t.accessors,t.animations||(t.animations=[]),t.animations.forEach(function(n,a){var o=n.samplers,s=[];s.minTime=1e7,s.maxTime=-1,s.name=n.name,e.parsingResult.animations.push(s),n.channels.forEach(function(n,a){var d,l,u,c,f,h=[];if(d=o[n.sampler],l=n.target,"mesh"in(c=r[l.node]))u=c.RedMesh,i[c.mesh].primitives.forEach(function(t){h.push(t.RedMesh),t.RedMesh.geometry.drawMode=e.redGL.gl.DYNAMIC_DRAW});else{if(!e.parsingResult.groups[l.node])return;u=e.parsingResult.groups[l.node]}"scale"!=l.path&&"rotation"!=l.path&&"translation"!=l.path&&"weights"!=l.path||s.push(f={key:l.path,time:E(e,t,d.input),data:E(e,t,d.output),interpolation:d.interpolation,target:u,targets:h}),f&&(s.minTime>f.time[0]&&(s.minTime=f.time[0]),s.maxTime<f.time[f.time.length-1]&&(s.maxTime=f.time[f.time.length-1]))})}),e.parsingResult.animations.length&&e.parsingResult.animations.forEach(function(t){e.playAnimation(t)})},function(r,i,n,o,d){e(n),d?(n.buffers[0].uri=d,t(r,n,function(){l(r,n),a(r,n,function(){s(r,n),o&&o()})})):t(r,n,function(){l(r,n),a(r,n,function(){s(r,n),o&&o()})})}}(),Object.freeze(RedGLTFLoader)}(),RedLinePoint=function(e,t,r,i,n,a,o,s,d){if(!(this instanceof RedLinePoint))return new RedLinePoint(e,t,r,i,n,a,o,s,d);this._inPoint=[i||0,n||0,a||0],this._point=[e||0,t||0,r||0],this._outPoint=[o||0,s||0,d||0],this._UUID=RedGL.makeUUID()},Object.freeze(RedLinePoint),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p,_,g;t=function(e,t,r){var i,n,a,o=[],s=!1,d=!1,l=0,u="",c=[],f=[0,0],h=[0,0];function R(){if(u.length>0){var e=parseFloat(u);if(c.push(e),2===c.length){if(s&&(c[0]+=f[0],c[1]+=f[1]),o.push(c),d&&(h=c.slice()),!--l){if("l"===i){var t=o.pop(),r=o.pop(),n=vec2.lerp([0,0],r,t,.25),a=vec2.lerp([0,0],r,t,.75);o.push(r,n,a,t)}f=h}c=[]}u=""}}var m,p=e.split("");for(n=0,a=p.length;n<a;n++)(m=p[n])>="0"&&m<="9"||"."===m?u+=m:"-"===m?(R(),u="-"):"m"===m?(R(),d=!0,l=1,s=!0,i="m"):"c"===m?(R(),d=!0,l=3,s=!0,i="c"):"l"===m?(R(),d=!0,l=1,s=!1,i="l"):"M"===m?(R(),d=!0,l=1,s=!1,i="m"):"C"===m?(R(),d=!0,l=3,s=!1,i="c"):"L"===m?(R(),d=!0,l=1,s=!1,i="l"):"Z"===m||(","===m?R():" "===m&&R());R();var _=o[0].slice(),g=o[0].slice();for(n=1,a=o.length;n<a;++n)_=vec2.min([0,0],_,o[n]),g=vec2.max([0,0],g,o[n]);var v,E=vec2.sub([0,0],g,_),M=vec2.scale([0,0],E,.5);for(n=0;n<a;++n)(v=o[n])[0]=t?g[0]-v[0]:v[0]-_[0],v[1]=r?M[1]-(v[1]-_[0]):v[1]-_[0]-M[1];return o},r=function(e,t,r){return e+(t-e)*r},d=function(e){for(c=[],f=0,h=0,R=e.length;h<R-1;++h)c[h]=f,f+=vec2.distance(e[h],e[h+1]);return c.push(f),c=c.map(function(e){return e/f})},l=function(){var e,t,i,n,a,o,s=mat4.create();return function(d,l,u,c,f,h,R){var m=[],p=[];for(i=0;i<=f;++i){var _;for(a=r(u,c,n=i/f)%(2*Math.PI),o=mat4.fromYRotation(s,a),h&&(m.push(0,d[0][1],0),p.push(n,0)),e=0,t=d.length;e<t;e++)_=d[e],_=vec3.transformMat4([0,0,0],[_[0],_[1],0],o),m.push(_[0],_[1],_[2]),p.push(n,l[e]);R&&(m.push(0,d[d.length-1][1],0),p.push(n,1))}return{positions:m,texcoords:p}}}(),g=0,u=function(e,t,r){var i=[];for(g=0;g<e;++g)for(p=(m=g*t)+t,_=0;_<r;++_)i.push(m+_,m+_+1,p+_),i.push(m+_+1,p+_+1,p+_);return i},i=function(e,t,r,i,n,a,o){var s=n?1:0,c=e.length+s+(a?1:0),f=c-1,h=d(e),R=l(e,h,t,r,i,n,a);return{position:R.positions,texcoord:R.texcoords,indices:u(i,c,f,o)}},n=function(e){var t=e.indices,r=0,i=function(){return t[r++]};return i.reset=function(){r=0},i.numElements=t.length,i},a=function(e){var t=0,r=function(){return t++};return r.reset=function(){t=0},r.numElements=e.positions.length/3,r},o=function(e){return e.indices?n(e):a(e)},s=function(e,t){for(var r,i=e.position,n=e.texcoord,a=o(e),s=a.numElements,d=e.position.length,l=s/3,u=[],c=0;c<l;++c){var f=3*a(),h=3*a(),R=3*a(),m=i.slice(f,f+3),p=i.slice(h,h+3),_=i.slice(R,R+3);u.push(vec3.normalize([0,0,0],vec3.cross([0,0,0],vec3.sub([0,0,0],m,p),vec3.sub([0,0,0],_,p))))}var g={},v=0;function E(e){var t=e,r=g[t];if(void 0!==r)return r;var i=v++;return g[t]=i,i}var M=[];for(c=0;c<d;++c){var b=3*c,L=i.slice(b,b+3);M.push(E(L))}var T=[];for(a.reset(),c=0;c<l;++c)for(r=0;r<3;++r){(G=T[D=M[F=a()]])||(G=[],T[D]=G),G.push(c)}g={},v=0;var P=[],x=[],y=[];function w(e,t,r,i,n,a,o,s){var d=e+","+t+","+r+","+i+","+n+","+a+","+o+","+s,l=g[d];if(void 0!==l)return l;var u=v++;return g[d]=u,P.push(e,t,r),y.push(i,n,a),x.push(o,s),u}var U=[];a.reset();var I=Math.cos(t);for(c=0;c<l;++c){var B=u[c];for(r=0;r<3;++r){var F,D,G=T[D=M[F=a()]],A=[0,0,0];G.forEach(function(e){var t=u[e];vec3.dot(B,t)>I&&vec3.add(A,A,t)}),vec3.normalize(A,A);var S=3*F,O=2*F;U.push(w(i[S+0],i[S+1],i[S+2],A[0],A[1],A[2],n[O+0],n[O+1]))}}return{position:P,texcoord:x,normal:y,indices:U}},e=function(e,t,r){var i,n=[],a=r.position,o=r.normal,s=r.texcoord;i=r.indices;for(var d,l=0,u=a.length/3;l<u;l++)d=3*l,n.push(a[d+0],a[d+1],a[d+2]),n.push(o[d+0],o[d+1],o[d+2]),d=2*l,n.push(s[d+0],s[d+1]);return{interleaveData:n,indexData:i,type:t,interleaveBuffer:RedBuffer(e,t+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(n),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,t+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(i))}},(RedLathe=function(r,n,a,o,d,l,u,c,f,h,R,m){if(!(this instanceof RedLathe))return new RedLathe(r,n,a,o,d,l,u,c,f,h,R,m);var p,_;if(r instanceof RedGL||RedGLUtil.throwFunc("RedLathe : RedGL Instance만 허용.",r),f=void 0!==f?f:.4,(h=void 0!==h?h:.15)<.1&&(h=.1),p="RedLathe_"+n+"_"+(a=Math.floor(a)||16)+"_"+(o=void 0!==o&&o)+"_"+(d=void 0!==d&&d)+"_"+(l=void 0!==l?l:0)+"_"+(u=void 0!==u?u:2*Math.PI)+"_"+(c=void 0!==c?c:Math.PI/180*30)+"_"+f+"_"+h+"_"+R+"_"+m,r._datas.Primitives||(r._datas.Primitives={}),r._datas.Primitives[p])return r._datas.Primitives[p];r._datas.Primitives[p]=this;var g=t(n,R,m),v=RedLine.prototype._getPointsOnBezierCurves(g,h),E=RedLine.prototype._simplifyPoints(v,0,v.length,f),M=i(E,l,u,a,o,d);_=e(r,p,s(M,c)),this.interleaveBuffer=_.interleaveBuffer,this.indexBuffer=_.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._UUID=RedGL.makeUUID()}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedLathe)}(),(RedAxis=function(e){if(!(this instanceof RedAxis))return new RedAxis(e);var t,r,i,n,a,o,s;e instanceof RedGL||RedGLUtil.throwFunc("RedAxis : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),i=RedBox(e),n=RedCylinder(e,0,.5),a=RedColorMaterial(e,"#ff0000"),o=RedColorMaterial(e,"#00ff00"),s=RedColorMaterial(e,"#0000ff"),t=RedMesh(e,n,a),(r=RedMesh(e,i,a)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleX=5,t.x=5,t.rotationZ=90,r.x=2.5,this.children.push(r),this.children.push(t),t=RedMesh(e,n,o),(r=RedMesh(e,i,o)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleY=5,t.y=5,r.y=2.5,this.children.push(r),this.children.push(t),t=RedMesh(e,n,s),(r=RedMesh(e,i,s)).scaleX=r.scaleY=r.scaleZ=.1,r.scaleZ=5,t.z=5,t.rotationX=-90,r.z=2.5,this.children.push(r),this.children.push(t),this.children.push(RedMesh(e,RedSphere(e,.25,16,16,16),RedColorMaterial(e,"#ff00ff"))),this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,Object.freeze(RedAxis),function(){var e,t,r,i,n,a;(RedGrid=function(e,t,r,i,n){if(!(this instanceof RedGrid))return new RedGrid(e,t,r,i,n);var a;e instanceof RedGL||RedGLUtil.throwFunc("RedGrid : RedGL Instance만 허용.",e),a=e.gl,RedBaseObject3D.build.call(this,a),this._redGL=e,this.size=t||100,this.divisions=r||100,this.color1=i||"#cccccc",this.color2=n||"#666666",this.geometry=this._makeGridGeometry(),this.material=RedGridMaterial(e),this.drawMode=a.LINES,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedGrid.prototype._makeGridGeometry=function(){if(this.color2){var o=[];for(e=this._divisions/2,t=this._size/this._divisions,r=this._size/2,i=0,n=-r;i<=this._divisions;i++,n+=t)a=i===e?RedGLUtil.hexToRGB_ZeroToOne(this.color1):RedGLUtil.hexToRGB_ZeroToOne(this.color2),o.push(-r,0,n,a[0],a[1],a[2],1,r,0,n,a[0],a[1],a[2],1,n,0,-r,a[0],a[1],a[2],1,n,0,r,a[0],a[1],a[2],1);return RedGeometry(RedBuffer(this._redGL,"gridInterleaveBuffer_"+this._size+"_"+this._divisions+"_"+this.color1+"_"+this.color2,RedBuffer.ARRAY_BUFFER,new Float32Array(o),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexColor",4)]))}},RedGrid.prototype._update=function(){this.geometry=this._makeGridGeometry()},RedDefinePropertyInfo.definePrototype("RedGrid","size","number",{min:1,callback:function(){this._update()}}),RedDefinePropertyInfo.definePrototype("RedGrid","divisions","uint",{min:1,callback:function(){this._update()}}),Object.defineProperty(RedGrid.prototype,"color1",{get:function(){return this._color1},set:function(e){return RedGLUtil.regHex(e)||RedGLUtil.throwFunc("RedGrid : color1 hex 형식만 허용.",e),this._color1=e,this._update(),this._color1}}),Object.defineProperty(RedGrid.prototype,"color2",{get:function(){return this._color2},set:function(e){return RedGLUtil.regHex(e)||RedGLUtil.throwFunc("RedGrid : color2 hex 형식만 허용.",e),this._color2=e,this._update(),this._color2}}),Object.defineProperty(RedGrid.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedGridMaterial||RedGLUtil.throwFunc("RedGrid : RedGridMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedGrid)}(),(RedMesh=function(e,t,r){if(!(this instanceof RedMesh))return new RedMesh(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedMesh : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=t,this.material=r,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedDefinePropertyInfo.definePrototypes("RedMesh",["perspectiveScale","boolean"],["sprite3DYn","boolean"]),Object.freeze(RedMesh),function(){var e,t,r,i,n,a,o,s,d,l;s=function(e,t,r){var i=vec2.sqrDist(t,r);if(0===i)return vec2.sqrDist(e,t);var n=((e[0]-t[0])*(r[0]-t[0])+(e[1]-t[1])*(r[1]-t[1]))/i;return n=Math.max(0,Math.min(1,n)),vec2.sqrDist(e,vec2.lerp([0,0],t,r,n))},o=function(e,t,r,i,n){for(var a=n||[],d=e[t],l=e[r-1],u=0,c=1,f=t+1;f<r-1;++f){var h=s(e[f],d,l);h>u&&(u=h,c=f)}return Math.sqrt(u)>i?(o(e,t,c+1,i,a),o(e,c,r,i,a)):a.push(d,l),a},e=function(e,t){null==t&&(t=1);for(var r,i,n,a,o=e.length,s=o-2,d=0;d<o-1;d++)r=d?e[d-1]._point:e[d]._point,i=e[d]._point,n=e[d+1]._point,a=d==s?n:e[d+2]._point,e[d]._outPoint[0]=i[0]+(n[0]-r[0])/6*t,e[d]._outPoint[1]=i[1]+(n[1]-r[1])/6*t,e[d]._outPoint[2]=i[2]+(n[2]-r[2])/6*t,e[d+1]._inPoint[0]=n[0]-(a[0]-i[0])/6*t,e[d+1]._inPoint[1]=n[1]-(a[1]-i[1])/6*t,e[d+1]._inPoint[2]=n[2]-(a[2]-i[2])/6*t;return e},r=function(e){var t,r,i,n=[],a=0;for(t=0,r=e.length;t<r;t++)i=e[t],0==a?(n[a++]=i._point,n[a++]=i._outPoint):(n[a++]=i._inPoint,n[a++]=i._point,e[t+1]&&(n[a++]=i._outPoint));return n},d=function(e,t){var r=e[t+0],i=e[t+1],n=e[t+2],a=e[t+3],o=3*i[0]-2*r[0]-a[0],s=3*i[1]-2*r[1]-a[1],d=3*n[0]-2*a[0]-r[0],l=3*n[1]-2*a[1]-r[1];return(o*=o)<(d*=d)&&(o=d),(s*=s)<(l*=l)&&(s=l),o+s},l=function(e,t,r,i){var n=i||[];if(d(e,t)<r)n.push(e[t+0]),n.push(e[t+3]);else{var a=.5,o=e[t+0],s=e[t+1],u=e[t+2],c=e[t+3],f=vec3.lerp([0,0],o,s,a),h=vec3.lerp([0,0],s,u,a),R=vec3.lerp([0,0],u,c,a),m=vec3.lerp([0,0],f,h,a),p=vec3.lerp([0,0],h,R,a),_=vec3.lerp([0,0],m,p,a);l([o,f,m,_],0,r,n),l([_,p,R,c],0,r,n)}return n},t=function(e,t){var r=[],i=(e.length-1)/3;i=Math.floor(i);for(var n=0;n<i;++n)l(e,3*n,t,r);return r},a=function(e){e.points.forEach(function(t,r){var i;t._debugObjectInPointMesh&&(t._debugObjectPointMesh.removeChild(i=t._debugObjectInPointMesh),i.disposeAll(),t._debugObjectInPointMesh=null),t._debugObjectOutPointMesh&&(t._debugObjectPointMesh.removeChild(i=t._debugObjectOutPointMesh),i.disposeAll(),t._debugObjectOutPointMesh=null),t._debugObjectPointMesh&&(e.removeChild(i=t._debugObjectPointMesh),i.disposeAll(),t._debugObjectPointMesh=null)})},n=function(e){var t,r,i,n=e._redGL;a(e),e.points.forEach(function(a,o){a._debugObjectPointMesh||(a._debugObjectPointMesh=RedMesh(n,RedBox(n,1,1,1),RedColorMaterial(n,"#00ff00")),e.addChild(a._debugObjectPointMesh)),r=a._debugObjectPointMesh,e._type==RedLine.LINEAR||(o&&(a._debugObjectInPointMesh||(a._debugObjectInPointMesh=RedMesh(n,RedBox(n,.5,.5,.5),RedColorMaterial(n,e._type==RedLine.BEZIER?"#0000ff":"#fff",e._type==RedLine.BEZIER?1:.5)),(i=RedLine(n,RedColorMaterial(n,"#fff",.5))).drawMode=n.gl.LINES,r.addChild(a._debugObjectInPointMesh),a._debugObjectInPointMesh.addChild(i)),(i=a._debugObjectInPointMesh.getChildAt(0))._interleaveData.length=0,i._interleaveData.push(0,0,0),i._interleaveData.push(a._point[0]-a._inPoint[0],a._point[1]-a._inPoint[1],a._point[2]-a._inPoint[2]),i._upload()),o!=e.points.length-1&&(a._debugObjectOutPointMesh||(a._debugObjectOutPointMesh=RedMesh(n,RedBox(n,.5,.5,.5),RedColorMaterial(n,e._type==RedLine.BEZIER?"#ff0000":"#fff",e._type==RedLine.BEZIER?1:.5)),(i=RedLine(n,RedColorMaterial(n,"#fff",.5))).drawMode=n.gl.LINES,r.addChild(a._debugObjectOutPointMesh),a._debugObjectOutPointMesh.addChild(i)),(i=a._debugObjectOutPointMesh.getChildAt(0))._interleaveData.length=0,i._interleaveData.push(0,0,0),i._interleaveData.push(a._point[0]-a._outPoint[0],a._point[1]-a._outPoint[1],a._point[2]-a._outPoint[2]),i._upload())),a._debugObjectPointMesh&&((t=a._debugObjectPointMesh).x=a._point[0],t.y=a._point[1],t.z=a._point[2]),a._debugObjectOutPointMesh&&(a._debugObjectOutPointMesh.x=a._outPoint[0]-a._point[0],a._debugObjectOutPointMesh.y=a._outPoint[1]-a._point[1],a._debugObjectOutPointMesh.z=a._outPoint[2]-a._point[2]),a._debugObjectInPointMesh&&(a._debugObjectInPointMesh.x=a._inPoint[0]-a._point[0],a._debugObjectInPointMesh.y=a._inPoint[1]-a._point[1],a._debugObjectInPointMesh.z=a._inPoint[2]-a._point[2])})},i=function(i,a,s,d){switch(i._interleaveData.length=0,i._type){case RedLine.CATMULL_ROM:if(i.points.length>1){var l=e(i.points,a);i._serializedPoints=r(l),l=t(i._serializedPoints,s);for(var u=0,c=(l=o(l,0,l.length,d)).length;u<c;u++)i._interleaveData.push(l[u][0],l[u][1],l[u][2])}else i._interleaveData.push(0,0,0);break;case RedLine.BEZIER:if(i.points.length>1){i._serializedPoints=r(i.points),l=t(i._serializedPoints,s);for(u=0,c=(l=o(l,0,l.length,d)).length;u<c;u++)i._interleaveData.push(l[u][0],l[u][1],l[u][2])}else i._interleaveData.push(0,0,0);break;default:i.points.forEach(function(e){i._interleaveData.push(e._point[0],e._point[1],e._point[2])})}i.debug&&n(i),i._upload()},(RedLine=function(e,t,r){if(!(this instanceof RedLine))return new RedLine(e,t,r);var i;e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),(t=t||RedColorMaterial(e))instanceof RedColorMaterial||RedGLUtil.throwFunc("RedLine : RedColorMaterial Instance만 허용."),i=e.gl,RedBaseObject3D.build.call(this,i),this._redGL=e,this._interleaveData=[0,0,0],this._UUID=RedGL.makeUUID(),this._interleaveBuffer=RedBuffer(e,"RedLine_InterleaveBuffer_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(this._interleaveData),[RedInterleaveInfo("aVertexPosition",3)]),this.geometry=RedGeometry(this._interleaveBuffer),this.material=t,this.drawMode=i.LINE_STRIP,this.points=[],this._serializedPoints=[],this._tension=1,this._tolerance=.01,this._distance=.1,this.type=r||RedLine.LINEAR,this._debug=!1}).LINEAR="linear",RedLine.CATMULL_ROM="catmullRom",RedLine.BEZIER="bezier",RedLine.prototype=new RedBaseContainer,RedLine.prototype.addPoint=function(e,t,r,n,a,o,s,d,l){"number"==typeof e||RedGLUtil.throwFunc("RedLine : addPoint - x값은 숫자만 허용","입력값 : "+e),"number"==typeof t||RedGLUtil.throwFunc("RedLine : addPoint - y값은 숫자만 허용","입력값 : "+t),"number"==typeof r||RedGLUtil.throwFunc("RedLine : addPoint - z값은 숫자만 허용","입력값 : "+r),a=a||0,o=o||0,"number"==typeof(n=n||0)||RedGLUtil.throwFunc("RedLine : addPoint - inX값은 숫자만 허용","입력값 : "+n),"number"==typeof a||RedGLUtil.throwFunc("RedLine : addPoint - inY값은 숫자만 허용","입력값 : "+a),"number"==typeof o||RedGLUtil.throwFunc("RedLine : addPoint - inZ값은 숫자만 허용","입력값 : "+o),d=d||0,l=l||0,"number"==typeof(s=s||0)||RedGLUtil.throwFunc("RedLine : addPoint - outX값은 숫자만 허용","입력값 : "+s),"number"==typeof d||RedGLUtil.throwFunc("RedLine : addPoint - outY값은 숫자만 허용","입력값 : "+d),"number"==typeof l||RedGLUtil.throwFunc("RedLine : addPoint - outZ값은 숫자만 허용","입력값 : "+l),this.points.push(RedLinePoint(e,t,r,n,a,o,s,d,l)),i(this,this._tension,this._tolerance,this._distance)},RedLine.prototype.addPointAt=function(e,t,r,n,a,o,s,d,l,u){"number"==typeof t||RedGLUtil.throwFunc("RedLine : addPoint - x값은 숫자만 허용","입력값 : "+t),"number"==typeof r||RedGLUtil.throwFunc("RedLine : addPoint - y값은 숫자만 허용","입력값 : "+r),"number"==typeof n||RedGLUtil.throwFunc("RedLine : addPoint - z값은 숫자만 허용","입력값 : "+n),o=o||0,s=s||0,"number"==typeof(a=a||0)||RedGLUtil.throwFunc("RedLine : addPoint - inX값은 숫자만 허용","입력값 : "+a),"number"==typeof o||RedGLUtil.throwFunc("RedLine : addPoint - inY값은 숫자만 허용","입력값 : "+o),"number"==typeof s||RedGLUtil.throwFunc("RedLine : addPoint - inZ값은 숫자만 허용","입력값 : "+s),l=l||0,u=u||0,"number"==typeof(d=d||0)||RedGLUtil.throwFunc("RedLine : addPoint - outX값은 숫자만 허용","입력값 : "+d),"number"==typeof l||RedGLUtil.throwFunc("RedLine : addPoint - outY값은 숫자만 허용","입력값 : "+l),"number"==typeof u||RedGLUtil.throwFunc("RedLine : addPoint - outZ값은 숫자만 허용","입력값 : "+u),"number"==typeof e||RedGLUtil.throwFunc("addPointAt","index는 숫자만 입력가능","입력값 : "+e),this.points.length<e&&(e=this.points.length),null!=e?this.points.splice(e,0,RedLinePoint(t,r,n,a,o,s,d,l,u)):this.points.push(RedLinePoint(t,r,n,a,o,s,d,l,u)),i(this,this._tension,this._tolerance,this._distance)},RedLine.prototype.removePointAt=function(e){"number"!=typeof e&&RedGLUtil.throwFunc("removeChildAt","index가 Number형이 아님 ","입력값 : "+e),this.points[e]?this.points.splice(e,1):RedGLUtil.throwFunc("removeChildAt","index 해당인덱스에 위치한 포인트가 없음.","입력값 : "+e),i(this,this._tension,this._tolerance,this._distance)},RedLine.prototype.removeAllPoint=function(){this.points.length=0,i(this,this._tension,this._tolerance,this._distance),this._upload()},RedLine.prototype._upload=function(){this._interleaveBuffer.upload(new Float32Array(this._interleaveData))},Object.defineProperty(RedLine.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedLine : geometry - 임의로 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedLine.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorMaterial||RedGLUtil.throwFunc("RedLine : RedColorMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.defineProperty(RedLine.prototype,"type",{get:function(){return this._type},set:function(e){e!=RedLine.LINEAR&&e!=RedLine.CATMULL_ROM&&e!=RedLine.BEZIER&&RedGLUtil.throwFunc("RedLine : 허용하지 않는 타입","입력값 : "+e),this._type=e,i(this,this._tension,this._tolerance,this._distance)}}),RedDefinePropertyInfo.definePrototype("RedLine","tension","number",{callback:function(e){i(this,this._tension,this._tolerance,this._distance)}}),RedDefinePropertyInfo.definePrototype("RedLine","distance","number",{min:0,callback:function(e){i(this,this._tension,this._tolerance,this._distance)}}),RedDefinePropertyInfo.definePrototype("RedLine","debug","boolean",{callback:function(e){e?n(this):a(this)}}),RedLine.prototype._simplifyPoints=o,RedLine.prototype._getPointsOnBezierCurves=t,Object.freeze(RedLine)}(),function(){(RedLatheMesh=function(t,r,i,n,a,o,s,d,l,u,c,f,h){if(!(this instanceof RedLatheMesh))return new RedLatheMesh(t,r,i,n,a,o,s,d,l,u,c,f,h);t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),RedBaseObject3D.build.call(this,t.gl),this._pathString=r,this._redGL=t,this.numDivisions=n=Math.floor(n)||16,this.capStart=void 0!==a&&a,this.capEnd=void 0!==o&&o,this.startAngle=void 0!==s?s:0,this.endAngle=void 0!==d?d:2*Math.PI,this.distance=void 0!==u?u:.4,this.maxAngle=void 0!==l?l:Math.PI/180*30,this.tolerance=void 0!==c?c:.15,this.flipX=!!f,this.flipY=!!h,this._tolerance<.1&&(this._tolerance=.1),e.call(this),this.material=i,this.useCullFace=!1,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer;var e=function(){this._geometry=RedLathe(this._redGL,this._pathString,this._numDivisions,this._capStart,this._capEnd,this._startAngle,this._endAngle,this._maxAngle,this._distance,this._tolerance,this._flipX,this._flipY)};Object.defineProperty(RedLatheMesh.prototype,"pathString",{get:function(){return this._pathString},set:function(t){this._pathString=t,e.call(this)}}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","numDivisions","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","capStart","boolean",{callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","capEnd","boolean",{callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","startAngle","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","endAngle","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","maxAngle","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","distance","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","tolerance","number",{min:0,callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","flipX","boolean",{callback:e}),RedDefinePropertyInfo.definePrototype("RedLatheMesh","flipY","boolean",{callback:e}),Object.freeze(RedLatheMesh)}(),(RedSkyBox=function(e,t,r){if(!(this instanceof RedSkyBox))return new RedSkyBox(e,t,r);e instanceof RedGL||RedGLUtil.throwFunc("RedSkyBox : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=RedBox(e),this.material=RedSkyBoxMaterial(e,RedBitmapCubeTexture(e,t)),this.cullFace=e.gl.FRONT,this.alpha=null==r?1:r,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseObject3D,RedDefinePropertyInfo.definePrototype("RedSkyBox","alpha","number",{min:0,max:1,callback:function(e){this.material.alpha=e}}),Object.defineProperty(RedSkyBox.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedSkyBox : geometry - 임의로 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.defineProperty(RedSkyBox.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedSkyBoxMaterial||RedGLUtil.throwFunc("RedSkyBox : RedSkyBoxMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedSkyBox),(RedSprite3D=function(e,t){if(!(this instanceof RedSprite3D))return new RedSprite3D(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedSprite3D : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this.geometry=RedPlane(e,1,1,0),this.material=t,this.perspectiveScale=!0,this.sprite3DYn=!0,this.useCullFace=!1,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseContainer,RedDefinePropertyInfo.definePrototypes("RedSprite3D",["perspectiveScale","boolean"],["sprite3DYn","boolean"]),Object.defineProperty(RedSprite3D.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorMaterial||e instanceof RedBitmapMaterial||e instanceof RedSheetMaterial||e instanceof RedVideoMaterial||RedGLUtil.throwFunc("RedSprite3D : RedColorMaterial or RedBitmapMaterial or RedSheetMaterial Instance만 허용.","입력값 : "+e),this._material=e}}),Object.freeze(RedSprite3D),function(){var e=function(e,t){switch(e.boundBoxMode){case RedTransformController.AABB:!function(e,t){var r=t.volumeCalculateAABB(),i=0;i<r.volume[0]&&(i=r.volume[0]),i<r.volume[1]&&(i=r.volume[1]),i<r.volume[2]&&(i=r.volume[2]),e.useScale&&(e.rotationGroup.scaleX=e.rotationGroup.scaleY=e.rotationGroup.scaleZ=i),e.boundBox.matrix=r.worldMatrix}(e,t);break;case RedTransformController.OBB:!function(e,t){var r=t.volumeCalculateOBB(),i=0;i<t.scaleX&&(i=t.scaleX),i<t.scaleY&&(i=t.scaleY),i<t.scaleZ&&(i=t.scaleZ),e.useScale&&(e.rotationGroup.scaleX=e.rotationGroup.scaleY=e.rotationGroup.scaleZ=i),e.boundBox.matrix=r.worldMatrix}(e,t)}},t=[];(RedTransformController=function(e){if(!(this instanceof RedTransformController))return new RedTransformController(e);e instanceof RedGL||RedGLUtil.throwFunc("RedTransformController : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl),this._setRotationGroup(e),this._setScaleGroup(e),this._setPositionGroup(e),this.boundBox=RedMesh(e,RedBox(e),RedColorMaterial(e)),this.boundBox.drawMode=e.gl.LINE_LOOP,this.boundBox.autoUpdateMatrix=!1,this.children.push(this.boundBox),this._boundBoxMode=RedTransformController.AABB,this.downed=!1,this.useScale=!0,this.usePosition=!0,this.useRotation=!0,t.push(this),this._UUID=RedGL.makeUUID()}).AABB="AABB",RedTransformController.OBB="OBB",RedTransformController.prototype=new RedBaseContainer,Object.defineProperty(RedTransformController.prototype,"boundBoxMode",{get:function(){return this._boundBoxMode},set:function(t){t!==RedTransformController.AABB&&t!==RedTransformController.OBB&&RedGLUtil.throwFunc("RedTransformController : boundBoxMode는 RedTransformController.AABB or RedTransformController.OBB만 허용함"),this._boundBoxMode=t,e(this,this._targetMesh)}}),RedDefinePropertyInfo.definePrototype("RedTransformController","useScale","boolean",{callback:function(e){t.forEach(function(t){t.scaleGroup.scaleX=t.scaleGroup.scaleY=t.scaleGroup.scaleZ=e?1:0})}}),RedDefinePropertyInfo.definePrototype("RedTransformController","usePosition","boolean",{callback:function(e){t.forEach(function(t){t.positionGroup.scaleX=t.positionGroup.scaleY=t.positionGroup.scaleZ=e?1:0})}}),RedDefinePropertyInfo.definePrototype("RedTransformController","useRotation","boolean",{callback:function(e){t.forEach(function(t){t.rotationGroup.scaleX=t.rotationGroup.scaleY=t.rotationGroup.scaleZ=e?1:0})}}),RedTransformController.prototype._setScaleGroup=function(e){var t,r,i=RedColorMaterial(e,"#ff0000",.5),n=RedColorMaterial(e,"#00ff00",.5),a=RedColorMaterial(e,"#0000ff",.5);r=RedSphere(e,.25),this.scaleGroup=RedMesh(e),this.children.push(this.scaleGroup),(t=RedMesh(e,r,i)).x=4,t.useCullFace=!1,t.depthTestFunc=e.gl.ALWAYS,this.scalePointX=t,this.scaleGroup.addChild(t),(t=RedMesh(e,r,n)).y=4,t.useCullFace=!1,t.depthTestFunc=e.gl.ALWAYS,this.scalePointY=t,this.scaleGroup.addChild(t),(t=RedMesh(e,r,a)).z=4,t.useCullFace=!1,t.depthTestFunc=e.gl.ALWAYS,this.scalePointZ=t,this.scaleGroup.addChild(t)},RedTransformController.prototype._setRotationGroup=function(e){var t,r,i,n=RedColorMaterial(e,"#ff0000",0),a=RedColorMaterial(e,"#00ff00",0),o=RedColorMaterial(e,"#0000ff",0);this.rotationGroup=RedMesh(e),this.children.push(this.rotationGroup),(t=RedMesh(e,RedSphere(e,1,32,32,32),n)).scaleZ=0,t.rotationX=90,t.rotationY=90,this.rotationGroup.addChild(t),(r=RedMesh(e,RedSphere(e,1,32,32,32),a)).scaleZ=0,r.rotationZ=90,r.rotationX=90,this.rotationGroup.addChild(r),(i=RedMesh(e,RedSphere(e,1,32,32,32),o)).scaleZ=0,this.rotationGroup.addChild(i),this.rotationXLine=t,this.rotationYLine=r,this.rotationZLine=i,t=RedLine(e,RedColorMaterial(e,"#ff0000",.75)),r=RedLine(e,RedColorMaterial(e,"#00ff00",.75)),i=RedLine(e,RedColorMaterial(e,"#0000ff",.75));var s=36,d=2*Math.PI/s;for(s=36;s--;)t.addPoint(Math.sin(d*s),Math.cos(d*s),0);for(t.addPoint(Math.sin(d*s),Math.cos(d*s),0),s=36;s--;)r.addPoint(Math.sin(d*s),Math.cos(d*s),0);for(r.addPoint(Math.sin(d*s),Math.cos(d*s),0),s=36;s--;)i.addPoint(Math.sin(d*s),Math.cos(d*s),0);i.addPoint(Math.sin(d*s),Math.cos(d*s),0),this.rotationXLine.addChild(t),this.rotationYLine.addChild(r),this.rotationZLine.addChild(i)},RedTransformController.prototype._setPositionGroup=function(e){var t,r,i,n,a,o,s;this.positionGroup=RedMesh(e),this.addChild(this.positionGroup),i=RedBox(e),n=RedCylinder(e,0,.5),a=RedColorMaterial(e,"#ff0000",.5),o=RedColorMaterial(e,"#00ff00",.5),s=RedColorMaterial(e,"#0000ff",.5),t=RedMesh(e,n,a),(r=RedMesh(e,i,a)).depthTestFunc=e.gl.ALWAYS,t.depthTestFunc=e.gl.ALWAYS,r.scaleX=r.scaleY=r.scaleZ=.01,r.scaleX=5,t.x=5,t.rotationZ=90,r.x=2.5,this.arrowX=t,this.positionGroup.addChild(r),this.positionGroup.addChild(t),t=RedMesh(e,n,o),(r=RedMesh(e,i,o)).depthTestFunc=e.gl.ALWAYS,t.depthTestFunc=e.gl.ALWAYS,r.scaleX=r.scaleY=r.scaleZ=.01,r.scaleY=5,t.y=5,r.y=2.5,this.arrowY=t,this.positionGroup.addChild(r),this.positionGroup.addChild(t),t=RedMesh(e,n,s),(r=RedMesh(e,i,s)).depthTestFunc=e.gl.ALWAYS,t.depthTestFunc=e.gl.ALWAYS,r.scaleX=r.scaleY=r.scaleZ=.01,r.scaleZ=5,t.z=5,t.rotationX=-90,r.z=2.5,this.arrowZ=t,this.positionGroup.addChild(r),this.positionGroup.addChild(t);var d=RedMesh(e,RedSphere(e,.1,32,32,32),RedColorMaterial(e,"#5b52aa",1));d.depthTestFunc=e.gl.ALWAYS,this.move=d,this.positionGroup.addChild(d)},RedTransformController.prototype.setTarget=function(t,r){var i,n,a=this,o=t.scene,s=t.camera,d=0,l=[],u=[],c=[],f=0;a._targetMesh=r,a.scaleGroup.rotationX=r.rotationX,a.scaleGroup.rotationY=r.rotationY,a.scaleGroup.rotationZ=r.rotationZ,a.rotationGroup.rotationX=r.rotationX,a.rotationGroup.rotationY=r.rotationY,a.rotationGroup.rotationZ=r.rotationZ,a.x=r.x,a.y=r.y,a.z=r.z;var h=function(o){var h,R,m,p,_,g=RedGLUtil.screenToWorld([o.layerX,o.layerY,t._viewRect[2],t._viewRect[3]],s),v=[u[0]+g[0]-l[0],u[1]+g[1]-l[1],u[2]+g[2]-l[2]];a.usePosition&&(3===d?(a.x=r.x=v[0],a.y=r.y=v[1],a.z=r.z=v[2]):0===d?a.x=r.x=v[0]:1===d?a.y=r.y=v[1]:2===d&&(a.z=r.z=v[2])),a.useScale&&(7===d&&(r.scaleX=c[0]+(g[0]-l[0])),8===d&&(r.scaleY=c[1]+(g[1]-l[1])),9===d&&(r.scaleZ=c[2]+(g[2]-l[2]))),a.useRotation&&(4!==d&&5!==d&&6!==d||(a.scaleGroup.rotationX=r.rotationX,a.scaleGroup.rotationY=r.rotationY,a.scaleGroup.rotationZ=r.rotationZ,a.rotationGroup.rotationX=r.rotationX,a.rotationGroup.rotationY=r.rotationY,a.rotationGroup.rotationZ=r.rotationZ),4===d?(h=f<t._viewRect[2]/2?r.localToWorld(1,0,0):r.localToWorld(-1,0,0),R=vec3.dot(h,g),m=vec3.dot(h,l),p=mat4.clone(n),mat4.scale(p,p,[1/r.scaleX,1/r.scaleY,1/r.scaleZ]),mat4.rotateX(p,p,-i[0]*Math.PI/180),mat4.rotateY(p,p,-i[1]*Math.PI/180),mat4.rotateZ(p,p,-i[2]*Math.PI/180),mat4.rotateZ(p,p,i[2]*Math.PI/180),mat4.rotateY(p,p,i[1]*Math.PI/180),mat4.rotateX(p,p,i[0]*Math.PI/180+R-m),RedGLUtil.quaternionToRotationMat4(mat4.getRotation(quat.create(),p),p),_=RedGLUtil.mat4ToEuler(p,[]),r.rotationX=180*-_[0]/Math.PI,r.rotationY=180*-_[1]/Math.PI,r.rotationZ=180*-_[2]/Math.PI):5===d?(h=f<t._viewRect[2]/2?r.localToWorld(0,-1,0):r.localToWorld(0,1,0),R=vec3.dot(h,g),m=vec3.dot(h,l),p=mat4.clone(n),mat4.scale(p,p,[1/r.scaleX,1/r.scaleY,1/r.scaleZ]),mat4.rotateY(p,p,-i[1]*Math.PI/180),mat4.rotateZ(p,p,-i[2]*Math.PI/180),mat4.rotateZ(p,p,i[2]*Math.PI/180),mat4.rotateY(p,p,i[1]*Math.PI/180+R-m),RedGLUtil.quaternionToRotationMat4(mat4.getRotation(quat.create(),p),p),_=RedGLUtil.mat4ToEuler(p,[]),r.rotationX=180*-_[0]/Math.PI,r.rotationY=180*-_[1]/Math.PI,r.rotationZ=180*-_[2]/Math.PI):6===d&&(h=f<t._viewRect[2]/2?[0,0,-1]:[0,0,1],R=180*vec3.dot(h,g)/Math.PI,m=180*vec3.dot(h,l)/Math.PI,r.rotationZ+=R-m,l=JSON.parse(JSON.stringify(g)))),e(a,r)};[a.rotationXLine,a.rotationYLine,a.rotationZLine].forEach(function(e){o.mouseManager.add(e,"over",function(){a.downed||(a.rotationXLine.material.alpha=0,a.rotationYLine.material.alpha=0,a.rotationZLine.material.alpha=0,this.material.alpha=.25)}),o.mouseManager.add(e,"out",function(){a.downed||(a.rotationXLine.material.alpha=0,a.rotationYLine.material.alpha=0,a.rotationZLine.material.alpha=0)})}),[a.arrowX,a.arrowY,a.arrowZ,a.move,a.rotationXLine,a.rotationYLine,a.rotationZLine,a.scalePointX,a.scalePointY,a.scalePointZ].forEach(function(e,R){o.mouseManager.remove(e,"down"),o.mouseManager.add(e,"down",function(e){a.downed=!0,d=R,u=[a.x,a.y,a.z],c=[r.scaleX,r.scaleY,r.scaleZ],i=[r.rotationX,r.rotationY,r.rotationZ],n=mat4.clone(r.localMatrix),l=RedGLUtil.screenToWorld([e.nativeEvent.layerX,e.nativeEvent.layerY,t._viewRect[2],t._viewRect[3]],s),f=e.nativeEvent.layerX,s.camera&&(s.needUpdate=!1),document.body.addEventListener("mousemove",h),window.addEventListener("click",function(){s.camera&&(s.needUpdate=!0),a.downed=!1,a.rotationXLine.material.alpha=0,a.rotationYLine.material.alpha=0,a.rotationZLine.material.alpha=0,document.body.removeEventListener("mousemove",h)})})}),e(a,r)},Object.freeze(RedTransformController)}(),(RedPointCloud=function(){}).prototype=new RedBaseContainer,RedPointCloud.prototype.update=function(e){this._geometry.interleaveBuffer.upload(new Float32Array(e))},Object.defineProperty(RedPointCloud.prototype,"geometry",{get:function(){return this._geometry},set:function(e){this._geometry&&RedGLUtil.throwFunc("RedPointCloud : geometry - 임의 설정을 허용하지 않음","입력값 : "+e),this._geometry=e}}),Object.freeze(RedPointCloud),(RedParticleUnit=function(e){this.startTime=null,this.age=0,this.lifeTime=2==e.length?Math.random()*(e[1]-e[0])+e[0]:e[0],this.initLifeTime=this.lifeTime,this._gravitySum=0}).prototype.addRule=function(e,t){this[e]={startCenter:null,start:2==t.start.length?Math.random()*(t.start[1]-t.start[0])+t.start[0]:t.start,end:2==t.end.length?Math.random()*(t.end[1]-t.end[0])+t.end[0]:t.end,ease:t.ease},this[e].gap=this[e].end-this[e].start},Object.freeze(RedParticleUnit),(RedColorPointCloud=function(e,t,r){if(!(this instanceof RedColorPointCloud))return new RedColorPointCloud(e,t,r);var i;t instanceof Array||RedGLUtil.throwFunc("RedLine : interleaveData - Array Instance만 허용.","입력값 :",e),e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),i=e.gl,RedBaseObject3D.build.call(this,i),this._UUID=RedGL.makeUUID(),this.geometry=RedGeometry(RedBuffer(e,"RedColorPointCloud_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(t),r,e.gl.DYNAMIC_DRAW)),this._material=RedColorPointCloudMaterial(e),this.drawMode=i.POINTS,this.useDepthMask=!1}).prototype=new RedPointCloud,Object.defineProperty(RedColorPointCloud.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedColorPointCloudMaterial||RedGLUtil.throwFunc("RedColorPointCloud : material - RedColorPointCloudMaterial Instance 만 허용."),this._material=e}}),Object.freeze(RedColorPointCloud),(RedBitmapPointCloud=function(e,t,r,i){if(!(this instanceof RedBitmapPointCloud))return new RedBitmapPointCloud(e,t,r,i);var n;t instanceof Array||RedGLUtil.throwFunc("RedLine : interleaveData - Array Instance만 허용.","입력값 :",e),e instanceof RedGL||RedGLUtil.throwFunc("RedLine : RedGL Instance만 허용.",e),n=e.gl,RedBaseObject3D.build.call(this,n),this._UUID=RedGL.makeUUID(),this.geometry=RedGeometry(RedBuffer(e,"RedBitmapPointCloud_"+this._UUID,RedBuffer.ARRAY_BUFFER,new Float32Array(t),r,e.gl.DYNAMIC_DRAW)),this.material=i,this.drawMode=n.POINTS,this.useDepthMask=!1}).prototype=new RedPointCloud,Object.defineProperty(RedBitmapPointCloud.prototype,"material",{get:function(){return this._material},set:function(e){e instanceof RedBitmapPointCloudMaterial||RedGLUtil.throwFunc("RedBitmapPointCloud : material - RedBitmapPointCloudMaterial Instance만 허용."),this._material=e}}),Object.freeze(RedBitmapPointCloud),(RedParticleEmitter=function(e,t,r){if(!(this instanceof RedParticleEmitter))return new RedParticleEmitter(e,t,r);RedBaseObject3D.build.call(this,e.gl),this.list=[],this._interleaveData=[],this.info=t,this.geometry=RedGeometry(RedBuffer(e,"RedParticleEmitter_Buffer"+RedGL.makeUUID(),RedBuffer.ARRAY_BUFFER,new Float32Array(this._interleaveData),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aPointSize",1),RedInterleaveInfo("aVertexColor",4)],e.gl.DYNAMIC_DRAW)),this._material=RedParticleMaterial(e,r),this.drawMode=e.gl.POINTS,this.blendSrc=e.gl.SRC_ALPHA,this.blendDst=e.gl.ONE,this.useDepthMask=!1,this._UUID=RedGL.makeUUID()}).TINT_RANDOM="random",RedParticleEmitter.QuintIn=1,RedParticleEmitter.QuintOut=2,RedParticleEmitter.QuintInOut=3,RedParticleEmitter.BackIn=4,RedParticleEmitter.BackOut=5,RedParticleEmitter.BackInOut=6,RedParticleEmitter.CircIn=7,RedParticleEmitter.CircOut=8,RedParticleEmitter.CircInOut=9,RedParticleEmitter.CubicIn=10,RedParticleEmitter.CubicOut=11,RedParticleEmitter.CubicInOut=12,RedParticleEmitter.ExpoIn=13,RedParticleEmitter.ExpoOut=14,RedParticleEmitter.ExpoInOut=15,RedParticleEmitter.QuadIn=16,RedParticleEmitter.QuadOut=17,RedParticleEmitter.QuadInOut=18,RedParticleEmitter.QuartIn=19,RedParticleEmitter.QuartOut=20,RedParticleEmitter.QuartInOut=21,RedParticleEmitter.SineIn=22,RedParticleEmitter.SineOut=23,RedParticleEmitter.SineInOut=24,RedParticleEmitter.ElasticIn=25,RedParticleEmitter.ElasticOut=26,RedParticleEmitter.ElasticInOut=27,RedParticleEmitter.prototype=new RedBaseObject3D,RedParticleEmitter.prototype.reset=function(){this.list.length=0,this._interleaveData.length=0},RedParticleEmitter.prototype.update=function(e){var t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p,_,g,v,E;if(e+=2e3,t=Math.pow,r=Math.sin,i=Math.cos,n=Math.sqrt,s=.5*(a=Math.PI),o=2*a,d=this.list.length,R=(h=this.info).particle,d<h.max)for((l=h.emitCount)+d>h.max&&(l=h.max-d);l--;)m=this.list[d+l]=new RedParticleUnit(h.lifeTime),this._interleaveData.push(this.x,this.y,this.z),this._interleaveData.push(0),h.tint==RedParticleEmitter.TINT_RANDOM?this._interleaveData.push(Math.random(),Math.random(),Math.random(),1):this._interleaveData.push(h.tint[0],h.tint[1],h.tint[2],1),h.particle&&(R.movementX&&m.addRule("movementX",R.movementX),R.movementY&&m.addRule("movementY",R.movementY),R.movementZ&&m.addRule("movementZ",R.movementZ),R.scale&&m.addRule("scale",R.scale),R.alpha&&m.addRule("alpha",R.alpha));for(d=this.list.length,_="movementX,movementY,movementZ,scale,alpha".split(",");d--;)if((u=this.list[d]).startTime||(u.startTime=e,u.age=0),u.age=e-u.startTime,f=8*d,(c=u.age/u.lifeTime)<1)for(E=c,u.startCenter||(u.startCenter=[this.x,this.y,this.z]),l=_.length;l--;)E=c,(p=u[g=_[l]].ease)&&(1==p?E*=E*E*E*E:2==p?E=(E-=1)*E*E*E*E+1:3==p?E=(E*=2)<1?E*E*E*E*E*.5:.5*((E-=2)*E*E*E*E+2):4==p?E=E*E*(1.70158*E+E-1.70158):5==p?E=(E-=1)*E*(1.70158*E+E+1.70158)+1:6==p?E=(E*=2)<1?.5*E*E*(1.70158*E+E-1.70158):.5*(E-=2)*E*(1.70158*E+E+1.70158)+1:7==p?E=-1*(n(1-E*E)-1):8==p?E=n(1-(E-=1)*E):9==p?E=(E*=2)<1?-.5*(n(1-E*E)-1):.5*n(1-(E-=2)*E)+.5:10==p?E*=E*E:11==p?E=(E-=1)*E*E+1:12==p?E=(E*=2)<1?E*E*E*.5:.5*((E-=2)*E*E+2):13==p?E=0==E?0:t(2,10*(E-1)):14==p?E=1==E?1:1-t(2,-10*E):15==p?E=(E*=2)<1?0==E?0:.5*t(2,10*(E-1)):2==E?1:-.5*t(2,-10*(E-1))+1:16==p?E*=E:17==p?E*=2-E:18==p?E=(E*=2)<1?E*E*.5:.5*((2-(E-=1))*E+1):19==p?E*=E*E*E:20==p?E=1-(E-=1)*E*E*E:21==p?E=(E*=2)<1?E*E*E*E*.5:1-(E-=2)*E*E*E*.5:22==p?E=1-i(E*s):23==p?E=r(E*s):24==p?E=.5*(1-i(E*a)):25==p?E=0===E?0:1===E?1:-1*t(2,10*(E-=1))*r((E-.075)*o/.3):26==p?E=0===E?0:1===E?1:t(2,-10*E)*r((E-.075)*o/.3)+1:27==p&&(0===E||1===E||(E*=2),E=E<1?-.5*t(2,10*(E-=1))*r((E-.075)*o/.3):.5*t(2,-10*(E-=1))*r((E-.075)*o/.3)+1)),"movementX"==g&&(v=0),"movementY"==g&&(v=1),"movementZ"==g&&(v=2),"scale"==g&&(v=3),"alpha"==g&&(v=7),this._interleaveData[f+v]=v<3?u.startCenter[v]+u[g].start+u[g].gap*E:u[g].start+u[g].gap*E,h.gravity&&(u._gravitySum-=h.gravity),this._interleaveData[f+1]+=u._gravitySum;else this._interleaveData[f+0]=u.startCenter[0]=this.x,this._interleaveData[f+1]=u.startCenter[1]=this.y,this._interleaveData[f+2]=u.startCenter[2]=this.z,this._interleaveData[f+3]=u.scale.start,h.tint==RedParticleEmitter.TINT_RANDOM?(this._interleaveData[f+4]=Math.random(),this._interleaveData[f+5]=Math.random(),this._interleaveData[f+6]=Math.random()):(this._interleaveData[f+4]=h.tint[0],this._interleaveData[f+5]=h.tint[1],this._interleaveData[f+6]=h.tint[2]),this._interleaveData[f+7]=0,u._gravitySum=0,u.startTime=null,u.age=-1;this._geometry.interleaveBuffer.upload(new Float32Array(this._interleaveData))},RedDefinePropertyInfo.definePrototype("RedParticleEmitter","diffuseTexture","sampler2D",{callback:function(e){this.material.diffuseTexture=e}}),Object.freeze(RedParticleEmitter),function(){var e,t,r;r=function(e,r,i,n,a,o,s,d,l,u,c,f){var h,R,m=d/c,p=l/f,_=d/2,g=l/2,v=u/2,E=c+1,M=f+1,b=0,L=[];for(R=0;R<M;R++){var T=R*p-g;for(h=0;h<E;h++){var P=h*m-_;L[i]=P*o,L[n]=T*s,L[a]=v,e.push(L.x,L.y,L.z),L[i]=0,L[n]=0,L[a]=u>0?1:-1,e.push(L.x,L.y,L.z),e.push(h/c,R/f),b+=1}}for(R=0;R<f;R++)for(h=0;h<c;h++){var x=t+h+E*R,y=t+h+E*(R+1),w=t+(h+1)+E*(R+1),U=t+(h+1)+E*R;r.push(x,y,U,y,w,U),6}t+=b},e=function(e,i,n,a,o,s,d,l){var u=[],c=[];return t=0,r(u,c,"z","y","x",-1,-1,o,a,n,l,d),r(u,c,"z","y","x",1,-1,o,a,-n,l,d),r(u,c,"x","z","y",1,1,n,o,a,s,l),r(u,c,"x","z","y",1,-1,n,o,-a,s,l),r(u,c,"x","y","z",1,-1,n,a,o,s,d),r(u,c,"x","y","z",-1,-1,n,a,-o,s,d),{interleaveData:u,indexData:c,type:i,interleaveBuffer:RedBuffer(e,i+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(u),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,i+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(c))}},(RedBox=function(t,r,i,n,a,o,s){return this instanceof RedBox?(t instanceof RedGL||RedGLUtil.throwFunc("RedBox : RedGL Instance만 허용.",t),d="RedBox_"+(r=r||1)+"_"+(i=i||1)+"_"+(n=n||1)+"_"+(a=a||1)+"_"+(o=o||1)+"_"+(s=s||1),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[d]?t._datas.Primitives[d]:(t._datas.Primitives[d]=this,l=e(t,d,r,i,n,a,o,s),this.interleaveBuffer=l.interleaveBuffer,this.indexBuffer=l.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._makeInfo={width:r,height:i,depth:n,wSegments:a,hSegments:o,dSegments:s},void(this._UUID=RedGL.makeUUID()))):new RedBox(t,r,i,n,a,o,s);var d,l}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedBox)}(),function(){var e,t;e=function(e,r,i,n,a,o,s,d,l,u){var c=[],f=[],h=0,R=[],m=a/2;return t=function(e){var t,r,a,s=[],d=[],R=!0===e?i:n,p=!0===e?1:-1;for(r=h,t=1;t<=o;t++)c.push(0,m*p,0),c.push(0,p,0),c.push(.5,.5),h++;for(a=h,t=0;t<=o;t++){var _=t/o*u+l,g=Math.cos(_),v=Math.sin(_);d[0]=R*v,d[1]=m*p,d[2]=R*g,c.push(d[0],d[1],d[2]),c.push(0,p,0),s[0]=.5*g+.5,s[1]=.5*v*p+.5,c.push(s[0],1-s[1]),h++}for(t=0;t<o;t++){var E=r+t,M=a+t;!0===e?f.push(M,M+1,E):f.push(M+1,M,E),3}},function(){var e,t,r=[],d=[],p=(n-i)/a;for(t=0;t<=s;t++){var _=[],g=t/s,v=g*(n-i)+i;for(e=0;e<=o;e++){var E=e/o,M=E*u+l,b=Math.sin(M),L=Math.cos(M);d[0]=v*b,d[1]=-g*a+m,d[2]=v*L,c.push(d[0],d[1],d[2]),r[0]=b,r[1]=p,r[2]=L,vec3.normalize(r,r),c.push(r[0],r[1],r[2]),c.push(E,g),_.push(h++)}R.push(_)}for(e=0;e<o;e++)for(t=0;t<s;t++){var T=R[t][e],P=R[t+1][e],x=R[t+1][e+1],y=R[t][e+1];f.push(T,P,y),f.push(P,x,y),6}}(),!1===d&&(i>0&&t(!0),n>0&&t(!1)),{interleaveData:c,indexData:f,type:r,interleaveBuffer:RedBuffer(e,r+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(c),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,r+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(f))}},(RedCylinder=function(t,r,i,n,a,o,s,d,l){return this instanceof RedCylinder?(t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),u="RedCylinder_"+(r=void 0!==r?r:1)+"_"+(i=void 0!==i?i:1)+"_"+(n=void 0!==n?n:1)+"_"+(a=Math.floor(a)||8)+"_"+(o=Math.floor(o)||1)+"_"+(s=void 0!==s&&s)+"_"+(d=void 0!==d?d:0)+"_"+(l=void 0!==l?l:2*Math.PI),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[u]?t._datas.Primitives[u]:(t._datas.Primitives[u]=this,c=e(t,u,r,i,n,a,o,s,d,l),this.interleaveBuffer=c.interleaveBuffer,this.indexBuffer=c.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,void(this._UUID=RedGL.makeUUID()))):new RedCylinder(t,r,i,n,a,o,s,d,l);var u,c}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedCylinder)}(),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p;e=function(e,_,g,v,E,M,b){t=g/2,r=v/2,i=Math.floor(E)||1,n=Math.floor(M)||1,a=i+1,o=n+1,s=g/i,d=v/n;var L=[],T=[];for(u=0;u<o;u++)for(f=u*d-r,l=0;l<a;l++)c=l*s-t,L.push(c,-f,0,0,0,1,l/i,b?1-u/n:u/n);for(u=0;u<n;u++)for(l=0;l<i;l++)h=l+a*u,R=l+a*(u+1),m=l+1+a*(u+1),p=l+1+a*u,T.push(h,R,p,R,m,p);return{interleaveData:L,indexData:T,type:_,interleaveBuffer:RedBuffer(e,_+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(L),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,_+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint32Array(T))}},(RedPlane=function(t,r,i,n,a,o){return this instanceof RedPlane?(t instanceof RedGL||RedGLUtil.throwFunc("RedPlane : RedGL Instance만 허용.",t),s="RedPlane_"+(r=r||1)+"_"+(i=i||1)+"_"+(n=n||1)+"_"+(a=a||1)+"_"+(o=!!o),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[s]?t._datas.Primitives[s]:(t._datas.Primitives[s]=this,d=e(t,s,r,i,n,a,o),this.interleaveBuffer=d.interleaveBuffer,this.indexBuffer=d.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._makeInfo={width:r,height:i,wSegments:n,hSegments:a,flipY:o},void(this._UUID=RedGL.makeUUID()))):new RedPlane(t,r,i,n,a,o);var s,d}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedPlane)}(),function(){var e,t,r,i,n,a,o,s,d,l,u,c;l=[],u=new Float32Array([0,0,0]),c=new Float32Array([0,0,0]),e=function(e,f,h,R,m,p,_,g,v){t=g+v,n=0,l.length=0,u[0]=0,u[1]=0,u[2]=0,c[0]=0,c[1]=0,c[2]=0;var E=[],M=[];for(i=0;i<=m;i++){var b=[],L=i/m;for(r=0;r<=R;r++){var T=r/R;u.x=-h*Math.cos(p+T*_)*Math.sin(g+L*v),u.y=h*Math.cos(g+L*v),u.z=h*Math.sin(p+T*_)*Math.sin(g+L*v),E.push(u.x,u.y,u.z),c[0]=u.x,c[1]=u.y,c[2]=u.z,vec3.normalize(c,c),E.push(c[0],c[1],c[2]),E.push(T,L),b.push(n++)}l.push(b)}for(i=0;i<m;i++)for(r=0;r<R;r++)a=l[i][r+1],o=l[i][r],s=l[i+1][r],d=l[i+1][r+1],(0!==i||g>0)&&M.push(a,o,d),(i!==m-1||t<Math.PI)&&M.push(o,s,d);return{interleaveData:E,indexData:M,type:f,interleaveBuffer:RedBuffer(e,f+"_interleaveBuffer",RedBuffer.ARRAY_BUFFER,new Float32Array(E),[RedInterleaveInfo("aVertexPosition",3),RedInterleaveInfo("aVertexNormal",3),RedInterleaveInfo("aTexcoord",2)]),indexBuffer:RedBuffer(e,f+"_indexBuffer",RedBuffer.ELEMENT_ARRAY_BUFFER,new Uint16Array(M))}},(RedSphere=function(t,r,i,n,a,o,s,d){return this instanceof RedSphere?(t instanceof RedGL||RedGLUtil.throwFunc("RedPrimitive : RedGL Instance만 허용.",t),l="RedSphere_"+(r=r||1)+"_"+(i=Math.max(3,Math.floor(i)||8))+"_"+(n=Math.max(2,Math.floor(n)||6))+"_"+(a=void 0!==a?a:0)+"_"+(o=void 0!==o?o:2*Math.PI)+"_"+(s=void 0!==s?s:0)+"_"+(d=void 0!==d?d:Math.PI),t._datas.Primitives||(t._datas.Primitives={}),t._datas.Primitives[l]?t._datas.Primitives[l]:(t._datas.Primitives[l]=this,u=e(t,l,r,i,n,a,o,s,d),this.interleaveBuffer=u.interleaveBuffer,this.indexBuffer=u.indexBuffer,this.interleaveBuffer.isPrimitiveBuffer=!0,this.indexBuffer.isPrimitiveBuffer=!0,this._makeInfo={radius:r,widthSegments:i,heightSegments:n,phiStart:a,phiLength:o,thetaStart:s,thetaLength:d},void(this._UUID=RedGL.makeUUID()))):new RedSphere(t,r,i,n,a,o,s,d);var l,u}).prototype=Object.create(RedGeometry.prototype),Object.freeze(RedSphere)}(),function(){var e,t,r,i,n,a,o,s,d,l,u;r=2,e=function(e,t,r,i){if(n=e.createProgram(),e.attachShader(n,r.webglShader),e.attachShader(n,i.webglShader),r.parseData.uniform)for(s in a=r.parseData.uniform.map,o=i.parseData.uniform.map,a)o[s]&&RedGLUtil.throwFunc("vertexShader와 fragmentShader에 중복된 유니폼 선언이 존재함.","중복선언 : "+s);if(r.parseData.const)for(s in a=r.parseData.const.map,o=i.parseData.const.map,a)o[s]&&RedGLUtil.throwFunc("vertexShader와 fragmentShader에 중복된 상수 선언이 존재함.","중복선언 : "+s);return e.linkProgram(n),e.getProgramParameter(n,e.LINK_STATUS)||RedGLUtil.throwFunc("RedProgram : 프로그램을 초기화 할 수 없습니다.",e.getProgramInfoLog(n)),n.key=t,n.vShaderKey=r.key,n.vShaderOriginSource=r.originSource,n.fShaderKey=i.key,n.fShaderOriginKey=r.originSource,n},u={},d=function(){},l=function(){},t=function(e,t,n){var a,o,s,c;if(n.parseData.attribute)for(a=(s=n.parseData.attribute.list).length;a--;)o=s[a],(p=new d)._UUID=RedGL.makeUUID(),p.location=t.getAttribLocation(e.webglProgram,o.name),-1==p.location?(p.msg="쉐이더 main 함수에서 사용되고 있지 않음",p.use=!1):p.use=!0,p.attributeType=o.attributeType,p.name=o.name,p.enabled=!1,c=e.attributeLocation.length,-1!=p.location&&(e.attributeLocation[c]=p),e.attributeLocation[p.name]=p;if(n.parseData.uniform)for(a=(s=n.parseData.uniform.list).length;a--;){var f,h,R,m,p;switch(o=s[a],(p=new l)._UUID=RedGL.makeUUID(),p.uniformType=o.uniformType,f=o.arrayNum,R=1e5,o.uniformType){case"sampler2D":h="sampler2D",R=0,m="uniform1i",p.samplerIndex=r,++r===i&&(r=2);break;case"samplerCube":h="samplerCube",R=1,m="uniform1i",p.samplerIndex=r,++r===i&&(r=2);break;case"float":h="float",R=f?12:11,m=f?"uniform1fv":"uniform1f";break;case"int":h="int",R=f?12:11,m=f?"uniform1iv":"uniform1i";break;case"bool":h="bool",R=f?12:11,m=f?"uniform1iv":"uniform1i";break;case"vec4":h="vec",R=12,m="uniform4fv";break;case"vec3":h="vec",R=12,m="uniform3fv";break;case"vec2":h="vec",R=12,m="uniform2fv";break;case"ivec4":h="vec",R=12,m="uniform4iv";break;case"ivec3":h="vec",R=12,m="uniform3iv";break;case"ivec2":h="vec",R=12,m="uniform2iv";break;case"bvec4":h="vec",R=12,m="uniform4iv";break;case"bvec3":h="vec",R=12,m="uniform3iv";break;case"bvec2":h="vec",R=12,m="uniform2iv";break;case"mat4":h="mat",R=13,m="uniformMatrix4fv";break;case"mat3":h="mat",R=13,m="uniformMatrix3fv";break;case"mat2":h="mat",R=13,m="uniformMatrix2fv"}p.location=t.getUniformLocation(e.webglProgram,o.name),p.renderType=h,p.renderMethod=m,p.renderTypeIndex=R,p.name=o.name,u[o.name]||(u[o.name]=o.name.charAt(1).toLowerCase()+o.name.substr(2)),p.materialPropertyName=u[o.name],p.arrayNum=o.arrayNum,p.location?p.use=!0:(p.msg="쉐이더 main 함수에서 사용되고 있지 않음",p.use=!1),o.systemUniformYn?(c=e.systemUniformLocation.length,p.use&&(e.systemUniformLocation[c]=p),e.systemUniformLocation[o.name]=p):(c=e.uniformLocation.length,p.use&&(e.uniformLocation[c]=p),e.uniformLocation[o.name]=p)}},(RedProgram=function(r,n,a,o){var s,d,l;return this instanceof RedProgram?(r instanceof RedGL||RedGLUtil.throwFunc("RedProgram : RedGL Instance만 허용.","입력값 : "+r),"string"==typeof n||RedGLUtil.throwFunc("RedProgram : key - 문자열만 허용.","입력값 : "+n),s=r.gl,r._datas.RedProgram||(r._datas.RedProgram={},r._datas.RedProgramList=[]),RedProgram.hasKey(r,n)?r._datas.RedProgram[n]:(d=a?RedShader(r,n+"_VS",RedShader.VERTEX,a):null,l=o?RedShader(r,n+"_FS",RedShader.FRAGMENT,o):null,d&&l?r._datas.RedProgram[n]=this:RedGLUtil.throwFunc("RedProgram : 신규 생성시 vertexShader, fragmentShader 모두 입력해야함."),r._datas.RedProgramList.push(this),this.key=n,this.webglProgram=e(s,n,d,l),this.attributeLocation=[],this.uniformLocation=[],this.systemUniformLocation=[],s.useProgram(this.webglProgram),i=r.detect.texture.MAX_COMBINED_TEXTURE_IMAGE_UNITS,t(this,s,d),t(this,s,l),void(this._UUID=RedGL.makeUUID()))):new RedProgram(r,n,a,o)}).prototype={},RedProgram.hasKey=function(e,t){return e instanceof RedGL||RedGLUtil.throwFunc("RedProgram : RedGL Instance만 허용.","입력값 : "+e),e._datas.RedProgram||(e._datas.RedProgram={},e._datas.RedProgramList=[]),!!e._datas.RedProgram[t]},RedProgram.makeProgram=function(e,t,r,i,n){var a;t.indexOf("_")>-1&&RedGLUtil.throwFunc("RedProgram : 프로그램이름에 _ 는 허용하지 않음.","입력값 : "+t),r="string"==typeof r?r:RedGLUtil.getStrFromComment(r.toString()),i="string"==typeof i?i:RedGLUtil.getStrFromComment(i.toString());var o=!1,s=!1,d=!1,l=!1;for(var u in RedSystemShaderCode.vertexShareFunc)a=new RegExp("//#REDGL_DEFINE#vertexShareFunc#"+u+"#","gi"),r=r.replace(a,RedSystemShaderCode.vertexShareFunc[u]);for(var u in RedSystemShaderCode.fragmentShareFunc)a=new RegExp("//#REDGL_DEFINE#fragmentShareFunc#"+u+"#","gi"),i=i.replace(a,RedSystemShaderCode.fragmentShareFunc[u]);if(n){n.sort(),t+="_"+n.join("_");for(var c=n.length;c--;)"fog"===n[c]&&(o=!0),"sprite3D"===n[c]&&(s=!0),"directionalShadow"===n[c]&&(d=!0),"skin"===n[c]&&(l=!0),"fog"!==n[c]&&"sprite3D"!=n[c]&&"directionalShadow"!=n[c]&&"skin"!=n[c]&&(a=new RegExp("//#REDGL_DEFINE#"+n[c]+"#","gi"),r=r.replace(a,""),i=i.replace(a,""))}return a=new RegExp("//#REDGL_DEFINE#fog#"+(o?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),a=new RegExp("//#REDGL_DEFINE#sprite3D#"+(s?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),a=new RegExp("//#REDGL_DEFINE#directionalShadow#"+(d?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),a=new RegExp("//#REDGL_DEFINE#skin#"+(l?"true":"false")+"#","gi"),r=r.replace(a,""),i=i.replace(a,""),RedProgram(e,t,r,i,n)},Object.freeze(RedProgram)}(),(RedSystemShaderCode={}).init=function(e){var t,r,i=e.detect;r=parseInt(Math.floor(Math.min((i.vertexShader.MAX_VERTEX_UNIFORM_VECTORS-64)/8,128))),t=parseInt(Math.floor(Math.min((i.fragmentShader.MAX_FRAGMENT_UNIFORM_VECTORS-64)/4,128))),(RedSystemShaderCode={vertexShareDeclare:["attribute vec3 aVertexPosition","attribute vec3 aVertexNormal","attribute vec4 aVertexColor","attribute vec4 aVertexWeight","attribute vec4 aVertexJoint","varying vec4 vVertexPosition","varying vec3 vVertexNormal","varying vec4 vVertexColor","attribute float aPointSize","uniform float uPointSize","attribute vec2 aTexcoord","attribute vec2 aTexcoord1","varying vec2 vTexcoord","varying vec2 vTexcoord1","uniform bool uMode2DYn","uniform float uTime","varying float vTime","uniform vec2 uResolution","varying vec2 vResolution","uniform mat4 uMMatrix","uniform mat4 uNMatrix","uniform mat4 uPMatrix","uniform mat4 uCameraMatrix","uniform bool u_PerspectiveScale","uniform float uOutlineThickness","uniform mat4 uDirectionalShadowLightMatrix","varying highp vec4 vShadowPos","const mat4 cTexUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0)","uniform mat4 uJointMatrix["+r+"]","uniform mat4 uInverseBindMatrixForJoint["+r+"]","uniform mat4 uGlobalTransformOfNodeThatTheMeshIsAttachedTo"],fragmentShareDeclare:["varying vec4 vVertexPosition","varying vec3 vVertexNormal","varying vec4 vVertexColor","varying vec2 vTexcoord","varying vec2 vTexcoord1","varying float vTime","varying vec2 vResolution","uniform vec3 uCameraPosition","uniform vec4 uOutlineColor","uniform float u_FogDistance","uniform float u_FogDensity","uniform vec4 uFogColor","const int cDIRETIONAL_MAX = 3","uniform vec3 uDirectionalLightPositionList[3]","uniform vec4 uDirectionalLightColorList[3]","uniform float uDirectionalLightIntensityList[3]","uniform int uDirectionalLightNum","const int cPOINT_MAX = "+t,"uniform vec3 uPointLightPositionList["+t+"]","uniform vec4 uPointLightColorList["+t+"]","uniform float uPointLightRadiusList["+t+"]","uniform float uPointLightIntensityList["+t+"]","uniform int uPointLightNum","uniform vec4 uAmbientLightColor","uniform float uAmbientIntensity","uniform sampler2D uDirectionalShadowTexture","varying highp vec4 vShadowPos"],systemUniform:{},vertexShareFunc:{getSkinMatrix:["//#REDGL_DEFINE#skin#true#  mat4 getSkinMatrix(){","//#REDGL_DEFINE#skin#true#      mat4 skinMat =","//#REDGL_DEFINE#skin#true#      aVertexWeight.x * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.x) ] * uInverseBindMatrixForJoint[int(aVertexJoint.x)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.y * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.y) ] * uInverseBindMatrixForJoint[int(aVertexJoint.y)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.z * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.z) ] * uInverseBindMatrixForJoint[int(aVertexJoint.z)]+","//#REDGL_DEFINE#skin#true#      aVertexWeight.w * uGlobalTransformOfNodeThatTheMeshIsAttachedTo * uJointMatrix[ int(aVertexJoint.w) ] * uInverseBindMatrixForJoint[int(aVertexJoint.w)];","//#REDGL_DEFINE#skin#true#      return skinMat;","//#REDGL_DEFINE#skin#true#  }"].join("\n"),getSprite3DMatrix:["mat4 getSprite3DMatrix(mat4 cameraMTX, mat4 mvMatrix){","   mat4 cacheScale = mat4(","      mvMatrix[0][0], 0.0, 0.0, 0.0,","       0.0, mvMatrix[1][1], 0.0, 0.0,","      0.0, 0.0, 1.0, mvMatrix[2][2],","      0.0, 0.0, 0.0, 1.0","   );","   mat4 tMTX = cameraMTX * mvMatrix;","   tMTX[0][0] = 1.0, tMTX[0][1] = 0.0, tMTX[0][2] = 0.0,","   tMTX[1][0] = 0.0, tMTX[1][1] = 1.0, tMTX[1][2] = 0.0,","   tMTX[2][0] = 0.0, tMTX[2][1] = 0.0, tMTX[2][2] = 1.0;","   return tMTX * cacheScale;","}"].join("\n")},fragmentShareFunc:{getFlatNormal:["vec3 getFlatNormal(vec3 vertexPosition){","   vec3 dx = dFdx(vVertexPosition.xyz);","   vec3 dy = dFdy(vVertexPosition.xyz);","   return normalize(cross(normalize(dx), normalize(dy)));","}"].join("\n"),getDirectionalLightColor:["vec4 getDirectionalLightColor(      vec4 texelColor,      vec3 N,      float shininess,      vec4 specularLightColor,      float specularTextureValue,      float specularPower) {","   vec3 L;","   float specular;","   float lambertTerm;","   vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);","   vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);","   for(int i=0; i<cDIRETIONAL_MAX; i++){","      if(i == uDirectionalLightNum) break;","      L = normalize(-uDirectionalLightPositionList[i]);","      lambertTerm = dot(N,-L);","      if(lambertTerm > 0.0){","         ld += uDirectionalLightColorList[i] * texelColor * lambertTerm * uDirectionalLightIntensityList[i];","         specular = pow( max(dot(reflect(L, N), -L), 0.0), shininess) * specularPower * specularTextureValue;","         ls +=  specularLightColor * specular * uDirectionalLightIntensityList[i] * uDirectionalLightColorList[i].a;","      }","   }","   return ld + ls;","}"].join("\n"),getPointLightColor:["vec4 getPointLightColor(      vec4 texelColor,      vec3 N,      float shininess,      vec4 specularLightColor,      float specularTextureValue,      float specularPower) {","   vec3 L;","   float specular;","   float lambertTerm;","   vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);","   vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);","   float distanceLength;","   float attenuation;","   for(int i=0;i<cPOINT_MAX;i++){","      if(i== uPointLightNum) break;","      L =  -uPointLightPositionList[i] + vVertexPosition.xyz;","      distanceLength = abs(length(L));","      if(uPointLightRadiusList[i]> distanceLength){","          attenuation = 1.0 / (0.01 + 0.02 * distanceLength + 0.03 * distanceLength * distanceLength) * 0.5;","          L = normalize(L);","          lambertTerm = dot(N,-L);","          if(lambertTerm > 0.0){","             ld += uPointLightColorList[i] * texelColor * lambertTerm * attenuation * uPointLightIntensityList[i] ;","             specular = pow( max(dot( reflect(L, N), -N), 0.0), shininess) * specularPower * specularTextureValue;","             ls +=  specularLightColor * specular  * uPointLightIntensityList[i]  * uPointLightColorList[i].a ;","          }","      }","   }","   return ld + ls;","}"].join("\n"),fogFactor:["float fogFactor(float perspectiveFar, float density){","   float flog_cord = gl_FragCoord.z / gl_FragCoord.w / perspectiveFar;","   float fog = flog_cord * density;","   if(1.0 - fog < 0.0) discard;","   return clamp(1.0 - fog, 0.0,  1.0);","}"].join("\n"),fog:["vec4 fog(float fogFactor, vec4 fogColor, vec4 currentColor) {","   return mix(fogColor, currentColor, fogFactor);","}"].join("\n"),decodeFloatShadow:["float decodeFloatShadow (vec4 color) {","   const vec4 cBitShift = vec4(","       1.0 / (256.0 * 256.0 * 256.0),","       1.0 / (256.0 * 256.0),","       1.0 / 256.0,","       1.0","   );","   return dot(color, cBitShift);","}"].join("\n"),getShadowColor:["float getShadowColor ( vec4 shadowPos, vec2 resolution, sampler2D directionalShadowTexture ) {","   vec3 fragmentDepth = shadowPos.xyz;","   fragmentDepth.z -= 0.007; // cShadowAcneRemover","   float amountInLight = 0.0;","   for (int x = -1; x <= 1; x++) {","       for (int y = -1; y <= 1; y++) {","           vec2 tUV = fragmentDepth.xy + vec2( float(x)/resolution.x, float(y)/resolution.y );","           if(tUV.x<0.0) return 1.0;","           if(tUV.x>1.0) return 1.0;","           if(tUV.y<0.0) return 1.0;","           if(tUV.y>1.0) return 1.0;","           float texelDepth = decodeFloatShadow( texture2D(directionalShadowTexture, tUV) );","           if (fragmentDepth.z < texelDepth ) amountInLight += 1.0;","      }","   }","   amountInLight /= 9.0;","   amountInLight =  amountInLight;","   return amountInLight;","}"].join("\n"),cotangent_frame:["mat3 cotangent_frame(vec3 N, vec3 p, vec2 uv)","{","   vec3 dp1 = dFdx( p );","   vec3 dp2 = dFdy( p );","   vec2 duv1 = dFdx( uv );","   vec2 duv2 = dFdy( uv );","   ","   vec3 dp2perp = cross( dp2, N );","   vec3 dp1perp = cross( N, dp1 );","   vec3 T = dp2perp * duv1.x + dp1perp * duv2.x;","   vec3 B = dp2perp * duv1.y + dp1perp * duv2.y;","   ","   float invmax = inversesqrt( max( dot(T,T), dot(B,B) ) );","   return mat3( T * invmax, B * invmax, N );","}"].join("\n"),perturb_normal:["vec3 perturb_normal( vec3 N, vec3 V, vec2 texcoord, vec3 normalColor )","   {","   ","   vec3 map = normalColor;","   map =  map * 255./127. - 128./127.;","   map.xy *= u_normalPower;","   mat3 TBN = cotangent_frame(N, V, texcoord);","   return normalize(TBN * map);","}"].join("\n")}}).MAX_DIRECTIONAL_LIGHT=3,RedSystemShaderCode.MAX_POINT_LIGHT=t,RedSystemShaderCode.MAX_JOINT=r,[RedSystemShaderCode.vertexShareDeclare,RedSystemShaderCode.fragmentShareDeclare].forEach(function(e){e.forEach(function(e){"uniform"===(e=e.split(" "))[0]&&(RedSystemShaderCode.systemUniform[e[2]]=1)})});var n=[],a=[],o={bool:4,float:4,int:4,uint:4,sampler2D:4,samplerCube:4,vec2:4,vec3:4,vec4:4,mat2:4,mat3:8,mat4:16};RedSystemShaderCode.vertexShareDeclare.forEach(function(e){var t;"uniform"===(e=e.split(" "))[0]&&(t={value:e,type:e[1],num:e[2].indexOf("[")>-1?+e[2].split("[")[1].replace("]","")*o[e[1]]:o[e[1]]},n.push(t))}),a=[],RedSystemShaderCode.fragmentShareDeclare.forEach(function(e){var t;"uniform"===(e=e.split(" "))[0]&&(t={value:e,type:e[1],num:e[2].indexOf("[")>-1?+e[2].split("[")[1].replace("]","")*o[e[1]]:o[e[1]]},a.push(t))}),Object.freeze(RedSystemShaderCode)},function(){var e,t,r,i,n,a,o,s,d,l;e=function(e,t,r){switch(r){case RedShader.VERTEX:return(n=e.createShader(e.VERTEX_SHADER))||(e.isContextLost()?RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - WebGL 컨텍스트가 손실"):RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - GPU메모리가 부족일 가능성이 큼")),n.key=t,n.type=r,n;case RedShader.FRAGMENT:return(n=e.createShader(e.FRAGMENT_SHADER))||(e.isContextLost()?RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - WebGL 컨텍스트가 손실"):RedGLUtil.throwFunc("RedShader : 쉐이더를 생성실패! - GPU메모리가 부족일 가능성이 큼")),n.key=t,n.type=r,n;default:RedGLUtil.throwFunc("RedShader : 쉐이더 타입을 확인하세요. RedShader.VERTEX or RedShader.FRAGMENT 만 허용")}},t=function(e,t,r,i){e.shaderSource(r,i.lastSource),e.compileShader(r),e.getShaderParameter(r,e.COMPILE_STATUS)||RedGLUtil.throwFunc("RedShader : 쉐이더 컴파일에 실패하였습니다.\n",e.getShaderInfoLog(r))},i=function(e,t){var r;switch(e){case RedShader.VERTEX:r=RedSystemShaderCode.vertexShareDeclare.concat();break;case RedShader.FRAGMENT:r=RedSystemShaderCode.fragmentShareDeclare.concat();break;default:RedGLUtil.throwFunc("RedShader : 쉐이더 타입을 확인하세요. RedShader.VERTEX or RedShader.FRAGMENT 만 허용")}for(a=t.length;a--;)o=(o=t[a]).replace(";",""),-1===r.indexOf(o)?r.push(o):RedGLUtil.throwFunc("RedShader : ","\n1. 중복 선언 이거나","\n2. RedSystemShaderCode에 정의된 선언\n","입력값 : "+o);return r},r=function(e,t){return t=(t=t.replace(/\s+$/,"")).replace(/  /g,"").trim(),s={etc:""},d=t.match(/attribute[\s\S]+?\;|uniform[\s\S]+?\;|varying[\s\S]+?\;|const[\s\S]+?\;|precision[\s\S]+?\;/g),(d=i(e,d=d||[])).sort(),d.forEach(function(e){var r,i,n,a,o,d,l,u,c;if(e=e.trim(),t=t.replace(e+";",""),("highp"===(r=e.split(" "))[1]||"mediump"===r[1]||"lowp"===r[1])&&(c=r[1],r.splice(1,1),r.push(c),u=c),r[2])switch(i=r[0],a=r[1],n=r[2].replace(";","").split("["),d=(d=e.split("="))[1]?d[1].trim().replace(";",""):null,o=n.length>1?+n[1].split("]")[0]:0,n=n[0],i){case"precision":break;case"attribute":"a"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : attribute의 첫글자는 a로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : attribute의 두번째 글자는 대문자 시작해야합니다.",n,r);break;case"uniform":"u"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : uniform의 첫글자는 u로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : uniform의 두번째 글자는 대문자 시작해야합니다.",n,r);break;case"varying":"v"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : varying의 첫글자는 v로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : varying의 두번째 글자는 대문자 시작해야합니다.",n,r);break;case"const":"c"!==n.charAt(0)&&RedGLUtil.throwFunc("RedShader : const의 첫글자는 c로 시작해야합니다.",n,r),n.charAt(1)!==n.charAt(1).toUpperCase()&&RedGLUtil.throwFunc("RedShader : const의 두번째 글자는 대문자 시작해야합니다.",n,r);break;default:RedGLUtil.throwFunc("RedShader : 체크되지 못하는값인데 뭐냐",n,r)}else RedGLUtil.throwFunc("RedShader : 체크되지 못하는값인데 뭐냐",r);s[i]||(s[i]={},s[i].list=[],s[i].map={},s[i].source=""),l={name:n,arrayNum:o,value:d,precision:u,systemUniformYn:!!RedSystemShaderCode.systemUniform[o?n+"["+o+"]":n]},"uniform"===i&&(l.uniformType=a),"attribute"===i&&(l.attributeType=a),"varying"===i&&(l.varyingType=a),s[i].list.push(l),s[i].map[n]=e,s[i].source+=e+";\n"}),t=(t+="\n").trim(),s.etc=t+"\n",l=e===RedShader.FRAGMENT?"#extension GL_OES_standard_derivatives : enable\n":"",s.precision&&(l+=s.precision.source+"\n//const\n"),s.const&&(l+=s.const.source+"\n//attribute\n"),s.attribute&&(l+=s.attribute.source+"\n//uniform\n"),s.uniform&&(l+=s.uniform.source+"\n//varying\n"),s.varying&&(l+=s.varying.source+"\n//etc\n"),s.etc&&(l+=s.etc),s.lastSource=l,e!==RedShader.FRAGMENT||s.precision||RedGLUtil.throwFunc("RedShader : FRAGMENT Shader는 precision를 반드시 선언해야함"),s},(RedShader=function(i,n,a,o){var s;if(!(this instanceof RedShader))return new RedShader(i,n,a,o);if(i instanceof RedGL||RedGLUtil.throwFunc("RedShader : RedGL Instance만 허용.","입력값 : "+i),"string"==typeof n||RedGLUtil.throwFunc("RedShader : key - 문자열만 허용.","입력값 : "+n),a!==RedShader.VERTEX&&a!==RedShader.FRAGMENT&&RedGLUtil.throwFunc("RedShader : type - RedShader.VERTEX or RedShader.FRAGMENT 만 허용.","입력값 : "+a),i._datas.RedShader||(i._datas.RedShader={},i._datas.RedShader[RedShader.VERTEX]={},i._datas.RedShader[RedShader.FRAGMENT]={}),o)"string"==typeof o||RedGLUtil.throwFunc("RedShader : source - 문자열만 허용."),RedShader.hasKey(i,n,a)?RedGLUtil.throwFunc("RedShader : key - 이미 정의된 키로 생성을 시도.","\n키 :",n,"\n타입 :"+a):i._datas.RedShader[a][n]=this;else{if(RedShader.hasKey(i,n,a))return i._datas.RedShader[a][n];RedGLUtil.throwFunc("RedShader : "+a+" 타입에 존재하지 않는 key를 검색하려고합니다.","입력값 : "+n)}s=i.gl,this.webglShader=e(s,n,a),this.parseData=r(a,o),this.originSource=o,t(s,0,this.webglShader,this.parseData),this.key=n,this.type=a,this._UUID=RedGL.makeUUID(),Object.freeze(this)}).hasKey=function(e,t,r){return!!e._datas.RedShader[r][t]},RedShader.FRAGMENT="fragmentShader",RedShader.VERTEX="vertexShader",Object.freeze(RedShader)}(),function(){var e,t,r,i=[];e=function(t){for(var r,n=i.length;n--;)(r=i[n]).worldRender(r._redGL,t),r._callback&&r._callback(t);requestAnimationFrame(e)},requestAnimationFrame(e),(RedRenderer=function(){if(!(this instanceof RedRenderer))return new RedRenderer;this.world=null,this._tickKey=null,this._callback=null,this._UUID=RedGL.makeUUID(),this.renderInfo={},this.cacheState=[],this.cacheInfo={cacheUniformInfo:[],cacheAttrInfo:[],cacheSamplerIndex:[],cacheTexture:[],cacheSystemUniformInfo:[]},this.renderDebuger=RedRenderDebuger(),this.worldRect=[],this._glInitialized=!1}).prototype={start:function(e,t){e instanceof RedGL||RedGLUtil.throwFunc("RedGL Instance만 허용"),e.world instanceof RedWorld||RedGLUtil.throwFunc("RedWorld Instance만 허용");this.stop(),this.world=e.world,this._redGL=e,this._callback=t,i.push(this)},setDebugButton:function(){var e,t=this;window.document&&(document.body.appendChild(e=document.createElement("button")),e.style.cssText="position:fixed;left:10px;top:10px;background:rgb(91, 82, 170);color:#fff;z-index:10001;border:0;outline:none;cursor:pointer;padding:8px;font-size:11px;border-radius:5px",e.innerHTML="debugRenderInfo - "+RedGL_VERSION.version,e.addEventListener("click",function(){t.renderDebuger.visible=!t.renderDebuger.visible}))},render:function(e,t){e instanceof RedGL||RedGLUtil.throwFunc("RedGL Instance만 허용"),t=t||0,this.world=e.world,this.worldRender(e,t)},stop:function(){-1===(t=i.indexOf(this))||i.splice(t,1)}};var n,a,o,s,d,l,u,c,f,h,R,m,p,_=[],g=[],v=0;l=[],o=function(e){for(u=e.length;u--;)"number"==typeof e[u]?e[u]=e[u]:e[u]=u<2?n[u+2]*parseFloat(e[u])/100:n[u]*parseFloat(e[u])/100;return e},s=function(e,t,i){r=RedSystemUniformUpdater.update(e,this,t,i,r,l)},d=function(e){e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.frontFace(e.CCW),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.SCISSOR_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.disable(e.DITHER),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1)},RedRenderer.prototype.worldRender=function(e,t){var r,i,u,c,f,h,R,E,M;for(r=e.gl,a=this,window.RedGLTFLoader&&RedGLTFLoader.animationLooper(t),(n=a.worldRect)[0]=0,n[1]=0,n[2]=r.drawingBufferWidth,n[3]=r.drawingBufferHeight,r.viewport(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.scissor(0,0,r.drawingBufferWidth,r.drawingBufferHeight),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT),_.length=0,g.length=0,v=0,a._glInitialized||(d(r),a._glInitialized=!0),a.renderInfo={},a.cacheInfo.cacheAttrInfo.length=0,e.gl.activeTexture(e.gl.TEXTURE0),e.gl.bindTexture(e.gl.TEXTURE_2D,e._datas.emptyTexture["2d"].webglTexture),e.gl.activeTexture(e.gl.TEXTURE0+1),e.gl.bindTexture(e.gl.TEXTURE_CUBE_MAP,e._datas.emptyTexture["3d"].webglTexture),h=0,R=a.world._viewList.length;h<R;h++)(M=(E=a.world._viewList[h])._viewRect)[0]=E._x,M[1]=E._y,M[2]=E._width,M[3]=E._height,f=E.camera,i=E.scene,o(M),a.renderInfo[E.key]||(a.renderInfo[E.key]={}),(u=a.renderInfo[E.key]).mode2DYn=f instanceof RedBaseController?f.camera.mode2DYn:f.mode2DYn,u.x=E._x,u.y=E._y,u.width=E._width,u.height=E._height,u.view=E,u.viewRectX=M[0],u.viewRectY=M[1],u.viewRectWidth=M[2],u.viewRectHeight=M[3],u.key=E.key,u.call=0,u.triangleNum=0,u.viewRenderTime=0,u.postEffectRenderTime=0,r.viewport(M[0],n[3]-M[3]-M[1],M[2],M[3]),r.scissor(M[0],n[3]-M[3]-M[1],M[2],M[3]),i._useBackgroundColor?(i._useFog?r.clearColor(i._fogR,i._fogG,i._fogB,1):r.clearColor(i._r,i._g,i._b,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)):(r.clearColor(0,0,0,1),r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT)),f instanceof RedBaseController&&(f.update(),f=f.camera),f.autoUpdateMatrix&&f.update(),c=f.perspectiveMTX,mat4.identity(c),f.mode2DYn?(mat4.ortho(c,-.5,.5,-.5,.5,-f.farClipping,f.farClipping),mat4.translate(c,c,[-.5,.5,0]),mat4.scale(c,c,[1/M[2]*e.renderScale*window.devicePixelRatio,1/M[3]*e.renderScale*window.devicePixelRatio,1]),mat4.identity(f.matrix),r.disable(r.CULL_FACE),a.cacheState.useCullFace=!1):(mat4.perspective(c,f.fov*Math.PI/180,M[2]/M[3],f.nearClipping,f.farClipping),r.enable(r.CULL_FACE),a.cacheState.useCullFace=!0),!a.cacheState.useDepthMask&&r.depthMask(a.cacheState.useDepthMask=!0),i.mouseManager&&(s.apply(a,[e,t,E]),i.mouseManager.render(e,a,E,t,u,h==R-1)),i.shadowManager._directionalShadow&&(s.apply(a,[e,t,E]),r.disable(r.BLEND),r.blendFunc(r.ONE,r.ONE),a.cacheState.useBlendMode=!0,a.cacheState.blendSrc=r.ONE,a.cacheState.blendDst=r.ONE,i.shadowManager.render(e,a,E,t,u),r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),a.cacheState.useBlendMode=!0,a.cacheState.blendSrc=r.SRC_ALPHA,a.cacheState.blendDst=r.ONE_MINUS_SRC_ALPHA),E.postEffectManager.postEffectList.length&&(E.postEffectManager.bind(r),r.viewport(0,0,E.postEffectManager.frameBuffer.width,E.postEffectManager.frameBuffer.height),r.scissor(0,0,E.postEffectManager.frameBuffer.width,E.postEffectManager.frameBuffer.height)),s.apply(a,[e,t,E]),i.skyBox&&(i.skyBox.x=f.x,i.skyBox.y=f.y,i.skyBox.z=f.z,i.skyBox.scaleX=i.skyBox.scaleY=i.skyBox.scaleZ=.6*f.farClipping,a.sceneRender(e,i,f,f.mode2DYn,[i.skyBox],t,u)),i.grid&&a.sceneRender(e,i,f,f.mode2DYn,[i.grid],t,u),m||(m=RedOutlineMaterial(e),p=RedOutlinePlaneMaterial(e)),a.sceneRender(e,i,f,f.mode2DYn,i.children,t,u),g.length&&(a.sceneRender(e,i,f,f.mode2DYn,g,t,u,null,!1,!0),g.length=0,v=0),_.length&&a.sceneRender(e,i,f,f.mode2DYn,_,t,u,null,!0),i.mirrorManager&&i.mirrorManager.render(e,a,E,t,u,s),i.axis&&a.sceneRender(e,i,f,f.mode2DYn,i.axis.children,t,u),l.length&&a.sceneRender(e,i,f,f.mode2DYn,l,t,u),u.viewRenderTime=performance.now(),E.postEffectManager.postEffectList.length&&E.postEffectManager.render(e,r,a,E,t,u),u.postEffectRenderTime=performance.now()-u.viewRenderTime,u.viewRenderTime-=t;this.renderDebuger.visible&&this.renderDebuger.update(e,a.renderInfo)},c=function(e,t,i,n,o,s,d,l,u,E,M,b,L){var T,P,x,y,w,U,I,B,F,D,G,A,S,O,C,N,k,Y,X,j,z,V,Z,W,H,q,J,K,Q,$,ee,te,re,ie,ne,ae,oe,se,de,le,ue,ce,fe,he,Re,me,pe,_e,ge,ve,Ee,Me,be,Le,Te,Pe,xe,ye,we,Ue,Ie,Be,Fe,De,Ge,Ae,Se,Oe,Ce,Ne,ke,Ye,Xe,je,ze,Ve,Ze,We,He,qe,Je,Ke,Qe,$e,et=e.gl,tt=l.cacheAttrInfo,rt=l.cacheUniformInfo,it=l.cacheSamplerIndex,nt=l.cacheTexture;x=Math.PI/180,ze=3.141592653589793,Ve=6.283185307179586,Ze=1.27323954,We=.405284735,He=1.5707963267948966,T=i.length;var at=i.length-1;for(ee=t._useFog,(Ke=t.shadowManager._directionalShadow)?ne=ee?"directionalShadow_fog":"directionalShadow":ee&&(ne="fog");T--;){if(d.call++,V=(y=i[at-T]).matrix,Z=y.normalMatrix,W=y.localMatrix,w=y._geometry,J=y._sprite3DYn,$=y.skinInfo,y.useLOD&&(ce=n.x-y.x,fe=n.y-y.y,he=n.z-y.z,qe=Math.abs(Math.sqrt(ce*ce+fe*fe+he*he)),(K=(I=y._lodLevels)[0])&&K.distance<qe&&(Je=K),(K=I[1])&&K.distance<qe&&(Je=K),(K=I[2])&&K.distance<qe&&(Je=K),(K=I[3])&&K.distance<qe&&(Je=K),(K=I[4])&&K.distance<qe&&(Je=K),Je&&(y._geometry=Je.geometry,y._material=Je.material)),w){if(U=M||y._material,L&&(U=y._material&&w instanceof RedPlane?p:m),Q=U._RedDirectionalShadowYn,U._RedMouseEventMaterialYn&&(U.color=y._mouseColorID),U.__RedSheetMaterialYn){if(U._nextFrameTime||(U._nextFrameTime=U._perFrameTime+s),U._playYn&&U._nextFrameTime<s){var ot=parseInt((s-U._nextFrameTime)/U._perFrameTime);ot=ot||1,U._nextFrameTime=U._perFrameTime+s,U.currentIndex+=ot,U.currentIndex>=U.totalFrame&&(U._loop?(U._playYn=!0,U.currentIndex=0):(U._playYn=!1,U.currentIndex=U.totalFrame-1))}U._sheetRect[0]=1/U._segmentW,U._sheetRect[1]=1/U._segmentH,U._sheetRect[2]=U.currentIndex%U._segmentW/U._segmentW,U._sheetRect[3]=Math.floor(U.currentIndex/U._segmentH)/U._segmentH}for((te=U.program)._prepareProgramYn&&(te=U.program=te._makePrepareProgram()),$e=te.key,$||J?Ke?re=ee&&J?"directionalShadow_fog_sprite3D":ee&&$?"directionalShadow_fog_skin":$?"directionalShadow_skin":J?"directionalShadow_sprite3D":ee?"directionalShadow_fog":"directionalShadow":ee&&J?re="fog_sprite3D":ee&&$?re="fog_skin":$?re="skin":J?re="sprite3D":ee&&(re="fog"):re=ne,(Qe=U._programList)&&re&&((ie=Qe[re][$e])._prepareProgramYn&&(ie=Qe[re][$e]=ie._makePrepareProgram()),te=ie),r!=te._UUID&&et.useProgram(te.webglProgram),r=te._UUID,B=te.attributeLocation,A=te.uniformLocation,S=te.systemUniformLocation,k=w.interleaveBuffer,Y=w.indexBuffer,H=k._UUID,P=B.length,A.length>P&&(P=A.length),D=k.interleaveDefineInfoList,h!=H&&et.bindBuffer(et.ARRAY_BUFFER,k.webglBuffer),h=H;P--;)(F=B[P])&&(G=D[F.name],N=F.location,G&&tt[N]!=G._UUID&&(!F.enabled&&et.enableVertexAttribArray(N),F.enabled=1,et.vertexAttribPointer(N,G.size,k.glArrayType,G.normalize,k.stride_BYTES_PER_ELEMENT,G.offset_BYTES_PER_ELEMENT),tt[N]=G._UUID)),(O=A[P])&&(C=O.location,H=O._UUID,z=O.renderTypeIndex,j=O.renderType,X=U[O.materialPropertyName],z<2?(q=O.samplerIndex,X?nt[q]!=X._UUID&&(R!=q&&et.activeTexture(et.TEXTURE0+(R=q)),X._videoDom?(et.bindTexture(et.TEXTURE_2D,X.webglTexture),X._videoDom.loaded&&et.texImage2D(et.TEXTURE_2D,0,et.RGBA,et.RGBA,et.UNSIGNED_BYTE,X._videoDom),nt=[]):et.bindTexture(0==z?et.TEXTURE_2D:et.TEXTURE_CUBE_MAP,X.webglTexture),it[H]!=q&&et.uniform1iv(C,[it[H]=q]),nt[q]=X._UUID):nt[q]!=z&&(it[H]!=z&&et.uniform1iv(C,[it[H]=z]),nt[q]=z,R=z)):(null==X&&RedGLUtil.throwFunc("RedRenderer : Material에 ",O.materialPropertyName,"이 정의 되지않았습니다."),z<13?rt[H]!=X&&et[O.renderMethod](C,(rt[H]=12==z?null:X,X)):13==z?et[O.renderMethod](C,!1,X):RedGLUtil.throwFunc("RedRenderer : 처리할수없는 타입입니다.","tRenderType -",j)))}if(U&&U._RedMouseEventMaterialYn)w&&et.uniformMatrix4fv(S.uMMatrix.location,!1,V);else if(y.autoUpdateMatrix&&(Re=1,me=0,pe=0,ge=0,ve=1,Ee=0,be=0,Le=0,Te=1,W[12]=y.x,W[13]=y.y*(o?-1:1),W[14]=y.z,W[15]=1,J?ce=fe=he=0:(ce=y.rotationX*x,fe=y.rotationY*x,he=y.rotationZ*x),(je=ce%Ve)<-ze?je+=Ve:je>ze&&(je-=Ve),ae=(je=je<0?Ze*je+We*je*je:Ze*je-We*je*je)<0?.225*(je*-je-je)+je:.225*(je*je-je)+je,(je=(ce+He)%Ve)<-ze?je+=Ve:je>ze&&(je-=Ve),de=(je=je<0?Ze*je+We*je*je:Ze*je-We*je*je)<0?.225*(je*-je-je)+je:.225*(je*je-je)+je,(je=fe%Ve)<-ze?je+=Ve:je>ze&&(je-=Ve),oe=(je=je<0?Ze*je+We*je*je:Ze*je-We*je*je)<0?.225*(je*-je-je)+je:.225*(je*je-je)+je,(je=(fe+He)%Ve)<-ze?je+=Ve:je>ze&&(je-=Ve),le=(je=je<0?Ze*je+We*je*je:Ze*je-We*je*je)<0?.225*(je*-je-je)+je:.225*(je*je-je)+je,(je=he%Ve)<-ze?je+=Ve:je>ze&&(je-=Ve),se=(je=je<0?Ze*je+We*je*je:Ze*je-We*je*je)<0?.225*(je*-je-je)+je:.225*(je*je-je)+je,(je=(he+He)%Ve)<-ze?je+=Ve:je>ze&&(je-=Ve),Ge=le*(ue=(je=je<0?Ze*je+We*je*je:Ze*je-We*je*je)<0?.225*(je*-je-je)+je:.225*(je*je-je)+je),Ae=ae*oe*ue-de*se,Se=de*oe*ue+ae*se,Oe=le*se,Ce=ae*oe*se+de*ue,Ne=de*oe*se-ae*ue,ke=-oe,Ye=ae*le,Xe=de*le,ce=y.scaleX,fe=y.scaleY,he=y.scaleZ,W[0]=(Re*Ge+ge*Ae+be*Se)*ce,W[1]=(me*Ge+ve*Ae+Le*Se)*ce,W[2]=(pe*Ge+Ee*Ae+Te*Se)*ce,W[3]=W[3]*ce,W[4]=(Re*Oe+ge*Ce+be*Ne)*fe,W[5]=(me*Oe+ve*Ce+Le*Ne)*fe,W[6]=(pe*Oe+Ee*Ce+Te*Ne)*fe,W[7]=W[7]*fe,W[8]=(Re*ke+ge*Ye+be*Xe)*he,W[9]=(me*ke+ve*Ye+Le*Xe)*he,W[10]=(pe*ke+Ee*Ye+Te*Xe)*he,W[11]=W[11]*he,(y.pivotX||y.pivotY||y.pivotZ)&&(Re=W[0],me=W[1],pe=W[2],_e=W[3],ge=W[4],ve=W[5],Ee=W[6],Me=W[7],be=W[8],Le=W[9],Te=W[10],Pe=W[11],xe=W[12],ye=W[13],we=W[14],Ue=W[15],Ie=1,Be=0,Fe=0,De=0,W[0]=Ie*Re+Be*ge+Fe*be+De*xe,W[1]=Ie*me+Be*ve+Fe*Le+De*ye,W[2]=Ie*pe+Be*Ee+Fe*Te+De*we,W[3]=Ie*_e+Be*Me+Fe*Pe+De*Ue,Ie=0,Be=1,Fe=0,De=0,W[4]=Ie*Re+Be*ge+Fe*be+De*xe,W[5]=Ie*me+Be*ve+Fe*Le+De*ye,W[6]=Ie*pe+Be*Ee+Fe*Te+De*we,W[7]=Ie*_e+Be*Me+Fe*Pe+De*Ue,Ie=0,Be=0,Fe=1,De=0,W[8]=Ie*Re+Be*ge+Fe*be+De*xe,W[9]=Ie*me+Be*ve+Fe*Le+De*ye,W[10]=Ie*pe+Be*Ee+Fe*Te+De*we,W[11]=Ie*_e+Be*Me+Fe*Pe+De*Ue,o?E?(Ie=-y.pivotX,Be=y.pivotY,Fe=-y.pivotZ,De=1):(Ie=-y.pivotX/ce,Be=y.pivotY/fe,Fe=-y.pivotZ,De=1):(Ie=-y.pivotX,Be=-y.pivotY,Fe=-y.pivotZ,De=1),W[12]=Ie*Re+Be*ge+Fe*be+De*xe,W[13]=Ie*me+Be*ve+Fe*Le+De*ye,W[14]=Ie*pe+Be*Ee+Fe*Te+De*we,W[15]=Ie*_e+Be*Me+Fe*Pe+De*Ue),E?(Re=E[0],me=E[1],pe=E[2],_e=E[3],ge=E[4],ve=E[5],Ee=E[6],Me=E[7],be=E[8],Le=E[9],Te=E[10],Pe=E[11],xe=E[12],ye=E[13],we=E[14],Ue=E[15],Ie=W[0],Be=W[1],Fe=W[2],De=W[3],V[0]=Ie*Re+Be*ge+Fe*be+De*xe,V[1]=Ie*me+Be*ve+Fe*Le+De*ye,V[2]=Ie*pe+Be*Ee+Fe*Te+De*we,V[3]=Ie*_e+Be*Me+Fe*Pe+De*Ue,Ie=W[4],Be=W[5],Fe=W[6],De=W[7],V[4]=Ie*Re+Be*ge+Fe*be+De*xe,V[5]=Ie*me+Be*ve+Fe*Le+De*ye,V[6]=Ie*pe+Be*Ee+Fe*Te+De*we,V[7]=Ie*_e+Be*Me+Fe*Pe+De*Ue,Ie=W[8],Be=W[9],Fe=W[10],De=W[11],V[8]=Ie*Re+Be*ge+Fe*be+De*xe,V[9]=Ie*me+Be*ve+Fe*Le+De*ye,V[10]=Ie*pe+Be*Ee+Fe*Te+De*we,V[11]=Ie*_e+Be*Me+Fe*Pe+De*Ue,Ie=W[12],Be=W[13],Fe=W[14],De=W[15],V[12]=Ie*Re+Be*ge+Fe*be+De*xe,V[13]=Ie*me+Be*ve+Fe*Le+De*ye,V[14]=Ie*pe+Be*Ee+Fe*Te+De*we,V[15]=Ie*_e+Be*Me+Fe*Pe+De*Ue):(V[0]=W[0],V[1]=W[1],V[2]=W[2],V[3]=W[3],V[4]=W[4],V[5]=W[5],V[6]=W[6],V[7]=W[7],V[8]=W[8],V[9]=W[9],V[10]=W[10],V[11]=W[11],V[12]=W[12],V[13]=W[13],V[14]=W[14],V[15]=W[15])),w&&(et.uniformMatrix4fv(S.uMMatrix.location,!1,V),S.uNMatrix.location&&(Re=V[0],me=V[1],pe=V[2],_e=V[3],ge=V[4],ve=V[5],Ee=V[6],Me=V[7],be=V[8],Le=V[9],Te=V[10],Pe=V[11],ye=V[12],we=V[13],Ne=Le*(Ue=V[14])-Te*we,Xe=1/(Xe=(xe=Re*ve-me*ge)*(Ne=Te*(Ie=V[15])-Pe*Ue)-(Be=Re*Ee-pe*ge)*(ke=Le*Ie-Pe*we)+(Fe=Re*Me-_e*ge)*Ne+(De=me*Ee-pe*ve)*(Ce=be*Ie-Pe*ye)-(Ge=me*Me-_e*ve)*(Oe=be*Ue-Te*ye)+(Ae=pe*Me-_e*Ee)*(Se=be*we-Le*ye)),Z[0]=(ve*Ne-Ee*ke+Me*Ne)*Xe,Z[4]=(-me*Ne+pe*ke-_e*Ne)*Xe,Z[8]=(we*Ae-Ue*Ge+Ie*De)*Xe,Z[12]=(-Le*Ae+Te*Ge-Pe*De)*Xe,Z[1]=(-ge*Ne+Ee*Ce-Me*Oe)*Xe,Z[5]=(Re*Ne-pe*Ce+_e*Oe)*Xe,Z[9]=(-ye*Ae+Ue*Fe-Ie*Be)*Xe,Z[13]=(be*Ae-Te*Fe+Pe*Be)*Xe,Z[2]=(ge*ke-ve*Ce+Me*Se)*Xe,Z[6]=(-Re*ke+me*Ce-_e*Se)*Xe,Z[10]=(ye*Ge-we*Fe+Ie*xe)*Xe,Z[14]=(-be*Ge+Le*Fe-Pe*xe)*Xe,Z[3]=(-ge*Ne+ve*Oe-Ee*Se)*Xe,Z[7]=(Re*Ne-me*Oe+pe*Se)*Xe,Z[11]=(-ye*De+we*Be-Ue*xe)*Xe,Z[15]=(be*De-Le*Be+Te*xe)*Xe,et.uniformMatrix4fv(S.uNMatrix.location,!1,Z))),$){var st,dt=$.joints,lt=0,ut=dt.length,ct=new Float32Array(16*ut),ft=[V[0],V[1],V[2],V[3],V[4],V[5],V[6],V[7],V[8],V[9],V[10],V[11],V[12],V[13],V[14],V[15]],ht=ft,Rt=ft[0],mt=ft[1],pt=ft[2],_t=ft[3],gt=ft[4],vt=ft[5],Et=ft[6],Mt=ft[7],bt=ft[8],Lt=ft[9],Tt=ft[10],Pt=ft[11],xt=ft[12],yt=ft[13],wt=ft[14],Ut=ft[15],It=Lt*wt*Mt-yt*Tt*Mt+yt*Et*Pt-vt*wt*Pt-Lt*Et*Ut+vt*Tt*Ut,Bt=xt*Tt*Mt-bt*wt*Mt-xt*Et*Pt+gt*wt*Pt+bt*Et*Ut-gt*Tt*Ut,Ft=bt*yt*Mt-xt*Lt*Mt+xt*vt*Pt-gt*yt*Pt-bt*vt*Ut+gt*Lt*Ut,Dt=xt*Lt*Et-bt*yt*Et-xt*vt*Tt+gt*yt*Tt+bt*vt*wt-gt*Lt*wt,Gt=Rt*It+mt*Bt+pt*Ft+_t*Dt;if(0===Gt)return mat4.identity(ft);var At=1/Gt;for(ht[0]=It*At,ht[1]=(yt*Tt*_t-Lt*wt*_t-yt*pt*Pt+mt*wt*Pt+Lt*pt*Ut-mt*Tt*Ut)*At,ht[2]=(vt*wt*_t-yt*Et*_t+yt*pt*Mt-mt*wt*Mt-vt*pt*Ut+mt*Et*Ut)*At,ht[3]=(Lt*Et*_t-vt*Tt*_t-Lt*pt*Mt+mt*Tt*Mt+vt*pt*Pt-mt*Et*Pt)*At,ht[4]=Bt*At,ht[5]=(bt*wt*_t-xt*Tt*_t+xt*pt*Pt-Rt*wt*Pt-bt*pt*Ut+Rt*Tt*Ut)*At,ht[6]=(xt*Et*_t-gt*wt*_t-xt*pt*Mt+Rt*wt*Mt+gt*pt*Ut-Rt*Et*Ut)*At,ht[7]=(gt*Tt*_t-bt*Et*_t+bt*pt*Mt-Rt*Tt*Mt-gt*pt*Pt+Rt*Et*Pt)*At,ht[8]=Ft*At,ht[9]=(xt*Lt*_t-bt*yt*_t-xt*mt*Pt+Rt*yt*Pt+bt*mt*Ut-Rt*Lt*Ut)*At,ht[10]=(gt*yt*_t-xt*vt*_t+xt*mt*Mt-Rt*yt*Mt-gt*mt*Ut+Rt*vt*Ut)*At,ht[11]=(bt*vt*_t-gt*Lt*_t-bt*mt*Mt+Rt*Lt*Mt+gt*mt*Pt-Rt*vt*Pt)*At,ht[12]=Dt*At,ht[13]=(bt*yt*pt-xt*Lt*pt+xt*mt*Tt-Rt*yt*Tt-bt*mt*wt+Rt*Lt*wt)*At,ht[14]=(xt*vt*pt-gt*yt*pt-xt*mt*Et+Rt*yt*Et+gt*mt*wt-Rt*vt*wt)*At,ht[15]=(gt*Lt*pt-bt*vt*pt+bt*mt*Et-Rt*Lt*Et-gt*mt*Tt+Rt*vt*Tt)*At;lt<ut;lt++)st=dt[lt].matrix,ct[16*lt+0]=st[0],ct[16*lt+1]=st[1],ct[16*lt+2]=st[2],ct[16*lt+3]=st[3],ct[16*lt+4]=st[4],ct[16*lt+5]=st[5],ct[16*lt+6]=st[6],ct[16*lt+7]=st[7],ct[16*lt+8]=st[8],ct[16*lt+9]=st[9],ct[16*lt+10]=st[10],ct[16*lt+11]=st[11],ct[16*lt+12]=st[12],ct[16*lt+13]=st[13],ct[16*lt+14]=st[14],ct[16*lt+15]=st[15];et.uniformMatrix4fv(S.uGlobalTransformOfNodeThatTheMeshIsAttachedTo.location,!1,ft),et.uniformMatrix4fv(S.uJointMatrix.location,!1,ct),$.inverseBindMatrices._UUID||($.inverseBindMatrices._UUID=JSON.stringify($.inverseBindMatrices)),rt[H=S.uInverseBindMatrixForJoint._UUID]!=$.inverseBindMatrices._UUID&&(et.uniformMatrix4fv(S.uInverseBindMatrixForJoint.location,!1,$.inverseBindMatrices),rt[H]=$.inverseBindMatrices._UUID)}if(w){if(u.useDepthMask!=y.useDepthMask&&et.depthMask(u.useDepthMask=y.useDepthMask),u.useDepthTest!=y.useDepthTest&&((u.useDepthTest=y.useDepthTest)?et.enable(et.DEPTH_TEST):et.disable(et.DEPTH_TEST)),L?(rt[H=S.uOutlineThickness._UUID]!=y.outlineThickness&&et.uniform1f(S.uOutlineThickness.location,u[H]=y.outlineThickness),et.uniform4fv(S.uOutlineColor.location,u.uOutlineColor=y._outlineColor),y.autoUpdateMatrix=y._renderAutoUpdateMatrix,w instanceof RedPlane?0!=u.useCullFace&&(u.useCullFace=!1,et.disable(et.CULL_FACE)):(1!=u.useCullFace&&(u.useCullFace=!0,et.enable(et.CULL_FACE)),u.cullFace!=et.FRONT&&et.cullFace(u.cullFace=et.FRONT))):(u.useDepthTest&&(u.depthTestFunc!=y.depthTestFunc&&et.depthFunc(u.depthTestFunc=y.depthTestFunc)),u.useCullFace!=y.useCullFace&&((u.useCullFace=y.useCullFace)?et.enable(et.CULL_FACE):et.disable(et.CULL_FACE)),u.useCullFace&&(u.cullFace!=y.cullFace&&et.cullFace(u.cullFace=y.cullFace)),y.outlineThickness&&(g[v++]=y,y._renderAutoUpdateMatrix=y.autoUpdateMatrix,y.autoUpdateMatrix=!1)),S.uPointSize.use&&u.pointSize!=y.pointSize&&et.uniform1f(S.uPointSize.location,u.pointSize=y.pointSize),S.u_PerspectiveScale.location&&(H=S.u_PerspectiveScale._UUID,X=y._perspectiveScale,rt[H]!=X&&(et[S.u_PerspectiveScale.renderMethod](S.u_PerspectiveScale.location,X),rt[H]=X)),Q||(u.useBlendMode!=y.useBlendMode&&((u.useBlendMode=y.useBlendMode)?et.enable(et.BLEND):et.disable(et.BLEND)),u.blendSrc==y.blendSrc&&u.blendDst==y.blendDst||(et.blendFunc(y.blendSrc,y.blendDst),u.blendSrc=y.blendSrc,u.blendDst=y.blendDst)),b)y.autoUpdateMatrix=y._renderAutoUpdateMatrix;else if(y.useTransparentSort){_.push(y),y._renderAutoUpdateMatrix=y.autoUpdateMatrix,y.autoUpdateMatrix=!1;continue}a._filterManager||(a._filterManager=RedFilterEffectManager(e)),y._filterList.length&&y!=a._filterManager.children[0]?(a._filterManager.filterList=y._filterList,a._filterManager.frameBuffer.width=d.viewRectWidth,a._filterManager.frameBuffer.height=d.viewRectHeight,et.clearColor(0,0,0,0),a._filterManager.bind(et),Y?(f!=Y._UUID&&et.bindBuffer(et.ELEMENT_ARRAY_BUFFER,Y.webglBuffer),et.drawElements(y.drawMode,Y.pointNum,Y.glArrayType,0),f=Y._UUID,d.triangleNum+=Y.triangleNum):(et.drawArrays(y.drawMode,0,k.pointNum),d.triangleNum+=k.triangleNum),a._filterManager.unbind(et),a._filterManager.render(e,et,a,d.view,s,d,y),a._filterManager.filterList=[]):Y?(f!=Y._UUID&&et.bindBuffer(et.ELEMENT_ARRAY_BUFFER,Y.webglBuffer),et.drawElements(y.drawMode,Y.pointNum,Y.glArrayType,0),f=Y._UUID,d.triangleNum+=Y.triangleNum):(et.drawArrays(y.drawMode,0,k.pointNum),d.triangleNum+=k.triangleNum)}!L&&y.children.length&&c(e,t,y.children,n,o,s,d,l,u,V,M,b,L)}},RedRenderer.prototype.sceneRender=function(e,t,r,i,n,a,o,s,d,l){this.cacheInfo.cacheTexture.length=0,f=null,h=null,R=null,c(e,t,n,r,i,a,o,this.cacheInfo,this.cacheState,void 0,s,d,l)},Object.freeze(RedRenderer)}(),(RedRenderDebuger=function(){if(!(this instanceof RedRenderDebuger))return new RedRenderDebuger;if(window.HTMLCanvasElement&&!this.renderResult){this.renderResult=document.createElement("div"),this._contentBox=document.createElement("div"),this._etcBox=document.createElement("div"),this.renderResult.appendChild(this._contentBox),this.renderResult.appendChild(this._etcBox),this.renderResult.style.cssText="position:absolute;bottom:0px;left:0px;color:#fff;font:11px Lucida Grande,sans-serif;font-size:11px;background:rgba(0,0,0,0.75);padding:3px;width:300px",this._etcBox.style.cssText="position:relative;color:#fff;font:11px Lucida Grande,sans-serif;font-size:11px;padding:3px;margin-top:10px;";var e=document.createElement("a");e.style.padding="5px",e.style.borderRadius="2px",e.style.background="rgba(91, 82, 170,0.8)",e.style.color="#fff",e.style.textDecoration="none",e.style.display="block",e.setAttribute("href","https://redcamel.github.io/RedGL2/redDoc/index.html"),e.innerHTML="API document",this._etcBox.appendChild(e),(e=document.createElement("a")).style.padding="5px",e.style.borderRadius="2px",e.style.background="rgba(91, 82, 170,0.8)",e.style.color="#fff",e.style.textDecoration="none",e.style.display="block",e.style.marginTop="2px",e.setAttribute("href","https://github.com/redcamel/RedGL2"),e.innerHTML="GITHUB",this._etcBox.appendChild(e)}this._visible=!1}).prototype={update:function(e,t){if(window.HTMLCanvasElement){this._contentBox.innerHTML="";var r="",i=0,n=0;for(var a in t)r+='<div style="padding:5px"><div><b style="color:rgb(242, 169, 113)">RedView : key - '+t[a].key+'</b></div> mode2DYn - <b style="color:rgb(191, 82, 170)">'+t[a].mode2DYn+'</b> <br>call - <b style="color:rgb(191, 82, 170)">'+t[a].call+'</b> <br>triangleNum - <b style="color:rgb(191, 82, 170)">'+t[a].triangleNum+'</b> <br> width - <b style="color:rgb(191, 82, 170)">'+t[a].width+'</b> / height - <b style="color:rgb(191, 82, 170)">'+t[a].height+'</b> <br> viewRectWidth - <b style="color:rgb(191, 82, 170)">'+t[a].viewRectWidth+'</b> / viewRectHeight - <b style="color:rgb(191, 82, 170)">'+t[a].viewRectHeight+'</b> <br> x - <b style="color:rgb(191, 82, 170)">'+t[a].x+'</b> / y - <b style="color:rgb(191, 82, 170)">'+t[a].y+'</b><div>renderTime</div><div style="padding:5px 7px 7px 7px;background:rgba(0,0,0, 0.5);"><div>viewRenderTime - <b style="color:rgb(191, 82, 170)">'+t[a].viewRenderTime.toFixed(2)+'ms</b></div><div>baseRenderTime - <b style="color:rgb(191, 82, 170)">'+(t[a].viewRenderTime-t[a].postEffectRenderTime).toFixed(2)+'ms</b></div><div>postEffectRenderTime - <b style="color:rgb(191, 82, 170)">'+t[a].postEffectRenderTime.toFixed(2)+"ms</b></div></div></div>",i+=t[a].viewRenderTime,n+=t[a].postEffectRenderTime;r+='<div style="padding:0px 5px">',r+='<div>renderScale : <span style="padding:3px;background:#000">'+e.renderScale+"</span></div>",r+='<div>totalRenderTime : <span style="padding:3px;background:#000">'+i.toFixed(2)+"ms</span></div>",r+='<div>baseRenderTime : <span style="padding:3px;background:#000">'+(i-n).toFixed(2)+"ms</span></div>",r+='<div>postEffectRenderTime : <span style="padding:3px;background:#000">'+n.toFixed(2)+"ms</span></div>",r+="</div>",this._contentBox.innerHTML=r}}},Object.defineProperty(RedRenderDebuger.prototype,"visible",{get:function(){return this._visible},set:function(e){this._visible=e,window.HTMLCanvasElement&&(this._visible?document.body.appendChild(this.renderResult):this.renderResult.parentNode&&document.body.removeChild(this.renderResult))}}),Object.freeze(RedRenderDebuger),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p,_,g,v,E,M,b,L,T,P,x,y,w,U,I,B,F,D,G,A,S,O,C,N;RedSystemUniformUpdater={update:(N=0,E=new Float32Array(3),function(k,Y,X,j,z,V){for(e!=k&&(L=null),e=k,L||(S=RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT,O=RedSystemShaderCode.MAX_POINT_LIGHT,L={uTime:{cacheData:null,data:0},uResolution:{cacheData:null,data:new Float32Array([0,0])},u_FogDensity:{cacheData:null,data:0},uFogColor:{cacheData:null,data:new Float32Array([0,0,0,0])},u_FogDistance:{cacheData:null,data:0},uCameraMatrix:{cacheData:null,data:null},uCameraPosition:{cacheData:null,data:new Float32Array([0,0,0])},uPMatrix:{cacheData:null,data:null},uMode2DYn:{cacheData:null,data:!1},uAmbientLightColor:{cacheData:null,data:new Float32Array([0,0,0,0])},uAmbientIntensity:{cacheData:null,data:1},uDirectionalLightPositionList:{cacheData:null,data:[]},uDirectionalLightColorList:{cacheData:null,data:[]},uDirectionalLightIntensityList:{cacheData:null,data:[]},uDirectionalLightNum:{cacheData:null,data:0},uPointLightPositionList:{cacheData:null,data:[]},uPointLightColorList:{cacheData:null,data:[]},uPointLightIntensityList:{cacheData:null,data:[]},uPointLightRadiusList:{cacheData:null,data:[]},uPointLightNum:{cacheData:null,data:0}},w=new Float32Array(3),P=new Float32Array(16),y=new Float32Array(16),l=new Float32Array(3*S),u=new Float32Array(4*S),c=new Float32Array(S),f=new Float32Array(3*O),h=new Float32Array(4*O),R=new Float32Array(O),m=new Float32Array(O)),t=k.gl,F=j.scene,D=(D=j.camera)instanceof RedBaseController?D.camera:D,G=j._viewRect,B=Y.cacheInfo.cacheSystemUniformInfo,I=null,T={},V.length=0,A=N!=k._datas.RedProgramList.length,N=0,(C=L.uTime).cacheData!=X&&(T.uTime=C.data=X,C.cacheData=X),d=JSON.stringify(G),((C=L.uResolution).cacheData!=d||A)&&(C.data[0]=G[2],C.data[1]=G[3],T.uResolution=C.data,C.cacheData=d),d=F._fogDensity,((C=L.u_FogDensity).cacheData!=d||A)&&(T.u_FogDensity=C.data=d,C.cacheData=d),d=F._fogR+"_"+F._fogG+"_"+F._fogB+"_1",((C=L.uFogColor).cacheData!=d||A)&&(C.data[0]=F._fogR,C.data[1]=F._fogG,C.data[2]=F._fogB,C.data[3]=1,T.uFogColor=C.data,C.cacheData=d),d=F._fogDistance,((C=L.u_FogDistance).cacheData!=d||A)&&(T.u_FogDistance=C.data=d,C.cacheData=d),d=JSON.stringify(D.matrix),((C=L.uCameraMatrix).cacheData!=d||A)&&(T.uCameraMatrix=C.data=D.matrix,C.cacheData=d),d=D.camera?[D.camera.x,D.camera.y,D.camera.z]:[D.x,D.y,D.z],((C=L.uCameraPosition).cacheData!=d.join(",")||A)&&(T.uCameraPosition=C.data=d,C.cacheData=d.join(",")),d=JSON.stringify(D.mode2DYn),((C=L.uMode2DYn).cacheData!=d||A)&&(T.uMode2DYn=C.data=D.mode2DYn,C.cacheData=d),d=JSON.stringify(D.perspectiveMTX),((C=L.uPMatrix).cacheData!=d||A)&&(T.uPMatrix=C.data=D.perspectiveMTX,C.cacheData=d),(g=F._lightInfo[RedAmbientLight.TYPE])&&(d=JSON.stringify(g._lightColor),((C=L.uAmbientLightColor).cacheData!=d||A)&&(T.uAmbientLightColor=C.data=[g._lightColor[0],g._lightColor[1],g._lightColor[2],g._lightColor[3]],C.cacheData=d,T.uAmbientLightColor[0]*=T.uAmbientLightColor[3],T.uAmbientLightColor[1]*=T.uAmbientLightColor[3],T.uAmbientLightColor[2]*=T.uAmbientLightColor[3]),d=g._intensity,((C=L.uAmbientIntensity).cacheData!=d||A)&&(T.uAmbientIntensity=C.data=g._intensity,C.cacheData=d)),p=F._lightInfo[RedDirectionalLight.TYPE],M=p.length;M--;)g=p[M],E[0]=g.x,E[1]=g.y,E[2]=g.z,g.debug&&((v=g._debugObject).x=E[0],v.y=E[1],v.z=E[2],v._material._color=g._lightColor,V.push(v)),vec3.normalize(E,E),l[0+3*M]=E[0],l[1+3*M]=E[1],l[2+3*M]=E[2],u[0+4*M]=g._lightColor[0]*g._lightColor[3],u[1+4*M]=g._lightColor[1]*g._lightColor[3],u[2+4*M]=g._lightColor[2]*g._lightColor[3],u[3+4*M]=g._lightColor[3],c[M]=g._intensity;for(d=JSON.stringify(l),((C=L.uDirectionalLightPositionList).cacheData!=d||A)&&(T.uDirectionalLightPositionList=C.data=l,C.cacheData=d),d=JSON.stringify(u),((C=L.uDirectionalLightColorList).cacheData!=d||A)&&(T.uDirectionalLightColorList=C.data=u,C.cacheData=d),d=JSON.stringify(c),((C=L.uDirectionalLightIntensityList).cacheData!=d||A)&&(T.uDirectionalLightIntensityList=C.data=c,C.cacheData=d),d=p.length,((C=L.uDirectionalLightNum).cacheData!=d||A)&&(T.uDirectionalLightNum=C.data=d,C.cacheData=d),p=F._lightInfo[RedPointLight.TYPE],M=p.length;M--;)g=p[M],E[0]=g.x,E[1]=g.y,E[2]=g.z,g.debug&&((v=g._debugObject).x=E[0],v.y=E[1],v.z=E[2],v.scaleX=v.scaleY=v.scaleZ=g._radius,v._material._color=g._lightColor,V.push(v)),f[0+3*M]=E[0],f[1+3*M]=E[1],f[2+3*M]=E[2],h[0+4*M]=g._lightColor[0]*g._lightColor[3],h[1+4*M]=g._lightColor[1]*g._lightColor[3],h[2+4*M]=g._lightColor[2]*g._lightColor[3],h[3+4*M]=g._lightColor[3],R[M]=g._intensity,m[M]=g._radius;for(d=JSON.stringify(f),((C=L.uPointLightPositionList).cacheData!=d||A)&&(T.uPointLightPositionList=C.data=f,C.cacheData=d),d=JSON.stringify(h),((C=L.uPointLightColorList).cacheData!=d||A)&&(T.uPointLightColorList=C.data=h,C.cacheData=d),d=JSON.stringify(R),((C=L.uPointLightIntensityList).cacheData!=d||A)&&(T.uPointLightIntensityList=C.data=R,C.cacheData=d),d=JSON.stringify(m),((C=L.uPointLightRadiusList).cacheData!=d||A)&&(T.uPointLightRadiusList=C.data=m,C.cacheData=d),d=p.length,((C=L.uPointLightNum).cacheData!=d||A)&&(T.uPointLightNum=C.data=d,C.cacheData=d),F.shadowManager._directionalShadow&&(P[1]=P[2]=P[3]=P[4]=P[6]=P[7]=P[8]=P[9]=P[11]=P[12]=P[13]=P[14]=0,P[0]=P[5]=P[10]=P[15]=1,x=F.shadowManager._directionalShadow.size,_=F.shadowManager._directionalShadow._light,mat4.ortho(y,-x,x,-x,x,-x,x),w[0]=0,w[1]=0,w[2]=0,_&&(w[0]=_.x,w[1]=_.y,w[2]=_.z,vec3.normalize(w,w),mat4.lookAt(P,w,[0,0,0],[0,1,0]),mat4.multiply(P,y,P))),M=k._datas.RedProgramList.length;M--;)for(b in N++,r=k._datas.RedProgramList[M],t.useProgram(r.webglProgram),z=r._UUID,i=r.systemUniformLocation,n=i.uDirectionalShadowLightMatrix,a=n.location,o=n._UUID,a&&F.shadowManager._directionalShadow&&(_=F.shadowManager._directionalShadow._light)&&(d=JSON.stringify(P),B[o]!=d&&(t.uniformMatrix4fv(a,!1,P),B[o]=d)),(n=i.uDirectionalShadowTexture)&&(a=n.location)&&(o=n._UUID,s=F.shadowManager._directionalShadow?F.shadowManager.directionalShadow.frameBuffer.texture:k._datas.emptyTexture["2d"],(U=n.samplerIndex)!=I&&(t.activeTexture(t.TEXTURE0+U),t.bindTexture(t.TEXTURE_2D,s.webglTexture),t[n.renderMethod](a,U)),I=U),T)n=i[b],(a=n.location)&&(o=n._UUID,s=T[b],"mat"==n.renderType?t[n.renderMethod](a,!1,s):t[n.renderMethod](a,s),B[o]=null);return z})},Object.freeze(RedSystemUniformUpdater)}(),(RedView=function(e,t,r){if(!(this instanceof RedView))return new RedView(e,t,r);!t||t instanceof RedScene||RedGLUtil.throwFunc("RedView : RedScene Instance만 허용","입력값 : "+t),r?!r||r instanceof RedCamera||r instanceof RedBaseController||RedGLUtil.throwFunc("RedView : RedCamera or XXController Instance만 허용"):RedGLUtil.throwFunc("RedView : RedCamera or XXController Instance만 허용","입력값 : "+r),this.scene=t,this.postEffectManager=RedPostEffectManager(e),this.camera=r,this._width="100%",this._height="100%",this._x=0,this._y=0,this._viewRect=[0,0,0,0],this._UUID=RedGL.makeUUID()}).prototype={setSize:function(e,t){null==e&&RedGLUtil.throwFunc("RedView setSize : width가 입력되지 않았습니다."),null==t&&RedGLUtil.throwFunc("RedView setSize : height가 입력되지 않았습니다."),"number"==typeof e?this._width=e<0?0:e:e.indexOf("%")>-1&&+e.replace("%","")>=0?this._width=e:RedGLUtil.throwFunc("RedView setSize : width는 0이상의 숫자나 %만 허용.",e),"number"==typeof t?this._height=t<0?0:t:t.indexOf("%")>-1&&+t.replace("%","")>=0?this._height=t:RedGLUtil.throwFunc("RedView setSize : height는 0이상의 숫자나 %만 허용.",t)},setLocation:function(e,t){null==e&&RedGLUtil.throwFunc("RedView setLocation : x가 입력되지 않았습니다."),null==t&&RedGLUtil.throwFunc("RedView setLocation : y가 입력되지 않았습니다."),"number"==typeof e?this._x=e<0?0:e:e.indexOf("%")>-1&&+e.replace("%","")>=0?this._x=e:RedGLUtil.throwFunc("RedView setLocation : x는 0이상의 숫자나 %만 허용.",e),"number"==typeof t?this._y=t<0?0:t:t.indexOf("%")>-1&&+t.replace("%","")>=0?this._y=t:RedGLUtil.throwFunc("RedView setLocation : y는 0이상의 숫자나 %만 허용.",t)}},Object.freeze(RedView),function(){var e,t;(RedWorld=function(){if(!(this instanceof RedWorld))return new RedWorld;this._viewList=[],this._viewMap={},this._UUID=RedGL.makeUUID()}).prototype={addView:function(e,t){e instanceof RedView||RedGLUtil.throwFunc("RedWorld :addView Instance만 허용함.","입력값 : "+e),t&&(this._viewMap[t]?RedGLUtil.throwFunc("RedWorld :key 중복","입력값 : "+t):this._viewMap[t]=e),this._viewList.push(e)},getView:function(e){return"string"==typeof e||RedGLUtil.throwFunc("RedWorld :getView 문자열만 허용함.","입력값 : "+e),this._viewMap[e]},delView:function(r){if("string"==typeof r||r instanceof RedView||RedGLUtil.throwFunc("RedWorld :delView 문자열이나 RedView 만 허용함.","입력값 : "+r),"string"==typeof r)(e=this._viewMap[r])&&(t=this._viewList.indexOf(e),this._viewList.splice(t,1),delete this._viewMap[r]);else for(var i in t=this._viewList.indexOf(r),this._viewList.splice(t,1),this._viewMap)this._viewMap[i]==r&&delete this._viewMap[i]},hasView:function(e){if("string"==typeof e||e instanceof RedView||RedGLUtil.throwFunc("RedWorld :hasView 문자열이나 RedView 만 허용함.","입력값 : "+e),"string"==typeof e)return!!this._viewMap[e];var t=this._viewList.indexOf(e);return!!this._viewList[t]},getViewList:function(){return this._viewList.concat()}},Object.freeze(RedWorld)}(),function(){RedScene=function(e,t){if(!(this instanceof RedScene))return new RedScene(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedScene : RedGL Instance만 허용.",e),this.backgroundColor=t||"#000000",this.useBackgroundColor=!0,this.useFog=!1,this.fogDensity=.5,this.fogDistance=25,this.fogColor="#ffffff",this.children=[],this.shadowManager=RedShadowManager(e),this.mouseManager=RedMouseEventManager(e),this._lightInfo={RedAmbientLight:null,RedDirectionalLight:[],RedPointLight:[]},this._UUID=RedGL.makeUUID()};var e,t,r={addLight:function(e){switch(e.TYPE){case RedAmbientLight.TYPE:this._lightInfo[e.TYPE]=e;break;case RedDirectionalLight.TYPE:this._lightInfo[e.TYPE].length===RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT&&RedGLUtil.throwFunc("RedScene : RedDirectionalLight "+RedSystemShaderCode.MAX_DIRECTIONAL_LIGHT+"개 까지 허용."),this._lightInfo[e.TYPE].push(e);break;case RedPointLight.TYPE:this._lightInfo[e.TYPE].length===RedSystemShaderCode.MAX_POINT_LIGHT&&RedGLUtil.throwFunc("RedScene : RedPointLight "+RedSystemShaderCode.MAX_POINT_LIGHT+"개 까지 허용."),this._lightInfo[e.TYPE].push(e);break;default:RedGLUtil.throwFunc("RedScene : RedBaseLight 인스턴스만 가능")}},removeLight:function(t){switch(t.TYPE){case RedAmbientLight.TYPE:this._lightInfo[t.TYPE]===t&&(this._lightInfo[t.TYPE]=null);break;case RedDirectionalLight.TYPE:case RedPointLight.TYPE:(e=this._lightInfo[t.TYPE].indexOf(t))>-1&&this._lightInfo[t.TYPE].splice(e,1);break;default:RedGLUtil.throwFunc("RedScene : RedBaseLight 인스턴스만 가능")}},removeLightAll:function(){this._lightInfo[RedAmbientLight.TYPE]=null,this._lightInfo[RedDirectionalLight.TYPE].length=0,this._lightInfo[RedPointLight.TYPE].length=0}};for(var i in RedScene.prototype=new RedBaseContainer,r)RedScene.prototype[i]=r[i];RedDefinePropertyInfo.definePrototype("RedScene","backgroundColor","hex",{callback:function(){t=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._backgroundColor),this._r=t[0],this._g=t[1],this._b=t[2]}}),RedDefinePropertyInfo.definePrototype("RedScene","useBackgroundColor","boolean"),RedDefinePropertyInfo.definePrototype("RedScene","useFog","boolean"),RedDefinePropertyInfo.definePrototype("RedScene","fogDensity","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedScene","fogDistance","number",{min:0}),RedDefinePropertyInfo.definePrototype("RedScene","fogColor","hex",{callback:function(){var e;return function(){e=RedGLUtil.hexToRGB_ZeroToOne.call(this,this._fogColor),this._fogR=e[0],this._fogG=e[1],this._fogB=e[2]}}()}),Object.defineProperty(RedScene.prototype,"skyBox",{get:function(){return this._skyBoxMesh},set:function(e){return!e||e instanceof RedSkyBox||RedGLUtil.throwFunc("RedScene : RedSkyBox Instance만 허용."),this._skyBoxMesh=e,this._skyBoxMesh}}),Object.defineProperty(RedScene.prototype,"grid",{get:function(){return this._gridMesh},set:function(e){return!e||e instanceof RedGrid||RedGLUtil.throwFunc("RedScene : RedGrid Instance만 허용."),this._gridMesh=e,this._gridMesh}}),Object.defineProperty(RedScene.prototype,"axis",{get:function(){return this._axisMesh},set:function(e){return!e||e instanceof RedAxis||RedGLUtil.throwFunc("RedScene : RedAxis Instance만 허용."),this._axisMesh=e,this._axisMesh}}),Object.freeze(RedScene)}(),function(){var e,t;(RedCamera=function(){if(!(this instanceof RedCamera))return new RedCamera;this.x=this.y=this.z=0,this.targetX=this.targetY=this.targetZ=0,this.fov=60,this.nearClipping=.1,this.farClipping=1e5,this.mode2DYn=!1,this.matrix=mat4.create(),this.perspectiveMTX=mat4.create(),this.autoUpdateMatrix=!0,this._UUID=RedGL.makeUUID()}).prototype.update=function(){this.lookAt(this.targetX,this.targetY,this.targetZ)},RedCamera.prototype.lookAt=(e=new Float32Array([0,1,0]),t=[],function(r,i,n){t[0]=this.targetX=r,t[1]=this.targetY=i,t[2]=this.targetZ=n,mat4.identity(this.matrix),mat4.lookAt(this.matrix,[this.x,this.y,this.z],t,e)}),Object.freeze(RedCamera)}(),(RedBasicController=function(e){if(!(this instanceof RedBasicController))return new RedBasicController(e);this.targetView=null,this.keyBuffer={},this.keyNameMapper={moveForward:"w",moveBack:"s",moveLeft:"a",moveRight:"d",moveUp:"t",moveDown:"g",turnLeft:"q",turnRight:"e",turnUp:"r",turnDown:"f"},this.speed=1,this.delay=.1,this.speedRotation=1,this.delayRotation=.1,this.maxAcceleration=3,this._currentAcceleration=0,this.camera=RedCamera(),this._desirePosition=[0,0,0],this._desirePan=0,this._desireTilt=0,this._targetObject=RedMesh(e),function(t){var r,i,n,a,o,s,d,l,u,c,f,h,R,m,p;"ie"==RedGLDetect.BROWSER_INFO.browser&&11==RedGLDetect.BROWSER_INFO.browserVer?(R="offsetX",m="offsetY"):(R="layerX",m="layerY"),p=function(r){if(r||((r={clientX:e._mouseX,clientY:e._mouseY})[R]=e._mouseX,r[m]=e._mouseY),t.targetView){var i,n;if(RedGLDetect.BROWSER_INFO.isMobile?(i=r.clientX,n=r.clientY):(i=r[R],n=r[m]),!(t.targetView._viewRect[0]<i&&i<t.targetView._viewRect[0]+t.targetView._viewRect[2]))return;if(!(t.targetView._viewRect[1]<n&&n<t.targetView._viewRect[1]+t.targetView._viewRect[3]))return}return!0},c=RedGLDetect.BROWSER_INFO.move,f=RedGLDetect.BROWSER_INFO.up,h=RedGLDetect.BROWSER_INFO.down,s=0,d=0,l=0,u=0,r=function(e){p()&&(t.keyBuffer[e.key]=1)},i=function(e){t.keyBuffer[e.key]=0},n=function(t){RedGLDetect.BROWSER_INFO.isMobile&&(t=t.targetTouches[0]),p(t)&&(RedGLDetect.BROWSER_INFO.isMobile?(s=t.clientX,d=t.clientY):(s=t[R],d=t[m]),e._canvas.addEventListener(c,a),window.addEventListener(f,o))},a=function(e){RedGLDetect.BROWSER_INFO.isMobile?(e=e.targetTouches[0],l=e.clientX-s,u=e.clientY-d,s=e.clientX,d=e.clientY):(l=e[R]-s,u=e[m]-d,s=e[R],d=e[m]),t._desirePan-=l*t._speedRotation*.1,t._desireTilt-=u*t._speedRotation*.1},o=function(){e._canvas.removeEventListener(c,a),window.removeEventListener(f,o)},window.addEventListener("keydown",r),window.addEventListener("keyup",i),e._canvas.addEventListener(h,n)}(this)}).prototype=new RedBaseController,RedDefinePropertyInfo.definePrototypes("RedBasicController",["speed","number",{min:0}],["delay","number",{min:0}],["speedRotation","number",{min:0}],["delayRotation","number",{min:0}],["maxAcceleration","number",{min:0}]),["x","y","z"].forEach(function(e,t){Object.defineProperty(RedBasicController.prototype,e,{get:function(){return this._targetObject[e]},set:function(r){this._targetObject[e]=r,this._desirePosition[t]=r}})}),Object.defineProperty(RedBasicController.prototype,"tilt",{get:function(){return this._desireTilt},set:function(e){this._targetObject.rotationX=e,this._desireTilt=e}}),Object.defineProperty(RedBasicController.prototype,"pan",{get:function(){return this._desirePan},set:function(e){this._targetObject.rotationY=e,this._desirePan=e}}),RedBasicController.prototype.update=function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p;return new Float32Array([0,1,0]),c=mat4.create(),l=mat4.create(),u=mat4.create(),f=vec3.create(),function(){e=0,t=0,i=!1,n=!1,a=this._speed,o=this._speedRotation,s=this._delay,d=this._delayRotation,h=this.camera,p=this._desirePosition,R=this.keyBuffer,m=this.keyNameMapper,f[0]=0,f[1]=0,f[2]=0,R[m.turnLeft]&&(n=!0,e=o),R[m.turnRight]&&(n=!0,e=-o),R[m.turnUp]&&(n=!0,t=o),R[m.turnDown]&&(n=!0,t=-o),R[m.moveForward]&&(i=!0,f[2]=-this._currentAcceleration*a),R[m.moveBack]&&(i=!0,f[2]=this._currentAcceleration*a),R[m.moveLeft]&&(i=!0,f[0]=-this._currentAcceleration*a),R[m.moveRight]&&(i=!0,f[0]=this._currentAcceleration*a),R[m.moveUp]&&(i=!0,f[1]=this._currentAcceleration*a),R[m.moveDown]&&(i=!0,f[1]=-this._currentAcceleration*a),n||i?(this._currentAcceleration+=.1,this._currentAcceleration>this._maxAcceleration&&(this._currentAcceleration=this._maxAcceleration)):(this._currentAcceleration+=-.1,this._currentAcceleration<0&&(this._currentAcceleration=0)),r=this._targetObject,n&&(this._desirePan+=e,this._desireTilt+=t),r.rotationY+=(this._desirePan-r.rotationY)*d,r.rotationX+=(this._desireTilt-r.rotationX)*d,(i||n)&&(l=r.matrix,mat4.identity(c),mat4.rotateY(c,c,r.rotationY*Math.PI/180),mat4.rotateX(c,c,r.rotationX*Math.PI/180),mat4.translate(c,c,f),mat4.identity(l),mat4.translate(l,l,[r.x,r.y,r.z]),mat4.multiply(l,l,c),p[0]=l[12],p[1]=l[13],p[2]=l[14]),r.x+=(p[0]-r.x)*s,r.y+=(p[1]-r.y)*s,r.z+=(p[2]-r.z)*s,r.rotationY+=(this._desirePan-r.rotationY)*d,r.rotationX+=(this._desireTilt-r.rotationX)*d,l=r.matrix,mat4.identity(l),mat4.translate(l,l,[r.x,r.y,r.z]),mat4.rotateY(l,l,r.rotationY*Math.PI/180),mat4.rotateX(l,l,r.rotationX*Math.PI/180),u=mat4.clone(l),mat4.translate(u,u,[0,0,.01]),h.x=u[12],h.y=u[13],h.z=u[14],h.lookAt(r.x,r.y,r.z)}}(),Object.freeze(RedBasicController),function(){var e,t,r,i;(RedObitController=function(e){if(!(this instanceof RedObitController))return new RedObitController(e);this.centerX=0,this.centerY=0,this.centerZ=0,this.distance=15,this.speedDistance=2,this.delayDistance=.1,this.speedRotation=3,this.delayRotation=.1,this.tilt=0,this.minTilt=-90,this.maxTilt=90,this.pan=0,this.camera=RedCamera(),this._currentPan=0,this._currentTilt=0,this._currentDistance=0,this.needUpdate=!0,this.targetView=null,function(t){var r,i,n,a,o,s,d,l,u,c,f,h,R,m;h=function(e){if(t.targetView){var r,i;if(RedGLDetect.BROWSER_INFO.isMobile?(r=e.clientX,i=e.clientY):(r=e[R],i=e[m]),!(t.targetView._viewRect[0]<r&&r<t.targetView._viewRect[0]+t.targetView._viewRect[2]))return;if(!(t.targetView._viewRect[1]<i&&i<t.targetView._viewRect[1]+t.targetView._viewRect[3]))return}return!0},u=RedGLDetect.BROWSER_INFO.move,c=RedGLDetect.BROWSER_INFO.up,f=RedGLDetect.BROWSER_INFO.down,o=0,s=0,d=0,l=0,"ie"==RedGLDetect.BROWSER_INFO.browser&&11==RedGLDetect.BROWSER_INFO.browserVer?(R="offsetX",m="offsetY"):(R="layerX",m="layerY"),r=function(r){if(t.needUpdate){if(RedGLDetect.BROWSER_INFO.isMobile&&(r=r.targetTouches[0]),!h(r))return;RedGLDetect.BROWSER_INFO.isMobile?(o=r.clientX,s=r.clientY):(o=r[R],s=r[m]),e._canvas.addEventListener(u,i),window.addEventListener(c,n)}},i=function(e){t.needUpdate&&(RedGLDetect.BROWSER_INFO.isMobile?(e=e.targetTouches[0],d=e.clientX-o,l=e.clientY-s,o=e.clientX,s=e.clientY):(d=e[R]-o,l=e[m]-s,o=e[R],s=e[m]),t._pan-=d*t._speedRotation*.1,t._tilt-=l*t._speedRotation*.1)},n=function(){e._canvas.removeEventListener(u,i),window.removeEventListener(c,n)},a=function(e){if(t.needUpdate){if(!h(e))return;t.distance+=e.deltaY/100*t._speedDistance}},e._canvas.addEventListener(f,r),e._canvas.addEventListener("wheel",a)}(this)}).prototype=new RedBaseController,RedDefinePropertyInfo.definePrototypes("RedObitController",["centerX","number"],["centerY","number"],["centerZ","number"],["distance","number",{min:1}],["speedDistance","number",{min:0}],["delayDistance","number",{min:0}],["speedRotation","number",{min:0}],["delayRotation","number",{min:0}],["pan","number"],["tilt","number"],["maxTilt","number",{min:-90,max:90}],["minTilt","number",{min:-90,max:90}]),RedObitController.prototype.update=(i=Math.PI/180,function(){this.needUpdate&&(this._tilt<this._minTilt&&(this._tilt=this._minTilt),this._tilt>this._maxTilt&&(this._tilt=this._maxTilt),e=this._delayRotation,t=this.camera,r=t.matrix,this._currentPan+=(this._pan-this._currentPan)*e,this._currentTilt+=(this._tilt-this._currentTilt)*e,this._currentDistance+=(this._distance-this._currentDistance)*this._delayDistance,mat4.identity(r),mat4.translate(r,r,[this._centerX,this._centerY,this._centerZ]),mat4.rotateY(r,r,this._currentPan*i),mat4.rotateX(r,r,this._currentTilt*i),mat4.translate(r,r,[0,0,this._currentDistance]),t.x=r[12],t.y=r[13],t.z=r[14],t.lookAt(this._centerX,this._centerY,this._centerZ))}),Object.freeze(RedObitController)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vVertexColor = aVertexColor;
gl_Position = uPMatrix * uCameraMatrix* uMMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
void main(void) {
vec4 finalColor = vVertexColor;
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
}
*/},(RedGridMaterial=function(i){if(!(this instanceof RedGridMaterial))return new RedGridMaterial(i);this.makeProgramList(this,i,"RedGridMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedGridMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
varying vec3 vReflectionCubeCoord;
void main(void) {
vReflectionCubeCoord = (uMMatrix *vec4(aVertexPosition, 0.0)).xyz;
gl_Position = uPMatrix * uCameraMatrix * uMMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
//#REDGL_DEFINE#fragmentShareFunc#fogFactor#
//#REDGL_DEFINE#fragmentShareFunc#fog#
uniform samplerCube u_skyBoxTexture;
varying vec3 vReflectionCubeCoord;
uniform float u_alpha;
uniform bool u_mirrorMode;
void main(void) {
vec4 finalColor ;
if(u_mirrorMode) finalColor = textureCube(u_skyBoxTexture, vec3(1.0-vReflectionCubeCoord.x,vReflectionCubeCoord.y,1.0-vReflectionCubeCoord.z));
else finalColor = textureCube(u_skyBoxTexture, vReflectionCubeCoord);
//#REDGL_DEFINE#fog#false# gl_FragColor = finalColor;
//#REDGL_DEFINE#fog#true# gl_FragColor = fog( fogFactor(u_FogDistance, u_FogDensity), uFogColor, finalColor);
gl_FragColor.a = u_alpha;
}
*/},(RedSkyBoxMaterial=function(i,n,a){if(!(this instanceof RedSkyBoxMaterial))return new RedSkyBoxMaterial(i,n,a);i instanceof RedGL||RedGLUtil.throwFunc("RedSkyBoxMaterial : RedGL Instance만 허용.",i),this.makeProgramList(this,i,"RedSkyBoxMaterialProgram",e,t),this.skyBoxTexture=n,this._UUID=RedGL.makeUUID(),this.alpha=null==a?1:a,this.mirrorMode=!1,r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedSkyBoxMaterial","skyBoxTexture","samplerCube",{essential:!0}),RedDefinePropertyInfo.definePrototype("RedSkyBoxMaterial","alpha","number",{min:0,max:1}),RedDefinePropertyInfo.definePrototype("RedSkyBoxMaterial","mirrorMode","boolean"),Object.freeze(RedSkyBoxMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = getSprite3DMatrix(uDirectionalShadowLightMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uDirectionalShadowLightMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
vec4 encodeFloat (float depth) {
const vec4 cBitShift = vec4(
256.0 * 256.0 * 256.0,
256.0 * 256.0,
256.0,
1.0
);
const vec4 cBitMask = vec4(
0.0,
1.0 / 256.0,
1.0 / 256.0,
1.0 / 256.0
);
vec4 comp = fract(depth * cBitShift);
comp -= comp.xxyz * cBitMask;
return comp;
}
void main(void) {
vec4 finalColor = encodeFloat(gl_FragCoord.z);
// if(finalColor.a < 0.5) finalColor = vec4(0.0, 0.0, 0.0, 1.0);
gl_FragColor = finalColor;
}
*/},(RedDirectionalShadowMaterial=function(i){if(!(this instanceof RedDirectionalShadowMaterial))return new RedDirectionalShadowMaterial(i);i instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalShadowMaterial : RedGL Instance만 허용.",i),this._RedDirectionalShadowYn=!0,this.makeProgramList(this,i,"RedDirectionalShadowMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedDirectionalShadowMaterial)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
gl_FragColor = texture2D(u_diffuseTexture, vTexcoord);
}
*/},(RedPostEffectMaterial=function(i,n){if(!(this instanceof RedPostEffectMaterial))return new RedPostEffectMaterial(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffectMaterial : RedGL Instance만 허용.",i),this.diffuseTexture=n,this.program=RedProgram.makeProgram(i,"RedPostEffectMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedPostEffectMaterial","diffuseTexture","sampler2D",{essential:!0}),Object.freeze(RedPostEffectMaterial)}(),function(){var e;(RedDirectionalShadow=function(e,t){if(!(this instanceof RedDirectionalShadow))return new RedDirectionalShadow(e,t);e instanceof RedGL||RedGLUtil.throwFunc("RedDirectionalShadow : RedGL Instance만 허용.",e),this._directionalShadowMaterial=RedDirectionalShadowMaterial(e),this.frameBuffer=RedFrameBuffer(e),this.light=t,this.width=2048,this.height=2048,this.size=20,this._UUID=RedGL.makeUUID(),this._castingList=[]}).prototype.addCasting=function(e){e instanceof RedBaseObject3D||RedGLUtil.throwFunc("addCasting","RedBaseObject3D Instance만 가능","입력값 : "+e),this._castingList.push(e)},RedDirectionalShadow.prototype.removeCasting=function(t){-1==(e=this._castingList.indexOf(t))?RedGLUtil.throwFunc("removeCasting","존재하지 않는 대상을 삭제하려고 함"):this._castingList.splice(e,1)},Object.defineProperty(RedDirectionalShadow.prototype,"light",{get:function(){return this._light},set:function(e){e&&e instanceof RedDirectionalLight||RedGLUtil.throwFunc("RedDirectionalShadow - light : RedDirectionalLight Instance만 허용.",e),this._light=e}}),RedDefinePropertyInfo.definePrototypes("RedDirectionalShadow",["width","number",{min:1}],["height","number",{min:1}],["size","number",{min:1}]),Object.freeze(RedDirectionalShadow)}(),function(){var e,t,r,i,n,a;(RedShadowManager=function(e){if(!(this instanceof RedShadowManager))return new RedShadowManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedShadowManager : RedGL Instance만 허용.",e),this._UUID=RedGL.makeUUID()}).prototype={render:function(o,s,d,l,u){(i=this._directionalShadow)&&(e=o.gl,r=s.worldRect,t=d._viewRect,n=i.width,a=i.height,i.frameBuffer.width=n,i.frameBuffer.height=a,i.frameBuffer.bind(o.gl),e.viewport(0,0,n,a),e.scissor(0,0,n,a),e.clearColor(0,0,0,1),e.clearDepth(1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),s.sceneRender(o,d.scene,d.camera,d.camera.mode2DYn,i._castingList,l,u,i._directionalShadowMaterial),i.frameBuffer.unbind(o.gl),e.viewport(t[0],r[3]-t[3]-t[1],t[2],t[3]),e.scissor(t[0],r[3]-t[3]-t[1],t[2],t[3]))}},Object.defineProperty(RedShadowManager.prototype,"directionalShadow",{get:function(){return this._directionalShadow},set:function(e){!e||e instanceof RedDirectionalShadow||RedGLUtil.throwFunc("RedShadowManager - directionalShadow : RedDirectionalShadow Instance만 허용.",e),this._directionalShadow=e}}),Object.freeze(RedShadowManager)}(),function(){var e,t,r,i;t=function(t,r,i){var n;n=t._svg.querySelector("td").style,t["_"+r]=i,Object.defineProperty(t,r,{get:function(){return t["_"+r]},set:function(i){t["_"+r]=i,n[r]="number"==typeof i?i+="px":i,e(t)}}),t[r]=i},e=function(e){e._height=+e._height,e._svg.setAttribute("width",e._width),e._svg.setAttribute("height",e._height),e._svg.querySelector("foreignObject").setAttribute("height",e._height),e._svg.querySelector("table").style.height=e._height+"px",e._img.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(e._svg.outerHTML)},(RedText=function(e,r,i){if(!(this instanceof RedText))return new RedText(e,r,i);e instanceof RedGL||RedGLUtil.throwFunc("RedText : RedGL Instance만 허용.",e),RedBaseObject3D.build.call(this,e.gl);var n=this;this._cvs=null,this._ctx=null,this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this._svg.style="position:absolute;top:0px;left:0px;text-align:center;z-index:10",this._svg.innerHTML='<foreignObject  width="100%" style="position:absolute;top:0;left:0">   <table xmlns="http://www.w3.org/1999/xhtml" style="border-collapse: collapse;position:table;top:0;left:0;width:100%;table-layout:fixed">       <tr xmlns="http://www.w3.org/1999/xhtml">       <td xmlns="http://www.w3.org/1999/xhtml"  > </td>       </tr>   </table></foreignObject>',this.geometry=RedPlane(e,1,1),this.material=RedTextMaterial(e,RedBitmapTexture(e,this._cvs)),this.blendSrc=e.gl.ONE,this.blendDst=e.gl.ONE_MINUS_SRC_ALPHA,this.useCullFace=!1,this.perspectiveScale=!0,this.sprite3DYn=!1,this._img=new Image,i=i||256,(r=r||256)>e.detect.texture.MAX_TEXTURE_SIZE&&(r=e.detect.texture.MAX_TEXTURE_SIZE),i>e.detect.texture.MAX_TEXTURE_SIZE&&(i=e.detect.texture.MAX_TEXTURE_SIZE),this.width=r,this.height=i,t(this,"padding",0),t(this,"background",""),t(this,"color","#000"),t(this,"fontFamily","Arial"),t(this,"fontSize",16),t(this,"fontWeight","normal"),t(this,"fontStyle","normal"),t(this,"lineHeight",24),t(this,"letterSpacing",0),t(this,"wordBreak","break-all"),t(this,"verticalAlign","middle"),t(this,"textAlign","center"),this._img.onload=function(){var t,r;(t=n._width)%2==0&&(t+=1),(r=n._height)%2==0&&(r+=1),n._cvs=window.OffscreenCanvas?new OffscreenCanvas(t,r):document.createElement("canvas"),n._ctx=n._cvs.getContext("2d"),n._cvs.width=t,n._cvs.height=r,n._ctx.clearRect(0,0,t,r),n._ctx.drawImage(n._img,0,0,t,r),n.material.width=t,n.material.height=r,n.material.diffuseTexture.src=n._cvs,n.material.diffuseTexture.option={min:e.gl.LINEAR,mag:e.gl.LINEAR,wrap_s:e.gl.CLAMP_TO_EDGE,wrap_t:e.gl.CLAMP_TO_EDGE}},this.useTransparentSort=!0,this._UUID=RedGL.makeUUID()}).prototype=new RedBaseObject3D,RedDefinePropertyInfo.definePrototypes("RedText",["perspectiveScale","boolean"],["sprite3DYn","boolean"],["width","uint",{min:2,callback:function(t){this._width=t,this.material.width=t,e(this)}}],["height","uint",{min:2,callback:function(t){this._height=t,this.material.height=t,e(this)}}]),Object.defineProperty(RedText.prototype,"text",{get:function(){return this._text},set:function(t){r=this._svg,i=r.querySelector("foreignObject td"),this._text=t.replace(/\<br\>/gi,"<div/>");var n=this,a=this._text.match(/<img .*?>/g),o=[],s=this._text,d=(a=a||[]).length,l=0;a.forEach(function(t){var r=t.match(/src\s*=\s*(\'|\").*?(\'|\")/g)[0];r=r.replace(/src\s*=\s*(\'|\")/g,"").replace(/(\'|\")/g,"");var a=document.createElement("div");a.innerHTML=t;var u=a.querySelector("img");u.onload=function(){var t=document.createElement("canvas");t.width=u.style.width?+u.style.width:u.width,t.height=u.style.height?+u.style.height:u.height;var r=t.getContext("2d");r.scale(t.width/u.naturalWidth,t.height/u.naturalHeight),r.drawImage(u,0,0),c.result='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink" width="'+u.width+'" height="'+u.height+'" display="inline" style="vertical-align: middle;display: inline-block"><image xlink:href="'+t.toDataURL("image/png")+'" height="'+u.height+'px" width="'+u.width+'px" /></svg>',++l==d&&(o.forEach(function(e){s=s.replace(e.source,e.result)}),i.innerHTML=s,e(n)),u.onload=null};var c={source:t,sourceSrc:r,result:""};o.push(c)}),0==a.length&&(i.innerHTML=s,e(this))}}),Object.freeze(RedText)}(),function(){var e,t,r,i,n,a,o,s,d;(RedMouseEventManager=function(e){if(!(this instanceof RedMouseEventManager))return new RedMouseEventManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedMouseEventManager : RedGL Instance만 허용.",e),this.frameBuffer=RedFrameBuffer(e),this._mouseEventMaterial=RedMouseEventMaterial(e),this._mouseEventListObject={},this._mouseEventList=[],this._prevInfo={},this._UUID=RedGL.makeUUID()}).prototype={add:function(e,t,r){var i=e._mouseColorID;this._mouseEventListObject[i]||(this._mouseEventListObject[i]={target:e},this._mouseEventList.push(e)),this._mouseEventListObject[i][t]=r},remove:function(e,t){var r=e._mouseColorID;if(this._mouseEventListObject[r]){var i=0;for(var n in this._mouseEventListObject[r][t]&&delete this._mouseEventListObject[r][t],this._mouseEventListObject[r])i++;if(1===i){var a=this._mouseEventList.indexOf(e);a>-1&&(this._mouseEventList.splice(a,1),delete this._mouseEventListObject[r])}}},render:(n=new Uint8Array(4),a=1,o=[],s="default",d=function(){if(o.length){var e=o.shift();e.info[e.type].call(e.info.target,{target:e.info.target,type:"out"})}},function(l,u,c,f,h,R){if(this._mouseEventList.length){a=l.renderScale*window.devicePixelRatio,e=l.gl,t=u.worldRect,c._viewRect,r=t[2],i=t[3],this.frameBuffer.width=r,this.frameBuffer.height=i,this.frameBuffer.bind(l.gl),u.sceneRender(l,c.scene,c.camera,c.camera.mode2DYn,this._mouseEventList,f,h,this._mouseEventMaterial);var m,p,_,g=l._mouseEventInfo;for(m=0,p=g.length;m<p;m++){_=g[m],e.readPixels(_.x*a,i-_.y*a,1,1,e.RGBA,e.UNSIGNED_BYTE,n);var v,E=this._mouseEventListObject[n[0]+","+n[1]+","+n[2]+","+n[3]];E?(E.target._UUID,_.type==RedGLDetect.BROWSER_INFO.down&&(v="down")&&E[v]&&E[v].call(E.target,{target:E.target,type:v,nativeEvent:_.nativeEvent}),_.type==RedGLDetect.BROWSER_INFO.up&&(v="up")&&E[v]&&E[v].call(E.target,{target:E.target,type:v,nativeEvent:_.nativeEvent}),this._prevInfo[c._UUID]&&this._prevInfo[c._UUID]!=E&&(v="out")&&this._prevInfo[c._UUID][v]&&this._prevInfo[c._UUID][v].call(this._prevInfo[c._UUID].target,{target:this._prevInfo[c._UUID].target,type:v}),this._prevInfo[c._UUID]!=E&&(v="over")&&E[v]&&E[v].call(E.target,{target:E.target,type:v,nativeEvent:_.nativeEvent}),this._prevInfo[c._UUID]=E):(v="out",this._prevInfo[c._UUID]&&this._prevInfo[c._UUID][v]&&o.push({info:this._prevInfo[c._UUID],type:v,nativeEvent:_.nativeEvent}),this._prevInfo[c._UUID]=null),d()}this._prevInfo[c._UUID]&&(s="pointer"),R&&(l._mouseEventInfo.length=0,document.body.style.cursor=s,s="default"),this.frameBuffer.unbind(l.gl)}})},Object.freeze(RedMouseEventManager)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2((uPMatrix * targetMatrix)[0][0],(uPMatrix * targetMatrix)[1][1]);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix *  vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform vec4 uColor;
void main(void) {
gl_FragColor = uColor / 255.0;
}
*/},(RedMouseEventMaterial=function(i){if(!(this instanceof RedMouseEventMaterial))return new RedMouseEventMaterial(i);i instanceof RedGL||RedGLUtil.throwFunc("RedMouseEventMaterial : RedGL Instance만 허용.",i),this._RedMouseEventMaterialYn=!0,this.color=null,this.makeProgramList(this,i,"RedMouseEventMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,Object.freeze(RedMouseEventMaterial)}(),function(){var e,t,r,i,n,a,o,s,d,l,u,c,f,h,R,m,p,_,g,v,E,M,b,L,T,P,x,y;(RedPostEffectManager=function(e){if(!(this instanceof RedPostEffectManager))return new RedPostEffectManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedPostEffectManager : RedGL Instance만 허용.",e),Object.defineProperty(this,"frameBuffer",{value:RedFrameBuffer(e)}),Object.defineProperty(this,"finalMaterial",{value:RedPostEffectMaterial(e,this.frameBuffer.texture)}),Object.defineProperty(this,"postEffectList",{value:[]}),Object.defineProperty(this,"children",{value:[RedMesh(e,RedPlane(e,1,1,1,1,!0),this.finalMaterial)]}),this._UUID=RedGL.makeUUID()}).prototype={addEffect:function(e){e instanceof RedBasePostEffect||RedGLUtil.throwFunc("RedPostEffectManager : addEffect - RedBasePostEffect Instance만 허용.","입력값 : "+e),this.postEffectList.push(e)},removeEffect:function(e){-1!=(y=this.postEffectList.indexOf(e))&&this.postEffectList.splice(y,1)},removeAllEffect:function(){this.postEffectList.length=0},bind:function(e){this.frameBuffer.bind(e)},unbind:function(e){this.frameBuffer.unbind(e)},render:(p=mat4.create(),m=new Float32Array(2),d=function(t,r,i,n,a){e._material=i,u=e._material.program,t.useProgram(u.webglProgram),f=u.systemUniformLocation,(c=f.uPMatrix)&&(h=c.location,R=c._UUID,h&&(mat4.ortho(p,-.5,.5,-.5,.5,-r.farClipping,r.farClipping),mat4.scale(p,p,[1,1,1]),_=JSON.stringify(p),l[R]!=_&&(t.uniformMatrix4fv(h,!1,p),l[R]=_))),(c=f.uResolution)&&(h=c.location,R=c._UUID,h&&(m[0]=n,m[1]=a,_=JSON.stringify(m),l[R]!=_&&(t.uniform2fv(h,m),l[R]=_)))},i=function(e,t,r,i){g=r.frameBuffer.width=i[2],v=r.frameBuffer.height=i[3],n==g&&a==v||(e.viewport(0,0,g,v),e.scissor(0,0,g,v)),d(e,t,r,g,v),n=g,a=v},s=function(e,t,d,l,u,c,f){var h,R,m,p,_,g,v,E,M,b;if(m=e.gl,M=l.scene,b=l._viewRect,t._process&&t._process.length)for(h=r,p=0,_=t._process.length;p<_;p++)s(e,t._process[p],d,l,u,c,f);if((R=t._subFrameBufferList)&&R.length)for(g=0,v=R.length;g<v;g++)if((E=R[g]).frameBuffer.width=b[2],E.frameBuffer.height=b[3],E.frameBuffer.bind(m),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),u.sceneRender(e,M,o,o.mode2DYn,M.children,c,f,E.renderMaterial,!0,!1),E.frameBuffer.unbind(m),n=E.frameBuffer.width,a=E.frameBuffer.height,E._process&&E._process.length)for(p=0,_=E._process.length;p<_;p++)s(e,E._process[p],d,M,u,c,f);t.frameBuffer&&(i(m,o,t,b),t.bind(m),t.updateTexture(r,h),u.sceneRender(e,M,o,!0,d,c,f,null,!0,!1),t.unbind(m),r=t.frameBuffer.texture)},M=[],function(i,u,c,f,h,R){for(E=this,n=null,a=null,T=f.scene,o=f.camera instanceof RedBaseController?f.camera.camera:f.camera,P=f._viewRect,x=c.worldRect,l=c.cacheInfo.cacheSystemUniformInfo,E.unbind(u),e=E.children[0],r=t=E.frameBuffer.texture,E.frameBuffer.width=P[2],E.frameBuffer.height=P[3],M.length=0,b=0,L=E.postEffectList.length;b<L;b++)M[b]=E.postEffectList[b];for(E.antialiasing&&M.push(E.antialiasing),b=0,L=M.length;b<L;b++)s(i,M[b],E.children,f,c,h,R);r!=t&&(E.finalMaterial.diffuseTexture=r,u.viewport(P[0],x[3]-P[3]-P[1],P[2],P[3]),u.scissor(P[0],x[3]-P[3]-P[1],P[2],P[3]),d(u,o,E.finalMaterial,P[2],P[3],!0),c.sceneRender(i,T,o,!0,E.children,h,R,null,!0)),E.finalMaterial.diffuseTexture=E.frameBuffer.texture})},Object.defineProperty(RedPostEffectManager.prototype,"antialiasing",{get:function(){return this._antialiasing},set:function(e){e&&(e instanceof RedPostEffect_FXAA||RedGLUtil.throwFunc("RedPostEffectManager : antialiasing - RedPostEffect_FXAA Instance만 허용.","입력값 : "+e)),this._antialiasing=e}}),Object.freeze(RedPostEffectManager)}(),function(){var e;(e=(RedBasePostEffect=function(){}).prototype=new RedBaseMaterial).bind=RedPostEffectManager.prototype.bind,e.unbind=RedPostEffectManager.prototype.unbind,e.updateTexture=function(){RedGLUtil.throwFunc("RedBasePostEffect - updateTexture : 반드시 재정의해야함")},e._process=[],e._subFrameBufferList=[],RedBasePostEffect.baseVertexShaderSource1=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
vTime = uTime;
gl_Position = uPMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},Object.freeze(RedBasePostEffect)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform sampler2D u_blurTexture;
uniform float u_exposure;
uniform float u_bloomStrength;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
vec4 thresholdColor = finalColor;
vec4 blurColor = texture2D(u_blurTexture, vTexcoord);
finalColor.rgb = (finalColor.rgb  + blurColor.rgb * u_bloomStrength) * u_exposure;
gl_FragColor = finalColor ;
}
*/},(RedPostEffect_Bloom=function(i){if(!(this instanceof RedPostEffect_Bloom))return new RedPostEffect_Bloom(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Bloom : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.blurTexture=null,this.exposure=1,this.bloomStrength=1.2,this._process=[RedPostEffect_BloomThreshold(i),RedPostEffect_BlurX(i),RedPostEffect_BlurY(i)],this.blur=20,this.threshold=75,this.program=RedProgram.makeProgram(i,"RedPostEffectBloomProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Bloom.prototype.updateTexture=function(e,t){this.diffuseTexture=t,this.blurTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Bloom",["diffuseTexture","sampler2D"],["blurTexture","sampler2D"],["exposure","number",{min:0}],["bloomStrength","number",{min:0}],["threshold","number",{min:0,callback:function(e){this._process[0].threshold=e,this._threshold=this._process[0].threshold}}],["blur","number",{min:0,callback:function(e){this._process[1].size=e,this._process[2].size=e}}]),Object.freeze(RedPostEffect_Bloom)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision highp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b < u_threshold_value)  finalColor.r = finalColor.g = finalColor.b = 0.0;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_BloomThreshold=function(i){if(!(this instanceof RedPostEffect_BloomThreshold))return new RedPostEffect_BloomThreshold(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BloomThreshold : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.threshold=128,this.program=RedProgram.makeProgram(i,"RedPostEffectBloomThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BloomThreshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BloomThreshold",["diffuseTexture","sampler2D"],["threshold","number",{min:0,max:255,callback:function(e){this._threshold_value=e/255}}]),Object.freeze(RedPostEffect_BloomThreshold)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec2 px = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec4 finalColor = vec4(0.0);
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-7.0*px.x, -7.0*px.y))*0.0044299121055113265;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-6.0*px.x, -6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-5.0*px.x, -5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-4.0*px.x, -4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-3.0*px.x, -3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-2.0*px.x, -2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2(-1.0*px.x, -1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, vTexcoord                             )*0.159576912161;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 1.0*px.x,  1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 2.0*px.x,  2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 3.0*px.x,  3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 4.0*px.x,  4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 5.0*px.x,  5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 6.0*px.x,  6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, vTexcoord + vec2( 7.0*px.x,  7.0*px.y))*0.0044299121055113265;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Blur=function(i){if(!(this instanceof RedPostEffect_Blur))return new RedPostEffect_Blur(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Blur : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectBlurProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Blur.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Blur","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Blur)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(u_size/vResolution.x,0.0);
for (float t = -10.0; t <= 10.0; t++) {
float percent = (t + offset - 0.5) / 10.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =  finalColor ;
}
*/},(RedPostEffect_BlurX=function(i){if(!(this instanceof RedPostEffect_BlurX))return new RedPostEffect_BlurX(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BlurX : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.size=50,this.program=RedProgram.makeProgram(i,"RedPostEffectBlurXProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BlurX.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BlurX",["diffuseTexture","sampler2D"],["size","number",{min:0}]),Object.freeze(RedPostEffect_BlurX)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(0.0, u_size/vResolution.y);
for (float t = -10.0; t <= 10.0; t++) {
float percent = (t + offset - 0.5) / 10.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =   finalColor ;
}
*/},(RedPostEffect_BlurY=function(i){if(!(this instanceof RedPostEffect_BlurY))return new RedPostEffect_BlurY(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BlurY : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.size=50,this.program=RedProgram.makeProgram(i,"RedPostEffectBlurYProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BlurY.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BlurY",["diffuseTexture","sampler2D"],["size","number",{min:0}]),Object.freeze(RedPostEffect_BlurY)}(),(RedPostEffect_GaussianBlur=function(e){if(!(this instanceof RedPostEffect_GaussianBlur))return new RedPostEffect_GaussianBlur(e);e instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_GaussianBlur : RedGL Instance만 허용.",e),this._UUID=RedGL.makeUUID(),this._process=[RedPostEffect_BlurX(e),RedPostEffect_BlurY(e)],this.radius=1}).prototype=new RedBasePostEffect,RedPostEffect_GaussianBlur.prototype.updateTexture=function(){},RedDefinePropertyInfo.definePrototype("RedPostEffect_GaussianBlur","radius","number",{min:.1,max:255,callback:function(e){this._process[0].size=e,this._process[1].size=e}}),Object.freeze(RedPostEffect_GaussianBlur),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_centerX;
uniform float u_centerY;
uniform float u_amount_value;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main(void) {
vec4 finalColor = vec4(0.0);
vec2 center = vec2(u_centerX+0.5,-u_centerY+0.5);
vec2 toCenter = center - vTexcoord ;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
float total = 0.0;
for (float t = 0.0; t <= 30.0; t++) {
float percent = (t + offset) / 30.0;
float weight = 3.0 * (percent - percent * percent);
vec4 sample = texture2D(u_diffuseTexture, vTexcoord + toCenter * percent * u_amount_value );
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
gl_FragColor = finalColor / total;
gl_FragColor.rgb /= gl_FragColor.a + 0.00001;
}
*/},(RedPostEffect_ZoomBlur=function(i){if(!(this instanceof RedPostEffect_ZoomBlur))return new RedPostEffect_ZoomBlur(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_ZoomBlur : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.centerX=0,this.centerY=0,this.amount=38,this.program=RedProgram.makeProgram(i,"RedPostEffectZoomBlurProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_ZoomBlur.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_ZoomBlur",["diffuseTexture","sampler2D"],["centerX","number"],["centerY","number"],["amount","number",{min:1,max:100,callback:function(e){this._amount_value=e/100}}]),Object.freeze(RedPostEffect_ZoomBlur)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_brightness_value;
uniform float u_contrast_value;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
if (u_contrast_value > 0.0) finalColor.rgb = (finalColor.rgb - 0.5) / (1.0 - u_contrast_value) + 0.5;
else finalColor.rgb = (finalColor.rgb - 0.5) * (1.0 + u_contrast_value) + 0.5;
finalColor.rgb += u_brightness_value;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_BrightnessContrast=function(i){if(!(this instanceof RedPostEffect_BrightnessContrast))return new RedPostEffect_BrightnessContrast(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_BrightnessContrast : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.brightness=0,this.contrast=0,this.program=RedProgram.makeProgram(i,"RedPostEffectBrightnessContrastProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_BrightnessContrast.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_BrightnessContrast",["diffuseTexture","sampler2D"],["brightness","number",{min:-150,max:150,callback:function(e){this._brightness_value=e/255}}],["contrast","number",{min:-50,max:100,callback:function(e){this._contrast_value=e/255}}]),Object.freeze(RedPostEffect_BrightnessContrast)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision highp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
float v;
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b >= u_threshold_value) v = 1.0;
else v = 0.0;
finalColor.r = finalColor.g = finalColor.b = v;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Threshold=function(i){if(!(this instanceof RedPostEffect_Threshold))return new RedPostEffect_Threshold(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Threshold : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.threshold=128,this.program=RedProgram.makeProgram(i,"RedPostEffectThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Threshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Threshold",["diffuseTexture","sampler2D"],["threshold","number",{min:1,max:255,callback:function(e){this._threshold_value=e/255}}]),Object.freeze(RedPostEffect_Threshold)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
finalColor.r = 1.0 - finalColor.r;
finalColor.g = 1.0 - finalColor.g;
finalColor.b = 1.0 - finalColor.b;
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Invert=function(i){if(!(this instanceof RedPostEffect_Invert))return new RedPostEffect_Invert(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Invert : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectInvertProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Invert.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Invert","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Invert)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
highp float gray = (finalColor.r  + finalColor.g + finalColor.b)/3.0;
gl_FragColor = vec4( gray, gray, gray, 1.0);
}
*/},(RedPostEffect_Gray=function(i){if(!(this instanceof RedPostEffect_Gray))return new RedPostEffect_Gray(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Gray : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectGrayProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Gray.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Gray","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_Gray)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_hue_value;
uniform float u_saturation_value;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
float angle = u_hue_value * 3.1415926535897932384626433832795;
float s = sin(angle), c = cos(angle);
vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
float len = length(finalColor.rgb);
finalColor.rgb = vec3(
dot(finalColor.rgb, weights.xyz),
dot(finalColor.rgb, weights.zxy),
dot(finalColor.rgb, weights.yzx)
);
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
if (u_saturation_value > 0.0) finalColor.rgb += (average - finalColor.rgb) * (1.0 - 1.0 / (1.001 - u_saturation_value));
else finalColor.rgb += (average - finalColor.rgb) * (-u_saturation_value);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_HueSaturation=function(i){if(!(this instanceof RedPostEffect_HueSaturation))return new RedPostEffect_HueSaturation(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_HueSaturation : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.hue=0,this.saturation=0,this.program=RedProgram.makeProgram(i,"RedPostEffectHueSaturationProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_HueSaturation.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_HueSaturation",["diffuseTexture","sampler2D"],["hue","number",{min:-180,max:180,callback:function(e){this._hue_value=e/180}}],["saturation","number",{min:-100,max:100,callback:function(e){this._saturation_value=e/100}}]),Object.freeze(RedPostEffect_HueSaturation)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_centerX;
uniform float u_centerY;
uniform float u_angle;
uniform float u_radius;
uniform bool u_grayMode;
float pattern(float angle) {
angle = angle * 3.141592653589793/180.0;
float s = sin(angle), c = cos(angle);
vec2 tex = vTexcoord;
tex.x -= u_centerX + 0.5;
tex.y -= u_centerY + 0.5;
vec2 point = vec2(
c * tex.x - s * tex.y,
s * tex.x + c * tex.y
) * vResolution / u_radius;
return (sin(point.x) * sin(point.y)) * 4.0;
}
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
if(u_grayMode) {
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern(u_angle)), finalColor.a);
}else{
vec3 cmy = 1.0 - finalColor.rgb;
float k = min(cmy.x, min(cmy.y, cmy.z));
cmy = (cmy - k) / (1.0 - k);
cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(u_angle + 0.26179), pattern(u_angle + 1.30899), pattern(u_angle)), 0.0, 1.0);
k = clamp(k * 10.0 - 5.0 + pattern(u_angle + 0.78539), 0.0, 1.0);
gl_FragColor = vec4(1.0 - cmy - k, finalColor.a);
}
}
*/},(RedPostEffect_HalfTone=function(i){if(!(this instanceof RedPostEffect_HalfTone))return new RedPostEffect_HalfTone(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_HalfTone : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.centerX=0,this.centerY=0,this.angle=0,this.radius=2,this.grayMode=!1,this.program=RedProgram.makeProgram(i,"RedPostEffectHalfToneProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_HalfTone.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_HalfTone",["diffuseTexture","sampler2D"],["centerX","number"],["centerY","number"],["angle","number"],["grayMode","boolean"],["radius","number",{min:0}]),Object.freeze(RedPostEffect_HalfTone)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_width;
uniform float u_height;
void main(void) {
vec4 finalColor;
float dx = 1.0/vResolution.x * u_width;
float dy = 1.0/vResolution.y * u_height;
vec2 coord = vec2(
dx * (floor(vTexcoord.x / dx) + 0.5),
dy * (floor(vTexcoord.y / dy) + 0.5)
);
finalColor = texture2D(u_diffuseTexture, coord);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Pixelize=function(i){if(!(this instanceof RedPostEffect_Pixelize))return new RedPostEffect_Pixelize(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Pixelize : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.width=5,this.height=5,this.program=RedProgram.makeProgram(i,"RedPostEffectPixelizeProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Pixelize.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Pixelize",["diffuseTexture","sampler2D"],["width","number",{min:0}],["height","number",{min:0}]),Object.freeze(RedPostEffect_Pixelize)}(),function(){var e,t,r,i,n;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform mat3 u_kernel;
uniform float uKernelWeight;
void main(void) {
vec2 perPX = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec4 finalColor = vec4(0.0);
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0, -1.0)) * u_kernel[0][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0, -1.0)) * u_kernel[0][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0, -1.0)) * u_kernel[0][2] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0,  0.0)) * u_kernel[1][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0,  0.0)) * u_kernel[1][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0,  0.0)) * u_kernel[1][2] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2(-1.0,  1.0)) * u_kernel[2][0] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 0.0,  1.0)) * u_kernel[2][1] ;
finalColor += texture2D(u_diffuseTexture, vTexcoord + perPX * vec2( 1.0,  1.0)) * u_kernel[2][2] ;
highp float weight;
weight = uKernelWeight;
if (0.01 > weight) {
weight = 1.0;
}
gl_FragColor = vec4((finalColor / uKernelWeight).rgb, 1.0);
}
*/},(RedPostEffect_Convolution=function(i,n){if(!(this instanceof RedPostEffect_Convolution))return new RedPostEffect_Convolution(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Convolution : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.kernel=n,this.program=RedProgram.makeProgram(i,"RedPostEffectConvolutionProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Convolution.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_Convolution","diffuseTexture","sampler2D"),Object.defineProperty(RedPostEffect_Convolution.prototype,"kernel",{get:function(){return this._kernel||(this._kernel=RedPostEffect_Convolution.NORMAL),this._kernel},set:function(e){this._kernel=e}}),Object.defineProperty(RedPostEffect_Convolution.prototype,"kernelWeight",{get:function(){for(n in i=0,this.kernel)i+=this.kernel[n];return i}}),RedPostEffect_Convolution.NORMAL=[0,0,0,0,1,0,0,0,0],RedPostEffect_Convolution.SHARPEN=[0,-1,0,-1,5,-1,0,-1,0],RedPostEffect_Convolution.BLUR=[1,1,1,1,1,1,1,1,1],RedPostEffect_Convolution.EDGE=[0,1,0,1,-4,1,0,1,0],RedPostEffect_Convolution.EMBOSS=[-2,-1,0,-1,1,1,0,1,2],Object.freeze(RedPostEffect_Convolution)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform sampler2D u_blurTexture;
uniform sampler2D u_depthTexture;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord);
vec4 blurColor = texture2D(u_blurTexture, vTexcoord);
vec4 depthColor = texture2D(u_depthTexture, vTexcoord);
finalColor.rgb *= (depthColor.r);
blurColor.rgb *= (1.0-depthColor.r);
gl_FragColor =  (finalColor + blurColor) ;
}
*/},(RedPostEffect_DoF=function(i){if(!(this instanceof RedPostEffect_DoF))return new RedPostEffect_DoF(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_DoF : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.blurTexture=null,this.depthTexture=null,this._subFrameBufferList=[{frameBuffer:RedFrameBuffer(i),renderMaterial:RedPostEffect_DoF_DepthMaterial(i),process:[]}],this._process=[RedPostEffect_BlurX(i),RedPostEffect_BlurY(i)],this.focusLength=15,this.blur=10,this.program=RedProgram.makeProgram(i,"RedPostEffectDoFProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_DoF.prototype.updateTexture=function(e,t){this.diffuseTexture=t,this.blurTexture=e,this.depthTexture=this._subFrameBufferList[0].frameBuffer.texture},RedDefinePropertyInfo.definePrototypes("RedPostEffect_DoF",["diffuseTexture","sampler2D"],["blurTexture","sampler2D"],["depthTexture","sampler2D"],["blur","number",{min:0,callback:function(e){this._process[0].size=e,this._process[1].size=e}}]),Object.defineProperty(RedPostEffect_DoF.prototype,"focusLength",{get:function(){return this._subFrameBufferList[0].renderMaterial.focusLength},set:function(e){this._subFrameBufferList[0].renderMaterial.focusLength=e}}),Object.freeze(RedPostEffect_DoF)}(),function(){var e,t,r;e=function(){
/* @preserve
//#REDGL_DEFINE#vertexShareFunc#getSkinMatrix#
//#REDGL_DEFINE#vertexShareFunc#getSprite3DMatrix#
void main(void) {
gl_PointSize = uPointSize;
//#REDGL_DEFINE#skin#true# mat4 targetMatrix = uMMatrix *  getSkinMatrix() ;
//#REDGL_DEFINE#skin#false# mat4 targetMatrix = uMMatrix;
//#REDGL_DEFINE#sprite3D#true# gl_Position = uPMatrix * getSprite3DMatrix(uCameraMatrix , targetMatrix) *  vec4(aVertexPosition, 1.0);
//#REDGL_DEFINE#sprite3D#true# if(!u_PerspectiveScale){
//#REDGL_DEFINE#sprite3D#true#   gl_Position /= gl_Position.w;
//#REDGL_DEFINE#sprite3D#true#   gl_Position.xy += aVertexPosition.xy * vec2(targetMatrix[0][0],targetMatrix[1][1] * uResolution.x/uResolution.y);
//#REDGL_DEFINE#sprite3D#true# }
//#REDGL_DEFINE#sprite3D#false# gl_Position = uPMatrix * uCameraMatrix * targetMatrix * vec4(aVertexPosition, 1.0);
}
*/},t=function(){
/* @preserve
precision mediump float;
uniform float u_focusLength;
void main(void) {
float depth = 1.0 - gl_FragCoord.z / gl_FragCoord.w / u_focusLength;
gl_FragColor = vec4(depth, depth, depth, 1.0);
}
*/},(RedPostEffect_DoF_DepthMaterial=function(i){if(!(this instanceof RedPostEffect_DoF_DepthMaterial))return new RedPostEffect_DoF_DepthMaterial(i);this.focusLength=15,this.makeProgramList(this,i,"RedPostEffectDoFdepthProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedDefinePropertyInfo.definePrototype("RedPostEffect_DoF_DepthMaterial","focusLength","number",{min:0}),Object.freeze(RedPostEffect_DoF_DepthMaterial)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform bool u_grayMode;
uniform sampler2D u_diffuseTexture;
uniform float u_noiseIntensity; // noise effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineIntensity; // scanlines effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineCount; // scanlines effect count value (0 = no effect, 4096 = full effect)
void main() {
vec4 diffuseColor = texture2D( u_diffuseTexture, vTexcoord );
float x = vTexcoord.x * vTexcoord.y * vTime;
x = mod( x, 13.0 ) * mod( x, 123.0 );
float dx = mod( x, 0.01 );
vec3 finalColor = diffuseColor.rgb + diffuseColor.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );
vec2 sc = vec2( sin( vTexcoord.y * u_scanlineCount ), cos( vTexcoord.y * u_scanlineCount ) );
finalColor += diffuseColor.rgb * vec3( sc.x, sc.y, sc.x ) * u_scanlineIntensity;
finalColor = diffuseColor.rgb + clamp( u_noiseIntensity, 0.0, 1.0 ) * ( finalColor - diffuseColor.rgb );
if( u_grayMode ) finalColor = vec3( finalColor.r * 0.3 + finalColor.g * 0.59 + finalColor.b * 0.11 );
gl_FragColor =  vec4( finalColor, diffuseColor.a );
}
*/},(RedPostEffect_Film=function(i){if(!(this instanceof RedPostEffect_Film))return new RedPostEffect_Film(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Film : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.grayMode=!1,this.scanlineIntensity=.5,this.noiseIntensity=.5,this.scanlineCount=2048,this.program=RedProgram.makeProgram(i,"RedPostEffectFilmProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Film.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Film",["diffuseTexture","sampler2D"],["grayMode","boolean"],["scanlineIntensity","number",{min:0}],["noiseIntensity","number",{min:0}],["scanlineCount","number",{min:0}]),Object.freeze(RedPostEffect_Film)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
uniform float u_intensity;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, vTexcoord );
float dist = distance(vTexcoord, vec2(0.5, 0.5));
finalColor.rgb *= smoothstep(0.8, u_size * 0.799, dist * (u_intensity + u_size));
gl_FragColor = finalColor;
}
*/},(RedPostEffect_Vignetting=function(i){if(!(this instanceof RedPostEffect_Vignetting))return new RedPostEffect_Vignetting(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_Vignetting : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.size=.1,this.intensity=.85,this.program=RedProgram.makeProgram(i,"RedPostEffectVignettingProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_Vignetting.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedPostEffect_Vignetting",["diffuseTexture","sampler2D"],["intensity","number",{min:0}],["size","number",{min:0}]),Object.freeze(RedPostEffect_Vignetting)}(),function(){var e,t,r;e=RedBasePostEffect.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
const float cFXAA_REDUCE_MIN = 1.0/ 128.0;
const float cFXAA_REDUCE_MUL = 1.0 / 8.0;
const float cFXAA_SPAN_MAX = 8.0;
void main() {
vec4 finalColor;
vec2 inverseVP = vec2(1.0 / vResolution.x, 1.0 / vResolution.y);
vec2 fragCoord = gl_FragCoord.xy;
vec3 rgbNW = texture2D(u_diffuseTexture, (fragCoord + vec2(-1.0, -1.0)) * inverseVP).xyz;
vec3 rgbNE = texture2D(u_diffuseTexture, (fragCoord + vec2(1.0, -1.0)) * inverseVP).xyz;
vec3 rgbSW = texture2D(u_diffuseTexture, (fragCoord + vec2(-1.0, 1.0)) * inverseVP).xyz;
vec3 rgbSE = texture2D(u_diffuseTexture, (fragCoord + vec2(1.0, 1.0)) * inverseVP).xyz;
vec3 rgbM  = texture2D(u_diffuseTexture, fragCoord  * inverseVP).xyz;
vec3 luma = vec3(0.299, 0.587, 0.114);
float lumaNW = dot(rgbNW, luma);
float lumaNE = dot(rgbNE, luma);
float lumaSW = dot(rgbSW, luma);
float lumaSE = dot(rgbSE, luma);
float lumaM  = dot(rgbM,  luma);
float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));
vec2 dir;
dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));
float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) * (0.25 * cFXAA_REDUCE_MUL), cFXAA_REDUCE_MIN);
float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
dir = min(
vec2(cFXAA_SPAN_MAX, cFXAA_SPAN_MAX),
max( vec2(-cFXAA_SPAN_MAX, -cFXAA_SPAN_MAX), dir * rcpDirMin)
) * inverseVP;
vec3 rgbA = 0.5 * (
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz
);
vec3 rgbB = rgbA * 0.5 + 0.25 * (
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * -0.5).xyz +
texture2D(u_diffuseTexture, fragCoord * inverseVP + dir * 0.5).xyz
);
float lumaB = dot(rgbB, luma);
if ((lumaB < lumaMin) || (lumaB > lumaMax)) finalColor = vec4(rgbA, 1.0);
else finalColor = vec4(rgbB, 1.0);
gl_FragColor = finalColor;
}
*/},(RedPostEffect_FXAA=function(i){if(!(this instanceof RedPostEffect_FXAA))return new RedPostEffect_FXAA(i);i instanceof RedGL||RedGLUtil.throwFunc("RedPostEffect_FXAA : RedGL Instance만 허용.",i),this.frameBuffer=RedFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedPostEffectFXAAProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBasePostEffect,RedPostEffect_FXAA.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedPostEffect_FXAA","diffuseTexture","sampler2D"),Object.freeze(RedPostEffect_FXAA)}(),(RedFilterFrameBuffer=function(e,t,r){if(!(this instanceof RedFilterFrameBuffer))return new RedFilterFrameBuffer(e,t,r);var i;e instanceof RedGL||RedGLUtil.throwFunc("RedFilterFrameBuffer : RedGL Instance만 허용.",e),t&&("number"==typeof t||RedGLUtil.throwFunc("RedFilterFrameBuffer : width - 숫자만 허용","입력값 : ",t)),r&&("number"==typeof r||RedGLUtil.throwFunc("RedFilterFrameBuffer : height - 숫자만 허용","입력값 : ",r)),i=e.gl,r=r||1080,(t=t||1920)>e.detect.texture.MAX_TEXTURE_SIZE&&(t=e.detect.texture.MAX_TEXTURE_SIZE),r>e.detect.texture.MAX_TEXTURE_SIZE&&(r=e.detect.texture.MAX_TEXTURE_SIZE),this.redGL=e,this.width=t,this.height=r,this._prevWidth=null,this._prevHeight=null,this.webglFrameBuffer=i.createFramebuffer(),this.webglRenderBuffer=i.createRenderbuffer(),this.texture=RedBitmapTexture(e),this._UUID=RedGL.makeUUID(),i.bindFramebuffer(i.FRAMEBUFFER,this.webglFrameBuffer),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture.webglTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture.webglTexture,0),i.bindTexture(i.TEXTURE_2D,null),i.bindFramebuffer(i.FRAMEBUFFER,null)}).prototype={bind:function(e){e.bindFramebuffer(e.FRAMEBUFFER,this.webglFrameBuffer),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture.webglTexture),this._prevWidth!=this.width||this._prevHeight!=this.height?e.texImage2D(e.TEXTURE_2D,0,e.RGBA,parseInt(this.width),parseInt(this.height),0,e.RGBA,e.UNSIGNED_BYTE,null):e.clear(e.COLOR_BUFFER_BIT),this._prevWidth=this.width,this._prevHeight=this.height},unbind:function(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}},RedDefinePropertyInfo.definePrototypes("RedFilterFrameBuffer",["width","number",{min:2}],["height","number",{min:2}]),Object.freeze(RedFilterFrameBuffer),function(){var e,t,r,i,n,a,o;(RedFilterEffectManager=function(e){if(!(this instanceof RedFilterEffectManager))return new RedFilterEffectManager(e);e instanceof RedGL||RedGLUtil.throwFunc("RedFilterEffectManager : RedGL Instance만 허용.",e),Object.defineProperty(this,"frameBuffer",{value:RedFilterFrameBuffer(e)}),Object.defineProperty(this,"finalMaterial",{value:RedFilterMaterial(e,this.frameBuffer.texture)}),this.filterList=[];var t=RedMesh(e,RedPlane(e,1,1,1,1,!0),this.finalMaterial);t.useCullFace=!1,Object.defineProperty(this,"children",{value:[t]}),this._UUID=RedGL.makeUUID()}).prototype={bind:function(e){this.frameBuffer.bind(e)},unbind:function(e){this.frameBuffer.unbind(e)},render:(o=[],n=function(r,o,s,d,l,u,c,f,h,R,m){var p,_,g,v,E,M,b,L,T,P,x,y,w=[];if(b=r.gl,P=d.scene,x=d._viewRect,o._process&&o._process.length)for(M=i,L=0,T=o._process.length;L<T;L++)n(r,o._process[L],s,d,l,u,c,f,h,R+1);if(y=o.frameBuffer){var U,I,B;if(y._width=parseInt(x[2]),y._height=parseInt(x[3]),t._material=o,p=t._material.program,b.useProgram(p.webglProgram),(_=p.systemUniformLocation.uPMatrix)&&(g=_.location,v=_._UUID,g))l.mode2DYn?(w[0]=2,w[1]=0,w[2]=0,w[3]=0,w[4]=0,w[5]=2,w[6]=0,w[7]=0,w[8]=0,w[9]=0,w[10]=-2/l.farClipping*2,w[11]=0,w[12]=0,w[13]=0,w[14]=0,w[15]=1,U=-.5,I=.5,B=0,w[12]=w[0]*U+w[4]*I+w[8]*B+w[12],w[13]=w[1]*U+w[5]*I+w[9]*B+w[13],w[14]=w[2]*U+w[6]*I+w[10]*B+w[14],w[15]=w[3]*U+w[7]*I+w[11]*B+w[15],U=1/parseInt(x[2])*e.renderScale*window.devicePixelRatio,I=1/parseInt(x[3])*e.renderScale*window.devicePixelRatio,B=1,w[0]=w[0]*U,w[1]=w[1]*U,w[2]=w[2]*U,w[3]=w[3]*U,w[4]=w[4]*I,w[5]=w[5]*I,w[6]=w[6]*I,w[7]=w[7]*I,w[8]=w[8]*B,w[9]=w[9]*B,w[10]=w[10]*B,w[11]=w[11]*B):w=l.perspectiveMTX,E=JSON.stringify(w),a[v]!=E&&(b.uniformMatrix4fv(g,!1,w),a[v]=E);b.bindFramebuffer(b.FRAMEBUFFER,y.webglFrameBuffer),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,y.texture.webglTexture),y._prevWidth!=y.width||y._prevHeight!=y.height?b.texImage2D(b.TEXTURE_2D,0,b.RGBA,y.width,y.height,0,b.RGBA,b.UNSIGNED_BYTE,null):b.clear(b.COLOR_BUFFER_BIT),y._prevWidth=y.width,y._prevHeight=y.height,o._process&&o._process.length?o.updateTexture(i,M):o._diffuseTexture=i,u.sceneRender(r,P,l,l.mode2DYn,s,c,f),b.bindFramebuffer(b.FRAMEBUFFER,null),i=y.texture}},function(s,d,l,u,c,f,h){var R,m,p,_,g,v,E,M,b,L,T,P,x,y,w,U,I,B,F,D,G,A,S,O,C,N,k,Y,X,j,z,V;for(Y=null,O=C=0,e=s,m=u.scene,S=0,R=u.camera instanceof RedBaseController?u.camera.camera:u.camera,p=u._viewRect,_=l.worldRect,a=l.cacheInfo.cacheSystemUniformInfo,D=h.matrix,G=h._geometry.interleaveBuffer.stride,g=v=E=M=b=L=0,y=h._geometry.interleaveBuffer.data,w=0,U=h._geometry.interleaveBuffer.pointNum;w<U;w++)P=1+(T=w*G),x=T+2,g=(I=D[0]*y[T]+D[4]*y[P]+D[8]*y[x])<g?I:g,M=I>M?I:M,v=(B=D[1]*y[T]+D[5]*y[P]+D[9]*y[x])<v?B:v,b=B>b?B:b,E=(F=D[2]*y[T]+D[6]*y[P]+D[10]*y[x])<E?F:E,L=F>L?F:L;for(A=[M-g,b-v,L-E],o.length=0,w=0,U=this.filterList.length,t=this.children[0];w<U;w++)Y!=(X=this.filterList[w])&&(o[o.length]=X,X instanceof RedFilter_Blur?(N=A[0]+(R.mode2DYn?5:0),k=A[1]+(R.mode2DYn?5:0)):X instanceof RedFilter_BlurX||X instanceof RedFilter_BlurY?(N=A[0]+X._size,k=A[1]+X._size):X instanceof RedFilter_GaussianBlur?(N=A[0]+X._radius,k=A[1]+X._radius):X instanceof RedFilter_Bloom?(N=A[0]+X._blur,k=A[1]+X._blur):(N=A[0],k=A[1]),O=O<N?N:O,C=C<k?k:C),Y=X;for(t.x=h.x,t.y=h.y,t.z=h.z,R.mode2DYn?(t.scaleX=O,t.scaleY=C,t.scaleZ=1):(S=Math.sqrt(A[0]*A[0]+A[1]*A[1]),t.scaleY=t.scaleX=t.scaleZ=S,t.lookAt(R.x,R.y,R.z)),i=r=this.frameBuffer.texture,this.frameBuffer._width=p[2],this.frameBuffer._height=p[3],R.mode2DYn?d.scissor(parseInt(h.x*s._renderScale*window.devicePixelRatio-t.scaleX/2*window.devicePixelRatio)-10,parseInt(p[3]-h.y*s._renderScale*window.devicePixelRatio-t.scaleY/2*window.devicePixelRatio)-10,parseInt(t.scaleX*window.devicePixelRatio)+20,parseInt(t.scaleY*window.devicePixelRatio)+20):(V={x:0,y:0,z:0,w:0},z=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],mat4.multiply(z,R.perspectiveMTX,R.matrix),mat4.multiply(z,z,t.matrix),V.x=z[12],V.y=z[13],V.z=z[14],V.w=z[15],V.x=.5*V.x/V.w+.5,V.y=.5*V.y/V.w+.5,j=[(p[0]+V.x*p[2])/window.devicePixelRatio,(p[1]+(1-V.y)*p[3])/window.devicePixelRatio],(S=S/vec3.distance([R.x,R.y,R.z],[h.x,h.y,h.z])*p[3])>p[3]&&(S=p[3]),d.scissor(parseInt(j[0]*window.devicePixelRatio-S/2),parseInt(_[3]-j[1]*window.devicePixelRatio-S/2),parseInt(S),parseInt(S))),w=0,U=o.length;w<U;w++)n(s,o[w],this.children,u,R,l,c,f,h,0,U);if(u.postEffectManager.postEffectList.length){var Z=u.postEffectManager.frameBuffer;d.bindFramebuffer(d.FRAMEBUFFER,Z.webglFrameBuffer),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,Z.texture.webglTexture),d.bindRenderbuffer(d.RENDERBUFFER,Z.webglRenderBuffer),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,Z.texture.webglTexture,0),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,Z.webglRenderBuffer)}i!=r&&(this.finalMaterial._diffuseTexture=i,t._material=this.finalMaterial,l.sceneRender(s,m,R,R.mode2DYn,this.children,c,f)),d.scissor(p[0],_[3]-p[3]-p[1],p[2],p[3]),this.finalMaterial._diffuseTexture=this.frameBuffer.texture})},Object.freeze(RedFilterEffectManager)}(),function(){var e;(e=(RedBaseFilter=function(){}).prototype=new RedBaseMaterial).bind=RedFilterEffectManager.prototype.bind,e.unbind=RedFilterEffectManager.prototype.unbind,e.updateTexture=function(){RedGLUtil.throwFunc("RedBaseFilter - updateTexture : 반드시 재정의해야함")},e._process=[],RedBaseFilter.baseVertexShaderSource1=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
vResolution = uResolution;
vTime = uTime;
gl_Position = uPMatrix * uCameraMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
}
*/},Object.freeze(RedBaseFilter)}(),function(){var e,t,r;e=function(){
/* @preserve
void main(void) {
vTexcoord = aTexcoord;
gl_Position = uPMatrix * uCameraMatrix * uMMatrix *  vec4(aVertexPosition, 1.0);
vResolution = uResolution;
}
*/},t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
void main(void) {
gl_FragColor = texture2D(u_diffuseTexture, gl_FragCoord.xy/vResolution.xy);
// gl_FragColor.r = 1.0;
// gl_FragColor.a = 0.5;
if(gl_FragColor.a == 0.0) discard;
}
*/},(RedFilterMaterial=function(i,n){if(!(this instanceof RedFilterMaterial))return new RedFilterMaterial(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedFilterMaterial : RedGL Instance만 허용.",i),this.diffuseTexture=n,this.program=RedProgram.makeProgram(i,"RedFilterMaterialProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseMaterial,RedDefinePropertyInfo.definePrototype("RedFilterMaterial","diffuseTexture","sampler2D",{essential:!0}),Object.freeze(RedFilterMaterial)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_brightness_value;
uniform float u_contrast_value;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, gl_FragCoord.xy/vResolution );
if (u_contrast_value > 0.0) finalColor.rgb = (finalColor.rgb - 0.5) / (1.0 - u_contrast_value) + 0.5;
else finalColor.rgb = (finalColor.rgb - 0.5) * (1.0 + u_contrast_value) + 0.5;
finalColor.rgb += u_brightness_value;
gl_FragColor = finalColor;
}
*/},(RedFilter_BrightnessContrast=function(i){if(!(this instanceof RedFilter_BrightnessContrast))return new RedFilter_BrightnessContrast(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_BrightnessContrast : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.brightness=0,this.contrast=0,this.program=RedProgram.makeProgram(i,"RedFilterBrightnessContrastProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_BrightnessContrast.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_BrightnessContrast",["diffuseTexture","sampler2D"],["brightness","number",{min:-150,max:150,callback:function(e){this._brightness_value=e/255}}],["contrast","number",{min:-50,max:100,callback:function(e){this._contrast_value=e/255}}]),Object.freeze(RedFilter_BrightnessContrast)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, gl_FragCoord.xy/vResolution);
highp float gray = (finalColor.r  + finalColor.g + finalColor.b)/3.0;
gl_FragColor = vec4( gray, gray, gray, finalColor.a);
}
*/},(RedFilter_Gray=function(i){if(!(this instanceof RedFilter_Gray))return new RedFilter_Gray(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Gray : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedFilterGrayProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Gray.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedFilter_Gray","diffuseTexture","sampler2D"),Object.freeze(RedFilter_Gray)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec4 finalColor = texture2D(u_diffuseTexture, gl_FragCoord.xy/vResolution);
if(finalColor.a == 0.0) discard;
finalColor.r = 1.0 - finalColor.r;
finalColor.g = 1.0 - finalColor.g;
finalColor.b = 1.0 - finalColor.b;
gl_FragColor = finalColor;
}
*/},(RedFilter_Invert=function(i){if(!(this instanceof RedFilter_Invert))return new RedFilter_Invert(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Invert : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedFilterInvertProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Invert.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedFilter_Invert","diffuseTexture","sampler2D"),Object.freeze(RedFilter_Invert)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture,  gl_FragCoord.xy/vResolution.xy);
float v;
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b >= u_threshold_value) v = 1.0;
else v = 0.0;
finalColor.r = finalColor.g = finalColor.b = v;
gl_FragColor = finalColor;
}
*/},(RedFilter_Threshold=function(i){if(!(this instanceof RedFilter_Threshold))return new RedFilter_Threshold(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Threshold : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.threshold=50,this.program=RedProgram.makeProgram(i,"RedFilterThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Threshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_Threshold",["diffuseTexture","sampler2D"],["threshold","number",{min:1,max:255,callback:function(e){this._threshold_value=e/255}}]),Object.freeze(RedFilter_Threshold)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
uniform float u_hue_value;
uniform float u_saturation_value;
void main(void) {
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
vec4 finalColor = texture2D(u_diffuseTexture, testCoord );
float angle = u_hue_value * 3.1415926535897932384626433832795;
float s = sin(angle), c = cos(angle);
vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
float len = length(finalColor.rgb);
finalColor.rgb = vec3(
dot(finalColor.rgb, weights.xyz),
dot(finalColor.rgb, weights.zxy),
dot(finalColor.rgb, weights.yzx)
);
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
if (u_saturation_value > 0.0) finalColor.rgb += (average - finalColor.rgb) * (1.0 - 1.0 / (1.001 - u_saturation_value));
else finalColor.rgb += (average - finalColor.rgb) * (-u_saturation_value);
gl_FragColor = finalColor;
}
*/},(RedFilter_HueSaturation=function(i){if(!(this instanceof RedFilter_HueSaturation))return new RedFilter_HueSaturation(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_HueSaturation : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.hue=0,this.saturation=0,this.program=RedProgram.makeProgram(i,"RedFilterHueSaturationProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_HueSaturation.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_HueSaturation",["diffuseTexture","sampler2D"],["hue","number",{min:-180,max:180,callback:function(e){this._hue_value=e/180}}],["saturation","number",{min:-100,max:100,callback:function(e){this._saturation_value=e/100}}]),Object.freeze(RedFilter_HueSaturation)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
void main(void) {
vec2 px = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec4 finalColor = vec4(0.0);
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2(-7.0*px.x, -7.0*px.y))*0.0044299121055113265;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2(-6.0*px.x, -6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2(-5.0*px.x, -5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2(-4.0*px.x, -4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2(-3.0*px.x, -3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2(-2.0*px.x, -2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2(-1.0*px.x, -1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, testCoord                             )*0.159576912161;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2( 1.0*px.x,  1.0*px.y))*0.147308056121;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2( 2.0*px.x,  2.0*px.y))*0.115876621105;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2( 3.0*px.x,  3.0*px.y))*0.0776744219933;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2( 4.0*px.x,  4.0*px.y))*0.0443683338718;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2( 5.0*px.x,  5.0*px.y))*0.0215963866053;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2( 6.0*px.x,  6.0*px.y))*0.00895781211794;
finalColor += texture2D(u_diffuseTexture, testCoord + vec2( 7.0*px.x,  7.0*px.y))*0.0044299121055113265;
gl_FragColor = finalColor;
}
*/},(RedFilter_Blur=function(i){if(!(this instanceof RedFilter_Blur))return new RedFilter_Blur(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Blur : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.program=RedProgram.makeProgram(i,"RedFilterBlurProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Blur.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedFilter_Blur","diffuseTexture","sampler2D"),Object.freeze(RedFilter_Blur)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(u_size/vResolution.x,0.0);
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
float percent;
float weight;
for (float t = -4.0; t <= 4.0; t+=1.0) {
float percent = (t + offset - 0.5) / 4.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, testCoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =  finalColor ;
}
*/},(RedFilter_BlurX=function(i){if(!(this instanceof RedFilter_BlurX))return new RedFilter_BlurX(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_BlurX : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.size=50,this.program=RedProgram.makeProgram(i,"RedFilterBlurXProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_BlurX.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_BlurX",["diffuseTexture","sampler2D"],["size","number",{min:0}]),Object.freeze(RedFilter_BlurX)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
uniform float u_size;
float random(vec3 scale, float seed) {
return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);
}
void main() {
vec4 finalColor = vec4(0.0);
vec2 delta;
float total = 0.0;
float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);
delta = vec2(0.0, u_size/vResolution.y);
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
for (float t = -4.0; t <= 4.0; t++) {
float percent = (t + offset - 0.5) / 4.0;
float weight = 1.0 - abs(percent);
vec4 sample = texture2D(u_diffuseTexture, testCoord + delta * percent);
sample.rgb *= sample.a;
finalColor += sample * weight;
total += weight;
}
finalColor = finalColor / total;
finalColor.rgb /= finalColor.a + 0.00001;
gl_FragColor =   finalColor ;
}
*/},(RedFilter_BlurY=function(i){if(!(this instanceof RedFilter_BlurY))return new RedFilter_BlurY(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_BlurY : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.size=25,this.program=RedProgram.makeProgram(i,"RedFilterBlurYProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_BlurY.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_BlurY",["diffuseTexture","sampler2D"],["size","number",{min:0}]),Object.freeze(RedFilter_BlurY)}(),(RedFilter_GaussianBlur=function(e){if(!(this instanceof RedFilter_GaussianBlur))return new RedFilter_GaussianBlur(e);e instanceof RedGL||RedGLUtil.throwFunc("RedFilter_GaussianBlur : RedGL Instance만 허용.",e),this._UUID=RedGL.makeUUID(),this._process=[RedFilter_BlurX(e),RedFilter_BlurY(e)],this.radius=1}).prototype=new RedBaseFilter,RedFilter_GaussianBlur.prototype.updateTexture=function(){},RedDefinePropertyInfo.definePrototype("RedFilter_GaussianBlur","radius","number",{min:.1,max:255,callback:function(e){this._process[0].size=e,this._process[1].size=e}}),Object.freeze(RedFilter_GaussianBlur),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
uniform float u_width;
uniform float u_height;
void main(void) {
vec4 finalColor;
float dx = 1.0/vResolution.x * u_width;
float dy = 1.0/vResolution.y * u_height;
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
vec2 coord = vec2(
dx * (floor(testCoord.x / dx) + 0.5),
dy * (floor(testCoord.y / dy) + 0.5)
);
finalColor = texture2D(u_diffuseTexture, coord);
gl_FragColor = finalColor;
}
*/},(RedFilter_Pixelize=function(i){if(!(this instanceof RedFilter_Pixelize))return new RedFilter_Pixelize(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Pixelize : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.width=5,this.height=5,this.program=RedProgram.makeProgram(i,"RedFilterPixelizeProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Pixelize.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_Pixelize",["diffuseTexture","sampler2D"],["width","number",{min:0}],["height","number",{min:0}]),Object.freeze(RedFilter_Pixelize)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
uniform float u_centerX;
uniform float u_centerY;
uniform float u_angle;
uniform float u_radius;
uniform bool u_grayMode;
float pattern(float angle, vec2 testCoord) {
angle = angle * 3.141592653589793/180.0;
float s = sin(angle), c = cos(angle);
vec2 tex = testCoord;
tex.x -= u_centerX + 0.5;
tex.y -= u_centerY + 0.5;
vec2 point = vec2(
c * tex.x - s * tex.y,
s * tex.x + c * tex.y
) * vResolution / u_radius;
return (sin(point.x) * sin(point.y)) * 4.0;
}
void main(void) {
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
vec4 finalColor = texture2D(u_diffuseTexture, testCoord);
if(u_grayMode) {
float average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;
gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern(u_angle,testCoord)), finalColor.a);
}else{
vec3 cmy = 1.0 - finalColor.rgb;
float k = min(cmy.x, min(cmy.y, cmy.z));
cmy = (cmy - k) / (1.0 - k);
cmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(u_angle + 0.26179,testCoord), pattern(u_angle + 1.30899,testCoord), pattern(u_angle,testCoord)), 0.0, 1.0);
k = clamp(k * 10.0 - 5.0 + pattern(u_angle + 0.78539,testCoord), 0.0, 1.0);
gl_FragColor = vec4(1.0 - cmy - k, finalColor.a);
}
}
*/},(RedFilter_HalfTone=function(i){if(!(this instanceof RedFilter_HalfTone))return new RedFilter_HalfTone(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_HalfTone : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.centerX=0,this.centerY=0,this.angle=0,this.radius=2,this.grayMode=!1,this.program=RedProgram.makeProgram(i,"RedFilterHalfToneProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_HalfTone.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_HalfTone",["diffuseTexture","sampler2D"],["centerX","number"],["centerY","number"],["angle","number"],["grayMode","boolean"],["radius","number",{min:0}]),Object.freeze(RedFilter_HalfTone)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
uniform sampler2D u_blurTexture;
uniform float u_exposure;
uniform float u_bloomStrength;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, gl_FragCoord.xy/vResolution.xy);
vec4 thresholdColor = finalColor;
vec4 blurColor = texture2D(u_blurTexture, gl_FragCoord.xy/vResolution.xy);
finalColor.rgb = (finalColor.rgb  + blurColor.rgb * u_bloomStrength) * u_exposure;
gl_FragColor = finalColor ;
}
*/},(RedFilter_Bloom=function(i){if(!(this instanceof RedFilter_Bloom))return new RedFilter_Bloom(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Bloom : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.blurTexture=null,this.exposure=1,this.bloomStrength=1.2,this._process=[RedFilter_BloomThreshold(i),RedFilter_BlurX(i),RedFilter_BlurY(i)],this.blur=20,this.threshold=75,this.program=RedProgram.makeProgram(i,"RedFilterBloomProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Bloom.prototype.updateTexture=function(e,t){this.diffuseTexture=t,this.blurTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_Bloom",["diffuseTexture","sampler2D"],["blurTexture","sampler2D"],["exposure","number",{min:0}],["bloomStrength","number",{min:0}],["threshold","number",{min:0,callback:function(e){this._process[0].threshold=e,this._threshold=this._process[0].threshold}}],["blur","number",{min:0,callback:function(e){this._process[1].size=e,this._process[2].size=e}}]),Object.freeze(RedFilter_Bloom)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform sampler2D u_diffuseTexture;
uniform float u_threshold_value;
void main() {
vec4 finalColor = texture2D(u_diffuseTexture, gl_FragCoord.xy/vResolution.xy);
if(0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b < u_threshold_value)  finalColor.r = finalColor.g = finalColor.b = 0.0;
gl_FragColor = finalColor;
}
*/},(RedFilter_BloomThreshold=function(i){if(!(this instanceof RedFilter_BloomThreshold))return new RedFilter_BloomThreshold(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_BloomThreshold : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.renderScale=.5,this.threshold=128,this.program=RedProgram.makeProgram(i,"RedFilterBloomThresholdProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_BloomThreshold.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_BloomThreshold",["diffuseTexture","sampler2D"],["threshold","number",{min:0,max:255,callback:function(e){this._threshold_value=e/255}}]),Object.freeze(RedFilter_BloomThreshold)}(),function(){var e,t,r;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision lowp float;
uniform bool u_grayMode;
uniform sampler2D u_diffuseTexture;
uniform float u_noiseIntensity; // noise effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineIntensity; // scanlines effect intensity value (0 = no effect, 1 = full effect)
uniform float u_scanlineCount; // scanlines effect count value (0 = no effect, 4096 = full effect)
void main() {
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
vec4 diffuseColor = texture2D( u_diffuseTexture, testCoord );
float x = testCoord.x * testCoord.y * vTime;
x = mod( x, 13.0 ) * mod( x, 123.0 );
float dx = mod( x, 0.01 );
vec3 finalColor = diffuseColor.rgb + diffuseColor.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );
vec2 sc = vec2( sin( testCoord.y * u_scanlineCount ), cos( testCoord.y * u_scanlineCount ) );
finalColor += diffuseColor.rgb * vec3( sc.x, sc.y, sc.x ) * u_scanlineIntensity;
finalColor = diffuseColor.rgb + clamp( u_noiseIntensity, 0.0, 1.0 ) * ( finalColor - diffuseColor.rgb );
if( u_grayMode ) finalColor = vec3( finalColor.r * 0.3 + finalColor.g * 0.59 + finalColor.b * 0.11 );
gl_FragColor =  vec4( finalColor, diffuseColor.a );
}
*/},(RedFilter_Film=function(i){if(!(this instanceof RedFilter_Film))return new RedFilter_Film(i);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Film : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.grayMode=!1,this.scanlineIntensity=.5,this.noiseIntensity=.5,this.scanlineCount=2048,this.program=RedProgram.makeProgram(i,"RedFilterFilmProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Film.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototypes("RedFilter_Film",["diffuseTexture","sampler2D"],["grayMode","boolean"],["scanlineIntensity","number",{min:0}],["noiseIntensity","number",{min:0}],["scanlineCount","number",{min:0}]),Object.freeze(RedFilter_Film)}(),function(){var e,t,r,i,n;e=RedBaseFilter.baseVertexShaderSource1,t=function(){
/* @preserve
precision mediump float;
uniform sampler2D u_diffuseTexture;
uniform mat3 u_kernel;
uniform float uKernelWeight;
void main(void) {
vec2 perPX = vec2(1.0/vResolution.x, 1.0/vResolution.y);
vec2 testCoord = gl_FragCoord.xy/vResolution.xy;
vec4 finalColor = vec4(0.0);
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2(-1.0, -1.0)) * u_kernel[0][0] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2( 0.0, -1.0)) * u_kernel[0][1] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2( 1.0, -1.0)) * u_kernel[0][2] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2(-1.0,  0.0)) * u_kernel[1][0] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2( 0.0,  0.0)) * u_kernel[1][1] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2( 1.0,  0.0)) * u_kernel[1][2] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2(-1.0,  1.0)) * u_kernel[2][0] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2( 0.0,  1.0)) * u_kernel[2][1] ;
finalColor += texture2D(u_diffuseTexture, testCoord + perPX * vec2( 1.0,  1.0)) * u_kernel[2][2] ;
gl_FragColor = vec4((finalColor / uKernelWeight).rgb, finalColor.a);
}
*/},(RedFilter_Convolution=function(i,n){if(!(this instanceof RedFilter_Convolution))return new RedFilter_Convolution(i,n);i instanceof RedGL||RedGLUtil.throwFunc("RedFilter_Convolution : RedGL Instance만 허용.",i),this.frameBuffer=RedFilterFrameBuffer(i),this.diffuseTexture=null,this.kernel=n,this.program=RedProgram.makeProgram(i,"RedFilterConvolutionProgram",e,t),this._UUID=RedGL.makeUUID(),r||(this.checkUniformAndProperty(),r=!0)}).prototype=new RedBaseFilter,RedFilter_Convolution.prototype.updateTexture=function(e){this.diffuseTexture=e},RedDefinePropertyInfo.definePrototype("RedFilter_Convolution","diffuseTexture","sampler2D"),Object.defineProperty(RedFilter_Convolution.prototype,"kernel",{get:function(){return this._kernel||(this._kernel=RedFilter_Convolution.NORMAL),this._kernel},set:function(e){this._kernel=e}}),Object.defineProperty(RedFilter_Convolution.prototype,"kernelWeight",{get:function(){for(n in i=0,this.kernel)i+=this.kernel[n];return i}}),RedFilter_Convolution.NORMAL=[0,0,0,0,1,0,0,0,0],RedFilter_Convolution.SHARPEN=[0,-1,0,-1,5,-1,0,-1,0],RedFilter_Convolution.BLUR=[1,1,1,1,1,1,1,1,1],RedFilter_Convolution.EDGE=[0,1,0,1,-4,1,0,1,0],RedFilter_Convolution.EMBOSS=[-2,-1,0,-1,1,1,0,1,2],Object.freeze(RedFilter_Convolution)}(),function(){var e,t,r,i,n,a;(RedGLOffScreen=function(e,t,r,i,n){if(!(this instanceof RedGLOffScreen))return new RedGLOffScreen(e,t,r,i,n);RedGLDetect.getBrowserInfo();var a=this;a.htmlCanvas=e,a.redGLSrc=i,fetch(n).then(function(e){e.text().then(function(e){a.hostCode="\ncanvas.tagName = 'CANVAS';\nreturn RedGL(canvas, function (v) {\nvar _host_ = "+e+";\n_host_.call(this);\n\n});",a.setSize(t,r)})}).catch(function(e){})}).prototype.updatePostMessage=function(e){if(!e)throw"RedGLOffScreen.prototype['updatePostMessage'] - run을 정의해야합니다."+e;if(!e.name)throw"RedGLOffScreen.prototype['updatePostMessage'] - run객체의 name을 정의해야합니다."+e.name;this.worker.postMessage({state:"update",run:e})},RedGLOffScreen.prototype._init=function(r,i,n){var a=this;this.worker&&this.worker.terminate();var o=this.htmlCanvas.parentNode,s=r.cloneNode(!0);o.replaceChild(s,this.htmlCanvas),this.htmlCanvas=s;var d="x,y,clientX,clientY,pageX,pageY,screenX,screenY,layerX,layerY,detail,shiftKey,altKey,ctrlKey,movementX,movementY,button,type,which,deltaX,deltaY,deltaZ,timeStamp,targetTouches".split(","),l="shiftKey,altKey,ctrlKey,key,keyCode,location,code,charCode,detail,timeStamp,which,type".split(","),u=[RedGLDetect.BROWSER_INFO.move,RedGLDetect.BROWSER_INFO.down,RedGLDetect.BROWSER_INFO.up],c="keydown,keyup,keypress".split(",");u.forEach(function(e){a.htmlCanvas.addEventListener(e,function(e){var t={};d.forEach(function(r){if("targetTouches"==r&&e[r]){for(var i=[],n=e[r].length;n--;){var a=e[r][n];i.push({clientX:a.clientX,clientY:a.clientY,force:a.force,identifier:a.identifier,pageX:a.pageX,pageY:a.pageY,radiusX:a.radiusX,radiusY:a.radiusY,rotationAngle:a.rotationAngle,screenX:a.screenX,screenY:a.screenY})}t[r]=i}else t[r]=e[r]}),a.worker.postMessage({state:e.type,event:t})})}),c.forEach(function(e){window.addEventListener(e,function(e){var t={};l.forEach(function(r){t[r]=e[r]}),a.worker.postMessage({state:e.type,event:t})})}),this.offScreenCanvas=this.htmlCanvas.transferControlToOffscreen(),this.offScreenCanvas.width=i,this.offScreenCanvas.height=n,this.worker=null,t=new Blob([e],{type:"application/javascript"}),this.worker=new Worker(URL.createObjectURL(t));var f=document.location.pathname.split("/");f[f.length-1].indexOf(".")>-1&&f.pop();var h=this.redGLSrc.split("/");h.forEach(function(e,t){".."===e&&(f.pop(),h[t]=""),"."===e&&(h[t]="")}),this.worker.postMessage({canvas:this.offScreenCanvas,state:"init",redGLSrc:document.location.origin+f.join("/")+"/"+h.join("/"),hostCode:this.hostCode.toString()},[this.offScreenCanvas])},RedGLOffScreen.prototype.setSize=(n=0,a=0,function(e,t,o){void 0===e&&RedGLUtil.throwFunc("RedGL setSize : width가 입력되지 않았습니다."),void 0===t&&RedGLUtil.throwFunc("RedGL setSize : height가 입력되지 않았습니다."),r=this._width=e,i=this._height=t,"number"!=typeof r&&(r.indexOf("%")>-1?r=(document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)*parseFloat(r)/100:RedGLUtil.throwFunc("RedGL setSize : width는 0이상의 숫자나 %만 허용.",r)),"number"!=typeof i&&(i.indexOf("%")>-1?i=window.innerHeight*parseFloat(i)/100:RedGLUtil.throwFunc("RedGL setSize : height는 0이상의 숫자나 %만 허용.",i)),window.devicePixelRatio,this._canvas,(n!==r||a!==i||o)&&(n=r,a=i),r=parseInt(r),i=parseInt(i),this._init(this.htmlCanvas,r,i)}),e=(e=function(){var e,t;this.window=this,onmessage=function(r){switch(r.data.state){case"init":e||(importScripts(r.data.redGLSrc),e=new Function("canvas",r.data.hostCode)),t=new e(r.data.canvas);break;case"update":var i=r.data.run.args;t.userInterface[r.data.run.name]["array"==typeof i?"apply":"call"](t,r.data.run.args);break;case RedGLDetect.BROWSER_INFO.move:var n=new Event(RedGLDetect.BROWSER_INFO.move),a=r.data.event;for(var o in a)n[o]=a[o];t._canvas.dispatchEvent(n);break;case RedGLDetect.BROWSER_INFO.down:for(var o in n=new Event(RedGLDetect.BROWSER_INFO.down),a=r.data.event)n[o]=a[o];t._canvas.dispatchEvent(n);break;case RedGLDetect.BROWSER_INFO.up:for(var o in n=new Event(RedGLDetect.BROWSER_INFO.up),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n);break;case"wheel":for(var o in n=new Event("wheel"),a=r.data.event)n[o]=a[o];t._canvas.dispatchEvent(n);break;case"keydown":for(var o in n=new Event("keydown"),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n);break;case"keyup":for(var o in n=new Event("keyup"),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n);break;case"keypress":for(var o in n=new Event("keypress"),a=r.data.event)n[o]=a[o];this.window.dispatchEvent(n)}}}).toString().replace(/^function ?. ?\) ?\{|\}\;?$/g,"")}();var RedGL_VERSION={version:"RedGL Release. last update( 2020-03-18 13:46:45)"};