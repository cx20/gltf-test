!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),i=r(a),o=n(6),s=r(o),u=n(7),l=r(u),f=n(8),c=r(f),d=n(9),m=r(d),p=n(10),h=r(p),b=n(1),y=r(b),v=n(15),_=r(v),g=n(11),w=r(g),x=n(12),T=r(x),C=n(13),O=r(C),R=n(16),S=r(R),M="1.8.1",A="grimoirejs-gltf",k={Accessor:{Accessor:i.default},Animation:{Animation:s.default,Interpolators:l.default},Components:{GLTFAnimationComponent:c.default,GLTFJointComponent:m.default,GLTFModelComponent:h.default},Parser:{ConstantConverter:y.default,GLTFMaterialFactory:_.default,MaterialParser:w.default,Parser:T.default},Util:{ResourceResolver:O.default}},j=(0,S.default)();Object.assign(k,{__VERSION__:M,__NAME__:A}),Object.assign(j||{},k),window.GrimoireJS.lib.gltf=k,t.default=j},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(26),s=r(o),u=n(27),l=r(u),f=function(){function e(){a(this,e)}return i(e,null,[{key:"asColorValue",value:function(e){return 3===e.length?new s.default(e[0],e[1],e[2]):new l.default(e[0],e[1],e[2],e[3])}},{key:"asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error("Invalid vectorSize")}}},{key:"asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:case WebGLRenderingContext.BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:case WebGLRenderingContext.SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:case WebGLRenderingContext.INT:case WebGLRenderingContext.FLOAT:return 4;default:throw new Error("Unknown size!")}}},{key:"elementTypeToTypedArray",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.BYTE:return Int8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.SHORT:return Int16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;case WebGLRenderingContext.INT:return Int32Array;case WebGLRenderingContext.FLOAT:return Float32Array;default:throw new Error("Unsupported")}}},{key:"indexCountToBufferInfo",value:function(e){return e<256?{elementType:WebGLRenderingContext.UNSIGNED_BYTE,byteSize:1,ctor:Uint8Array}:e<65536?{elementType:WebGLRenderingContext.UNSIGNED_SHORT,byteSize:2,ctor:Uint16Array}:{elementType:WebGLRenderingContext.UNSIGNED_INT,byteSize:4,ctor:Uint32Array}}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),s=r(o),u=function(){function e(t,n,r,i,o,u){a(this,e),this.buffer=t,this.count=n,this.componentType=r,this.elementSize=i,this.byteOffset=o,this.byteStride=u,this._dView=new DataView(t.buffer,t.byteOffset+o),this._elementByteSize=s.default.asByteSize(r),0===u&&(this.byteStride=this.elementSize*this._elementByteSize)}return i(e,[{key:"getByIndex",value:function(e){if(e<0||e>=this.count)return null;for(var t=new Array(this.elementSize),n=0;n<this.elementSize;n++)t[n]=this._getSingleByIndex(e,n);return t}},{key:"_getSingleByIndex",value:function(e,t){switch(this.componentType){case WebGLRenderingContext.FLOAT:return this._dView.getFloat32(e*this.byteStride+this._elementByteSize*t,!0);default:throw new Error("Unsupported element type")}}}]),e}();t.default=u},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Components.TransformComponent},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(7),s=r(o),u=n(1),l=r(u),f=n(2),c=r(f),d=function(){function e(t,n,r){a(this,e),this.tf=t,this.animationKey=n,this._buffers=r,this.accessors={},this.timeLength=0,this.targetNodes=[],this._animationData=t.animations[n];for(var i in this._animationData.parameters){var o=t.accessors[this._animationData.parameters[i]];this.accessors[i]=new c.default(r[o.bufferView],o.count,o.componentType,l.default.asVectorSize(o.type),o.byteOffset||0,o.byteStride||0)}var s=!0,u=!1,f=void 0;try{for(var d,m=this._animationData.channels[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){var p=d.value,h=this._animationData.samplers[p.sampler],b=this.accessors[h.input];this.timeLength=Math.max(this.timeLength,b.getByIndex(b.count-1)[0]),this.targetNodes.push(p.target.id),"rotation"===p.target.path&&"LINEAR"===this._animationData.samplers[p.sampler].interpolation&&(this._animationData.samplers[p.sampler].interpolation="SPHERICAL")}}catch(e){u=!0,f=e}finally{try{!s&&m.return&&m.return()}finally{if(u)throw f}}}return i(e,[{key:"processCurrentFrame",value:function(e,t){for(var n=0;n<this._animationData.channels.length;n++){var r=this._animationData.channels[n],a=this._getBySampler(r.sampler,e);t(r.target.id,r.target.path,a)}}},{key:"_getBySampler",value:function(e,t){var n=this._animationData.samplers[e],r=this.accessors[n.input],a=this.accessors[n.output],i=0;for(i=0;i<r.count;i++){var o=r.getByIndex(i)[0];if(o>t)return this._complementFrame(t,r.getByIndex(i-1),r.getByIndex(i),a.getByIndex(i-1),a.getByIndex(i),n.interpolation)}return this._complementFrame(t,r.getByIndex(i-1),null,a.getByIndex(i-1),null,n.interpolation)}},{key:"_complementFrame",value:function(e,t,n,r,a,i){if(!r)return a;if(!a)return r;var o=(e-t[0])/(n[0]-t[0]);return s.default[i](o,r,a)}}]),e}();t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(28),i=r(a),o=i.default.quat;t.default={LINEAR:function(e,t,n){for(var r=new Array(t.length),a=0;a<t.length;a++)r[a]=t[a]+(n[a]-t[a])*e;return r},SPHERICAL:function(e,t,n){var r=new Array(t.length);return o.slerp(r,t,n,e),r}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),l=r(u),f=n(5),c=r(f),d=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"$mount",value:function(){this._startTime=(new Date).getTime(),this._animation=this.getAttribute("animation")}},{key:"$update",value:function(){var e=this;if(!this._targetTransforms){this._targetTransforms={};var t=this._animation.targetNodes,n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value,u=this.node.parent.parent.parent.getChildrenByClass(s);u.length>0&&(this._targetTransforms[s]=u[0].getComponent(l.default))}}catch(e){r=!0,a=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw a}}}var f=((new Date).getTime()-this._startTime)/1e3;this._animation.processCurrentFrame(f%this._animation.timeLength,function(t,n,r){var a=e._targetTransforms[t];if(a)switch(n){case"translation":a.localPosition.rawElements=r;break;case"rotation":a.localRotation.rawElements=r;break;case"scale":a.localScale.rawElements=r}});for(var c in this._targetTransforms)this._targetTransforms[c].updateTransform()}},{key:"$unmount",value:function(){}}]),t}(c.default);t.default=d,d.attributes={play:{converter:"Boolean",default:!1},animation:{converter:"Object",default:null},frame:{converter:"Number",default:0}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(4),l=r(u),f=n(3),c=r(f),d=n(5),m=r(d),p=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"$mount",value:function(){this._transform=this.node.getComponent(c.default),this._skeletonTransform=this.getAttribute("skeletonTransform");var e=this.getAttribute("skinInfo");this._poseIndex=e.jointNames.indexOf(this.getAttribute("jointName")),this._jointMatrices=this.getAttribute("jointMatrices"),this._bindShapeMatrix=e.bindShapeMatrix,this._invBindMatrix=new l.default(e.inverseBindMatrices.getByIndex(this._poseIndex))}},{key:"$update",value:function(){for(var e=l.default.inverse(this._skeletonTransform.globalTransform).multiplyWith(this._transform.globalTransform).multiplyWith(this._invBindMatrix).multiplyWith(this._bindShapeMatrix),t=0;t<16;t++)this._jointMatrices[16*this._poseIndex+t]=e.rawElements[t]}}]),t}(m.default);t.default=p,p.attributes={skinInfo:{converter:"Object",default:null},jointName:{converter:"String",default:null},skeletonTransform:{converter:"Object",default:null},jointMatrices:{converter:"Object",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(3),l=r(u),f=n(4),c=r(f),d=n(5),m=r(d),p=n(12),h=r(p),b=function(e){function t(){return a(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),s(t,[{key:"$mount",value:function(){var e=this,t=this.getAttribute("src");if(t){var n=this.companion.get("gl");h.default.parseFromURL(n,t).then(function(t){e._parsedData=t,e._populateAssets(t),e._populateScene(t)})}}},{key:"_populateScene",value:function(e){var t=this.getAttribute("scene");t||(t=e.tf.scene);var n=e.tf.scenes[t],r=!0,a=!1,i=void 0;try{for(var o,s=n.nodes[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;this._populateNode(e,u,this.node)}}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}}},{key:"_populateAssets",value:function(e){this._assetRoot=this.node.addChildByName("gltf-assets",{});for(var t in e.animations)this._assetRoot.addChildByName("gltf-animation",{animation:e.animations[t]})}},{key:"_populateMaterial",value:function(e,t,n){var r=n?"gltf-"+e.tf.id+"-"+t+"-"+n:"gltf-"+e.tf.id+"-"+t,a=this.node.getChildrenByClass(r);if(0===a.length){var i=this._assetRoot.addChildByName("material",Object.assign({boneMatrices:n?e.skins[n].jointMatrices:void 0,boneCount:n?e.skins[n].jointNames.length:void 0},e.materials[t])),o=e.materials[t].class;n&&(o+=" "+r),i.element.className=o}return"."+r}},{key:"_populateNode",value:function(e,t,n){var r=e.tf.nodes[t];r.skin&&(n=n.addChildByName("object",{}));var a=n.addChildByName("object",{});if(a.element.className=t,void 0!==r.meshes)for(var i=0;i<r.meshes.length;i++)for(var o=e.meshes[r.meshes[i]],s=0;s<o.length;s++){var u=e.tf.meshes[r.meshes[i]].primitives[s].material,f=e.tf.materials[u].extensions,c=f&&f.KHR_materials_common&&!f.KHR_materials_common.transparent,d=this._populateMaterial(e,u,r.skin);a.addChildByName("gltf-mesh",{geometry:o[s],material:d,drawOrder:c?"NoAlpha":"UseAlpha"})}if(this._applyTransform(r,a),r.children){var m=!0,p=!1,h=void 0;try{for(var b,y=r.children[Symbol.iterator]();!(m=(b=y.next()).done);m=!0){var v=b.value;this._populateNode(e,v,a)}}catch(e){p=!0,h=e}finally{try{!m&&y.return&&y.return()}finally{if(p)throw h}}}if(r.skeletons&&r.skin)for(var _=0;_<r.skeletons.length;_++){var g=this.node.getChildrenByClass(r.skeletons[_]);this._injectJoint(e,g[0],r.skeletons[_],a.getComponent(l.default),r.skin)}}},{key:"_injectJoint",value:function(e,t,n,r,a){if(t.addComponent("GLTFJoint",{skinInfo:e.skins[a],jointName:e.tf.nodes[n].jointName,skeletonTransform:r,jointMatrices:e.skins[a].jointMatrices}),e.tf.nodes[n].children)for(var i=e.tf.nodes[n],o=0;o<i.children.length;o++){var s=this.node.getChildrenByClass(i.children[o]);this._injectJoint(e,s[0],i.children[o],r,a)}}},{key:"_applyTransform",value:function(e,t){if(e.translation&&t.setAttribute("position",e.translation),e.scale&&t.setAttribute("scale",e.scale),e.rotation&&t.setAttribute("rotation",e.rotation),e.matrix){var n=new c.default(e.matrix);t.setAttribute("rawMatrix",n)}}}]),t}(m.default);t.default=b,b.componentName="GLTFModelComponent",b.attributes={src:{converter:"String",default:null},scene:{converter:"String",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(20),s=r(o),u=n(14),l=r(u),f=n(1),c=r(f),d=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})},m=function(){function e(){a(this,e)}return i(e,null,[{key:"parse",value:function(e,t,n,r){return d(this,void 0,void 0,regeneratorRuntime.mark(function a(){var i,o,u,f,c,d,m,p,h=this;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(i=e.materials[t],!i.extensions||!i.extensions.KHR_materials_common){a.next=5;break}return a.abrupt("return",this._parseMaterialCommon(e,t,r));case 5:if(void 0!==l.default.registerdHandlers[i.technique]){a.next=7;break}return a.delegateYield(regeneratorRuntime.mark(function r(){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,h._convertIntoTechniqueRecipe(e,t,n);case 2:a=r.sent,l.default.addMaterialType(i.technique,function(e){return new s.default(e.gl,a)});case 4:case"end":return r.stop()}},r,h)})(),"t0",7);case 7:o={type:i.technique,class:"gltf-"+e.id+"-"+t};for(u in i.values){f=i.values[u],c=e.techniques[i.technique],d=c.parameters[u],m="";for(p in c.uniforms)c.uniforms[p]===u&&(m=p);d.type!==WebGLRenderingContext.SAMPLER_2D?o[m]=i.values[u]:o[m]=r[i.values[u]]}return a.abrupt("return",o);case 10:case"end":return a.stop()}},a,this)}))}},{key:"_convertIntoTechniqueRecipe",value:function(e,t,n){return d(this,void 0,void 0,regeneratorRuntime.mark(function r(){var a,i,o,s;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=e.materials[t],i=e.techniques[a.technique],o=e.programs[i.program],r.next=5,n.loadShader(e.shaders[o.vertexShader]);case 5:return r.t0=r.sent,r.next=8,n.loadShader(e.shaders[o.fragmentShader]);case 8:return r.t1=r.sent,r.t2=this._asAttributeInfo(i),r.t3=this._asUniformInfo(i),r.t4={},r.t5=this._getState(i),r.t6={vertex:r.t0,fragment:r.t1,attributes:r.t2,uniforms:r.t3,macros:r.t4,states:r.t5},r.t7=[r.t6],s={passes:r.t7,drawOrder:"UseAlpha"},r.abrupt("return",{default:s});case 17:case"end":return r.stop()}},r,this)}))}},{key:"_asAttributeInfo",value:function(e){var t={};for(var n in e.attributes){var r=e.attributes[n],a=e.parameters[r];t[n]={name:n,semantic:a.semantic,type:a.type}}return t}},{key:"_asUniformInfo",value:function(e){var t={};for(var n in e.uniforms){var r=e.uniforms[n],a=e.parameters[r],i={};a.value&&(i.default=a.value),t[n]={name:n,semantic:a.semantic||"USER_VALUE",type:a.type,attributes:i}}return t}},{key:"_getState",value:function(e){var t={enable:[],functions:{blendColor:[0,0,0,0],cullFace:[WebGLRenderingContext.BACK],blendFuncSeparate:[WebGLRenderingContext.ONE,WebGLRenderingContext.ZERO,WebGLRenderingContext.ONE,WebGLRenderingContext.ZERO],blendEquationSeparate:[WebGLRenderingContext.FUNC_ADD,WebGLRenderingContext.FUNC_ADD],lineWidth:[1],frontFace:[WebGLRenderingContext.CCW],depthRange:[0,1],depthFunc:[WebGLRenderingContext.LESS]}},n=e.states;if(n.enable){var r=!0,a=!1,i=void 0;try{for(var o,s=n.enable[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;t.enable.push(u)}}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}}return t}},{key:"_parseMaterialCommon",value:function(e,t,n){var r=e.materials[t],a=r.extensions.KHR_materials_common,i=a.values;switch(a.technique){case"PHONG":case"BLINN":var o={type:"gltf-unlit",class:"gltf-"+e.id+"-"+t};return this._setAsColorOrTexture(o,n,i.ambient,"ambient","ambientTexture"),this._setAsColorOrTexture(o,n,i.diffuse,"diffuse","diffuseTexture"),this._setAsColorOrTexture(o,n,i.specular,"specular","specularTexture"),this._setAsColorOrTexture(o,n,i.specular,"specular","specularTexture"),this._setAsColorOrTexture(o,n,i.emission,"emission","emissionTexture"),o.transparency=i.transparency,o.shininess=i.shininess,o;default:throw new Error("Unsupported common material technique "+a.technique)}}},{key:"_setAsColorOrTexture",value:function(e,t,n,r,a){if(Array.isArray(n))e[r]=c.default.asColorValue(n);else{if("string"!=typeof n){if(void 0===n)return;throw new Error("Unknown type for color registration")}e[a]=t[n]}}}]),e}();t.default=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(13),s=r(o),u=n(2),l=r(u),f=n(4),c=r(f),d=n(6),m=r(d),p=n(11),h=r(p),b=n(1),y=r(b),v=n(29),_=r(v),g=n(25),w=r(g),x=n(22),T=r(x),C=n(19),O=r(C),R=n(23),S=r(R),M=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})},A=function(){function e(){a(this,e)}return i(e,null,[{key:"parseFromURL",value:function(t,n){return M(this,void 0,void 0,regeneratorRuntime.mark(function r(){var a,i,o,u,f,d,p,b,v,_,g,w,x,C,O,R,M,A,k,j,N,E,L,G,P,I,U,B,F,D,W;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return a=new s.default(n),r.next=3,a.loadGLTFFile();case 3:i=r.sent,o={},u={},f={},d={},p={},b={},v={},_={},g={},w={},r.t0=regeneratorRuntime.keys(i.buffers);case 15:if((r.t1=r.t0()).done){r.next=26;break}if(x=r.t1.value,"binary_glTF"!==x){r.next=21;break}o[x]=a.binaryGLTFBuffer,r.next=24;break;case 21:return r.next=23,a.loadBuffer(i.buffers[x].uri);case 23:o[x]=r.sent;case 24:r.next=15;break;case 26:for(C in i.bufferViews)O=i.bufferViews[C],R=o[O.buffer],u[C]=new Uint8Array(R,O.byteOffset,O.byteLength),void 0===O.target||(M=d[C]=new T.default(t,O.target,WebGLRenderingContext.STATIC_DRAW),M.update(u[C]));for(A in i.meshes)f[A]=e._parseMesh(t,i,A,d,u);k=[],j=function(e){k.push(a.loadImage(i.images[e]).then(function(t){p[e]=t}))};for(N in i.images)j(N);return r.next=33,Promise.all(k);case 33:for(E in i.textures)L=i.textures[E],G=i.samplers[L.sampler],P=b[E]=new S.default(t),P.magFilter=G.magFilter||WebGLRenderingContext.LINEAR,P.minFilter=G.minFilter||WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,P.wrapS=G.wrapS||WebGLRenderingContext.REPEAT,P.wrapT=G.wrapT||WebGLRenderingContext.REPEAT,P.update(p[L.source]);r.t2=regeneratorRuntime.keys(i.materials);case 35:if((r.t3=r.t2()).done){r.next=49;break}if(I=r.t3.value,U=i.materials[I],void 0===U.extensions||!U.extensions.KHR_materials_common){r.next=44;break}return r.next=41,h.default.parse(i,I,a,b);case 41:g[I]=r.sent,r.next=47;break;case 44:return r.next=46,h.default.parse(i,I,a,b);case 46:g[I]=r.sent;case 47:r.next=35;break;case 49:if(i.animations)for(B in i.animations)v[B]=new m.default(i,B,u);if(i.skins)for(F in i.skins)D=i.skins[F],W=i.accessors[D.inverseBindMatrices],_[F]={bindShapeMatrix:new c.default(D.bindShapeMatrix),jointNames:D.jointNames,inverseBindMatrices:new l.default(u[W.bufferView],W.count,W.componentType,y.default.asVectorSize(W.type),W.byteOffset||0,W.byteStride||0),jointMatrices:new Float32Array(16*D.jointNames.length)};return r.abrupt("return",{meshes:f,textures:b,tf:i,materials:g,animations:v,skins:_});case 52:case"end":return r.stop()}},r,this)}))}},{key:"_parseMesh",value:function(t,n,r,a,i){for(var o=n.meshes[r],s=[],u=0;u<o.primitives.length;u++){var l=new O.default(t),f=o.primitives[u],c=f.mode||WebGLRenderingContext.TRIANGLES;if(f.indices){var d=n.accessors[f.indices];l.addIndex("default",a[d.bufferView],c,d.byteOffset,d.count,d.componentType)}else{for(var m=n.accessors[f.attributes.POSITION].count,p=y.default.indexCountToBufferInfo(m),h=new T.default(t,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW),b=new p.ctor(m),v=0;v<m;v++)b[v]=v;h.update(b),l.addIndex("default",h,c,0,m,p.elementType)}var g={},x=void 0;if(!f.attributes.TEXCOORD_0){var C=n.accessors[f.attributes.POSITION],R=new T.default(t,WebGLRenderingContext.ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);R.update(new Float32Array(new ArrayBuffer(8*C.count))),g["@@UV"]=R,l.addAttributes(R,{TEXCOORD_0:{size:2}})}for(var S in f.attributes){var M=n.accessors[f.attributes[S]];g[M.bufferView]=a[M.bufferView],"POSITION"===S&&(x=M.max&&M.min?new w.default([new _.default(M.max[0],M.max[1],M.max[2]),new _.default(M.min[0],M.min[1],M.min[2])]):e._genAABB(i[M.bufferView],M.byteStride,M.byteOffset,M.count));var A={};A[S]={size:y.default.asVectorSize(M.type),type:M.componentType,stride:M.byteStride,offset:M.byteOffset},l.addAttributes(a[M.bufferView],A)}l.materialName=f.material,s.push(l)}return s}},{key:"_genAABB",value:function(e,t,n,r){for(var a=new w.default,i=new Float32Array(e.buffer,e.byteOffset),o=n;o<n+(r-1)*t;o+=t)a.expand(new _.default(i[o],i[o+1],i[o+2]));return a}}]),e}();t.default=A},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(18),s=r(o),u=n(17),l=r(u),f=n(24),c=r(f),d=function(){function e(t){a(this,e),this._rootPath=t,this.baseDirectory=this._getBaseDir(t)}return i(e,[{key:"loadGLTFFile",value:function(){var e=this;return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e._rootPath),r.responseType="arraybuffer",r.onload=function(n){for(var a=new Uint8Array(r.response),i=[103,108,84,70],o=!0,s=0;s<i.length;s++)a[s]!==i[s]&&(o=!1);var u=void 0;if(o){var l=new DataView(r.response),f=l.getUint32(8,!0),d=l.getUint32(12,!0);u=e._bufferToString(r.response.slice(20,20+d)),e.binaryGLTFBuffer=r.response.slice(20+d,f)}else u=e._bufferToString(r.response);e.tf=JSON.parse(u),e.tf.id=c.default.calcHash(u),t(e.tf)},r.onerror=function(e){},r.send()})}},{key:"loadImage",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,a=this.tf.bufferViews[r.bufferView],i=new Blob([new Uint8Array(this.binaryGLTFBuffer,a.byteOffset,a.byteLength)],{type:r.mimeType});t=window.URL.createObjectURL(i),n=!0}return this._isDataUrl(t)?this._dataUriToImage(t):l.default.resolve(n?t:this.baseDirectory+t)}},{key:"loadBuffer",value:function(e){var t=this;return this._isDataUrl(e)?new Promise(function(n,r){n(t._dataUriToArrayBuffer(e))}):new Promise(function(n,r){var a=new XMLHttpRequest;a.open("GET",t.baseDirectory+e),a.responseType="arraybuffer",a.onload=function(e){n(a.response)},a.onerror=function(n){r({message:"Loading resource at '"+(t.baseDirectory+e)+" failed. Is there resource file in dependency at correct location?'",error:n})},a.send()})}},{key:"loadShader",value:function(e){var t=e.uri,n=!1;if(e.extensions&&e.extensions.KHR_binary_glTF){var r=e.extensions.KHR_binary_glTF,a=this.tf.bufferViews[r.bufferView],i=new Blob([new Uint8Array(this.binaryGLTFBuffer,a.byteOffset,a.byteLength)],{type:"text/plain"});t=window.URL.createObjectURL(i),n=!0}return this._isDataUrl(t)?Promise.resolve(this._dataUriToText(t)):s.default.resolve(n?t:this.baseDirectory+t)}},{key:"_dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,a=new ArrayBuffer(r),i=new Uint8Array(a),o=0;o<r;o++)i[o]=n.charCodeAt(o);return a}},{key:"_dataUriToImage",value:function(e){var t=this;return new Promise(function(n,r){var a=document.createElement("canvas"),i=(a.getContext("2d"),new Image);i.src=e,i.onload=function(){n(t._ensureCorrectSize(i))}})}},{key:"_dataUriToText",value:function(e){var t=e.split(","),n=atob(t[1]);return n}},{key:"_ensureCorrectSize",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=Math.pow(2,Math.ceil(Math.log(e.width)/Math.LN2)),a=Math.pow(2,Math.ceil(Math.log(e.height)/Math.LN2));return r===e.width&&a==e.height?e:(t.width=r,t.height=a,n.drawImage(e,0,0,e.width,e.height,0,0,r,a),t)}},{key:"_bufferToString",value:function(e){for(var t="",n=1024,r=0;r<e.byteLength;r+=n)t+=this._smallBufferToString(new Uint8Array(e.slice(r,r+n)));return t}},{key:"_smallBufferToString",value:function(e){return String.fromCharCode.apply("",e)}},{key:"_isDataUrl",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"_getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=d},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.MaterialFactory},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=t.GLTFMaterilFactory=function e(){n(this,e)};t.default=new r},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n(9),i=r(a),o=n(8),s=r(o),u=n(10),l=r(u),f=n(30),c=r(f),d=n(14),m=r(d),p=n(21),h=r(p),b=n(31),y=r(b),v=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}u((r=r.apply(e,t||[])).next())})};t.default=function(){c.default.register(function(){return v(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c.default.registerComponent("GLTFModel",l.default),c.default.registerComponent("GLTFAnimation",s.default),c.default.registerComponent("GLTFJoint",i.default),c.default.registerNode("model",["GLTFModel"],{},"object"),c.default.registerNode("gltf-mesh",[],{material:"new(gltf-unlit)"},"mesh"),c.default.registerNode("gltf-joint",["GLTFJoint"],{},"object"),c.default.registerNode("gltf-assets",[],{}),c.default.registerNode("gltf-animation",["GLTFAnimation"],{}),m.default.addSORTMaterial("gltf-unlit",y.default),h.default.add("JOINTMATRIX",function(e,t){return t.addArgument("boneMatrices",{converter:"Object",default:null}),function(n,r){t.arguments.boneMatrices&&n.uniformMatrixArray(e.name,t.arguments.boneMatrices)}});case 10:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.ImageResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.TextFileResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Geometry.Geometry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.Material},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.UniformResolverRegistry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Buffer},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Texture2D},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Util.HashCalculator;
},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.AABB},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.GLM},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t){e.exports='@Pass{\n@BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\n@ExposeMacro(int,boneCount,BONE_COUNT,0)\nFS_PREC(mediump,float)\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n#if BONE_COUNT > 0\n  @JOINTMATRIX\n  uniform mat4 boneMatrices[BONE_COUNT];\n#endif\n  @NORMAL\n  attribute vec3 normal;\n  @POSITION\n  attribute vec3 position;\n  @TEXCOORD_0\n  attribute vec2 texCoord;\n#if BONE_COUNT > 0\n  @JOINT\n  attribute vec4 joint;\n  @WEIGHT\n  attribute vec4 weight;\n#endif\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n  void main(){\n    mat4 transform = _matM;\n    mat4 projectionTransform = _matPVM;\n    #if BONE_COUNT > 0\n      mat4 skinMat = weight.x * boneMatrices[int(joint.x)] + weight.y * boneMatrices[int(joint.y)] + weight.z * boneMatrices[int(joint.z)] + weight.w * boneMatrices[int(joint.w)];\n      transform *= skinMat;\n      projectionTransform *= skinMat;\n    #endif\n    vUV = texCoord;\n    vNormal = normalize((transform * vec4(normal,0.0)).xyz);\n    vPosition = (transform * vec4(position,1.0)).xyz;\n    gl_Position = projectionTransform * vec4(position,1.0);\n  }\n\n\n#endif\n\n\n#ifdef FS\n\n  @{type:"color",default:"black"}\n  uniform vec3 ambient;\n\n  uniform sampler2D ambientTexture;\n\n  @HAS_TEXTURE{sampler:"ambientTexture"}\n  uniform bool ambientTextureUsed;\n\n  @{type:"color",default:"black"}\n  uniform vec4 diffuse;\n\n  uniform sampler2D diffuseTexture;\n\n  @HAS_TEXTURE{sampler:"diffuseTexture"}\n  uniform bool diffuseTextureUsed;\n\n  @{type:"color",default:"black"}\n  uniform vec3 specular;\n\n  uniform sampler2D specularTexture;\n\n  @HAS_TEXTURE{sampler:"specularTexture"}\n  uniform bool specularTextureUsed;\n\n  @{type:"color",default:"black"}\n  uniform vec3 emission;\n\n  uniform sampler2D emissionTexture;\n\n  @HAS_TEXTURE{sampler:"emissionTexture"}\n  uniform bool emissionTextureUsed;\n\n  @{default:"1.0"}\n  uniform float shininess;\n\n  @{default:"1.0"}\n  uniform float transparency;\n\n  uniform vec3 _cameraPosition;\n\n  @{default:"n(1,1,-1)"}\n  uniform vec3 sunDir;\n\n  void main(){\n    vec4 dColor = vec4(0);\n    vec3 sColor = vec3(0);\n    vec3 eColor = vec3(0);\n    vec3 aColor = vec3(0);\n    vec3 hVec = normalize(normalize(_cameraPosition - vPosition) + sunDir);\n    if(ambientTextureUsed){\n      aColor = texture2D(ambientTexture,vUV).rgb;\n    }else{\n      aColor = ambient;\n    }\n    if(diffuseTextureUsed){\n      dColor = texture2D(diffuseTexture,vUV);\n    }else{\n      dColor = diffuse;\n    }\n    dColor.rgb = dot(sunDir,vNormal) * dColor.rgb;\n    if(specularTextureUsed){\n      sColor = texture2D(specularTexture,vUV).rgb;\n    }else{\n      sColor = specular;\n    }\n    if(emissionTextureUsed){\n      eColor = texture2D(emissionTexture,vUV).rgb;\n    }else{\n      eColor = emission;\n    }\n    sColor = sColor * pow(max(0.,dot(hVec,vNormal)),shininess);\n    gl_FragColor.rgb = dColor.rgb + sColor + eColor + aColor;\n    gl_FragColor.a = dColor.a * transparency;\n  }\n#endif\n}\n'}])});
//# sourceMappingURL=grimoire-gltf.min.js.map