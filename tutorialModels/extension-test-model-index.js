// TODO: Since the let variable of the external file cannot be referenced from the ES6 module in Safari, I temporarily changed it back to var.
//let TutorialExtensionTestModelIndex = {};
var TutorialExtensionTestModelIndex = {};

TutorialExtensionTestModelIndex.List = [
    {category:'tutorialModels', name:'ABeautifulGame', screenshot:'screenshot/screenshot.jpg', scale:8},
    {category:'tutorialModels', name:'AnimateAllTheThings', screenshot:'screenshot/screenshot.jpg', scale:0.5},
    {category:'tutorialModels', name:'AnimatedColorsCube', screenshot:'screenshot/screenshot.gif', scale:0.5},
    {category:'tutorialModels', name:'AnimatedWaterfall', screenshot:'screenshot/screenshot.jpg', scale:0.5},
    {category:'tutorialModels', name:'AnimationPointerUVs', screenshot:'screenshot/screenshot.jpg', scale:0.3},
    {category:'tutorialModels', name:'AnisotropyBarnLamp', screenshot:'screenshot/screenshot.jpg', scale:10},
    {category:'tutorialModels', name:'AnisotropyDiscTest', screenshot:'screenshot/screenshot.jpg', scale:0.5},
    {category:'tutorialModels', name:'AnisotropyRotationTest', screenshot:'screenshot/screenshot.png', scale:0.5},
    {category:'tutorialModels', name:'AnisotropyStrengthTest', screenshot:'screenshot/screenshot.png', scale:0.3},
    {category:'tutorialModels', name:'AttenuationTest', screenshot:'screenshot/screenshot.jpg', scale:0.2},
    {category:'tutorialModels', name:'CarbonFibre', screenshot:'screenshot/screenshot.jpg', scale:2},
    {category:'tutorialModels', name:'CarbonFrameBike', screenshot:'screenshot/screenshot.png', scale:1},
    {category:'tutorialModels', name:'CarConcept', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'ChairDamaskPurplegold', screenshot:'screenshot/screenshot.jpg', scale:3},
    {category:'tutorialModels', name:'ClearCoatCarPaint', screenshot:'screenshot/screenshot.jpg', scale:2},
    {category:'tutorialModels', name:'ClearCoatTest', screenshot:'screenshot/screenshot.jpg', scale:0.3},
    {category:'tutorialModels', name:'ClearcoatWicker', screenshot:'screenshot/screenshot.jpg', scale:2},
    {category:'tutorialModels', name:'DiffuseTransmissionPlant', screenshot:'screenshot/screenshot.jpg', scale:3},
    {category:'tutorialModels', name:'DiffuseTransmissionTeacup', screenshot:'screenshot/screenshot.jpg', scale:10},
    {category:'tutorialModels', name:'DirectionalLight', screenshot:'screenshot/screenshot.png', scale:5},
    {category:'tutorialModels', name:'DispersionTest', screenshot:'screenshot/screenshot.png', scale:20},
    {category:'tutorialModels', name:'DragonAttenuation', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'DragonAttenuation-MaterialAnimation', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'DragonDispersion', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'EmissiveStrengthTest', screenshot:'screenshot/screenshot.jpg', scale:0.3},
    {category:'tutorialModels', name:'EmissiveFireflies', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'EnvironmentTest', screenshot:'screenshot/screenshot.jpg', scale:0.3},
    {category:'tutorialModels', name:'GlamVelvetSofa', screenshot:'screenshot/screenshot.jpg', scale:2},
    {category:'tutorialModels', name:'GlassBrokenWindow', screenshot:'screenshot/screenshot.jpg', scale:4},
    {category:'tutorialModels', name:'GlassHurricaneCandleHolder', screenshot:'screenshot/screenshot.jpg', scale:5},
    {category:'tutorialModels', name:'GlassVaseFlowers', screenshot:'screenshot/screenshot.jpg', scale:10},
    {category:'tutorialModels', name:'IORTestGrid', screenshot:'screenshot/screenshot.jpg', scale:5},
    {category:'tutorialModels', name:'IridescenceAbalone', screenshot:'screenshot/screenshot.jpg', scale:15},
    {category:'tutorialModels', name:'IridescenceDielectricSpheres', screenshot:'screenshot/screenshot.jpg', scale:0.1},
    {category:'tutorialModels', name:'IridescenceLamp', screenshot:'screenshot/screenshot.jpg', scale:4},
    {category:'tutorialModels', name:'IridescenceMetallicSpheres', screenshot:'screenshot/screenshot.jpg', scale:0.1},
    {category:'tutorialModels', name:'IridescenceSuzanne', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'IridescentDishWithOlives', screenshot:'screenshot/screenshot.jpg', scale:8},
    {category:'tutorialModels', name:'Lights', screenshot:'screenshot/screenshot.png', scale:1},
    {category:'tutorialModels', name:'LightsPunctualLamp', screenshot:'screenshot/screenshot.png', scale:1},
    {category:'tutorialModels', name:'MandarinOrange', screenshot:'screenshot/screenshot.jpg', scale:150},
    {category:'tutorialModels', name:'MaterialsVariantsChair', screenshot:'screenshot/screenshot.jpg', scale:0.7},
    {category:'tutorialModels', name:'MaterialsVariantsShoe', screenshot:'screenshot/screenshot.jpg', scale:10},
    {category:'tutorialModels', name:'MosquitoInAmber', screenshot:'screenshot/screenshot.jpg', scale:30},
    {category:'tutorialModels', name:'PointLightIntensityTest', screenshot:'screenshot/screenshot.jpg', scale:0.5},
    {category:'tutorialModels', name:'PotOfCoals', screenshot:'screenshot/screenshot.jpg', scale:30},
    {category:'tutorialModels', name:'PotOfCoalsAnimationPointer', screenshot:'screenshot/screenshot.jpg', scale:30},
    {category:'tutorialModels', name:'SheenChair', screenshot:'screenshot/screenshot.jpg', scale:3},
    {category:'tutorialModels', name:'SheenCloth', screenshot:'screenshot/screenshot.jpg', scale:50},
    {category:'tutorialModels', name:'SheenTestGrid', screenshot:'screenshot/screenshot.jpg', scale:5},
    {category:'tutorialModels', name:'SpecGlossVsMetalRough', screenshot:'screenshot/screenshot.jpg', scale:10},
    {category:'tutorialModels', name:'SpecularSilkPouf', screenshot:'screenshot/screenshot.jpg', scale:5},
    {category:'tutorialModels', name:'SpecularTest', screenshot:'screenshot/screenshot.jpg', scale:5},
    {category:'tutorialModels', name:'StainedGlassLamp', screenshot:'screenshot/screenshot.jpg', scale:3},
    {category:'tutorialModels', name:'SunglassesKhronos', screenshot:'screenshot/screenshot.jpg', scale:20},
    {category:'tutorialModels', name:'TeapotsGalore', screenshot:'screenshot/screenshot.jpg', scale:0.1},
    {category:'tutorialModels', name:'TextureTransformTest', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'TextureTransformMultiTest', screenshot:'screenshot/screenshot.jpg', scale:1},
    {category:'tutorialModels', name:'ToyCar', screenshot:'screenshot/screenshot.jpg', scale:100},
    {category:'tutorialModels', name:'ToyCarSpecular', screenshot:'screenshot/screenshot.jpg', scale:10},
    {category:'tutorialModels', name:'TransmissionRoughnessTest', screenshot:'screenshot/screenshot.jpg', scale:3},
    {category:'tutorialModels', name:'TransmissionTest', screenshot:'screenshot/screenshot.jpg', scale:3},
    {category:'tutorialModels', name:'TransmissionThinwallTestGrid', screenshot:'screenshot/screenshot.jpg', scale:0.2},
    {category:'tutorialModels', name:'UnlitTest', screenshot:'screenshot/screenshot.png', scale:1},
    {category:'tutorialModels', name:'XmpMetadataRoundedCube', screenshot:'screenshot/screenshot.jpg', scale:0.1},
];

TutorialExtensionTestModelIndex.getScreenshot = function(name) {
    const model = this.List.find(model => model.name === name);
    const defaultScreenshot = 'screenshot/screenshot.png';
    return model ? `${name}/${model.screenshot || defaultScreenshot}` : `${name}/${defaultScreenshot}`;
};

TutorialExtensionTestModelIndex.getModelInfoCollection = function() {
    let numModels = TutorialExtensionTestModelIndex.List.length;
    let modelInfoCollection = {};
    for (let i = 0; i < numModels; ++i) {
        let category = TutorialExtensionTestModelIndex.List[i].category;
        let name = TutorialExtensionTestModelIndex.List[i].name;
        let scale = TutorialExtensionTestModelIndex.List[i].scale;
        modelInfoCollection[name] = {
            category: category,
            name: name,
            scale: scale
        };
    }
    return modelInfoCollection;
}

TutorialExtensionTestModelIndex.getCurrentModel = function() {
    let modelInfoCollection = TutorialExtensionTestModelIndex.getModelInfoCollection();
    let queryString = window.location.search.substring(1);
    let parts = queryString.replace(/\+/g, '%20').split('&');
    let options = {};
    for (let i = 0, len = parts.length; i < len; ++i) {
        let subparts = parts[i].split('=');

        let name = decodeURIComponent(subparts[0]);
        let value = subparts[1];
        if (value) {
            options[name] = decodeURIComponent(value);
        }
    }
    if (options.type === undefined) {
        options.type = 'glTF';
    }
    if (options.model && modelInfoCollection.hasOwnProperty(options.model)) {
        document.title += ' + ' + options.model + '.gltf';
        if (options.scale !== undefined) {
            modelInfoCollection[options.model].scale = options.scale;
        }
        if (options.variant !== undefined) {
            modelInfoCollection[options.model].variant = options.variant;
        }
        if (options.type == 'glTF-Binary' 
         || options.type == 'glTF-Draco'        && options.model == 'MorphPrimitivesTest'
         || options.type == 'glTF-Draco'        && options.model == 'CarbonFrameBike'
         || options.type == 'glTF-Draco-KTX2'   && options.model == 'CarbonFrameBike'
         || options.type == 'glTF-KTX2'         && options.model == 'CarbonFrameBike'
         || options.type == 'glTF-Meshopt'      && options.model == 'CarbonFrameBike'
         || options.type == 'glTF-Meshopt-KTX2' && options.model == 'CarbonFrameBike') {
            modelInfoCollection[options.model].path = modelInfoCollection[options.model].name + '/' + options.type + '/' + modelInfoCollection[options.model].name + '.glb';
        } else {
            modelInfoCollection[options.model].path = modelInfoCollection[options.model].name + '/' + options.type + '/' + modelInfoCollection[options.model].name + '.gltf';
        }
        return modelInfoCollection[options.model];
    }
    return undefined;
};